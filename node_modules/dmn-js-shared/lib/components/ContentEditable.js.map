{"version":3,"file":"ContentEditable.js","names":["Component","escapeHtml","getRange","setRange","applyRange","getWindowSelection","selectionUpdate","ContentEditable","constructor","props","context","state","isIE","onInputIEPolyfill","event","oldText","node","innerHTML","setTimeout","text","onInput","componentWillUpdate","newProps","newState","range","focussed","selected","innerText","componentDidUpdate","newText","newRange","onFocus","propsFocus","setState","onBlur","onChange","value","currentValue","onKeydown","which","preventDefault","ctrlForNewline","isCmd","singleLine","stopPropagation","insertLineBreak","propsInput","onKeyPress","onPaste","clipboardData","window","getData","document","execCommand","replace","getClassName","className","placeholder","join","render","label","createVNode","null","onKeypress","__html","brTag","createElement","selection","getRangeAt","cloneRange","br","deleteContents","insertNode","setStartAfter","setEndAfter","ua","navigator","userAgent","indexOf","metaKey","ctrlKey"],"sources":["../../src/components/ContentEditable.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport escapeHtml from 'escape-html';\n\nimport {\n  getRange,\n  setRange,\n  applyRange,\n  getWindowSelection\n} from 'selection-ranges';\n\nimport selectionUpdate from 'selection-update';\n\n\n/**\n * A content ediable that performs proper selection updates on\n * editable changes. It normalizes editor operations by allowing\n * only <br/> and plain text to be inserted.\n *\n * The callback `onInput(text)` recieves text (including line breaks)\n * only. Updating the value via props will update the selection\n * if needed, too.\n *\n * @example\n *\n * class SomeComponent extends Component {\n *\n *   render() {\n *     return (\n *       <ContentEditable\n *         className=\"some classes\"\n *         value={ this.state.text }\n *         onInput={ this.handleInput }\n *         onChange={ this.handleChange }\n *         onFocus={ ... }\n *         onBlur={ ... } />\n *     );\n *   }\n *\n * }\n *\n */\nexport default class ContentEditable extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.state = {};\n\n    // TODO(nikku): remove once we drop IE 11 support\n    if (isIE()) {\n\n      // onInput shim for IE <= 11\n      this.onInputIEPolyfill = (event) => {\n\n        var oldText = this.node.innerHTML;\n\n        setTimeout(() => {\n\n          var text = this.node.innerHTML;\n          if (oldText !== text) {\n            this.onInput(event);\n          }\n        }, 0);\n      };\n\n    }\n  }\n\n  componentWillUpdate(newProps, newState) {\n\n    // save old selection + text for later\n    var node = this.node;\n\n    var range = newState.focussed && getRange(node);\n\n    this.selected = range && {\n      range: range,\n      text: innerText(node)\n    };\n  }\n\n  componentDidUpdate() {\n\n    var selected = this.selected;\n\n    if (!selected) {\n      return;\n    }\n\n    // compute and restore selection based on\n    // (possibly new) text\n\n    const range = selected.range;\n    const text = selected.text;\n\n    const node = this.node;\n\n    const newText = innerText(node);\n\n    const newRange = (\n      newText !== text\n        ? selectionUpdate(range, text, newText)\n        : range\n    );\n\n    setRange(node, newRange);\n  }\n\n  onFocus = event => {\n    var propsFocus = this.props.onFocus;\n\n    this.setState({\n      focussed: true\n    });\n\n    if (typeof propsFocus === 'function') {\n      propsFocus(event);\n    }\n  };\n\n  onBlur = event => {\n    const {\n      onBlur,\n      onChange,\n      value\n    } = this.props;\n\n    this.setState({\n      focussed: false\n    });\n\n    if (typeof onChange === 'function' && this.node) {\n      const currentValue = innerText(this.node);\n\n      if (currentValue !== value) {\n        onChange(currentValue);\n      }\n    }\n\n    if (typeof onBlur === 'function') {\n      onBlur(event);\n    }\n  };\n\n  onKeydown = (event) => {\n\n    // enter\n    if (event.which === 13) {\n\n      // prevent default action (<br/> insert)\n      event.preventDefault();\n\n      if (this.props.ctrlForNewline && !isCmd(event)) {\n        return;\n      }\n\n      if (this.props.singleLine) {\n        return;\n      }\n\n      event.stopPropagation();\n\n      insertLineBreak();\n\n      this.onInput(event);\n    }\n\n  };\n\n  onInput = (event) => {\n\n    var propsInput = this.props.onInput;\n\n    if (typeof propsInput !== 'function') {\n      return;\n    }\n\n    var text = innerText(this.node);\n\n    propsInput(text);\n  };\n\n  // TODO(barmac): remove once we drop IE 11 support\n  onKeyPress = (event) => {\n    if (this.onInputIEPolyfill) {\n      this.onInputIEPolyfill(event);\n    }\n  };\n\n  onPaste = (event) => {\n\n    // TODO(barmac): remove once we drop IE 11 support\n    if (this.onInputIEPolyfill) {\n      this.onInputIEPolyfill(event);\n    }\n\n    if (this.props.singleLine) {\n      const text = (event.clipboardData || window.clipboardData).getData('text');\n\n      // replace newline with space\n      document.execCommand('insertText', false, text.replace(/\\n/g, ' '));\n      event.preventDefault();\n    }\n  };\n\n  getClassName() {\n    const {\n      className,\n      placeholder,\n      value\n    } = this.props;\n\n    return [\n      className || '',\n      'content-editable',\n      (!value && placeholder) ? 'placeholder' : ''\n    ].join(' ');\n  }\n\n  render(props) {\n\n    var {\n      label,\n      value,\n      placeholder\n    } = props;\n\n    // QUIRK: must add trailing <br/> for line\n    // breaks to properly work\n    value =\n      escapeHtml(value)\n        .replace(/\\r?\\n/g, '<br/>') + '<br/>';\n\n    return (\n      <div\n        aria-label={ label }\n        role=\"textbox\"\n        aria-multiline={ !this.props.singleLine }\n        tabIndex=\"0\"\n        className={ this.getClassName() }\n        contentEditable=\"true\"\n        spellcheck=\"false\"\n        data-placeholder={ placeholder || '' }\n        onInput={ this.onInput }\n        onKeypress={ this.onKeypress }\n        onPaste={ this.onPaste }\n        onFocus={ this.onFocus }\n        onBlur={ this.onBlur }\n        onKeydown={ this.onKeydown }\n        ref={ node => this.node = node }\n        dangerouslySetInnerHTML={ { __html: value } }></div>\n    );\n  }\n\n}\n\nfunction brTag() {\n  return document.createElement('br');\n}\n\nfunction innerText(node) {\n\n  // QUIRK: we must remove the last trailing <br/>, if any\n  return node.innerText.replace(/\\n$/, '');\n}\n\nfunction insertLineBreak() {\n\n  // insert line break at current insertation\n  // point; this assumes that the correct element, i.e.\n  // a <ContentEditable /> is currently focussed\n  var selection = getWindowSelection();\n\n  var range = selection.getRangeAt(0);\n\n  if (!range) {\n    return;\n  }\n\n  var newRange = range.cloneRange();\n\n  var br = brTag();\n\n  newRange.deleteContents();\n\n  newRange.insertNode(br);\n\n  newRange.setStartAfter(br);\n  newRange.setEndAfter(br);\n\n  applyRange(newRange);\n}\n\nfunction isIE() {\n  var ua = window.navigator.userAgent;\n\n  return (\n\n    // IE 10 or older\n    ua.indexOf('MSIE ') > 0 ||\n\n    // IE 11\n    ua.indexOf('Trident/') > 0\n  );\n}\n\nfunction isCmd(event) {\n  return event.metaKey || event.ctrlKey;\n}"],"mappings":"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","ignoreList":[]}