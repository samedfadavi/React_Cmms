import {
  A,
  O as O2,
  T,
  _ as _2,
  c as c2,
  f as f3,
  g as g3,
  h as h5,
  l,
  m as m2,
  p as p2
} from "./chunk-QXNY6GFF.js";
import {
  d as d3,
  d2 as d4,
  f as f2
} from "./chunk-QUSFRO4I.js";
import {
  i as i5
} from "./chunk-EZCD2BEA.js";
import {
  i as i3
} from "./chunk-IX2O3H2Q.js";
import {
  i as i4
} from "./chunk-SQ4YHPTM.js";
import {
  a as a5,
  f,
  y as y2
} from "./chunk-ZCZQCHTP.js";
import "./chunk-SB76Q4D6.js";
import {
  h as h4,
  r as r5,
  t as t3
} from "./chunk-ZGAEGZY4.js";
import {
  E as E2,
  r as r4,
  s as s2
} from "./chunk-55VZQ2O4.js";
import "./chunk-JYOYXNA4.js";
import {
  a as a4,
  g as g2,
  i as i2,
  u as u2
} from "./chunk-6XHWVKUJ.js";
import {
  o as o2
} from "./chunk-MUBZ333A.js";
import {
  p
} from "./chunk-FHON4NYJ.js";
import {
  D as D2,
  ae,
  se,
  v
} from "./chunk-X5IXAJYK.js";
import {
  S as S2,
  g
} from "./chunk-CCWDVTAF.js";
import "./chunk-HDF4ZNLN.js";
import "./chunk-OXVX5F4E.js";
import "./chunk-QBIZASGH.js";
import "./chunk-TLURKUXV.js";
import {
  E
} from "./chunk-235Z7ZG7.js";
import "./chunk-JSBYWL75.js";
import {
  c2 as c,
  e2
} from "./chunk-4ZTHXCOS.js";
import {
  a as a3
} from "./chunk-TCGVPS3X.js";
import "./chunk-A2WMIQD6.js";
import "./chunk-GRVB2MLZ.js";
import "./chunk-G44Z4LKI.js";
import "./chunk-LXZ5X57H.js";
import {
  D,
  L,
  O,
  P as P2,
  R,
  U
} from "./chunk-POOHJZAR.js";
import "./chunk-F54TE5DA.js";
import "./chunk-ZPZCSP4J.js";
import "./chunk-5YPRHJQA.js";
import "./chunk-ZVC7ZICV.js";
import "./chunk-UH2ZCS4D.js";
import {
  mt
} from "./chunk-UF7MKJFM.js";
import "./chunk-2RHJP66D.js";
import "./chunk-4C2THXV6.js";
import {
  e as e3
} from "./chunk-XMJZJ562.js";
import {
  t as t2
} from "./chunk-OELB7RPX.js";
import "./chunk-AKR4324J.js";
import {
  m,
  r as r3
} from "./chunk-VVQOSOJY.js";
import {
  h as h3
} from "./chunk-WI6OODG3.js";
import "./chunk-GQ3ZCFNN.js";
import "./chunk-QKCF7BZB.js";
import "./chunk-2U77OHLU.js";
import {
  t
} from "./chunk-O45ZPWWN.js";
import "./chunk-VXVUW2QY.js";
import "./chunk-H6PZORTK.js";
import {
  a as a2
} from "./chunk-TNRF7MOE.js";
import {
  M,
  b as b2,
  h,
  i,
  o,
  r as r2
} from "./chunk-PNPG5IXD.js";
import "./chunk-CYGO6TZX.js";
import {
  h as h2
} from "./chunk-6V4RA3W6.js";
import "./chunk-YJXOPMOL.js";
import "./chunk-P3MZKJDB.js";
import "./chunk-JWA73VK6.js";
import {
  z
} from "./chunk-JFTJTGUT.js";
import "./chunk-4N73DVTU.js";
import "./chunk-QUNQAVSE.js";
import "./chunk-EGMIKFPM.js";
import "./chunk-44DGTEO5.js";
import "./chunk-URNMKNS6.js";
import "./chunk-3QWMYL5A.js";
import "./chunk-ITGBXG45.js";
import "./chunk-IGNUVZ34.js";
import "./chunk-YUQFVZCH.js";
import "./chunk-TQBRYTUC.js";
import "./chunk-T4EIRKFE.js";
import "./chunk-RTULPMO3.js";
import "./chunk-AJ6PR43V.js";
import "./chunk-6LV4OO46.js";
import "./chunk-JQIB7GFW.js";
import {
  d as d2
} from "./chunk-CJJCN7PA.js";
import "./chunk-IJUFAIOF.js";
import "./chunk-MNMU4ARP.js";
import "./chunk-7OW2VNCC.js";
import "./chunk-AFBYZF6Q.js";
import "./chunk-IJ42YN7D.js";
import "./chunk-4AGGGL2W.js";
import "./chunk-FJPG3YI6.js";
import "./chunk-BJHLU2MM.js";
import "./chunk-E5KBRIJQ.js";
import "./chunk-Z32PAECZ.js";
import "./chunk-TW7VY7XV.js";
import "./chunk-CAC7FEOV.js";
import "./chunk-KK4UI5LV.js";
import "./chunk-BL2UGYYZ.js";
import "./chunk-Q4D7WYWB.js";
import "./chunk-NYWHVRZC.js";
import "./chunk-ZH4RVBER.js";
import "./chunk-UGXIDNPX.js";
import "./chunk-FADA7L64.js";
import "./chunk-YTTIKQNA.js";
import "./chunk-PNUUOKAJ.js";
import {
  C,
  P,
  d
} from "./chunk-7PMYO342.js";
import "./chunk-4K4GIBGP.js";
import "./chunk-WMMHQ2SA.js";
import "./chunk-AZ7WOCBW.js";
import "./chunk-3DBICPHD.js";
import "./chunk-7R5XEKR3.js";
import "./chunk-ZK4LSXOH.js";
import "./chunk-XFBTC3BA.js";
import "./chunk-XFU3BDEI.js";
import "./chunk-IZXTMJPP.js";
import "./chunk-5MMVRBZL.js";
import "./chunk-RS5OZZZ5.js";
import "./chunk-VRHSV3YE.js";
import "./chunk-OVORXUCO.js";
import "./chunk-WLUQPLAY.js";
import "./chunk-BTSZKQPH.js";
import {
  u
} from "./chunk-AL3F322A.js";
import "./chunk-6N5YXCNN.js";
import "./chunk-MJ2NSPP7.js";
import "./chunk-6YSPJNLC.js";
import {
  _,
  w
} from "./chunk-66KCMKB5.js";
import "./chunk-ZART2Y5J.js";
import "./chunk-F4OBDVPS.js";
import "./chunk-X3IFQMC4.js";
import "./chunk-4ZEH5SNV.js";
import "./chunk-Z6R2SP3D.js";
import "./chunk-K4UOG562.js";
import "./chunk-WC4SPMPL.js";
import {
  S,
  y
} from "./chunk-TJUEGVVG.js";
import "./chunk-FXNOKZ3B.js";
import {
  a3 as a
} from "./chunk-GEH2VXFC.js";
import {
  e
} from "./chunk-BJY5ADVY.js";
import {
  b,
  k
} from "./chunk-VMWKLHJD.js";
import {
  r
} from "./chunk-5AEITAWU.js";
import "./chunk-G36SOMYZ.js";
import {
  n2 as n,
  s2 as s
} from "./chunk-YNL57W4I.js";
import "./chunk-2PA5UPTB.js";
import "./chunk-XZXEUADC.js";

// ../node_modules/@arcgis/core/views/2d/engine/imagery/RasterBitmap.js
var p3 = { bandCount: 3, outMin: 0, outMax: 1, minCutOff: [0, 0, 0], maxCutOff: [255, 255, 255], factor: [1 / 255, 1 / 255, 1 / 255], useGamma: false, gamma: [1, 1, 1], gammaCorrection: [1, 1, 1], colormap: null, colormapOffset: null, stretchType: "none", type: "stretch" };
var _3 = class extends s2 {
  constructor(e17 = null, t6 = null, s19 = null) {
    super(), this._textureInvalidated = true, this._colormapTextureInvalidated = true, this._rasterTexture = null, this._rasterTextureBandIds = null, this._transformGridTexture = null, this._colormapTexture = null, this._colormap = null, this._supportsBilinearTexture = true, this._processedTexture = null, this.functionTextures = [], this.projected = false, this.stencilRef = 0, this.coordScale = [1, 1], this._processed = false, this._symbolizerParameters = null, this.height = null, this.isRendereredSource = false, this.pixelRatio = 1, this.resolution = 0, this.rotation = 0, this._source = null, this.rawPixelData = null, this._suspended = false, this._bandIds = null, this._interpolation = null, this._transformGrid = null, this.width = null, this.x = 0, this.y = 0, this.source = e17, this.transformGrid = t6, this.interpolation = s19;
  }
  destroy() {
    this._disposeTextures();
  }
  get processedTexture() {
    return this._processedTexture;
  }
  set processedTexture(e17) {
    this._processedTexture !== e17 && (this._disposeTextures(true), this._processedTexture = e17);
  }
  get rasterTexture() {
    return this._rasterTexture;
  }
  set rasterTexture(e17) {
    var _a;
    this._rasterTexture !== e17 && ((_a = this._rasterTexture) == null ? void 0 : _a.dispose(), this._rasterTexture = e17), null == e17 && (this.projected = false);
  }
  get processed() {
    return this._processed;
  }
  set processed(t6) {
    this._processed = t6, t6 || (r(this.processedTexture), this.invalidateTexture());
  }
  get symbolizerParameters() {
    return this._symbolizerParameters || p3;
  }
  set symbolizerParameters(e17) {
    this._symbolizerParameters !== e17 && (this._symbolizerParameters = e17, this._colormapTextureInvalidated = true, this.commonUniforms = null);
  }
  get source() {
    return this._source;
  }
  set source(e17) {
    this._source !== e17 && (this._source = e17, this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this.commonUniforms = null, this.projected = false, this.invalidateTexture());
  }
  get suspended() {
    return this._suspended;
  }
  set suspended(e17) {
    this._suspended && !e17 && this.stage && (this.ready(), this.requestRender()), this._suspended = e17;
  }
  get bandIds() {
    return this._bandIds;
  }
  set bandIds(e17) {
    this._bandIds = e17, this._isBandIdsChanged(e17) && (this.projected = false, this.invalidateTexture());
  }
  get interpolation() {
    return this._interpolation || "nearest";
  }
  set interpolation(e17) {
    this._interpolation = e17, this._rasterTexture && this._rasterTexture.setSamplingMode("bilinear" === this._getTextureSamplingMethod(e17 || "nearest") ? L.LINEAR : L.NEAREST);
  }
  get transformGrid() {
    return this._transformGrid;
  }
  set transformGrid(t6) {
    this._transformGrid !== t6 && (this._transformGrid = t6, this._transformGridTexture = r(this._transformGridTexture));
  }
  invalidateTexture() {
    this._textureInvalidated || (this._textureInvalidated = true, this.requestRender());
  }
  getRasterTextureSize(e17 = false) {
    var _a, _b;
    const t6 = e17 || this.projected;
    return [t6 ? this.width : ((_a = this.source) == null ? void 0 : _a.width) || this.width, t6 ? this.height : ((_b = this.source) == null ? void 0 : _b.height) || this.height];
  }
  getRasterCellSize() {
    var _a;
    const e17 = (_a = this.rawPixelData) == null ? void 0 : _a.srcPixelSize, { projected: t6, resolution: s19 } = this;
    return e17 && !t6 ? [e17.x, e17.y] : [s19, s19];
  }
  _createTransforms() {
    return { displayViewScreenMat3: e3() };
  }
  setTransform(e17) {
    const a23 = o(this.transforms.displayViewScreenMat3), [h7, n22] = e17.toScreenNoRotation([0, 0], [this.x, this.y]), l3 = this.resolution / this.pixelRatio / e17.resolution, d5 = l3 * this.width, c5 = l3 * this.height, p4 = Math.PI * this.rotation / 180;
    M(a23, a23, t(h7, n22)), M(a23, a23, t(d5 / 2, c5 / 2)), h(a23, a23, -p4), M(a23, a23, t(-d5 / 2, -c5 / 2)), b2(a23, a23, t(d5, c5)), i(this.transforms.displayViewScreenMat3, e17.displayViewMat3, a23);
  }
  getTextures({ forProcessing: e17 = false, useProcessedTexture: t6 = false } = {}) {
    const s19 = t6 ? this._processedTexture ?? this._rasterTexture : this._rasterTexture, r15 = [], i11 = [];
    return s19 ? (this._transformGridTexture && !this.projected && (i11.push(this._transformGridTexture), r15.push("u_transformGrid")), t6 ? (i11.push(s19), r15.push("u_image"), this._colormapTexture && (i11.push(this._colormapTexture), r15.push("u_colormap")), { names: r15, textures: i11 }) : (i11.push(s19), r15.push("u_image"), this._colormapTexture && !e17 && (i11.push(this._colormapTexture), r15.push("u_colormap")), { names: r15, textures: i11 })) : { names: r15, textures: i11 };
  }
  onAttach() {
    this.invalidateTexture();
  }
  onDetach() {
    this.invalidateTexture();
  }
  updateTexture({ context: e17 }) {
    if (!this.stage) return void this._disposeTextures();
    const t6 = this._isValidSource(this.source);
    t6 && this._colormapTextureInvalidated && (this._colormapTextureInvalidated = false, this._updateColormapTexture(e17)), this._textureInvalidated && (this._textureInvalidated = false, this._createOrDestroyRasterTexture(e17), this._rasterTexture && (t6 ? this.transformGrid && !this._transformGridTexture && (this._transformGridTexture = c2(e17, this.transformGrid)) : this._rasterTexture.setData(null)), this.suspended || (this.ready(), this.requestRender()));
  }
  updateProcessedTexture() {
    const { functionTextures: e17 } = this;
    0 !== e17.length && (this.processedTexture = e17.shift(), e17.forEach((e18) => e18 == null ? void 0 : e18.dispose()), e17.length = 0);
  }
  _createOrDestroyRasterTexture(e17) {
    var _a;
    const t6 = (_a = this.source) == null ? void 0 : _a.extractBands(this.bandIds);
    if (!this._isValidSource(t6)) return void (this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null));
    const s19 = !this._isBandIdsChanged(this.bandIds);
    if (this._rasterTexture) {
      if (s19) return;
      this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null;
    }
    this._supportsBilinearTexture = !!e17.capabilities.textureFloatLinear;
    const r15 = this._getTextureSamplingMethod(this.interpolation), i11 = this.isRendereredSource;
    this._rasterTexture = f3(e17, t6, r15, i11), this.projected = false, this._processed = false, this._rasterTextureBandIds = this.bandIds ? [...this.bandIds] : null;
  }
  _isBandIdsChanged(e17) {
    const t6 = this._rasterTextureBandIds;
    return !(null == t6 && null == e17 || t6 && e17 && t6.join("") === e17.join(""));
  }
  _isValidSource(e17) {
    var _a;
    return null != e17 && ((_a = e17.pixels) == null ? void 0 : _a.length) > 0;
  }
  _getTextureSamplingMethod(e17) {
    const { type: t6 } = this.symbolizerParameters, s19 = "lut" === t6 || "hillshade" === t6 || "stretch" === t6 && 1 === this.symbolizerParameters.bandCount;
    return !this._supportsBilinearTexture || s19 || "bilinear" !== e17 && "cubic" !== e17 ? "nearest" : "bilinear";
  }
  _updateColormapTexture(e17) {
    const t6 = this._colormap, s19 = this.symbolizerParameters.colormap;
    return s19 ? t6 ? s19.length !== t6.length || s19.some((e18, s20) => e18 !== t6[s20]) ? (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), this._colormapTexture = m2(e17, s19), void (this._colormap = s19)) : void 0 : (this._colormapTexture = m2(e17, s19), void (this._colormap = s19)) : (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), void (this._colormap = null));
  }
  _disposeTextures(e17 = false) {
    !this._transformGridTexture || e17 && !this.projected || (this._transformGridTexture.dispose(), this._transformGridTexture = null), !e17 && this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null, this._colormap = null, this._colormapTextureInvalidated = true), !e17 && this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this._processedTexture && (this._processedTexture.dispose(), this._processedTexture = null);
  }
};
function m3(e17) {
  return null != e17.source;
}

// ../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/utils.js
function i6(i11) {
  const n22 = [];
  return i11 && (n22.push("applyProjection"), 1 === i11.spacing[0] && n22.push("lookupProjection")), n22;
}
function n2(i11, n22, e17) {
  const u5 = !e17.capabilities.textureFloatLinear, t6 = [];
  return "cubic" === i11 ? t6.push("bicubic") : "bilinear" === i11 && (n22 ? (t6.push("bilinear"), t6.push("nnedge")) : u5 && t6.push("bilinear")), t6;
}

// ../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/lut.js
var s3 = { vsPath: "raster/common", fsPath: "raster/lut", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a6(t6, e17, o11) {
  const a23 = o11 ? [] : i6(e17.transformGrid);
  return { defines: a23, program: t6.painter.materialManager.getProgram(s3, a23) };
}
function n3(r15, s19, a23, n22, m7 = false) {
  const { names: i11, textures: c5 } = a23.getTextures({ useProcessedTexture: m7 });
  O2(r15.context, s19, i11, c5), h5(s19, n22, a23.commonUniforms), s19.setUniformMatrix3fv("u_dvsMat3", a23.transforms.displayViewScreenMat3);
  const { colormap: f4, colormapOffset: u5 } = a23.symbolizerParameters, l3 = _2(f4, u5);
  h5(s19, n22, l3);
}
var m4 = { createProgram: a6, bindTextureAndUniforms: n3 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/shadedrelief.js
var n4 = { vsPath: "raster/common", fsPath: "raster/hillshade", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function i7(e17, o11, s19) {
  const { colormap: a23 } = o11.symbolizerParameters, i11 = [...s19 ? [] : i6(o11.transformGrid), ...n2(o11.interpolation, true, e17.context)];
  null != a23 && i11.push("applyColormap");
  return { defines: i11, program: e17.painter.materialManager.getProgram(n4, i11) };
}
function m5(r15, t6, n22, i11, m7 = false) {
  const { names: c5, textures: l3 } = n22.getTextures({ useProcessedTexture: m7 });
  O2(r15.context, t6, c5, l3), h5(t6, i11, n22.commonUniforms), t6.setUniformMatrix3fv("u_dvsMat3", n22.transforms.displayViewScreenMat3);
  const f4 = n22.symbolizerParameters, { colormap: p4, colormapOffset: u5 } = f4;
  if (null != p4) {
    const r16 = _2(p4, u5);
    h5(t6, i11, r16);
  }
  const d5 = A(f4);
  h5(t6, i11, d5);
}
var c3 = { createProgram: i7, bindTextureAndUniforms: m5 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/stretch.js
var n5 = { vsPath: "raster/common", fsPath: "raster/stretch", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function i8(e17, o11, s19) {
  const { colormap: a23, bandCount: i11 } = o11.symbolizerParameters, m7 = [...s19 ? [] : i6(o11.transformGrid), ...n2(o11.interpolation, 1 === i11, e17.context)];
  o11.isRendereredSource && !s19 ? m7.push("noop") : null != a23 && m7.push("applyColormap");
  return { defines: m7, program: e17.painter.materialManager.getProgram(n5, m7) };
}
function m6(r15, t6, n22, i11, m7 = false) {
  const { names: c5, textures: l3 } = n22.getTextures({ useProcessedTexture: m7 });
  O2(r15.context, t6, c5, l3), h5(t6, i11, n22.commonUniforms), t6.setUniformMatrix3fv("u_dvsMat3", n22.transforms.displayViewScreenMat3);
  const p4 = n22.symbolizerParameters, { colormap: u5, colormapOffset: f4 } = p4;
  if (null != u5) {
    const r16 = _2(u5, f4);
    h5(t6, i11, r16);
  }
  const d5 = p2(p4);
  h5(t6, i11, d5);
}
var c4 = { createProgram: i8, bindTextureAndUniforms: m6 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/rasterColorizer.js
var s4 = /* @__PURE__ */ new Map();
function o3(t6) {
  return s4.get(t6);
}
s4.set("lut", m4), s4.set("hillshade", c3), s4.set("stretch", c4);

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/utils.js
var t4 = [1, 1];
var n6 = [2, 0, 0, 0, 2, 0, -1, -1, 0];
function a7(t6, n22, a23) {
  const { context: r15, rasterFunction: s19, hasBranches: i11 } = t6, { raster: o11 } = s19.parameters, f4 = i11 ? (o11 == null ? void 0 : o11.id) ?? -1 : 0, m7 = a23.functionTextures[f4] ?? a23.rasterTexture;
  O2(r15, n22, ["u_image"], [m7]);
}
function r6(t6, n22, r15) {
  const { rasters: s19 } = t6.rasterFunction.parameters;
  if (!s19) return;
  if (s19.length < 2) return a7(t6, n22, r15);
  const i11 = s19.filter((e17) => "Constant" !== e17.name).map((e17) => null != e17.id && "Identity" !== e17.name ? r15.functionTextures[e17.id] : r15.rasterTexture);
  if (O2(t6.context, n22, ["u_image", "u_image1", "u_image2"].slice(0, i11.length), i11), i11.length !== s19.length) {
    if (2 === s19.length) {
      const e17 = s19.findIndex((e18) => "Constant" === e18.name), t7 = 0 === e17 ? [0, 1, 0, 1, 0, 0, 0, 0, 0] : [1, 0, 0, 0, 1, 0, 0, 0, 0], { value: a23 } = s19[e17].parameters;
      n22.setUniform1f("u_image1Const", a23), n22.setUniformMatrix3fv("u_imageSwap", t7);
    } else if (3 === s19.length) {
      const e17 = [];
      if (s19.forEach((t7, n23) => "Constant" === t7.name && e17.push(n23)), 1 === e17.length) {
        const { value: t7 } = s19[e17[0]].parameters;
        n22.setUniform1f("u_image1Const", t7);
        const a23 = 0 === e17[0] ? [0, 1, 0, 0, 0, 1, 1, 0, 0] : 1 === e17[0] ? [1, 0, 0, 0, 0, 1, 0, 1, 0] : [1, 0, 0, 0, 1, 0, 0, 0, 1];
        n22.setUniformMatrix3fv("u_imageSwap", a23);
      } else if (2 === e17.length) {
        const { value: t7 } = s19[e17[0]].parameters;
        n22.setUniform1f("u_image1Const", t7);
        const { value: a23 } = s19[e17[1]].parameters;
        n22.setUniform1f("u_image2Const", a23);
        const r16 = s19.findIndex((e18) => "Constant" !== e18.name), i12 = 0 === r16 ? [1, 0, 0, 0, 1, 0, 0, 0, 1] : 1 === r16 ? [0, 1, 0, 1, 0, 0, 0, 0, 1] : [0, 0, 1, 1, 0, 0, 0, 1, 0];
        n22.setUniformMatrix3fv("u_imageSwap", i12);
      }
    }
  }
}
function s5(e17) {
  e17.setUniform2fv("u_coordScale", t4), e17.setUniformMatrix3fv("u_dvsMat3", n6);
}

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/aspectProcessor.js
var r7 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/aspect", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a8(t6, e17) {
  return t6.painter.materialManager.getProgram(r7, []);
}
function s6(r15, a23, s19) {
  a7(r15, a23, s19), s5(a23);
  const n22 = s19.getRasterTextureSize();
  a23.setUniform2fv("u_srcImageSize", n22);
  const o11 = s19.getRasterCellSize();
  a23.setUniform2fv("u_cellSize", o11);
}
var n7 = { createProgram: a8, bindTextureAndUniforms: s6 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/bandArithmeticProcessor.js
var a9 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/bandarithmetic", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e4(t6, r15) {
  const { painter: e17, rasterFunction: n22 } = t6, { indexType: s19 } = n22.parameters;
  return e17.materialManager.getProgram(a9, [s19]);
}
function n8(a23, e17, n22) {
  a7(a23, e17, n22), s5(e17);
  const { bandIndexMat3: s19 } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", s19);
}
var s7 = { createProgram: e4, bindTextureAndUniforms: n8 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/compositeBandProcessor.js
var n9 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/compositeband", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a10(t6, r15) {
  const a23 = t6.rasterFunction.parameters.rasters.filter((t7) => "Constant" === t7.name), e17 = [];
  return a23.length && (e17.push("oneConstant"), 2 === a23.length && e17.push("twoConstant")), t6.painter.materialManager.getProgram(n9, e17);
}
function e5(n22, a23, e17) {
  r6(n22, a23, e17), s5(a23);
}
var s8 = { createProgram: a10, bindTextureAndUniforms: e5 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/computeChangeProcessor.js
var n10 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/computechange", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function r8(t6) {
  const { painter: e17, rasterFunction: r15 } = t6, { method: a23, rasters: s19, isOutputRounded: o11 } = r15.parameters, i11 = [a23.includes("-") ? a23.slice(0, a23.indexOf("-")) : a23];
  return s19.filter((t7) => "Constant" === t7.name).length && i11.push("oneConstant"), o11 && i11.push("roundOutput"), e17.materialManager.getProgram(n10, i11);
}
function a11(n22, r15, a23) {
  r6(n22, r15, a23), s5(r15);
  const { domainRange: s19 } = n22.rasterFunction.parameters;
  r15.setUniform2fv("u_domainRange", s19);
}
var s9 = { createProgram: r8, bindTextureAndUniforms: a11 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/contrastProcessor.js
var s10 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/contrast", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e6(t6, r15) {
  return t6.painter.materialManager.getProgram(s10, []);
}
function a12(s19, e17, a23) {
  a7(s19, e17, a23), s5(e17);
  const { contrastOffset: n22, brightnessOffset: o11 } = s19.rasterFunction.parameters;
  e17.setUniform1f("u_contrastOffset", n22), e17.setUniform1f("u_brightnessOffset", o11);
}
var n11 = { createProgram: e6, bindTextureAndUniforms: a12 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/convolutionProcessor.js
var t5 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/convolution", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a13(e17, r15) {
  const { painter: a23, rasterFunction: n22 } = e17, { kernelRows: o11, kernelCols: s19 } = n22.parameters, i11 = [{ name: "rows", value: o11 }, { name: "cols", value: s19 }];
  return a23.materialManager.getProgram(t5, i11);
}
function n12(t6, a23, n22) {
  a7(t6, a23, n22), s5(a23), a23.setUniform2fv("u_srcImageSize", [n22.width, n22.height]);
  const { kernel: o11, clampRange: s19 } = t6.rasterFunction.parameters;
  a23.setUniform1fv("u_kernel", o11), a23.setUniform2fv("u_clampRange", s19);
}
var o4 = { createProgram: a13, bindTextureAndUniforms: n12 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/curvatureProcessor.js
var e7 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/curvature", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function a14(r15, t6) {
  const { painter: a23, rasterFunction: s19 } = r15, { curvatureType: n22 } = s19.parameters, o11 = [n22];
  return a23.materialManager.getProgram(e7, o11);
}
function s11(e17, a23, s19) {
  a7(e17, a23, s19), s5(a23);
  const n22 = s19.getRasterTextureSize();
  a23.setUniform2fv("u_srcImageSize", n22);
  const { zFactor: o11 } = e17.rasterFunction.parameters, i11 = s19.getRasterCellSize();
  a23.setUniform1f("u_zlFactor", 200 * o11 / i11[0] / i11[1]);
}
var n13 = { createProgram: a14, bindTextureAndUniforms: s11 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/extractBandProcessor.js
var a15 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/extractband", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e8(t6, r15) {
  return t6.painter.materialManager.getProgram(a15, []);
}
function n14(a23, e17, n22) {
  a7(a23, e17, n22), s5(e17);
  const { bandIndexMat3: o11 } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", o11);
}
var o5 = { createProgram: e8, bindTextureAndUniforms: n14 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/focalStatisticsProcessor.js
var e9 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/focalstatistics", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function r9(t6, a23) {
  const { painter: r15, rasterFunction: s19 } = t6, { kernelRows: n22, kernelCols: o11, fillNoDataOnly: i11, statisticsType: c5 } = s19.parameters, l3 = [{ name: "rows", value: n22 }, { name: "cols", value: o11 }, c5];
  return i11 && l3.push("fill"), r15.materialManager.getProgram(e9, l3);
}
function s12(e17, r15, s19) {
  a7(e17, r15, s19), s5(r15), r15.setUniform2fv("u_srcImageSize", [s19.width, s19.height]);
  const { clampRange: n22 } = e17.rasterFunction.parameters;
  r15.setUniform2fv("u_clampRange", n22);
}
var n15 = { createProgram: r9, bindTextureAndUniforms: s12 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/grayscaleProcessor.js
var a16 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/grayscale", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e10(t6, r15) {
  return t6.painter.materialManager.getProgram(a16, []);
}
function s13(a23, e17, s19) {
  a7(a23, e17, s19), s5(e17);
  const { weights: n22 } = a23.rasterFunction.parameters;
  e17.setUniform3fv("u_weights", n22);
}
var n16 = { createProgram: e10, bindTextureAndUniforms: s13 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/localProcessor.js
var a17 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/local", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e11(t6) {
  const { painter: n22, rasterFunction: e17 } = t6, { imageCount: r15, operationName: o11, rasters: s19, isOutputRounded: u5 } = e17.parameters, i11 = [o11.toLowerCase()];
  2 === r15 && i11.push("twoImages");
  const m7 = s19.filter((t7) => "Constant" === t7.name);
  return m7.length && (i11.push("oneConstant"), 2 === m7.length && i11.push("twoConstant")), u5 && i11.push("roundOutput"), n22.materialManager.getProgram(a17, i11);
}
function r10(a23, e17, r15) {
  r6(a23, e17, r15), s5(e17);
  const { domainRange: o11 } = a23.rasterFunction.parameters;
  e17.setUniform2fv("u_domainRange", o11);
}
var o6 = { createProgram: e11, bindTextureAndUniforms: r10 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/maskProcessor.js
var r11 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/mask", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function n17(t6, a23) {
  const { painter: n22, rasterFunction: e17 } = t6, s19 = e17.parameters.bandCount > 1 ? ["multiBand"] : [];
  return n22.materialManager.getProgram(r11, s19);
}
function e12(r15, n22, e17) {
  a7(r15, n22, e17), s5(n22);
  const { includedRanges: s19, noDataValues: o11 } = r15.rasterFunction.parameters;
  n22.setUniform1fv("u_includedRanges", s19), n22.setUniform1fv("u_noDataValues", o11);
}
var s14 = { createProgram: n17, bindTextureAndUniforms: e12 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/ndviProcessor.js
var a18 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/ndvi", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e13(t6, r15) {
  const { painter: e17, rasterFunction: n22 } = t6, s19 = n22.parameters.scaled ? ["scaled"] : [];
  return e17.materialManager.getProgram(a18, s19);
}
function n18(a23, e17, n22) {
  a7(a23, e17, n22), s5(e17);
  const { bandIndexMat3: s19 } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", s19);
}
var s15 = { createProgram: e13, bindTextureAndUniforms: n18 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/remapProcessor.js
var r12 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/remap", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function e14(a23, t6) {
  return a23.painter.materialManager.getProgram(r12, []);
}
function n19(r15, e17, n22) {
  a7(r15, e17, n22), s5(e17);
  const { noDataRanges: s19, rangeMaps: o11, allowUnmatched: f4, clampRange: i11 } = r15.rasterFunction.parameters;
  e17.setUniform1fv("u_noDataRanges", s19), e17.setUniform1fv("u_rangeMaps", o11), e17.setUniform1f("u_unmatchMask", f4 ? 1 : 0), e17.setUniform2fv("u_clampRange", i11);
}
var s16 = { createProgram: e14, bindTextureAndUniforms: n19 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/reprojectProcessor.js
var e15 = { vsPath: "raster/common", fsPath: "raster/reproject", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function i9(r15, t6) {
  var _a;
  const { painter: i11 } = r15, o11 = [], { interpolation: s19, transformGrid: n22 } = t6, a23 = (_a = r15.rasterFunction) == null ? void 0 : _a.parameters;
  return "cubic" === s19 ? o11.push("bicubic") : "bilinear" === s19 && (o11.push("bilinear"), (a23 == null ? void 0 : a23.requireNNEdge) && o11.push("nnedge")), n22 && (o11.push("applyProjection"), 1 === n22.spacing[0] && o11.push("lookupProjection")), i11.materialManager.getProgram(e15, o11);
}
function o7(e17, i11, o11) {
  const { names: s19, textures: n22 } = o11.getTextures({ forProcessing: true });
  O2(e17.context, i11, s19, n22), i11.setUniform1f("u_scale", 1), i11.setUniform2fv("u_offset", [0, 0]), i11.setUniform2fv("u_coordScale", [1, 1]), i11.setUniformMatrix3fv("u_dvsMat3", [2, 0, 0, 0, 2, 0, -1, -1, 0]), i11.setUniform1i("u_flipY", 0), i11.setUniform1f("u_opacity", 1);
  const { width: a23, height: f4, source: c5, transformGrid: m7 } = o11;
  i11.setUniform2fv("u_srcImageSize", [c5.width, c5.height]), i11.setUniform2fv("u_targetImageSize", [a23, f4]), i11.setUniform2fv("u_transformSpacing", m7 ? m7.spacing : a2), i11.setUniform2fv("u_transformGridSize", m7 ? m7.size : a2);
}
var s17 = { createProgram: i9, bindTextureAndUniforms: o7 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/slopeProcessor.js
var r13 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/slope", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function s18(e17, t6) {
  const { painter: s19, rasterFunction: o11 } = e17, { slopeType: a23 } = o11.parameters, i11 = "percent-rise" === a23 ? ["percentRise"] : [];
  return s19.materialManager.getProgram(r13, i11);
}
function o8(r15, s19, o11) {
  a7(r15, s19, o11), s5(s19);
  const a23 = o11.getRasterTextureSize();
  s19.setUniform2fv("u_srcImageSize", a23);
  const i11 = o11.getRasterCellSize();
  s19.setUniform2fv("u_cellSize", i11);
  const { zFactor: n22, slopeType: c5, pixelSizePower: f4, pixelSizeFactor: p4 } = r15.rasterFunction.parameters;
  s19.setUniform1f("u_zFactor", n22), s19.setUniform1f("u_pixelSizePower", "adjusted" === c5 ? f4 : 0), s19.setUniform1f("u_pixelSizeFactor", "adjusted" === c5 ? p4 : 0);
}
var a19 = { createProgram: s18, bindTextureAndUniforms: o8 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/stretchProcessor.js
var a20 = { vsPath: "raster/rfx/vs", fsPath: "raster/rfx/stretch", attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]]) };
function u3(t6, r15) {
  const { useGamma: u5, bandCount: e17, isOutputRounded: n22 } = t6.rasterFunction.parameters, o11 = [];
  return u5 && o11.push("useGamma"), e17 > 1 && o11.push("multiBand"), n22 && o11.push("roundOutput"), t6.painter.materialManager.getProgram(a20, o11);
}
function e16(a23, u5, e17) {
  a7(a23, u5, e17), s5(u5);
  const { width: n22, height: o11 } = e17, m7 = a23.rasterFunction.parameters;
  u5.setUniform2fv("u_srcImageSize", [n22, o11]), u5.setUniform1f("u_minOutput", m7.outMin), u5.setUniform1f("u_maxOutput", m7.outMax), u5.setUniform1fv("u_factor", m7.factor), u5.setUniform1fv("u_minCutOff", m7.minCutOff), u5.setUniform1fv("u_maxCutOff", m7.maxCutOff), u5.setUniform1fv("u_gamma", m7.gamma), u5.setUniform1fv("u_gammaCorrection", m7.gammaCorrection);
}
var n20 = { createProgram: u3, bindTextureAndUniforms: e16 };

// ../node_modules/@arcgis/core/views/2d/engine/imagery/processor/rasterProcessor.js
var v2 = /* @__PURE__ */ new Map();
function A2(r15, e17) {
  const o11 = new e2();
  return o11.width = r15, o11.height = e17, o11.internalFormat = P2.RGBA32F, o11.samplingMode = L.NEAREST, o11.dataType = U.FLOAT, o11.isImmutable = true, o11.wrapMode = D.CLAMP_TO_EDGE, o11;
}
function F(r15, e17, o11, t6) {
  const { context: s19, requestRender: c5, allowDelayedRender: n22 } = r15, i11 = t6.createProgram(r15, o11);
  return n22 && null != c5 && !i11.compiled ? (c5(), null) : (s19.bindFramebuffer(e17), s19.setViewport(0, 0, e17.width, e17.height), s19.useProgram(i11), i11);
}
function y3(r15) {
  return v2.get(r15.toLowerCase());
}
function R2(r15, e17, o11, t6) {
  const s19 = r15.rasterFunction.name.toLowerCase(), c5 = "reproject" === s19 ? s17 : y3(s19);
  if (null == c5) return;
  const n22 = F(r15, o11, t6, c5);
  if (!n22) return;
  c5.bindTextureAndUniforms(r15, n22, t6);
  const { interpolation: i11 } = t6;
  "reproject" === s19 && (t6.interpolation = "nearest"), e17.draw();
  const [m7, a23] = t6.getRasterTextureSize("reproject" === s19), p4 = A2(m7, a23), u5 = new c(r15.context, p4);
  if (o11.copyToTexture(0, 0, m7, a23, 0, 0, u5), "reproject" === s19) t6.rasterTexture = u5, t6.projected = true, t6.interpolation = i11;
  else {
    const e18 = r15.hasBranches ? r15.rasterFunction.id : 0;
    t6.functionTextures[e18] = u5;
  }
}
v2.set("arithmetic", o6), v2.set("aspect", n7), v2.set("bandarithmetic", s7), v2.set("computechange", s9), v2.set("compositeband", s8), v2.set("convolution", o4), v2.set("contrastbrightness", n11), v2.set("curvature", n13), v2.set("extractband", o5), v2.set("statistics", n15), v2.set("grayscale", n16), v2.set("local", o6), v2.set("mask", s14), v2.set("ndvi", s15), v2.set("remap", s16), v2.set("slope", a19), v2.set("stretch", n20);

// ../node_modules/@arcgis/core/views/2d/engine/imagery/BrushRasterBitmap.js
var h6 = class extends t3 {
  constructor() {
    super(...arguments), this.name = "raster", this._quad = null, this._rendererUniformInfos = /* @__PURE__ */ new Map(), this._fbo = null;
  }
  dispose() {
    r(this._quad), r(this._fbo);
  }
  prepareState(e17) {
    const { context: t6, renderPass: r15 } = e17, s19 = "raster" === r15;
    t6.setBlendingEnabled(!s19), t6.setBlendFunctionSeparate(R.ONE, R.ONE_MINUS_SRC_ALPHA, R.ONE, R.ONE_MINUS_SRC_ALPHA), t6.setColorMask(true, true, true, true), t6.setStencilWriteMask(0), t6.setStencilTestEnabled(!s19);
  }
  draw(e17, r15) {
    if (!m3(r15) || r15.suspended) return;
    const { renderPass: s19 } = e17;
    if ("raster-bitmap" !== s19) return "raster" === s19 ? this._process(e17, r15) : void this._drawBitmap(e17, r15, true);
    this._drawBitmap(e17, r15);
  }
  _process(t6, r15) {
    const { rasterFunction: i11 } = t6, o11 = "Reproject" === i11.name;
    if (!(o11 ? !(r15.rasterTexture && r15.projected) : !r15.processed)) return;
    const { timeline: n22, context: a23 } = t6;
    n22.begin(this.name);
    const d5 = a23.getBoundFramebufferObject(), c5 = a23.getViewport();
    o11 || (r15.processedTexture = r(r15.processedTexture)), a23.setStencilFunction(O.EQUAL, r15.stencilRef, 255), r15.updateTexture(t6), this._initQuad(a23);
    const [f4, u5] = r15.getRasterTextureSize(o11), { isStandardRasterTileSize: p4, fbo: h7 } = this._getRasterFBO(a23, f4, u5);
    R2(t6, this._quad, h7, r15), p4 || h7.dispose(), a23.bindFramebuffer(d5), a23.setViewport(c5.x, c5.y, c5.width, c5.height), n22.end(this.name);
  }
  _drawBitmap(e17, t6, s19 = false) {
    const { timeline: i11, context: o11 } = e17;
    if (i11.begin(this.name), o11.setStencilFunction(O.EQUAL, t6.stencilRef, 255), t6.updateTexture(e17), s19 && !t6.processedTexture) {
      if (t6.updateProcessedTexture(), !t6.processedTexture) return void i11.end(this.name);
      t6.processed = true;
    }
    this._initBitmapCommonUniforms(t6);
    const a23 = t6.symbolizerParameters.type, d5 = o3(a23), { requestRender: c5, allowDelayedRender: f4 } = e17, { defines: u5, program: p4 } = d5.createProgram(e17, t6, t6.projected && s19);
    if (f4 && null != c5 && !p4.compiled) return void c5();
    o11.useProgram(p4);
    const h7 = this._getUniformInfos(a23, o11, p4, u5);
    this._quad || (this._quad = new h4(o11, [0, 0, 1, 0, 0, 1, 1, 1])), d5.bindTextureAndUniforms(e17, p4, t6, h7, s19), this._quad.draw(), i11.end(this.name);
  }
  _initBitmapCommonUniforms(e17) {
    if (!e17.commonUniforms) {
      const t6 = g3(1, [0, 0]), { transformGrid: r15, width: s19, height: i11 } = e17, o11 = l(r15, [s19, i11], [e17.source.width, e17.source.height], 1, false);
      e17.commonUniforms = { ...t6, ...o11, u_coordScale: e17.coordScale };
    }
  }
  _getRasterFBO(e17, t6, r15) {
    const s19 = t6 === a3 && r15 === a3;
    return s19 ? (this._fbo || (this._fbo = this._createNewFBO(e17, t6, r15)), { isStandardRasterTileSize: s19, fbo: this._fbo }) : { isStandardRasterTileSize: s19, fbo: this._createNewFBO(e17, t6, r15) };
  }
  _createNewFBO(e17, t6, r15) {
    const s19 = A2(t6, r15);
    return new E(e17, s19);
  }
  _initQuad(e17) {
    this._quad || (this._quad = new h4(e17, [0, 0, 1, 0, 0, 1, 1, 1]));
  }
  _getUniformInfos(e17, t6, r15, s19) {
    const i11 = s19.length > 0 ? e17 + "-" + s19.join("-") : e17;
    if (this._rendererUniformInfos.has(i11)) return this._rendererUniformInfos.get(i11);
    const o11 = T(t6, r15);
    return this._rendererUniformInfos.set(i11, o11), o11;
  }
};

// ../node_modules/@arcgis/core/views/2d/engine/imagery/RasterTile.js
var i10 = class extends r5 {
  constructor(t6, e17, i11, a23, r15, l3, n22 = null) {
    super(t6, e17, i11, a23, r15, l3), this.bitmap = null, this.bitmap = new _3(n22, null, null), this.bitmap.coordScale = [r15, l3], this.bitmap.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.bitmap.destroy(), this.bitmap = null, this.stage = null;
  }
  set stencilRef(t6) {
    this.bitmap.stencilRef = t6;
  }
  get stencilRef() {
    return this.bitmap.stencilRef;
  }
  setTransform(t6) {
    super.setTransform(t6), this.bitmap.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  _createTransforms() {
    return { displayViewScreenMat3: e3(), tileMat3: e3() };
  }
  onAttach() {
    this.bitmap.stage = this.stage;
  }
  onDetach() {
    this.bitmap.stage = null;
  }
};

// ../node_modules/@arcgis/core/views/2d/engine/imagery/RasterTileContainer.js
var o9 = class extends i3 {
  constructor() {
    super(...arguments), this.isCustomTilingScheme = false;
  }
  createTile(e17) {
    const s19 = this._getTileBounds(e17), [r15, i11] = this._tileInfoView.tileInfo.size, n22 = this._tileInfoView.getTileResolution(e17.level);
    return new i10(e17, n22, s19[0], s19[3], r15, i11);
  }
  prepareRenderPasses(e17) {
    const s19 = e17.registerRenderPass({ name: "imagery (tile)", brushes: [h6], target: () => this.children.map((e18) => e18.bitmap), drawPhase: E2.MAP });
    return [...super.prepareRenderPasses(e17), s19];
  }
  doRender(e17) {
    if (!this.visible || e17.drawPhase !== E2.MAP) return;
    const { rasterFunctionChain: s19 } = this;
    if (!s19) return e17.renderPass = "raster-bitmap", void super.doRender(e17);
    if (!s19.hasFocalFunction) {
      const [r15, t6] = this._tileInfoView.tileInfo.size;
      e17.renderPass = "raster", e17.rasterFunction = { name: "Reproject", parameters: { targetImageSize: [r15, t6], requireNNEdge: s19.isSourceSingleBand }, pixelType: "f32", id: 0, isNoopProcess: false }, super.doRender(e17);
    }
    if (s19 == null ? void 0 : s19.functions.length) {
      const { functions: r15, hasBranches: t6 } = s19;
      for (let s20 = 0; s20 < r15.length; s20++) {
        const i11 = r15[s20];
        "Constant" !== i11.name && "Identity" !== i11.name && (e17.renderPass = "raster", e17.rasterFunction = i11, e17.hasBranches = t6, super.doRender(e17));
      }
    }
    e17.rasterFunction = null, e17.renderPass = "bitmap", super.doRender(e17);
  }
  _getTileBounds(r15) {
    const t6 = this._tileInfoView.getTileBounds(u(), r15);
    if (this.isCustomTilingScheme && r15.world) {
      const { tileInfo: e17 } = this._tileInfoView, i11 = mt(e17.spatialReference);
      if (i11) {
        const s19 = e17.lodAt(r15.level);
        if (!s19) return t6;
        const { resolution: n22 } = s19, o11 = i11 / n22 % e17.size[0], a23 = o11 ? (e17.size[0] - o11) * n22 : 0;
        t6[0] -= a23 * r15.world, t6[2] -= a23 * r15.world;
      }
    }
    return t6;
  }
};

// ../node_modules/@arcgis/core/views/2d/layers/imagery/BaseImageryTileSubView2D.js
var R3 = [0, 0];
var C2 = class extends S {
  constructor() {
    super(...arguments), this._updatingHandles = new h2(), this._emptyTilePixelBlock = null, this._tileStrategy = null, this._tileInfoView = null, this._fetchQueue = null, this._blockCacheRegistryUrl = null, this._blockCacheRegistryId = null, this._srcResolutions = [], this.previousLOD = null, this._needBlockCacheUpdate = false, this._globalSymbolizerParams = null, this._symbolizerParams = null, this._abortController = null, this._isCustomTilingScheme = false, this._maxIndexedColormapSize = 0, this._rasterFunctionState = "na", this._globalUpdateRequested = false, this.attached = false, this.timeExtent = null, this.redrawOrRefetch = k(async (e17 = {}) => {
      const t6 = this._rasterFunctionState;
      if (e17.reprocess && (await this._updatingHandles.addPromise(this.layer.updateRasterFunction()), this.updateRasterFunctionParameters()), !this.previousLOD || this.layerView.suspended) return;
      const i11 = this._rasterFunctionState, { type: s19 } = this;
      return e17.refetch || "raster" !== s19 && !!e17.reprocess || "cpu" === i11 || "cpu" === t6 ? this._updatingHandles.addPromise(this.doRefresh()) : this._updatingHandles.addPromise(this._redrawImage(e17.signal));
    });
  }
  destroy() {
    this._updatingHandles.destroy();
  }
  get useWebGLForProcessing() {
    return this._get("useWebGLForProcessing") ?? true;
  }
  set useWebGLForProcessing(e17) {
    this._set("useWebGLForProcessing", e17);
  }
  get useProgressiveUpdate() {
    return this._get("useProgressiveUpdate") ?? true;
  }
  set useProgressiveUpdate(e17) {
    if (this._tileStrategy && this.useProgressiveUpdate !== e17) {
      this._tileStrategy.destroy(), this.container.removeAllChildren();
      const t6 = this._getCacheSize(e17);
      this._tileStrategy = new r3({ cachePolicy: "purge", acquireTile: (e18) => this.acquireTile(e18), releaseTile: (e18) => this.releaseTile(e18), cacheSize: t6, tileInfoView: this._tileInfoView }), this._set("useProgressiveUpdate", e17), this.layerView.requestUpdate();
    }
  }
  update(e17) {
    var _a;
    this._fetchQueue.pause(), this._fetchQueue.state = e17.state, this._tileStrategy.update(e17), this._fetchQueue.resume();
    const { extent: t6, resolution: i11, scale: s19 } = e17.state, r15 = this._tileInfoView.getClosestInfoForScale(s19);
    if (this.layer.raster) {
      if (!this.useProgressiveUpdate || this._needBlockCacheUpdate) {
        const e18 = this._srcResolutions[r15.level], s20 = t6.toJSON ? t6 : w.fromJSON(t6);
        g2(this._blockCacheRegistryUrl, this._blockCacheRegistryId, s20, i11, e18, this.layer.raster.ioConfig.sampling);
      }
      this._needBlockCacheUpdate = false, ((_a = this.previousLOD) == null ? void 0 : _a.level) !== r15.level && (this.previousLOD = r15, null == this._symbolizerParams || this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._tileStrategy.updateCacheSize(0));
    }
  }
  moveEnd() {
    !this.layerView.hasTilingEffects && this.useProgressiveUpdate || (this._abortController && this._abortController.abort(), this._abortController = new AbortController(), 0 === this._fetchQueue.length && this._redrawImage(this._abortController.signal).then(() => {
      this._globalUpdateRequested = false, this.layerView.requestUpdate();
    }));
    const e17 = this._getCacheSize(this.useProgressiveUpdate);
    this._tileStrategy.updateCacheSize(e17), this.layerView.requestUpdate();
  }
  get updating() {
    var _a;
    return this._globalUpdateRequested || ((_a = this._updatingHandles) == null ? void 0 : _a.updating);
  }
  attach() {
    const e17 = t2();
    this._maxIndexedColormapSize = 4 * (e17.maxTextureSize || 4096), this._initializeTileInfo(), this._tileInfoView = new h3(this.layerView.tileInfo, this.layerView.fullExtent);
    const t6 = this._computeFetchConcurrency();
    this._fetchQueue = new m({ tileInfoView: this._tileInfoView, concurrency: t6, process: (e18, t7) => this._fetchTile(e18, t7) });
    const i11 = this._getCacheSize(this.useProgressiveUpdate);
    this._tileStrategy = new r3({ cachePolicy: "purge", acquireTile: (e18) => this.acquireTile(e18), releaseTile: (e18) => this.releaseTile(e18), cacheSize: i11, tileInfoView: this._tileInfoView }), this._updateBlockCacheRegistry();
  }
  detach() {
    this._tileStrategy.destroy(), this._fetchQueue.clear(), this.container.removeAllChildren(), this._fetchQueue = this._tileStrategy = this._tileInfoView = null, a4(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryUrl = this._blockCacheRegistryId = null;
  }
  acquireTile(e17) {
    const t6 = this.container.createTile(e17);
    return this._updatingHandles.addPromise(this._enqueueTileFetch(t6)), this.layerView.requestUpdate(), this._needBlockCacheUpdate = true, this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, t6;
  }
  releaseTile(e17) {
    this._fetchQueue.abort(e17.key.id), this.container.removeChild(e17), e17.once("detach", () => {
      e17.destroy(), this.layerView.requestUpdate();
    }), this.layerView.requestUpdate();
  }
  createEmptyTilePixelBlock(e17 = null) {
    const t6 = null == e17 || e17.join(",") === this._tileInfoView.tileInfo.size.join(",");
    if (t6 && null != this._emptyTilePixelBlock) return this._emptyTilePixelBlock;
    e17 = e17 || this._tileInfoView.tileInfo.size;
    const [i11, s19] = e17, r15 = new g({ width: i11, height: s19, pixels: [new Uint8Array(i11 * s19)], mask: new Uint8Array(i11 * s19), pixelType: "u8" });
    return t6 && (this._emptyTilePixelBlock = r15), r15;
  }
  _getBandIds() {
    if (!("rasterFunctionChain" in this.container) || !this.container.rasterFunctionChain) return this.layer.bandIds;
    const { bandIds: e17, raster: t6 } = this.layer, i11 = "rasterFunction" in t6 ? t6.rasterFunction.rawInputBandIds : null;
    return (e17 == null ? void 0 : e17.length) && (i11 == null ? void 0 : i11.length) && 1 !== t6.rasterInfo.bandCount ? e17.map((e18) => i11[Math.min(e18, i11.length - 1)]) : e17 || i11;
  }
  updateRasterFunctionParameters() {
  }
  _fetchTile(e17, t6) {
    const i11 = this._getFetchOptions(e17.level, t6.signal);
    return this.fetchTile(e17, i11);
  }
  _getFetchOptions(e17, t6) {
    const i11 = this.canUseWebGLForProcessing(), { layerView: s19 } = this, { tileInfo: r15 } = s19, a23 = !r15.isWrappable && null != D2(s19.view.spatialReference), o11 = i11 && this.layer.raster.hasUniqueSourceStorageInfo;
    return { allowPartialFill: true, datumTransformation: s19.datumTransformation, interpolation: i11 ? "nearest" : this.layer.interpolation, registryId: this._blockCacheRegistryId, requestRawData: o11, skipRasterFunction: "raster" === this.type && null != this.container.rasterFunctionChain, signal: t6, srcResolution: this._srcResolutions[e17], timeExtent: s19.timeExtent, tileInfo: r15, disableWrapAround: a23 };
  }
  _getCacheSize(e17) {
    return e17 ? 40 : 0;
  }
  _initializeTileInfo() {
    const { layerView: e17 } = this, t6 = e17.view.spatialReference;
    if (this._canUseLayerLODs()) {
      const { origin: i12, lods: s20 } = this.layer.tileInfo, r16 = s20.map(({ scale: e18 }) => e18), a24 = z.create({ spatialReference: t6, size: a3, scales: r16, origin: i12 });
      return e17.set("tileInfo", a24), void (this._srcResolutions = s20.map(({ resolution: e18 }) => ({ x: e18, y: e18 })));
    }
    const { scales: i11, srcResolutions: s19, isCustomTilingScheme: r15 } = ae(this.layer.serviceRasterInfo, t6, { tileSize: a3, alignGlobalDatasetWithAGOL: true, limitToSrcResolution: false }), a23 = z.create({ spatialReference: t6, size: a3, scales: i11 }), o11 = 0 === a23.origin.x, { xmin: l3, ymax: h7 } = e17.fullExtent;
    (o11 || r15 && a23.origin.x > l3) && (a23.origin = new _({ x: l3, y: h7, spatialReference: t6 })), this._isCustomTilingScheme = r15, e17.set("tileInfo", a23), this._srcResolutions = s19 ?? [];
  }
  _canUseLayerLODs() {
    var _a;
    const { layer: e17, layerView: t6 } = this;
    if ("Map" !== e17.raster.tileType) return false;
    const { lods: i11 } = e17.tileInfo, s19 = (_a = t6.view.constraints) == null ? void 0 : _a.effectiveLODs;
    return (s19 == null ? void 0 : s19.length) === i11.length && s19.every(({ scale: e18 }, t7) => Math.abs(e18 - i11[t7].scale) < 1e-3);
  }
  _computeFetchConcurrency() {
    const { blockBoundary: e17 } = this.layer.serviceRasterInfo.storageInfo, t6 = e17[e17.length - 1];
    return (t6.maxCol - t6.minCol + 1) * (t6.maxRow - t6.minRow + 1) > 64 ? 2 : 10;
  }
  async _enqueueTileFetch(e17, t6) {
    var _a;
    if (!this._fetchQueue.has(e17.key.id)) {
      try {
        const t7 = await this._fetchQueue.push(e17.key), a23 = this._getBandIds();
        let o11 = !this.useProgressiveUpdate || this.layerView.hasTilingEffects && !this._globalSymbolizerParams;
        if (this._globalUpdateRequested && !this.layerView.moving && 0 === this._fetchQueue.length) {
          o11 = false;
          try {
            await this._redrawImage((_a = this._abortController) == null ? void 0 : _a.signal);
          } catch (s19) {
            b(s19) && n.getLogger(this).error(s19);
          }
          this._globalUpdateRequested = false;
        }
        !this.canUseWebGLForProcessing() && "rasterVF" !== this.type || this.layerView.hasTilingEffects || null != this._symbolizerParams || this._updateSymbolizerParams();
        const l3 = this._tileInfoView.getTileCoords(R3, e17.key), n22 = this._tileInfoView.getTileResolution(e17.key);
        await this.updateTileSource(e17, { source: t7, symbolizerParams: this._symbolizerParams, globalSymbolizerParams: this._globalSymbolizerParams, suspended: o11, bandIds: a23, coords: l3, resolution: n22 }), e17.once("attach", () => this.layerView.requestUpdate()), this.container.addChild(e17);
      } catch (s19) {
        b(s19) || n.getLogger(this).error(s19);
      }
      this.layerView.requestUpdate();
    }
  }
  async _redrawImage(e17) {
    if (0 === this.container.children.length) return;
    await this.layer.updateRenderer(), this.layerView.hasTilingEffects ? await this._updateGlobalSymbolizerParams(e17) : (this._updateSymbolizerParams(), this._globalSymbolizerParams = null);
    const t6 = this.container.children.map(async (e18) => this.updateTileSymbolizerParameters(e18, { local: this._symbolizerParams, global: this._globalSymbolizerParams }));
    await Promise.allSettled(t6), this.container.requestRender();
  }
  async _updateGlobalSymbolizerParams(e17) {
    const t6 = this._getFetchOptions(this.previousLOD.level, e17), i11 = await this.layer.fetchPixels(this.layerView.view.extent, this.layerView.view.width, this.layerView.view.height, { ...t6, interpolation: "nearest", requestRawData: false, skipRasterFunction: false });
    if (!(i11 == null ? void 0 : i11.pixelBlock)) return;
    const { resolution: s19 } = this.previousLOD, r15 = this._getBandIds(), a23 = this.layer.symbolizer.generateWebGLParameters({ pixelBlock: i11.pixelBlock.extractBands(r15), isGCS: this.layerView.view.spatialReference.isGeographic, resolution: { x: s19, y: s19 }, bandIds: r15 });
    !this.canUseWebGLForProcessing() && a23 && "stretch" === a23.type && this.layer.renderer && "raster-stretch" === this.layer.renderer.type && (a23.factor = a23.factor.map((e18) => 255 * e18), a23.outMin = Math.round(255 * a23.outMin), a23.outMax = Math.round(255 * a23.outMax)), this._globalSymbolizerParams = a23;
  }
  _updateSymbolizerParams() {
    const { resolution: e17 } = this.previousLOD, t6 = this._getBandIds();
    this._symbolizerParams = this.layer.symbolizer.generateWebGLParameters({ pixelBlock: null, isGCS: this.layerView.view.spatialReference.isGeographic, resolution: { x: e17, y: e17 }, bandIds: t6 });
  }
  _updateBlockCacheRegistry(e17 = false) {
    const { layer: t6, layerView: i11 } = this, { raster: s19 } = t6, { multidimensionalDefinition: r15 } = t6.normalizeRasterFetchOptions({ multidimensionalDefinition: t6.multidimensionalDefinition, timeExtent: i11.timeExtent }), a23 = s19.rasterInfo.multidimensionalInfo ? s19.getSliceIndex(r15) : null, o11 = i2(s19.rasterId, a23);
    if (o11 !== this._blockCacheRegistryUrl) {
      if (null != this._blockCacheRegistryUrl && a4(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryId = u2(o11, s19.rasterInfo), e17) {
        const { view: e18 } = i11, t7 = this._tileInfoView.getClosestInfoForScale(e18.scale), r16 = this._srcResolutions[t7.level];
        g2(o11, this._blockCacheRegistryId, e18.extent, e18.resolution, r16, s19.ioConfig.sampling);
      }
      this._blockCacheRegistryUrl = o11;
    }
  }
  async doRefresh() {
    if (!this.attached || !this.previousLOD || this.layerView.suspended) return;
    await this.layer.updateRenderer(), this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._updateBlockCacheRegistry(true), this._fetchQueue.reset();
    const e17 = [];
    this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, this._tileStrategy.refresh((t6) => e17.push(this._enqueueTileFetch(t6))), await this._updatingHandles.addPromise(Promise.allSettled(e17));
  }
};
e([y()], C2.prototype, "_globalUpdateRequested", void 0), e([y()], C2.prototype, "attached", void 0), e([y()], C2.prototype, "container", void 0), e([y()], C2.prototype, "layer", void 0), e([y()], C2.prototype, "layerView", void 0), e([y()], C2.prototype, "type", void 0), e([y()], C2.prototype, "useWebGLForProcessing", null), e([y()], C2.prototype, "useProgressiveUpdate", null), e([y()], C2.prototype, "timeExtent", void 0), e([y()], C2.prototype, "updating", null), C2 = e([a("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")], C2);

// ../node_modules/@arcgis/core/views/2d/layers/imagery/ImageryTileView2D.js
var a21 = class extends C2 {
  constructor() {
    super(...arguments), this.type = "raster";
  }
  attach() {
    super.attach(), this.container = new o9(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this.updateRasterFunctionParameters();
  }
  detach() {
    super.detach(), this.container.removeAllChildren(), this.container = null;
  }
  canUseWebGLForProcessing() {
    var _a, _b;
    const { symbolizer: e17 } = this.layer, t6 = (_b = (_a = e17.lookup) == null ? void 0 : _a.colormapLut) == null ? void 0 : _b.indexedColormap, r15 = t6 && t6.length > this._maxIndexedColormapSize;
    return this.useWebGLForProcessing && e17.canRenderInWebGL && !r15 && !("majority" === this.layer.interpolation && r4(this.layer));
  }
  fetchTile(e17, t6) {
    return this.layer.fetchTile(e17.level, e17.row, e17.col, t6);
  }
  updateRasterFunctionParameters() {
    const { clips: e17, view: t6 } = this.layerView;
    null != this._geometry && e17.remove(this._geometry);
    const { raster: r15, type: s19 } = this.layer;
    if ("Function" === r15.datasetFormat) {
      const s20 = r15.getClippingGeometry(t6.spatialReference);
      if (s20) {
        const t7 = new a5({ geometry: s20 });
        e17.add(t7), this._geometry = t7;
      }
    }
    const { container: i11 } = this;
    if ("Function" !== r15.datasetFormat || "wcs" === s19) return i11.rasterFunctionChain = null, i11.children.forEach((e18) => {
      const { bitmap: t7 } = e18;
      t7 && (t7.suspended = true, t7.processed = false, t7.projected && (t7.invalidateTexture(), t7.rasterTexture = null));
    }), void (this._rasterFunctionState = "na");
    const o11 = this._rasterFunctionState, { rasterFunction: a23, primaryRasters: l3 } = r15, c5 = a23.supportsGPU && (!l3 || l3.rasters.length <= 1), u5 = c5 ? a23.flatWebGLFunctionChain : null, { renderer: p4 } = this.layer, d5 = !c5 || !(u5 == null ? void 0 : u5.functions.length) || "raster-stretch" === (p4 == null ? void 0 : p4.type) && p4.dynamicRangeAdjustment || !this.canUseWebGLForProcessing();
    i11.rasterFunctionChain = d5 ? null : u5;
    const h7 = null == a23 ? "na" : i11.rasterFunctionChain ? "gpu" : "cpu";
    i11.children.forEach((e18) => {
      const { bitmap: t7 } = e18;
      t7 && (t7.suspended = o11 !== h7, t7.processed = false, t7.processedTexture = null);
    }), this._rasterFunctionState = h7;
  }
  async updateTileSource(e17, t6) {
    const r15 = this._getBandIds(), s19 = this._getLayerInterpolation(), i11 = this.canUseWebGLForProcessing(), { source: o11, globalSymbolizerParams: n22, suspended: a23, coords: l3, resolution: c5 } = t6, u5 = this.layerView.hasTilingEffects ? n22 : t6.symbolizerParams, { bitmap: p4 } = e17;
    if ([p4.x, p4.y] = l3, p4.resolution = c5, null != (o11 == null ? void 0 : o11.pixelBlock)) {
      const e18 = { extent: o11.extent, pixelBlock: o11.pixelBlock, srcPixelSize: o11.srcTilePixelSize };
      if (p4.rawPixelData = e18, i11) p4.source = o11.pixelBlock, p4.isRendereredSource = false;
      else {
        const t7 = await this.layer.applyRenderer(e18, "stretch" === (n22 == null ? void 0 : n22.type) ? n22 : void 0);
        p4.source = t7, p4.isRendereredSource = true;
      }
      p4.symbolizerParameters = i11 ? u5 : null, p4.transformGrid = i11 ? o11.transformGrid : null;
    } else {
      const e18 = this.createEmptyTilePixelBlock();
      p4.source = e18, p4.symbolizerParameters = i11 ? u5 : null, p4.transformGrid = null;
    }
    p4.bandIds = i11 ? r15 : null, p4.width = this._tileInfoView.tileInfo.size[0], p4.height = this._tileInfoView.tileInfo.size[1], p4.interpolation = s19, p4.suspended = a23, p4.invalidateTexture();
  }
  async updateTileSymbolizerParameters(e17, t6) {
    const { local: r15, global: s19 } = t6, i11 = this._getBandIds(), o11 = this._getLayerInterpolation(), n22 = this.canUseWebGLForProcessing(), { bitmap: a23 } = e17, { rawPixelData: l3 } = a23;
    n22 || null == l3 ? (a23.isRendereredSource && null != l3 && (a23.source = l3.pixelBlock), a23.isRendereredSource = false) : (a23.source = await this.layer.applyRenderer(l3, "stretch" === (s19 == null ? void 0 : s19.type) ? s19 : void 0), a23.isRendereredSource = true), a23.symbolizerParameters = n22 ? this.layerView.hasTilingEffects ? s19 : r15 : null, a23.bandIds = n22 ? i11 : null, a23.interpolation = o11, a23.suspended = false;
  }
  _getLayerInterpolation() {
    const { interpolation: e17, renderer: t6 } = this.layer;
    if (!t6) return e17;
    const r15 = t6.type;
    return "raster-colormap" === r15 || "unique-value" === r15 || "class-breaks" === r15 ? "nearest" : "raster-stretch" === t6.type && null != t6.colorRamp ? "bilinear" === e17 || "cubic" === e17 ? "bilinear" : "nearest" : e17;
  }
};
e([y()], a21.prototype, "container", void 0), e([y()], a21.prototype, "layer", void 0), e([y()], a21.prototype, "type", void 0), a21 = e([a("esri.views.2d.layers.imagery.ImageryTileView2D")], a21);
var l2 = a21;

// ../node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFTile.js
var r14 = class extends r5 {
  constructor(t6, e17, s19, a23, r15, l3, o11 = null) {
    super(t6, e17, s19, a23, r15, l3), this.tileData = new f2(o11), this.tileData.coordScale = [r15, l3], this.tileData.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.tileData.destroy(), this.tileData = null, this.stage = null;
  }
  set stencilRef(t6) {
    this.tileData.stencilRef = t6;
  }
  get stencilRef() {
    return this.tileData.stencilRef;
  }
  _createTransforms() {
    return { displayViewScreenMat3: e3(), tileMat3: e3() };
  }
  setTransform(s19) {
    super.setTransform(s19);
    const i11 = this.resolution / (s19.resolution * s19.pixelRatio), a23 = this.transforms.tileMat3, [r15, l3] = this.tileData.offset, o11 = [this.x + r15 * this.resolution, this.y - l3 * this.resolution], [n22, h7] = s19.toScreenNoRotation([0, 0], o11), { symbolTileSize: c5 } = this.tileData.symbolizerParameters, f4 = Math.round((this.width - this.tileData.offset[0]) / c5) * c5, m7 = Math.round((this.height - this.tileData.offset[1]) / c5) * c5, D3 = f4 / this.rangeX * i11, d5 = m7 / this.rangeY * i11;
    r2(a23, D3, 0, 0, 0, d5, 0, n22, h7, 1), i(this.transforms.displayViewScreenMat3, s19.displayViewMat3, a23), this.tileData.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  onAttach() {
    this.tileData.stage = this.stage;
  }
  onDetach() {
    this.tileData.stage = null;
  }
};

// ../node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFTileContainer.js
var o10 = class extends i3 {
  constructor() {
    super(...arguments), this.isCustomTilingScheme = false, this.symbolTypes = ["triangle"];
  }
  createTile(s19) {
    const t6 = this._tileInfoView.getTileBounds(u(), s19), [i11, o11] = this._tileInfoView.tileInfo.size, n22 = this._tileInfoView.getTileResolution(s19.level);
    return new r14(s19, n22, t6[0], t6[3], i11, o11);
  }
  prepareRenderPasses(e17) {
    const r15 = e17.registerRenderPass({ name: "imagery (vf tile)", brushes: [d4], target: () => this.children.map((e18) => e18.tileData), drawPhase: E2.MAP });
    return [...super.prepareRenderPasses(e17), r15];
  }
  doRender(e17) {
    this.visible && e17.drawPhase === E2.MAP && this.symbolTypes.forEach((s19) => {
      e17.renderPass = s19, super.doRender(e17);
    });
  }
};

// ../node_modules/@arcgis/core/views/2d/layers/imagery/VectorFieldTileView2D.js
var a22 = class extends C2 {
  constructor() {
    super(...arguments), this._handle = null, this.type = "rasterVF";
  }
  canUseWebGLForProcessing() {
    return false;
  }
  async fetchTile(e17, t6) {
    var _a;
    t6 = { ...t6, interpolation: "nearest", requestProjectedLocalDirections: true };
    const i11 = await this.layer.fetchTile(e17.level, e17.row, e17.col, t6);
    return "vector-magdir" === ((_a = this.layer.serviceRasterInfo) == null ? void 0 : _a.dataType) && (i11 == null ? void 0 : i11.pixelBlock) && (i11.pixelBlock = await this.layer.convertVectorFieldData(i11.pixelBlock, t6)), i11;
  }
  updateTileSource(e17, t6) {
    const i11 = t6.symbolizerParams, { tileData: r15 } = e17;
    r15.key = e17.key, r15.width = this._tileInfoView.tileInfo.size[0], r15.height = this._tileInfoView.tileInfo.size[1];
    const { symbolTileSize: o11 } = i11, { source: s19 } = t6;
    if (r15.offset = this._getTileSymbolOffset(r15.key, o11), null != (s19 == null ? void 0 : s19.pixelBlock)) {
      const e18 = { extent: s19.extent, pixelBlock: s19.pixelBlock };
      r15.rawPixelData = e18, r15.symbolizerParameters = i11, r15.source = this._sampleVectorFieldData(s19.pixelBlock, i11, r15.offset);
    } else {
      const e18 = [Math.round((this._tileInfoView.tileInfo.size[0] - r15.offset[0]) / o11), Math.round((this._tileInfoView.tileInfo.size[1] - r15.offset[1]) / o11)], t7 = this.createEmptyTilePixelBlock(e18);
      r15.source = t7, r15.symbolizerParameters = i11;
    }
    return r15.invalidateVAO(), Promise.resolve();
  }
  updateTileSymbolizerParameters(e17, t6) {
    var _a;
    const i11 = t6.local, { symbolTileSize: r15 } = i11, { tileData: o11 } = e17;
    o11.offset = this._getTileSymbolOffset(o11.key, r15);
    const s19 = o11.symbolizerParameters.symbolTileSize;
    o11.symbolizerParameters = i11;
    const l3 = (_a = o11.rawPixelData) == null ? void 0 : _a.pixelBlock;
    return null != l3 && s19 !== r15 && (o11.source = this._sampleVectorFieldData(l3, o11.symbolizerParameters, o11.offset)), Promise.resolve();
  }
  attach() {
    super.attach(), this.container = new o10(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this._updateSymbolType(this.layer.renderer), this._handle = d(() => this.layer.renderer, (e17) => this._updateSymbolType(e17));
  }
  detach() {
    var _a;
    super.detach(), this.container.removeAllChildren(), (_a = this._handle) == null ? void 0 : _a.remove(), this._handle = null, this.container = null;
  }
  _getTileSymbolOffset(e17, t6) {
    const i11 = e17.col * this._tileInfoView.tileInfo.size[0] % t6, r15 = e17.row * this._tileInfoView.tileInfo.size[1] % t6;
    return [i11 > t6 / 2 ? t6 - i11 : -i11, r15 > t6 / 2 ? t6 - r15 : -r15];
  }
  _sampleVectorFieldData(e17, t6, i11) {
    const { symbolTileSize: r15 } = t6;
    return S2(e17, "vector-uv", r15, i11);
  }
  _updateSymbolType(e17) {
    "vector-field" === e17.type && (this.container.symbolTypes = "wind-barb" === e17.style ? ["scalar", "triangle"] : "simple-scalar" === e17.style ? ["scalar"] : ["triangle"]);
  }
};
e([y()], a22.prototype, "container", void 0), e([y()], a22.prototype, "layer", void 0), e([y()], a22.prototype, "type", void 0), a22 = e([a("esri.views.2d.layers.imagery.VectorFieldTileView2D")], a22);
var n21 = a22;

// ../node_modules/@arcgis/core/views/layers/ImageryTileLayerView.js
var u4 = (u5) => {
  let p4 = class extends u5 {
    constructor() {
      super(...arguments), this._rasterFieldPrefix = "Raster.", this.layer = null, this.view = null, this.tileInfo = null;
    }
    get fullExtent() {
      return this._getfullExtent();
    }
    get timeExtent() {
      var _a;
      return i5(this.layer, (_a = this.view) == null ? void 0 : _a.timeExtent, this._get("timeExtent"));
    }
    get hasTilingEffects() {
      return !!(this.layer.renderer && "dynamicRangeAdjustment" in this.layer.renderer && this.layer.renderer.dynamicRangeAdjustment);
    }
    get datumTransformation() {
      return v(this.layer.fullExtent, this.view.spatialReference, true);
    }
    supportsSpatialReference(e17) {
      return !!se(this.layer.serviceRasterInfo, e17);
    }
    async fetchPopupFeaturesAtLocation(e17, i11) {
      var _a;
      const { layer: s19 } = this;
      if (!e17) throw new s("imageryTileLayerView:fetchPopupFeatures", "Nothing to fetch without area", { layer: s19 });
      const { popupEnabled: a23 } = s19, o11 = p(s19, i11);
      if (!a23 || null == o11) return [];
      const n22 = [], { value: u6, magdirValue: p5, processedValue: c5 } = await s19.identify(e17, { timeExtent: this.timeExtent, signal: i11 == null ? void 0 : i11.signal });
      let m7 = "";
      if (u6 == null ? void 0 : u6.length) {
        m7 = "imagery-tile" === s19.type && s19.hasStandardTime() && null != u6[0] ? u6.map((e19) => s19.getStandardTimeValue(e19)).join(", ") : u6.join(", ");
        const e18 = { ObjectId: 0 }, r15 = "Raster.ServicePixelValue";
        e18[r15] = "imagery-tile" === s19.type && "Function" === s19.raster.datasetFormat ? c5 == null ? void 0 : c5.join(", ") : m7, e18[r15 + ".Raw"] = m7;
        const i12 = ((_a = s19.raster) == null ? void 0 : _a.rasterInfo) ?? s19.serviceRasterInfo, a24 = i12 == null ? void 0 : i12.attributeTable;
        if (null != a24) {
          const { fields: t6, features: i13 } = a24, s20 = t6.find(({ name: e19 }) => "value" === e19.toLowerCase()), o13 = e18[r15], n23 = s20 ? i13.find((e19) => String(e19.attributes[s20.name]) === o13) : null;
          if (n23) {
            for (const r16 in n23.attributes) if (n23.attributes.hasOwnProperty(r16)) {
              e18[this._rasterFieldPrefix + r16] = n23.attributes[r16];
            }
          }
        }
        const o12 = i12 == null ? void 0 : i12.dataType;
        "vector-magdir" !== o12 && "vector-uv" !== o12 || (e18["Raster.Magnitude"] = p5 == null ? void 0 : p5[0], e18["Raster.Direction"] = p5 == null ? void 0 : p5[1]);
        const l3 = new d2({ geometry: this.fullExtent.clone(), attributes: e18, layer: s19, sourceLayer: s19 });
        n22.push(l3);
      }
      return n22;
    }
    _getfullExtent() {
      return se(this.layer.serviceRasterInfo, this.view.spatialReference);
    }
  };
  return e([y()], p4.prototype, "fullExtent", null), e([y()], p4.prototype, "layer", void 0), e([y({ readOnly: true })], p4.prototype, "timeExtent", null), e([y()], p4.prototype, "view", void 0), e([y()], p4.prototype, "tileInfo", void 0), e([y({ readOnly: true })], p4.prototype, "hasTilingEffects", null), e([y()], p4.prototype, "datumTransformation", null), p4 = e([a("esri.views.layers.ImageryTileLayerView")], p4), p4;
};

// ../node_modules/@arcgis/core/views/2d/layers/ImageryTileLayerView2D.js
var b3 = class extends u4(i4(f(y2))) {
  constructor() {
    super(...arguments), this._useWebGLForProcessing = true, this._useProgressiveUpdate = true, this.subview = null;
  }
  get useWebGLForProcessing() {
    return this._useWebGLForProcessing;
  }
  set useWebGLForProcessing(e17) {
    this._useWebGLForProcessing = e17, this.subview && "useWebGLForProcessing" in this.subview && (this.subview.useWebGLForProcessing = e17);
  }
  get useProgressiveUpdate() {
    return this._useWebGLForProcessing;
  }
  set useProgressiveUpdate(e17) {
    this._useProgressiveUpdate = e17, this.subview && "useProgressiveUpdate" in this.subview && (this.subview.useProgressiveUpdate = e17);
  }
  get displayParameters() {
    const { layer: e17 } = this, s19 = this._get("displayParameters");
    return e17.renderer ? { bandIds: e17.bandIds, renderer: e17.renderer, interpolation: e17.interpolation, multidimensionalDefinition: e17.multidimensionalDefinition, rasterFunction: "imagery-tile" === e17.type ? e17.rasterFunction : null } : s19;
  }
  update(e17) {
    var _a;
    (_a = this.subview) == null ? void 0 : _a.update(e17), this.notifyChange("updating");
  }
  isUpdating() {
    return !this.subview || this.subview.updating;
  }
  attach() {
    this.layer.increaseRasterJobHandlerUsage(), this._updateSubview(), this.addAttachHandles([d(() => this.displayParameters, (e17, t6) => {
      const r15 = e17.interpolation !== (t6 == null ? void 0 : t6.interpolation) && ("majority" === e17.interpolation || "majority" === (t6 == null ? void 0 : t6.interpolation)) && r4(this.layer), o11 = e17.renderer !== (t6 == null ? void 0 : t6.renderer) && this._getSubviewType(t6 == null ? void 0 : t6.renderer) !== this._getSubviewType(e17.renderer);
      o11 && this._updateSubview();
      const a23 = e17.multidimensionalDefinition !== (t6 == null ? void 0 : t6.multidimensionalDefinition), n22 = e17.rasterFunction !== (t6 == null ? void 0 : t6.rasterFunction), u5 = n22 && !this._useWebGLForProcessing, h7 = a23 || r15 || o11 || u5;
      this.subview.redrawOrRefetch({ refetch: h7, reprocess: n22 }).catch((e18) => {
        b(e18) || n.getLogger(this).error(e18);
      }), this.notifyChange("updating");
    }), d(() => this.layer.multidimensionalSubset ?? null, (e17, t6) => {
      const { multidimensionalDefinition: r15 } = this.layer;
      null != r15 && o2(r15, e17) !== o2(r15, t6) && (this.subview.redrawOrRefetch({ refetch: true }).catch((e18) => {
        b(e18) || n.getLogger(this).error(e18);
      }), this.notifyChange("updating"));
    }, C), d(() => this.timeExtent, () => {
      this.subview.timeExtent = this.timeExtent, this.subview.redrawOrRefetch({ refetch: true }).catch((e17) => {
        b(e17) || n.getLogger(this).error(e17);
      });
    }, P)]);
  }
  detach() {
    var _a;
    this.layer.decreaseRasterJobHandlerUsage(), this._detachSubview(this.subview), (_a = this.subview) == null ? void 0 : _a.destroy(), this.subview = null;
  }
  viewChange() {
    this.requestUpdate();
  }
  moveEnd() {
    this.subview.moveEnd();
  }
  doRefresh() {
    return this.subview ? this.subview.doRefresh() : Promise.resolve();
  }
  _updateSubview() {
    var _a;
    const { renderer: e17 } = this.layer;
    if (!e17) return;
    const s19 = this._getSubviewType(e17);
    if (this.subview) {
      if (this.subview.type === s19) return void this._attachSubview(this.subview);
      this._detachSubview(this.subview), (_a = this.subview) == null ? void 0 : _a.destroy(), this.subview = null;
    }
    const { layer: i11 } = this;
    let t6;
    if (t6 = "rasterVF" === s19 ? new n21({ layer: i11, layerView: this }) : "flow" === s19 ? new d3({ layer: i11, layerView: this }) : new l2({ layer: i11, layerView: this }), "useWebGLForProcessing" in t6 && (t6.useWebGLForProcessing = this._useWebGLForProcessing), "useProgressiveUpdate" in t6 && (t6.useProgressiveUpdate = this._useProgressiveUpdate), "previousLOD" in t6) {
      const { subview: e18 } = this;
      t6.previousLOD = e18 && "previousLOD" in e18 ? e18.previousLOD : null;
    }
    this._attachSubview(t6), this.subview = t6, this.requestUpdate();
  }
  _attachSubview(e17) {
    e17 && !e17.attached && (e17.attach(), e17.attached = true, this.container.addChildAt(e17.container, 0));
  }
  _detachSubview(e17) {
    (e17 == null ? void 0 : e17.attached) && (this.container.removeChild(e17.container), e17.detach(), e17.attached = false);
  }
  _getSubviewType(e17) {
    const s19 = e17 == null ? void 0 : e17.type;
    return "vector-field" === s19 ? "rasterVF" : "flow" === s19 ? "flow" : "raster";
  }
};
e([y()], b3.prototype, "subview", void 0), e([y()], b3.prototype, "useWebGLForProcessing", null), e([y()], b3.prototype, "useProgressiveUpdate", null), e([y({ readOnly: true })], b3.prototype, "displayParameters", null), b3 = e([a("esri.views.2d.layers.ImageryTileLayerView2D")], b3);
var g4 = b3;
export {
  g4 as default
};
//# sourceMappingURL=ImageryTileLayerView2D-CAJU6AJI.js.map
