import {
  t as t11
} from "./chunk-4WNCED5D.js";
import {
  t as t10
} from "./chunk-XJMUILUK.js";
import {
  R as R2
} from "./chunk-SYU3UT5R.js";
import {
  J,
  i as i8
} from "./chunk-AMVHUQMF.js";
import {
  O as O4,
  O2 as O5,
  c as c4,
  c2 as c5,
  d,
  e as e12,
  f as f4,
  h as h3,
  o2 as o8,
  o3 as o9,
  o5 as o11,
  r as r9,
  r2 as r10,
  r3 as r11,
  r4 as r12,
  t2 as t12,
  u as u7
} from "./chunk-KPCHTGP2.js";
import "./chunk-LVLFR7HJ.js";
import {
  S as S2,
  _ as _5,
  h as h4,
  l as l9,
  o as o10
} from "./chunk-LMPNMUNH.js";
import "./chunk-FMECO4I3.js";
import "./chunk-AGBLTPV7.js";
import "./chunk-PTZQ7V6T.js";
import {
  l2 as l8,
  n as n7,
  n2 as n8,
  o2 as o6,
  o3 as o7,
  t as t7,
  t2 as t8
} from "./chunk-O7D6ZSDY.js";
import {
  r as r8
} from "./chunk-N7IDH6EP.js";
import {
  N,
  e as e11,
  n as n9,
  s as s7,
  t as t9,
  u as u6
} from "./chunk-J4UNWSS7.js";
import {
  v
} from "./chunk-5SIVFK3W.js";
import {
  a as a4,
  n2 as n6,
  o as o5,
  r as r7
} from "./chunk-GRO6TRQ6.js";
import "./chunk-BMX34DUY.js";
import "./chunk-2CZAGFZF.js";
import "./chunk-V4RHVJ2H.js";
import {
  V,
  _ as _4,
  s as s6
} from "./chunk-2PUGZZAH.js";
import {
  c2 as c3,
  e2 as e10,
  u2 as u5
} from "./chunk-4ZTHXCOS.js";
import {
  a as a3
} from "./chunk-CL2YKTVD.js";
import {
  I as I2,
  L as L3,
  t as t6
} from "./chunk-ZEOXREFF.js";
import "./chunk-5BIU5HC2.js";
import "./chunk-4K57JS64.js";
import "./chunk-DOINOMWZ.js";
import {
  H as H2,
  t as t4
} from "./chunk-U23SDH2H.js";
import "./chunk-HCN6M4ZV.js";
import {
  l as l5,
  t as t3
} from "./chunk-KWTQCB43.js";
import {
  s as s4
} from "./chunk-UNI34X2Q.js";
import {
  D,
  G as G4,
  I,
  L as L2,
  O as O3,
  R,
  X,
  c as c2,
  f
} from "./chunk-POOHJZAR.js";
import {
  e as e6
} from "./chunk-RRSX64BO.js";
import {
  n as n5,
  s as s5
} from "./chunk-6KYG4MCU.js";
import {
  e as e9,
  f as f2,
  l as l6,
  o as o4
} from "./chunk-VJBBHRSD.js";
import "./chunk-D7WIM7VD.js";
import "./chunk-XIC3SN6R.js";
import {
  e as e8,
  o as o3,
  r as r6
} from "./chunk-WX4IZMIC.js";
import {
  e as e7,
  t as t5
} from "./chunk-T5CIHLIU.js";
import {
  E,
  L,
  O as O2,
  c,
  i as i5,
  q as q2,
  u as u4,
  x,
  y as y2
} from "./chunk-XXTMACWZ.js";
import {
  a as a2
} from "./chunk-BPQ42BUB.js";
import {
  f as f3,
  i as i7
} from "./chunk-O45ZPWWN.js";
import {
  l as l7
} from "./chunk-CBN77ZVG.js";
import {
  l as l4
} from "./chunk-TNRF7MOE.js";
import {
  i as i6,
  j,
  n as n4
} from "./chunk-PNPG5IXD.js";
import "./chunk-CYGO6TZX.js";
import {
  r as r4
} from "./chunk-XEELLOJE.js";
import "./chunk-G5U2OA3R.js";
import {
  r as r5
} from "./chunk-NREDFKHH.js";
import "./chunk-DCOKV3EO.js";
import "./chunk-LTSQHA4C.js";
import {
  G as G3,
  H,
  h as h2
} from "./chunk-T4EIRKFE.js";
import "./chunk-6LV4OO46.js";
import {
  A as A2,
  G as G2,
  P as P2,
  h,
  i as i4
} from "./chunk-BJHLU2MM.js";
import "./chunk-7PMYO342.js";
import "./chunk-3DBICPHD.js";
import {
  _
} from "./chunk-7R5XEKR3.js";
import {
  o
} from "./chunk-ZK4LSXOH.js";
import "./chunk-XFU3BDEI.js";
import "./chunk-WLUQPLAY.js";
import "./chunk-AL3F322A.js";
import {
  _ as _3
} from "./chunk-6N5YXCNN.js";
import {
  A,
  G,
  K,
  O,
  P,
  S,
  U as U3,
  _2,
  e as e4,
  e2 as e5,
  g,
  i as i3,
  l as l3,
  n as n3,
  o as o2,
  p,
  q,
  r as r2,
  r2 as r3,
  s2 as s3,
  t as t2,
  u as u3,
  z
} from "./chunk-MJ2NSPP7.js";
import "./chunk-6YSPJNLC.js";
import "./chunk-66KCMKB5.js";
import "./chunk-ZART2Y5J.js";
import "./chunk-F4OBDVPS.js";
import "./chunk-X3IFQMC4.js";
import "./chunk-4ZEH5SNV.js";
import "./chunk-Z6R2SP3D.js";
import {
  n as n2
} from "./chunk-K4UOG562.js";
import {
  U as U2,
  Z,
  i2,
  tt
} from "./chunk-WC4SPMPL.js";
import {
  e3
} from "./chunk-TJUEGVVG.js";
import "./chunk-FXNOKZ3B.js";
import "./chunk-GEH2VXFC.js";
import {
  e
} from "./chunk-BJY5ADVY.js";
import {
  a,
  m,
  s as s2,
  u as u2
} from "./chunk-VMWKLHJD.js";
import {
  l,
  r
} from "./chunk-5AEITAWU.js";
import {
  l as l2
} from "./chunk-G36SOMYZ.js";
import {
  n2 as n,
  s2 as s
} from "./chunk-YNL57W4I.js";
import {
  U,
  e as e2,
  has,
  i,
  t3 as t,
  u,
  y2 as y
} from "./chunk-2PA5UPTB.js";
import "./chunk-XZXEUADC.js";

// ../node_modules/@arcgis/core/views/3d/glTF/internal/TextureTransformUtils.js
function s8(s15) {
  if (null == s15) return null;
  const a10 = null != s15.offset ? s15.offset : i7, n12 = null != s15.rotation ? s15.rotation : 0, e14 = null != s15.scale ? s15.scale : f3, f9 = t5(1, 0, 0, 0, 1, 0, a10[0], a10[1], 1), c13 = t5(Math.cos(n12), -Math.sin(n12), 0, Math.sin(n12), Math.cos(n12), 0, 0, 0, 1), m7 = t5(e14[0], 0, 0, 0, e14[1], 0, 0, 0, 1), u13 = e7();
  return i6(u13, c13, m7), i6(u13, f9, u13), u13;
}

// ../node_modules/@arcgis/core/views/3d/layers/graphics/ProcessedObjectResource.js
var s9 = class {
  constructor() {
    this.geometries = new Array(), this.materials = new Array(), this.textures = new Array();
  }
};
var t13 = class {
  constructor(t19, e14, r18) {
    this.name = t19, this.lodThreshold = e14, this.pivotOffset = r18, this.stageResources = new s9(), this.numberOfVertices = 0;
  }
};

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/AttributeArray.js
function o12(o20) {
  if (o20.length < U) return Array.from(o20);
  if (y(o20)) return Float64Array.from(o20);
  if (!("BYTES_PER_ELEMENT" in o20)) return Array.from(o20);
  switch (o20.BYTES_PER_ELEMENT) {
    case 1:
      return Uint8Array.from(o20);
    case 2:
      return i(o20) ? Uint16Array.from(o20) : Int16Array.from(o20);
    case 4:
      return Float32Array.from(o20);
    default:
      return Float64Array.from(o20);
  }
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/BoundingInfo.js
var o13 = class _o {
  constructor(i13, e14, o20) {
    this.primitiveIndices = i13, this._numIndexPerPrimitive = e14, this.position = o20, this._children = void 0, s4(i13.length >= 1), s4(3 === o20.size || 4 === o20.size);
    const { data: c13, size: l13, indices: m7 } = o20;
    s4(m7.length % this._numIndexPerPrimitive == 0), s4(m7.length >= i13.length * this._numIndexPerPrimitive);
    const d6 = i13.length;
    let u13 = l13 * m7[this._numIndexPerPrimitive * i13[0]];
    a5.clear(), a5.push(u13);
    const f9 = r2(c13[u13], c13[u13 + 1], c13[u13 + 2]), x4 = t2(f9);
    for (let t19 = 0; t19 < d6; ++t19) {
      const e15 = this._numIndexPerPrimitive * i13[t19];
      for (let i14 = 0; i14 < this._numIndexPerPrimitive; ++i14) {
        u13 = l13 * m7[e15 + i14], a5.push(u13);
        let t20 = c13[u13];
        f9[0] = Math.min(t20, f9[0]), x4[0] = Math.max(t20, x4[0]), t20 = c13[u13 + 1], f9[1] = Math.min(t20, f9[1]), x4[1] = Math.max(t20, x4[1]), t20 = c13[u13 + 2], f9[2] = Math.min(t20, f9[2]), x4[2] = Math.max(t20, x4[2]);
      }
    }
    this.bbMin = f9, this.bbMax = x4;
    const P6 = A(n3(), this.bbMin, this.bbMax, 0.5);
    this.radius = 0.5 * Math.max(Math.max(x4[0] - f9[0], x4[1] - f9[1]), x4[2] - f9[2]);
    let v5 = this.radius * this.radius;
    for (let t19 = 0; t19 < a5.length; ++t19) {
      u13 = a5.at(t19);
      const i14 = c13[u13] - P6[0], e15 = c13[u13 + 1] - P6[1], s15 = c13[u13 + 2] - P6[2], r18 = i14 * i14 + e15 * e15 + s15 * s15;
      if (r18 <= v5) continue;
      const n12 = Math.sqrt(r18), h10 = 0.5 * (n12 - this.radius);
      this.radius = this.radius + h10, v5 = this.radius * this.radius;
      const o21 = h10 / n12;
      P6[0] += i14 * o21, P6[1] += e15 * o21, P6[2] += s15 * o21;
    }
    this.center = P6, a5.clear();
  }
  getChildren() {
    if (this._children || p(this.bbMin, this.bbMax) <= 1) return this._children;
    const i13 = A(n3(), this.bbMin, this.bbMax, 0.5), s15 = this.primitiveIndices.length, r18 = new Uint8Array(s15), h10 = new Array(8);
    for (let t19 = 0; t19 < 8; ++t19) h10[t19] = 0;
    const { data: a10, size: c13, indices: l13 } = this.position;
    for (let t19 = 0; t19 < s15; ++t19) {
      let e14 = 0;
      const s16 = this._numIndexPerPrimitive * this.primitiveIndices[t19];
      let n12 = c13 * l13[s16], o20 = a10[n12], m8 = a10[n12 + 1], d7 = a10[n12 + 2];
      for (let i14 = 1; i14 < this._numIndexPerPrimitive; ++i14) {
        n12 = c13 * l13[s16 + i14];
        const t20 = a10[n12], e15 = a10[n12 + 1], r19 = a10[n12 + 2];
        t20 < o20 && (o20 = t20), e15 < m8 && (m8 = e15), r19 < d7 && (d7 = r19);
      }
      o20 < i13[0] && (e14 |= 1), m8 < i13[1] && (e14 |= 2), d7 < i13[2] && (e14 |= 4), r18[t19] = e14, ++h10[e14];
    }
    let m7 = 0;
    for (let t19 = 0; t19 < 8; ++t19) h10[t19] > 0 && ++m7;
    if (m7 < 2) return;
    const d6 = new Array(8);
    for (let t19 = 0; t19 < 8; ++t19) d6[t19] = h10[t19] > 0 ? new Uint32Array(h10[t19]) : void 0;
    for (let t19 = 0; t19 < 8; ++t19) h10[t19] = 0;
    for (let t19 = 0; t19 < s15; ++t19) {
      const i14 = r18[t19];
      d6[i14][h10[i14]++] = this.primitiveIndices[t19];
    }
    this._children = new Array();
    for (let t19 = 0; t19 < 8; ++t19) void 0 !== d6[t19] && this._children.push(new _o(d6[t19], this._numIndexPerPrimitive, this.position));
    return this._children;
  }
  static prune() {
    a5.prune();
  }
};
var a5 = new l2({ deallocator: null });

// ../node_modules/@arcgis/core/geometry/support/triangle.js
function j3(t19) {
  return t19 ? { p0: t2(t19.p0), p1: t2(t19.p1), p2: t2(t19.p2) } : { p0: n3(), p1: n3(), p2: n3() };
}
function d2(t19, e14, o20) {
  return e5(M, e14, t19), e5(O6, o20, t19), 0.5 * s3(_2(M, M, O6));
}
var w = new s6(v);
var x2 = new s6(() => j3());
var M = n3();
var O6 = n3();

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/geometryDataUtils.js
function i9(r18, s15) {
  if (!r18) return false;
  const { size: i13, data: c13, indices: f9 } = r18;
  o2(s15, 0, 0, 0), o2(m2, 0, 0, 0);
  let g4 = 0, d6 = 0;
  for (let p6 = 0; p6 < f9.length - 2; p6 += 3) {
    const r19 = f9[p6] * i13, h10 = f9[p6 + 1] * i13, j8 = f9[p6 + 2] * i13;
    o2(a6, c13[r19], c13[r19 + 1], c13[r19 + 2]), o2(l10, c13[h10], c13[h10 + 1], c13[h10 + 2]), o2(u8, c13[j8], c13[j8 + 1], c13[j8 + 2]);
    const z5 = d2(a6, l10, u8);
    z5 ? (u3(a6, a6, l10), u3(a6, a6, u8), g(a6, a6, 1 / 3 * z5), u3(s15, s15, a6), g4 += z5) : (u3(m2, m2, a6), u3(m2, m2, l10), u3(m2, m2, u8), d6 += 3);
  }
  return (0 !== d6 || 0 !== g4) && (0 !== g4 ? (g(s15, s15, 1 / g4), true) : 0 !== d6 && (g(s15, m2, 1 / d6), true));
}
function c7(e14, r18) {
  if (!e14) return false;
  const { size: s15, data: o20, indices: i13 } = e14;
  o2(r18, 0, 0, 0);
  let c13 = -1, f9 = 0;
  for (let t19 = 0; t19 < i13.length; t19++) {
    const e15 = i13[t19] * s15;
    c13 !== e15 && (r18[0] += o20[e15], r18[1] += o20[e15 + 1], r18[2] += o20[e15 + 2], f9++), c13 = e15;
  }
  return f9 > 1 && g(r18, r18, 1 / f9), f9 > 0;
}
function f5(s15, o20, i13) {
  if (!s15) return false;
  o2(i13, 0, 0, 0), o2(m2, 0, 0, 0);
  let c13 = 0, f9 = 0;
  const { size: u13, data: g4, indices: d6 } = s15, p6 = d6.length - 1, h10 = p6 + (o20 ? 2 : 0);
  for (let t19 = 0; t19 < h10; t19 += 2) {
    const s16 = t19 < p6 ? t19 + 1 : 0, o21 = d6[t19 < p6 ? t19 : p6] * u13, h11 = d6[s16] * u13;
    a6[0] = g4[o21], a6[1] = g4[o21 + 1], a6[2] = g4[o21 + 2], l10[0] = g4[h11], l10[1] = g4[h11 + 1], l10[2] = g4[h11 + 2], g(a6, u3(a6, a6, l10), 0.5);
    const j8 = U3(a6, l10);
    j8 > 0 ? (u3(i13, i13, g(a6, a6, j8)), c13 += j8) : 0 === c13 && (u3(m2, m2, a6), f9++);
  }
  return 0 !== c13 ? (g(i13, i13, 1 / c13), true) : 0 !== f9 && (g(i13, m2, 1 / f9), true);
}
var a6 = n3();
var l10 = n3();
var u8 = n3();
var m2 = n3();

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateID.js
var r13 = class {
  constructor(r18) {
    this.channel = r18, this.id = e3();
  }
};

// ../node_modules/@arcgis/core/views/3d/webgl-engine/materials/renderers/utils.js
function n10(t19, e14) {
  return null == t19 && (t19 = []), t19.push(e14), t19;
}
function r14(t19, e14) {
  if (null == t19) return null;
  const n12 = t19.filter((t20) => t20 !== e14);
  return 0 === n12.length ? null : n12;
}
var o14 = n3();
var s10 = new Float32Array(6);

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Geometry.js
var I3 = class _I extends r9 {
  constructor(t19, i13, e14 = null, s15 = e12.Mesh, r18 = null, o20 = -1) {
    super(), this.material = t19, this.mapPositions = e14, this.type = s15, this.objectAndLayerIdColor = r18, this.edgeIndicesLength = o20, this.visible = true, this._attributes = /* @__PURE__ */ new Map(), this._boundingInfo = null;
    for (const [h10, a10] of i13) this._attributes.set(h10, { ...a10, indices: t3(a10.indices) }), h10 === e6.POSITION && (this.edgeIndicesLength = this.edgeIndicesLength < 0 ? this._attributes.get(h10).indices.length : this.edgeIndicesLength);
  }
  instantiate(t19 = {}) {
    const i13 = new _I(t19.material || this.material, [], this.mapPositions, this.type, this.objectAndLayerIdColor, this.edgeIndicesLength);
    return this._attributes.forEach((t20, e14) => {
      t20.exclusive = false, i13._attributes.set(e14, t20);
    }), i13._boundingInfo = this._boundingInfo, i13.transformation = t19.transformation || this.transformation, i13;
  }
  get attributes() {
    return this._attributes;
  }
  getMutableAttribute(t19) {
    let i13 = this._attributes.get(t19);
    return i13 && !i13.exclusive && (i13 = { ...i13, exclusive: true, data: o12(i13.data) }, this._attributes.set(t19, i13)), i13;
  }
  setAttributeData(t19, i13) {
    const e14 = this._attributes.get(t19);
    e14 && this._attributes.set(t19, { ...e14, exclusive: true, data: i13 });
  }
  get indexCount() {
    const t19 = this._attributes.values().next().value.indices;
    return (t19 == null ? void 0 : t19.length) ?? 0;
  }
  get faceCount() {
    return this.indexCount / 3;
  }
  get boundingInfo() {
    return null == this._boundingInfo && (this._boundingInfo = this._calculateBoundingInfo()), this._boundingInfo;
  }
  computeAttachmentOrigin(t19) {
    return !!(this.type === e12.Mesh ? this._computeAttachmentOriginTriangles(t19) : this.type === e12.Line ? this._computeAttachmentOriginLines(t19) : this._computeAttachmentOriginPoints(t19)) && (null != this._transformation && O(t19, t19, this._transformation), true);
  }
  _computeAttachmentOriginTriangles(t19) {
    const i13 = this.attributes.get(e6.POSITION);
    return i9(i13, t19);
  }
  _computeAttachmentOriginLines(t19) {
    const i13 = this.attributes.get(e6.POSITION);
    return f5(i13, _6(this.material.parameters, i13), t19);
  }
  _computeAttachmentOriginPoints(t19) {
    const i13 = this.attributes.get(e6.POSITION);
    return c7(i13, t19);
  }
  invalidateBoundingInfo() {
    this._boundingInfo = null;
  }
  _calculateBoundingInfo() {
    const t19 = this.attributes.get(e6.POSITION);
    if (!t19 || 0 === t19.indices.length) return null;
    const i13 = this.type === e12.Mesh ? 3 : 1;
    s4(t19.indices.length % i13 == 0, "Indexing error: " + t19.indices.length + " not divisible by " + i13);
    const e14 = l5(t19.indices.length / i13);
    return new o13(e14, i13, t19);
  }
  get transformation() {
    return this._transformation ?? o3;
  }
  set transformation(e14) {
    this._transformation = e14 && e14 !== o3 ? r6(e14) : null;
  }
  addHighlight() {
    const t19 = new r13(t9.Highlight);
    return this.highlights = n10(this.highlights, t19), t19;
  }
  removeHighlight(t19) {
    this.highlights = r14(this.highlights, t19);
  }
};
function _6(t19, i13) {
  return !(!("isClosed" in t19) || !t19.isClosed) && i13.indices.length > 2;
}

// ../node_modules/@arcgis/core/libs/basisu/BasisU.js
function i10() {
  return t15 ?? (t15 = (async () => {
    const i13 = await import("./basis_transcoder-UG4VP44E.js"), t19 = await i13.default({ locateFile: (i14) => n2(`esri/libs/basisu/${i14}`) });
    return t19.initializeBasis(), t19;
  })()), t15;
}
var t15;

// ../node_modules/@arcgis/core/libs/basisu/TextureFormat.js
var _7;
!function(_11) {
  _11[_11.ETC1_RGB = 0] = "ETC1_RGB", _11[_11.ETC2_RGBA = 1] = "ETC2_RGBA", _11[_11.BC1_RGB = 2] = "BC1_RGB", _11[_11.BC3_RGBA = 3] = "BC3_RGBA", _11[_11.BC4_R = 4] = "BC4_R", _11[_11.BC5_RG = 5] = "BC5_RG", _11[_11.BC7_M6_RGB = 6] = "BC7_M6_RGB", _11[_11.BC7_M5_RGBA = 7] = "BC7_M5_RGBA", _11[_11.PVRTC1_4_RGB = 8] = "PVRTC1_4_RGB", _11[_11.PVRTC1_4_RGBA = 9] = "PVRTC1_4_RGBA", _11[_11.ASTC_4x4_RGBA = 10] = "ASTC_4x4_RGBA", _11[_11.ATC_RGB = 11] = "ATC_RGB", _11[_11.ATC_RGBA = 12] = "ATC_RGBA", _11[_11.FXT1_RGB = 17] = "FXT1_RGB", _11[_11.PVRTC2_4_RGB = 18] = "PVRTC2_4_RGB", _11[_11.PVRTC2_4_RGBA = 19] = "PVRTC2_4_RGBA", _11[_11.ETC2_EAC_R11 = 20] = "ETC2_EAC_R11", _11[_11.ETC2_EAC_RG11 = 21] = "ETC2_EAC_RG11", _11[_11.RGBA32 = 13] = "RGBA32", _11[_11.RGB565 = 14] = "RGB565", _11[_11.BGR565 = 15] = "BGR565", _11[_11.RGBA4444 = 16] = "RGBA4444";
}(_7 || (_7 = {}));

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/BasisUtil.js
var l11 = null;
var o15 = null;
async function g2() {
  return null == o15 && (o15 = i10(), l11 = await o15), o15;
}
function u9(e14, t19) {
  if (null == l11) return e14.byteLength;
  const n12 = new l11.BasisFile(new Uint8Array(e14)), s15 = E2(n12) ? m3(n12.getNumLevels(0), n12.getHasAlpha(), n12.getImageWidth(0, 0), n12.getImageHeight(0, 0), t19) : 0;
  return n12.close(), n12.delete(), s15;
}
function c8(e14, t19) {
  if (null == l11) return e14.byteLength;
  const n12 = new l11.KTX2File(new Uint8Array(e14)), s15 = T(n12) ? m3(n12.getLevels(), n12.getHasAlpha(), n12.getWidth(), n12.getHeight(), t19) : 0;
  return n12.close(), n12.delete(), s15;
}
function m3(e14, t19, s15, r18, i13) {
  const l13 = u5(t19 ? c2.COMPRESSED_RGBA8_ETC2_EAC : c2.COMPRESSED_RGB8_ETC2), o20 = i13 && e14 > 1 ? (4 ** e14 - 1) / (3 * 4 ** (e14 - 1)) : 1;
  return Math.ceil(s15 * r18 * l13 * o20);
}
function E2(e14) {
  return e14.getNumImages() >= 1 && !e14.isUASTC();
}
function T(e14) {
  return e14.getFaces() >= 1 && e14.isETC1S();
}
async function h5(e14, t19, n12) {
  null == l11 && (l11 = await g2());
  const s15 = new l11.BasisFile(new Uint8Array(n12));
  if (!E2(s15)) return null;
  s15.startTranscoding();
  const r18 = p2(e14, t19, s15.getNumLevels(0), s15.getHasAlpha(), s15.getImageWidth(0, 0), s15.getImageHeight(0, 0), (e15, t20) => s15.getImageTranscodedSizeInBytes(0, e15, t20), (e15, t20, n13) => s15.transcodeImage(n13, 0, e15, t20, 0, 0));
  return s15.close(), s15.delete(), r18;
}
async function _8(e14, t19, n12) {
  null == l11 && (l11 = await g2());
  const s15 = new l11.KTX2File(new Uint8Array(n12));
  if (!T(s15)) return null;
  s15.startTranscoding();
  const r18 = p2(e14, t19, s15.getLevels(), s15.getHasAlpha(), s15.getWidth(), s15.getHeight(), (e15, t20) => s15.getImageTranscodedSizeInBytes(e15, 0, 0, t20), (e15, t20, n13) => s15.transcodeImage(n13, e15, 0, 0, t20, 0, -1, -1));
  return s15.close(), s15.delete(), r18;
}
function p2(e14, a10, l13, o20, g4, u13, c13, m7) {
  const { compressedTextureETC: E10, compressedTextureS3TC: T6 } = e14.capabilities, [h10, _11] = E10 ? o20 ? [_7.ETC2_RGBA, c2.COMPRESSED_RGBA8_ETC2_EAC] : [_7.ETC1_RGB, c2.COMPRESSED_RGB8_ETC2] : T6 ? o20 ? [_7.BC3_RGBA, c2.COMPRESSED_RGBA_S3TC_DXT5_EXT] : [_7.BC1_RGB, c2.COMPRESSED_RGB_S3TC_DXT1_EXT] : [_7.RGBA32, G4.RGBA], p6 = a10.hasMipmap ? l13 : Math.min(1, l13), A8 = [];
  for (let t19 = 0; t19 < p6; t19++) A8.push(new Uint8Array(c13(t19, h10))), m7(t19, h10, A8[t19]);
  return a10.internalFormat = _11, a10.hasMipmap = A8.length > 1, a10.samplingMode = a10.hasMipmap ? L2.LINEAR_MIPMAP_LINEAR : L2.LINEAR, a10.width = g4, a10.height = u13, new c3(e14, a10, { type: "compressed", levels: A8 });
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/DDSUtil.js
var o16 = () => n.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");
var a7 = 542327876;
var i11 = 131072;
var l12 = 4;
function s11(e14) {
  return e14.charCodeAt(0) + (e14.charCodeAt(1) << 8) + (e14.charCodeAt(2) << 16) + (e14.charCodeAt(3) << 24);
}
function u10(e14) {
  return String.fromCharCode(255 & e14, e14 >> 8 & 255, e14 >> 16 & 255, e14 >> 24 & 255);
}
var c9 = s11("DXT1");
var h6 = s11("DXT3");
var m4 = s11("DXT5");
var d3 = 31;
var p3 = 0;
var g3 = 1;
var D2 = 2;
var C = 3;
var f6 = 4;
var w2 = 7;
var T2 = 20;
var _9 = 21;
function E3(e14, r18, o20) {
  const a10 = S3(o20, r18.hasMipmap ?? false);
  if (null == a10) throw new Error("DDS texture data is null");
  const { textureData: i13, internalFormat: l13, width: s15, height: u13 } = a10;
  return r18.samplingMode = i13.levels.length > 1 ? L2.LINEAR_MIPMAP_LINEAR : L2.LINEAR, r18.hasMipmap = i13.levels.length > 1, r18.internalFormat = l13, r18.width = s15, r18.height = u13, new c3(e14, r18, i13);
}
function S3(e14, t19) {
  const n12 = new Int32Array(e14, 0, d3);
  if (n12[p3] !== a7) return o16().error("Invalid magic number in DDS header"), null;
  if (!(n12[T2] & l12)) return o16().error("Unsupported format, must contain a FourCC code"), null;
  const s15 = n12[_9];
  let E10, S6;
  switch (s15) {
    case c9:
      E10 = 8, S6 = c2.COMPRESSED_RGB_S3TC_DXT1_EXT;
      break;
    case h6:
      E10 = 16, S6 = c2.COMPRESSED_RGBA_S3TC_DXT3_EXT;
      break;
    case m4:
      E10 = 16, S6 = c2.COMPRESSED_RGBA_S3TC_DXT5_EXT;
      break;
    default:
      return o16().error("Unsupported FourCC code:", u10(s15)), null;
  }
  let A8 = 1, M5 = n12[f6], x4 = n12[C];
  (3 & M5 || 3 & x4) && (o16().warn("Rounding up compressed texture size to nearest multiple of 4."), M5 = M5 + 3 & -4, x4 = x4 + 3 & -4);
  const R8 = M5, X2 = x4;
  let b4, I7;
  n12[D2] & i11 && false !== t19 && (A8 = Math.max(1, n12[w2]));
  let v5 = n12[g3] + 4;
  const F = [];
  for (let r18 = 0; r18 < A8; ++r18) I7 = (M5 + 3 >> 2) * (x4 + 3 >> 2) * E10, b4 = new Uint8Array(e14, v5, I7), F.push(b4), v5 += I7, M5 = Math.max(1, M5 >> 1), x4 = Math.max(1, x4 >> 1);
  return { textureData: { type: "compressed", levels: F }, internalFormat: S6, width: R8, height: X2 };
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/textureUtils.js
function r15(t19, e14) {
  const n12 = 1048576, i13 = 4096, r18 = 2;
  let h10 = t19.width * t19.height;
  if (h10 < i13) return t19 instanceof ImageData ? a8(t19) : t19;
  let c13 = t19.width, u13 = t19.height;
  do {
    c13 = Math.ceil(c13 / r18), u13 = Math.ceil(u13 / r18), h10 = c13 * u13;
  } while (h10 > n12 || null != e14 && (c13 > e14 || u13 > e14));
  return o17(t19, c13, u13);
}
function h7(t19, e14) {
  const n12 = Math.max(t19.width, t19.height);
  if (n12 <= e14) return t19;
  const i13 = e14 / n12;
  return o17(t19, Math.round(t19.width * i13), Math.round(t19.height * i13));
}
function o17(t19, e14, n12) {
  if (t19 instanceof ImageData) return o17(a8(t19), e14, n12);
  const i13 = document.createElement("canvas");
  i13.width = e14, i13.height = n12;
  return i13.getContext("2d").drawImage(t19, 0, 0, i13.width, i13.height), i13;
}
function a8(e14) {
  const n12 = document.createElement("canvas");
  n12.width = e14.width, n12.height = e14.height;
  const i13 = n12.getContext("2d");
  if (null == i13) throw new s("Failed to create 2d context from HTMLCanvasElement");
  return i13.putImageData(e14, 0, 0), n12;
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js
var N2 = class extends r9 {
  get parameters() {
    return this._parameters;
  }
  constructor(e14, r18) {
    super(), this._data = e14, this.type = e12.Texture, this._glTexture = null, this._loadingPromise = null, this._loadingController = null, this.events = new o(), this._parameters = { ...M2, ...r18 }, this._startPreload(e14);
  }
  dispose() {
    this.unload(), this._data = this.frameUpdate = void 0;
  }
  _startPreload(e14) {
    null != e14 && (e14 instanceof HTMLVideoElement ? (this.frameUpdate = (t19) => this._frameUpdate(e14, t19), this._startPreloadVideoElement(e14)) : e14 instanceof HTMLImageElement && this._startPreloadImageElement(e14));
  }
  _startPreloadVideoElement(e14) {
    if (!(Z(e14.src) || "auto" === e14.preload && e14.crossOrigin)) {
      e14.preload = "auto", e14.crossOrigin = "anonymous";
      const t19 = !e14.paused;
      if (e14.src = e14.src, t19 && e14.autoplay) {
        const t20 = () => {
          e14.removeEventListener("canplay", t20), e14.play();
        };
        e14.addEventListener("canplay", t20);
      }
    }
  }
  _startPreloadImageElement(e14) {
    tt(e14.src) || Z(e14.src) || e14.crossOrigin || (e14.crossOrigin = "anonymous", e14.src = e14.src);
  }
  _createDescriptor(e14) {
    const t19 = new e10();
    return t19.wrapMode = this._parameters.wrap ?? D.REPEAT, t19.flipped = !this._parameters.noUnpackFlip, t19.samplingMode = this._parameters.mipmap ? L2.LINEAR_MIPMAP_LINEAR : L2.LINEAR, t19.hasMipmap = !!this._parameters.mipmap, t19.preMultiplyAlpha = !!this._parameters.preMultiplyAlpha, t19.maxAnisotropy = this._parameters.maxAnisotropy ?? (this._parameters.mipmap ? e14.parameters.maxMaxAnisotropy : 1), t19;
  }
  get glTexture() {
    return this._glTexture;
  }
  get memoryEstimate() {
    var _a;
    return ((_a = this._glTexture) == null ? void 0 : _a.usedMemory) || C2(this._data, this._parameters);
  }
  load(e14) {
    if (this._glTexture) return this._glTexture;
    if (this._loadingPromise) return this._loadingPromise;
    const t19 = this._data;
    return null == t19 ? (this._glTexture = new c3(e14, this._createDescriptor(e14), null), this._glTexture) : (this._parameters.reloadable || (this._data = void 0), "string" == typeof t19 ? this._loadFromURL(e14, t19) : t19 instanceof Image ? this._loadFromImageElement(e14, t19) : t19 instanceof HTMLVideoElement ? this._loadFromVideoElement(e14, t19) : t19 instanceof ImageData || t19 instanceof HTMLCanvasElement ? this._loadFromImage(e14, t19) : (t(t19) || u(t19)) && this._parameters.encoding === u6.DDS_ENCODING ? this._loadFromDDSData(e14, t19) : (t(t19) || u(t19)) && this._parameters.encoding === u6.KTX2_ENCODING ? this._loadFromKTX2(e14, t19) : (t(t19) || u(t19)) && this._parameters.encoding === u6.BASIS_ENCODING ? this._loadFromBasis(e14, t19) : u(t19) ? this._loadFromPixelData(e14, t19) : t(t19) ? this._loadFromPixelData(e14, new Uint8Array(t19)) : null);
  }
  _frameUpdate(e14, t19) {
    return null == this._glTexture || e14.readyState < V2.HAVE_CURRENT_DATA || t19 === e14.currentTime ? t19 : (this._glTexture.setData(e14), this._glTexture.descriptor.hasMipmap && this._glTexture.generateMipmap(), this._parameters.updateCallback && this._parameters.updateCallback(), e14.currentTime);
  }
  _loadFromDDSData(e14, t19) {
    return this._glTexture = E3(e14, this._createDescriptor(e14), t19), this._glTexture;
  }
  _loadFromKTX2(e14, t19) {
    return this._loadAsync(() => _8(e14, this._createDescriptor(e14), t19).then((e15) => (this._glTexture = e15, e15)));
  }
  _loadFromBasis(e14, t19) {
    return this._loadAsync(() => h5(e14, this._createDescriptor(e14), t19).then((e15) => (this._glTexture = e15, e15)));
  }
  _loadFromPixelData(e14, t19) {
    s4(this._parameters.width > 0 && this._parameters.height > 0);
    const r18 = this._createDescriptor(e14);
    return r18.pixelFormat = 1 === this._parameters.components ? G4.LUMINANCE : 3 === this._parameters.components ? G4.RGB : G4.RGBA, r18.width = this._parameters.width ?? 0, r18.height = this._parameters.height ?? 0, this._glTexture = new c3(e14, r18, t19), this._glTexture;
  }
  _loadFromURL(e14, t19) {
    return this._loadAsync(async (r18) => {
      const s15 = await t11(t19, { signal: r18 });
      return s2(r18), this._loadFromImage(e14, s15);
    });
  }
  _loadFromImageElement(e14, t19) {
    return t19.complete ? this._loadFromImage(e14, t19) : this._loadAsync(async (r18) => {
      const s15 = await i2(t19, t19.src, false, r18);
      return s2(r18), this._loadFromImage(e14, s15);
    });
  }
  _loadFromVideoElement(e14, t19) {
    return t19.readyState >= V2.HAVE_CURRENT_DATA ? this._loadFromImage(e14, t19) : this._loadFromVideoElementAsync(e14, t19);
  }
  _loadFromVideoElementAsync(t19, r18) {
    return this._loadAsync((a10) => new Promise((n12, l13) => {
      const m7 = () => {
        r18.removeEventListener("loadeddata", h10), r18.removeEventListener("error", _11), l(p6);
      }, h10 = () => {
        r18.readyState >= V2.HAVE_CURRENT_DATA && (m7(), n12(this._loadFromImage(t19, r18)));
      }, _11 = (t20) => {
        m7(), l13(t20 || new s("Failed to load video"));
      };
      r18.addEventListener("loadeddata", h10), r18.addEventListener("error", _11);
      const p6 = m(a10, () => _11(u2()));
    }));
  }
  _loadFromImage(e14, t19) {
    let r18 = t19;
    if (!(r18 instanceof HTMLVideoElement)) {
      const { maxTextureSize: t20 } = e14.parameters;
      r18 = this._parameters.downsampleUncompressed ? r15(r18, t20) : h7(r18, t20);
    }
    const s15 = R3(r18);
    this._parameters.width = s15.width, this._parameters.height = s15.height;
    const a10 = this._createDescriptor(e14);
    return a10.pixelFormat = 3 === this._parameters.components ? G4.RGB : G4.RGBA, a10.width = s15.width, a10.height = s15.height, this._glTexture = new c3(e14, a10, r18), this._glTexture;
  }
  _loadAsync(e14) {
    const t19 = new AbortController();
    this._loadingController = t19;
    const r18 = e14(t19.signal);
    this._loadingPromise = r18;
    const s15 = () => {
      this._loadingController === t19 && (this._loadingController = null), this._loadingPromise === r18 && (this._loadingPromise = null);
    };
    return r18.then(s15, s15), r18;
  }
  unload() {
    if (this._glTexture = r(this._glTexture), null != this._loadingController) {
      const e14 = this._loadingController;
      this._loadingController = null, this._loadingPromise = null, e14.abort();
    }
    this.events.emit("unloaded");
  }
};
function C2(e14, t19) {
  if (null == e14) return 0;
  if (t(e14) || u(e14)) return t19.encoding === u6.KTX2_ENCODING ? c8(e14, !!t19.mipmap) : t19.encoding === u6.BASIS_ENCODING ? u9(e14, !!t19.mipmap) : e14.byteLength;
  const { width: r18, height: s15 } = e14 instanceof Image || e14 instanceof ImageData || e14 instanceof HTMLCanvasElement || e14 instanceof HTMLVideoElement ? R3(e14) : t19;
  return (t19.mipmap ? 4 / 3 : 1) * r18 * s15 * (t19.components || 4) || 0;
}
function R3(e14) {
  return e14 instanceof HTMLVideoElement ? { width: e14.videoWidth, height: e14.videoHeight } : e14;
}
var V2;
!function(e14) {
  e14[e14.HAVE_NOTHING = 0] = "HAVE_NOTHING", e14[e14.HAVE_METADATA = 1] = "HAVE_METADATA", e14[e14.HAVE_CURRENT_DATA = 2] = "HAVE_CURRENT_DATA", e14[e14.HAVE_FUTURE_DATA = 3] = "HAVE_FUTURE_DATA", e14[e14.HAVE_ENOUGH_DATA = 4] = "HAVE_ENOUGH_DATA";
}(V2 || (V2 = {}));
var M2 = { wrap: { s: D.REPEAT, t: D.REPEAT }, mipmap: true, noUnpackFlip: false, preMultiplyAlpha: false, downsampleUncompressed: false };

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/OrderIndependentTransparency.js
var A3 = l9(R.SRC_ALPHA, R.ONE, R.ONE_MINUS_SRC_ALPHA, R.ONE_MINUS_SRC_ALPHA);
var N3 = l9(R.ONE, R.ZERO, R.ONE, R.ONE_MINUS_SRC_ALPHA);
function c10(r18) {
  return r18 === o9.FrontFace ? null : N3;
}
var E4 = 5e5;
var O7 = { factor: -1, units: -2 };
function _10(n12) {
  return n12 ? O7 : null;
}
function f7(r18, o20 = O3.LESS) {
  return r18 === o9.NONE || r18 === o9.FrontFace ? o20 : O3.LEQUAL;
}
function s12(r18) {
  return r18 === o9.ColorAlpha ? { buffers: [X.COLOR_ATTACHMENT0, X.COLOR_ATTACHMENT1] } : null;
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/RayIntersections.js
var m5 = class {
  constructor(t19 = false, n12 = true) {
    this.isVerticalRay = t19, this.normalRequired = n12;
  }
};
var h8 = i4();
function p4(n12, o20, i13, e14, s15, c13) {
  if (!n12.visible) return;
  const r18 = K(P3, e14, i13), a10 = (t19, n13, o21) => {
    c13(t19, o21, n13, false);
  }, h10 = new m5(false, o20.options.normalRequired);
  if (n12.boundingInfo) {
    s4(n12.type === e12.Mesh);
    const t19 = o20.tolerance;
    b2(n12.boundingInfo, i13, r18, t19, s15, h10, a10);
  } else {
    const t19 = n12.attributes.get(e6.POSITION), o21 = t19.indices;
    V3(i13, r18, 0, o21.length / 3, o21, t19.data, t19.stride, s15, h10, a10);
  }
}
var M3 = n3();
function b2(t19, n12, o20, i13, e14, s15, c13) {
  if (null == t19) return;
  const f9 = C3(o20, M3);
  if (A2(h8, t19.bbMin), G2(h8, t19.bbMax), null != e14 && e14.applyToAabb(h8), k(h8, n12, f9, i13)) {
    const { primitiveIndices: r18, position: a10 } = t19, f10 = r18 ? r18.length : a10.indices.length / 3;
    if (f10 > z2) {
      const r19 = t19.getChildren();
      if (void 0 !== r19) {
        for (const t20 of r19) b2(t20, n12, o20, i13, e14, s15, c13);
        return;
      }
    }
    T3(n12, o20, 0, f10, a10.indices, a10.data, a10.stride, r18, e14, s15, c13);
  }
}
var d4 = n3();
function T3(t19, n12, o20, i13, e14, s15, c13, r18, a10, f9, u13) {
  const l13 = t19[0], m7 = t19[1], h10 = t19[2], p6 = n12[0], M5 = n12[1], b4 = n12[2], { normalRequired: x4 } = f9;
  for (let g4 = o20; g4 < i13; ++g4) {
    const t20 = r18[g4], n13 = 3 * t20, o21 = c13 * e14[n13];
    let i14 = s15[o21], f10 = s15[o21 + 1], y5 = s15[o21 + 2];
    const T6 = c13 * e14[n13 + 1];
    let V6 = s15[T6], j8 = s15[T6 + 1], q7 = s15[T6 + 2];
    const v5 = c13 * e14[n13 + 2];
    let R8 = s15[v5], O12 = s15[v5 + 1], A8 = s15[v5 + 2];
    null != a10 && ([i14, f10, y5] = a10.applyToVertex(i14, f10, y5, g4), [V6, j8, q7] = a10.applyToVertex(V6, j8, q7, g4), [R8, O12, A8] = a10.applyToVertex(R8, O12, A8, g4));
    const B3 = V6 - i14, C4 = j8 - f10, k4 = q7 - y5, w4 = R8 - i14, z5 = O12 - f10, P6 = A8 - y5, S6 = M5 * P6 - z5 * b4, U5 = b4 * w4 - P6 * p6, D4 = p6 * z5 - w4 * M5, E10 = B3 * S6 + C4 * U5 + k4 * D4;
    if (Math.abs(E10) <= N4) continue;
    const F = l13 - i14, G6 = m7 - f10, H4 = h10 - y5, J2 = F * S6 + G6 * U5 + H4 * D4;
    if (E10 > 0) {
      if (J2 < 0 || J2 > E10) continue;
    } else if (J2 > 0 || J2 < E10) continue;
    const K2 = G6 * k4 - C4 * H4, L5 = H4 * B3 - k4 * F, Q = F * C4 - B3 * G6, W2 = p6 * K2 + M5 * L5 + b4 * Q;
    if (E10 > 0) {
      if (W2 < 0 || J2 + W2 > E10) continue;
    } else if (W2 > 0 || J2 + W2 < E10) continue;
    const X2 = (w4 * K2 + z5 * L5 + P6 * Q) / E10;
    if (X2 >= 0) {
      u13(X2, t20, x4 ? I4(B3, C4, k4, w4, z5, P6, d4) : null);
    }
  }
}
function V3(i13, e14, s15, c13, r18, a10, f9, u13, l13, m7) {
  const h10 = e14, p6 = S4, M5 = Math.abs(h10[0]), b4 = Math.abs(h10[1]), d6 = Math.abs(h10[2]), x4 = M5 >= b4 ? M5 >= d6 ? 0 : 2 : b4 >= d6 ? 1 : 2, g4 = x4, y5 = h10[g4] < 0 ? 2 : 1, T6 = (x4 + y5) % 3, V6 = (x4 + (3 - y5)) % 3, I7 = h10[T6] / h10[g4], O12 = h10[V6] / h10[g4], A8 = 1 / h10[g4], B3 = j4, C4 = q3, k4 = v2, { normalRequired: w4 } = l13;
  for (let j8 = s15; j8 < c13; ++j8) {
    const e15 = 3 * j8, s16 = f9 * r18[e15];
    o2(p6[0], a10[s16 + 0], a10[s16 + 1], a10[s16 + 2]);
    const c14 = f9 * r18[e15 + 1];
    o2(p6[1], a10[c14 + 0], a10[c14 + 1], a10[c14 + 2]);
    const l14 = f9 * r18[e15 + 2];
    o2(p6[2], a10[l14 + 0], a10[l14 + 1], a10[l14 + 2]), u13 && (r3(p6[0], u13.applyToVertex(p6[0][0], p6[0][1], p6[0][2], j8)), r3(p6[1], u13.applyToVertex(p6[1][0], p6[1][1], p6[1][2], j8)), r3(p6[2], u13.applyToVertex(p6[2][0], p6[2][1], p6[2][2], j8))), K(B3, p6[0], i13), K(C4, p6[1], i13), K(k4, p6[2], i13);
    const h11 = B3[T6] - I7 * B3[g4], M6 = B3[V6] - O12 * B3[g4], b5 = C4[T6] - I7 * C4[g4], d7 = C4[V6] - O12 * C4[g4], x5 = k4[T6] - I7 * k4[g4], y6 = k4[V6] - O12 * k4[g4], q7 = x5 * d7 - y6 * b5, v5 = h11 * y6 - M6 * x5, z5 = b5 * M6 - d7 * h11;
    if ((q7 < 0 || v5 < 0 || z5 < 0) && (q7 > 0 || v5 > 0 || z5 > 0)) continue;
    const N7 = q7 + v5 + z5;
    if (0 === N7) continue;
    const P6 = q7 * (A8 * B3[g4]) + v5 * (A8 * C4[g4]) + z5 * (A8 * k4[g4]);
    if (P6 * Math.sign(N7) < 0) continue;
    const S6 = P6 / N7;
    if (S6 >= 0) {
      m7(S6, j8, w4 ? R4(p6) : null);
    }
  }
}
var j4 = n3();
var q3 = n3();
var v2 = n3();
function I4(t19, o20, s15, c13, r18, a10, f9) {
  return o2(O8, t19, o20, s15), o2(A4, c13, r18, a10), _2(f9, O8, A4), z(f9, f9), f9;
}
function R4(n12) {
  return K(O8, n12[1], n12[0]), K(A4, n12[2], n12[0]), _2(d4, O8, A4), z(d4, d4), d4;
}
var O8 = n3();
var A4 = n3();
function C3(t19, o20) {
  return o2(o20, 1 / t19[0], 1 / t19[1], 1 / t19[2]);
}
function k(t19, n12, o20, i13) {
  return w3(t19, n12, o20, i13, 1 / 0);
}
function w3(t19, n12, o20, i13, e14) {
  const s15 = (t19[0] - i13 - n12[0]) * o20[0], c13 = (t19[3] + i13 - n12[0]) * o20[0];
  let r18 = Math.min(s15, c13), a10 = Math.max(s15, c13);
  const f9 = (t19[1] - i13 - n12[1]) * o20[1], u13 = (t19[4] + i13 - n12[1]) * o20[1];
  if (a10 = Math.min(a10, Math.max(f9, u13)), a10 < 0) return false;
  if (r18 = Math.max(r18, Math.min(f9, u13)), r18 > a10) return false;
  const l13 = (t19[2] - i13 - n12[2]) * o20[2], m7 = (t19[5] + i13 - n12[2]) * o20[2];
  return a10 = Math.min(a10, Math.max(l13, m7)), !(a10 < 0) && (r18 = Math.max(r18, Math.min(l13, m7)), !(r18 > a10) && r18 < e14);
}
var z2 = 1e3;
var N4 = 1e-7;
var P3 = n3();
var S4 = [n3(), n3(), n3()];

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderSlot.js
var E5;
!function(E10) {
  E10[E10.INTEGRATED_MESH = 0] = "INTEGRATED_MESH", E10[E10.OPAQUE_TERRAIN = 1] = "OPAQUE_TERRAIN", E10[E10.OPAQUE_MATERIAL = 2] = "OPAQUE_MATERIAL", E10[E10.OPAQUE_NO_SSAO_DEPTH = 3] = "OPAQUE_NO_SSAO_DEPTH", E10[E10.TRANSPARENT_MATERIAL = 4] = "TRANSPARENT_MATERIAL", E10[E10.TRANSPARENT_NO_SSAO_DEPTH = 5] = "TRANSPARENT_NO_SSAO_DEPTH", E10[E10.TRANSPARENT_TERRAIN = 6] = "TRANSPARENT_TERRAIN", E10[E10.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL = 7] = "TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL", E10[E10.OCCLUDED_TERRAIN = 8] = "OCCLUDED_TERRAIN", E10[E10.OCCLUDER_MATERIAL = 9] = "OCCLUDER_MATERIAL", E10[E10.TRANSPARENT_OCCLUDER_MATERIAL = 10] = "TRANSPARENT_OCCLUDER_MATERIAL", E10[E10.OCCLUSION_PIXELS = 11] = "OCCLUSION_PIXELS", E10[E10.OPAQUE_ENVIRONMENT = 12] = "OPAQUE_ENVIRONMENT", E10[E10.TRANSPARENT_ENVIRONMENT = 13] = "TRANSPARENT_ENVIRONMENT", E10[E10.LASERLINES = 14] = "LASERLINES", E10[E10.LASERLINES_CONTRAST_CONTROL = 15] = "LASERLINES_CONTRAST_CONTROL", E10[E10.HUD_MATERIAL = 16] = "HUD_MATERIAL", E10[E10.LABEL_MATERIAL = 17] = "LABEL_MATERIAL", E10[E10.LINE_CALLOUTS = 18] = "LINE_CALLOUTS", E10[E10.LINE_CALLOUTS_HUD_DEPTH = 19] = "LINE_CALLOUTS_HUD_DEPTH", E10[E10.DRAPED_MATERIAL = 20] = "DRAPED_MATERIAL", E10[E10.DRAPED_WATER = 21] = "DRAPED_WATER", E10[E10.VIEWSHED = 22] = "VIEWSHED", E10[E10.VOXEL = 23] = "VOXEL", E10[E10.MAX_SLOTS = 24] = "MAX_SLOTS";
}(E5 || (E5 = {}));

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/verticalOffsetUtils.js
var T4 = class {
  constructor(t19 = 0) {
    this.offset = t19, this.tmpVertex = n3();
  }
  applyToVertex(t19, s15, r18) {
    const e14 = o2(q4, t19, s15, r18), i13 = u3(z3, e14, this.localOrigin), o20 = this.offset / s3(i13);
    return q(this.tmpVertex, e14, i13, o20), this.tmpVertex;
  }
  applyToAabb(t19) {
    const s15 = A5, r18 = R5, e14 = B;
    for (let n12 = 0; n12 < 3; ++n12) s15[n12] = t19[0 + n12] + this.localOrigin[n12], r18[n12] = t19[3 + n12] + this.localOrigin[n12], e14[n12] = s15[n12];
    const i13 = this.applyToVertex(s15[0], s15[1], s15[2]);
    for (let n12 = 0; n12 < 3; ++n12) t19[n12] = i13[n12], t19[n12 + 3] = i13[n12];
    const o20 = (s16) => {
      const r19 = this.applyToVertex(s16[0], s16[1], s16[2]);
      for (let e15 = 0; e15 < 3; ++e15) t19[e15] = Math.min(t19[e15], r19[e15]), t19[e15 + 3] = Math.max(t19[e15 + 3], r19[e15]);
    };
    for (let n12 = 1; n12 < 8; ++n12) {
      for (let t20 = 0; t20 < 3; ++t20) e14[t20] = n12 & 1 << t20 ? r18[t20] : s15[t20];
      o20(e14);
    }
    let a10 = 0;
    for (let n12 = 0; n12 < 3; ++n12) {
      s15[n12] * r18[n12] < 0 && (a10 |= 1 << n12);
    }
    if (0 !== a10 && 7 !== a10) {
      for (let n12 = 0; n12 < 8; ++n12) if (!(a10 & n12)) {
        for (let t20 = 0; t20 < 3; ++t20) e14[t20] = a10 & 1 << t20 ? 0 : n12 & 1 << t20 ? s15[t20] : r18[t20];
        o20(e14);
      }
    }
    for (let n12 = 0; n12 < 3; ++n12) t19[n12] -= this.localOrigin[n12], t19[n12 + 3] -= this.localOrigin[n12];
    return t19;
  }
};
var x3 = class {
  constructor(t19 = 0) {
    this.componentLocalOriginLength = 0, this._totalOffset = 0, this._offset = 0, this._tmpVertex = n3(), this._tmpMbs = _4(), this._tmpObb = new I2(), this._resetOffset(t19);
  }
  _resetOffset(t19) {
    this._offset = t19, this._totalOffset = t19;
  }
  set offset(t19) {
    this._resetOffset(t19);
  }
  get offset() {
    return this._offset;
  }
  set componentOffset(t19) {
    this._totalOffset = this._offset + t19;
  }
  set localOrigin(t19) {
    this.componentLocalOriginLength = s3(t19);
  }
  applyToVertex(t19, s15, r18) {
    const e14 = o2(q4, t19, s15, r18), i13 = o2(z3, t19, s15, r18 + this.componentLocalOriginLength), o20 = this._totalOffset / s3(i13);
    return q(this._tmpVertex, e14, i13, o20), this._tmpVertex;
  }
  applyToAabb(t19) {
    const s15 = this.componentLocalOriginLength, r18 = t19[0], e14 = t19[1], i13 = t19[2] + s15, o20 = t19[3], a10 = t19[4], n12 = t19[5] + s15, h10 = Math.abs(r18), f9 = Math.abs(e14), l13 = Math.abs(i13), m7 = Math.abs(o20), p6 = Math.abs(a10), c13 = Math.abs(n12), _11 = 0.5 * (1 + Math.sign(r18 * o20)) * Math.min(h10, m7), u13 = 0.5 * (1 + Math.sign(e14 * a10)) * Math.min(f9, p6), g4 = 0.5 * (1 + Math.sign(i13 * n12)) * Math.min(l13, c13), M5 = Math.max(h10, m7), v5 = Math.max(f9, p6), b4 = Math.max(l13, c13), T6 = Math.sqrt(_11 * _11 + u13 * u13 + g4 * g4), x4 = Math.sign(h10 + r18), O12 = Math.sign(f9 + e14), y5 = Math.sign(l13 + i13), d6 = Math.sign(m7 + o20), V6 = Math.sign(p6 + a10), L5 = Math.sign(c13 + n12), j8 = this._totalOffset;
    if (T6 < j8) return t19[0] -= (1 - x4) * j8, t19[1] -= (1 - O12) * j8, t19[2] -= (1 - y5) * j8, t19[3] += d6 * j8, t19[4] += V6 * j8, t19[5] += L5 * j8, t19;
    const I7 = j8 / Math.sqrt(M5 * M5 + v5 * v5 + b4 * b4), w4 = j8 / T6, q7 = w4 - I7, z5 = -q7;
    return t19[0] += r18 * (x4 * z5 + w4), t19[1] += e14 * (O12 * z5 + w4), t19[2] += i13 * (y5 * z5 + w4), t19[3] += o20 * (d6 * q7 + I7), t19[4] += a10 * (V6 * q7 + I7), t19[5] += n12 * (L5 * q7 + I7), t19;
  }
  applyToMbs(t19) {
    const s15 = s3(V(t19)), r18 = this._totalOffset / s15;
    return q(V(this._tmpMbs), V(t19), V(t19), r18), this._tmpMbs[3] = t19[3] + t19[3] * this._totalOffset / s15, this._tmpMbs;
  }
  applyToObb(t19) {
    return L3(t19, this._totalOffset, this._totalOffset, l7.Global, this._tmpObb), this._tmpObb;
  }
};
var O9 = class {
  constructor(t19 = 0) {
    this.offset = t19, this.sphere = _4(), this.tmpVertex = n3();
  }
  applyToVertex(t19, s15, r18) {
    const e14 = this.objectTransform.transform, i13 = o2(q4, t19, s15, r18), o20 = O(i13, i13, e14), a10 = this.offset / s3(o20);
    q(o20, o20, o20, a10);
    const h10 = this.objectTransform.inverse;
    return O(this.tmpVertex, o20, h10), this.tmpVertex;
  }
  applyToMinMax(t19, s15) {
    const r18 = this.offset / s3(t19);
    q(t19, t19, t19, r18);
    const e14 = this.offset / s3(s15);
    q(s15, s15, s15, e14);
  }
  applyToAabb(t19) {
    const s15 = this.offset / Math.sqrt(t19[0] * t19[0] + t19[1] * t19[1] + t19[2] * t19[2]);
    t19[0] += t19[0] * s15, t19[1] += t19[1] * s15, t19[2] += t19[2] * s15;
    const r18 = this.offset / Math.sqrt(t19[3] * t19[3] + t19[4] * t19[4] + t19[5] * t19[5]);
    return t19[3] += t19[3] * r18, t19[4] += t19[4] * r18, t19[5] += t19[5] * r18, t19;
  }
  applyToBoundingSphere(t19) {
    const s15 = s3(V(t19)), r18 = this.offset / s15;
    return q(V(this.sphere), V(t19), V(t19), r18), this.sphere[3] = t19[3] + t19[3] * this.offset / s15, this.sphere;
  }
};
var y4 = new O9();
function d5(t19) {
  return null != t19 ? (y4.offset = t19, y4) : null;
}
var V4 = new x3();
var j5 = new T4();
var q4 = n3();
var z3 = n3();
var A5 = n3();
var R5 = n3();
var B = n3();

// ../node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/bufferWriterUtils.js
function u11(e14, t19, f9) {
  const { data: o20, indices: r18 } = e14, i13 = t19.typedBuffer, s15 = t19.typedBufferStride, n12 = r18.length;
  f9 *= s15;
  for (let c13 = 0; c13 < n12; ++c13) {
    const e15 = 2 * r18[c13];
    i13[f9] = o20[e15], i13[f9 + 1] = o20[e15 + 1], f9 += s15;
  }
}
function a9(e14, t19, f9, o20) {
  const { data: r18, indices: i13 } = e14, s15 = t19.typedBuffer, n12 = t19.typedBufferStride, c13 = i13.length;
  if (f9 *= n12, null == o20 || 1 === o20) for (let l13 = 0; l13 < c13; ++l13) {
    const e15 = 3 * i13[l13];
    s15[f9] = r18[e15], s15[f9 + 1] = r18[e15 + 1], s15[f9 + 2] = r18[e15 + 2], f9 += n12;
  }
  else for (let l13 = 0; l13 < c13; ++l13) {
    const e15 = 3 * i13[l13];
    for (let t20 = 0; t20 < o20; ++t20) s15[f9] = r18[e15], s15[f9 + 1] = r18[e15 + 1], s15[f9 + 2] = r18[e15 + 2], f9 += n12;
  }
}
function p5(e14, t19, f9, o20 = 1) {
  const { data: r18, indices: i13 } = e14, s15 = t19.typedBuffer, n12 = t19.typedBufferStride, c13 = i13.length;
  if (f9 *= n12, 1 === o20) for (let l13 = 0; l13 < c13; ++l13) {
    const e15 = 4 * i13[l13];
    s15[f9] = r18[e15], s15[f9 + 1] = r18[e15 + 1], s15[f9 + 2] = r18[e15 + 2], s15[f9 + 3] = r18[e15 + 3], f9 += n12;
  }
  else for (let l13 = 0; l13 < c13; ++l13) {
    const e15 = 4 * i13[l13];
    for (let t20 = 0; t20 < o20; ++t20) s15[f9] = r18[e15], s15[f9 + 1] = r18[e15 + 1], s15[f9 + 2] = r18[e15 + 2], s15[f9 + 3] = r18[e15 + 3], f9 += n12;
  }
}
function b3(t19, f9, o20, r18, i13 = 1) {
  if (!f9) return void a9(t19, o20, r18, i13);
  const { data: s15, indices: n12 } = t19, c13 = o20.typedBuffer, l13 = o20.typedBufferStride, d6 = n12.length, u13 = f9[0], p6 = f9[1], y5 = f9[2], B3 = f9[4], g4 = f9[5], b4 = f9[6], O12 = f9[8], h10 = f9[9], S6 = f9[10], N7 = f9[12], R8 = f9[13], E10 = f9[14];
  r18 *= l13;
  let A8 = 0, L5 = 0, F = 0;
  const z5 = H(f9) ? (e14) => {
    A8 = s15[e14] + N7, L5 = s15[e14 + 1] + R8, F = s15[e14 + 2] + E10;
  } : (e14) => {
    const t20 = s15[e14], f10 = s15[e14 + 1], o21 = s15[e14 + 2];
    A8 = u13 * t20 + B3 * f10 + O12 * o21 + N7, L5 = p6 * t20 + g4 * f10 + h10 * o21 + R8, F = y5 * t20 + b4 * f10 + S6 * o21 + E10;
  };
  if (1 === i13) for (let e14 = 0; e14 < d6; ++e14) z5(3 * n12[e14]), c13[r18] = A8, c13[r18 + 1] = L5, c13[r18 + 2] = F, r18 += l13;
  else for (let e14 = 0; e14 < d6; ++e14) {
    z5(3 * n12[e14]);
    for (let e15 = 0; e15 < i13; ++e15) c13[r18] = A8, c13[r18 + 1] = L5, c13[r18 + 2] = F, r18 += l13;
  }
}
function O10(f9, o20, r18, i13, s15 = 1) {
  if (!o20) return void a9(f9, r18, i13, s15);
  const { data: n12, indices: c13 } = f9, l13 = o20, d6 = r18.typedBuffer, u13 = r18.typedBufferStride, p6 = c13.length, y5 = l13[0], B3 = l13[1], g4 = l13[2], b4 = l13[4], O12 = l13[5], h10 = l13[6], S6 = l13[8], N7 = l13[9], R8 = l13[10], E10 = !G3(l13), A8 = 1e-6, L5 = 1 - A8;
  i13 *= u13;
  let F = 0, z5 = 0, m7 = 0;
  const I7 = H(l13) ? (e14) => {
    F = n12[e14], z5 = n12[e14 + 1], m7 = n12[e14 + 2];
  } : (e14) => {
    const t19 = n12[e14], f10 = n12[e14 + 1], o21 = n12[e14 + 2];
    F = y5 * t19 + b4 * f10 + S6 * o21, z5 = B3 * t19 + O12 * f10 + N7 * o21, m7 = g4 * t19 + h10 * f10 + R8 * o21;
  };
  if (1 === s15) if (E10) for (let e14 = 0; e14 < p6; ++e14) {
    I7(3 * c13[e14]);
    const t19 = F * F + z5 * z5 + m7 * m7;
    if (t19 < L5 && t19 > A8) {
      const e15 = 1 / Math.sqrt(t19);
      d6[i13] = F * e15, d6[i13 + 1] = z5 * e15, d6[i13 + 2] = m7 * e15;
    } else d6[i13] = F, d6[i13 + 1] = z5, d6[i13 + 2] = m7;
    i13 += u13;
  }
  else for (let e14 = 0; e14 < p6; ++e14) I7(3 * c13[e14]), d6[i13] = F, d6[i13 + 1] = z5, d6[i13 + 2] = m7, i13 += u13;
  else for (let e14 = 0; e14 < p6; ++e14) {
    if (I7(3 * c13[e14]), E10) {
      const e15 = F * F + z5 * z5 + m7 * m7;
      if (e15 < L5 && e15 > A8) {
        const t19 = 1 / Math.sqrt(e15);
        F *= t19, z5 *= t19, m7 *= t19;
      }
    }
    for (let e15 = 0; e15 < s15; ++e15) d6[i13] = F, d6[i13 + 1] = z5, d6[i13 + 2] = m7, i13 += u13;
  }
}
function h9(e14, f9, o20, r18, i13 = 1) {
  if (!f9) return void p5(e14, o20, r18, i13);
  const { data: s15, indices: n12 } = e14, c13 = f9, l13 = o20.typedBuffer, d6 = o20.typedBufferStride, u13 = n12.length, a10 = c13[0], y5 = c13[1], B3 = c13[2], g4 = c13[4], b4 = c13[5], O12 = c13[6], h10 = c13[8], S6 = c13[9], N7 = c13[10], R8 = !G3(c13), E10 = 1e-6, A8 = 1 - E10;
  if (r18 *= d6, 1 === i13) for (let t19 = 0; t19 < u13; ++t19) {
    const e15 = 4 * n12[t19], f10 = s15[e15], o21 = s15[e15 + 1], i14 = s15[e15 + 2], c14 = s15[e15 + 3];
    let u14 = a10 * f10 + g4 * o21 + h10 * i14, p6 = y5 * f10 + b4 * o21 + S6 * i14, L5 = B3 * f10 + O12 * o21 + N7 * i14;
    if (R8) {
      const e16 = u14 * u14 + p6 * p6 + L5 * L5;
      if (e16 < A8 && e16 > E10) {
        const t20 = 1 / Math.sqrt(e16);
        u14 *= t20, p6 *= t20, L5 *= t20;
      }
    }
    l13[r18] = u14, l13[r18 + 1] = p6, l13[r18 + 2] = L5, l13[r18 + 3] = c14, r18 += d6;
  }
  else for (let t19 = 0; t19 < u13; ++t19) {
    const e15 = 4 * n12[t19], f10 = s15[e15], o21 = s15[e15 + 1], c14 = s15[e15 + 2], u14 = s15[e15 + 3];
    let p6 = a10 * f10 + g4 * o21 + h10 * c14, L5 = y5 * f10 + b4 * o21 + S6 * c14, F = B3 * f10 + O12 * o21 + N7 * c14;
    if (R8) {
      const e16 = p6 * p6 + L5 * L5 + F * F;
      if (e16 < A8 && e16 > E10) {
        const t20 = 1 / Math.sqrt(e16);
        p6 *= t20, L5 *= t20, F *= t20;
      }
    }
    for (let t20 = 0; t20 < i13; ++t20) l13[r18] = p6, l13[r18 + 1] = L5, l13[r18 + 2] = F, l13[r18 + 3] = u14, r18 += d6;
  }
}
function S5(e14, t19, f9, o20, r18 = 1) {
  const { data: i13, indices: s15 } = e14, n12 = f9.typedBuffer, c13 = f9.typedBufferStride, l13 = s15.length;
  if (o20 *= c13, t19 !== i13.length || 4 !== t19) if (1 !== r18) if (4 !== t19) for (let d6 = 0; d6 < l13; ++d6) {
    const e15 = 3 * s15[d6];
    for (let t20 = 0; t20 < r18; ++t20) n12[o20] = i13[e15], n12[o20 + 1] = i13[e15 + 1], n12[o20 + 2] = i13[e15 + 2], n12[o20 + 3] = 255, o20 += c13;
  }
  else for (let d6 = 0; d6 < l13; ++d6) {
    const e15 = 4 * s15[d6];
    for (let t20 = 0; t20 < r18; ++t20) n12[o20] = i13[e15], n12[o20 + 1] = i13[e15 + 1], n12[o20 + 2] = i13[e15 + 2], n12[o20 + 3] = i13[e15 + 3], o20 += c13;
  }
  else {
    if (4 === t19) {
      for (let e15 = 0; e15 < l13; ++e15) {
        const t20 = 4 * s15[e15];
        n12[o20] = i13[t20], n12[o20 + 1] = i13[t20 + 1], n12[o20 + 2] = i13[t20 + 2], n12[o20 + 3] = i13[t20 + 3], o20 += c13;
      }
      return;
    }
    for (let e15 = 0; e15 < l13; ++e15) {
      const t20 = 3 * s15[e15];
      n12[o20] = i13[t20], n12[o20 + 1] = i13[t20 + 1], n12[o20 + 2] = i13[t20 + 2], n12[o20 + 3] = 255, o20 += c13;
    }
  }
  else {
    n12[o20] = i13[0], n12[o20 + 1] = i13[1], n12[o20 + 2] = i13[2], n12[o20 + 3] = i13[3];
    const e15 = new Uint32Array(f9.typedBuffer.buffer, f9.start), t20 = c13 / 4, s16 = e15[o20 /= 4];
    o20 += t20;
    const d6 = l13 * r18;
    for (let f10 = 1; f10 < d6; ++f10) e15[o20] = s16, o20 += t20;
  }
}
function N5(e14, t19, f9) {
  const { data: o20, indices: r18 } = e14, i13 = t19.typedBuffer, s15 = t19.typedBufferStride, n12 = r18.length, c13 = o20[0];
  f9 *= s15;
  for (let l13 = 0; l13 < n12; ++l13) i13[f9] = c13, f9 += s15;
}
function R6(e14, t19, f9, o20, r18 = 1) {
  const i13 = t19.typedBuffer, s15 = t19.typedBufferStride;
  if (o20 *= s15, 1 === r18) for (let n12 = 0; n12 < f9; ++n12) i13[o20] = e14[0], i13[o20 + 1] = e14[1], i13[o20 + 2] = e14[2], i13[o20 + 3] = e14[3], o20 += s15;
  else for (let n12 = 0; n12 < f9; ++n12) for (let t20 = 0; t20 < r18; ++t20) i13[o20] = e14[0], i13[o20 + 1] = e14[1], i13[o20 + 2] = e14[2], i13[o20 + 3] = e14[3], o20 += s15;
}
function E6(e14, t19, o20, r18, i13, s15) {
  var _a;
  for (const n12 of t19.fields.keys()) {
    const t20 = e14.attributes.get(n12), c13 = t20 == null ? void 0 : t20.indices;
    if (t20 && c13) A6(n12, t20, o20, r18, i13, s15);
    else if (n12 === e6.OBJECTANDLAYERIDCOLOR && null != e14.objectAndLayerIdColor) {
      const t21 = (_a = e14.attributes.get(e6.POSITION)) == null ? void 0 : _a.indices;
      if (t21) {
        const o21 = t21.length, r19 = i13.getField(n12, x);
        R6(e14.objectAndLayerIdColor, r19, o21, s15);
      }
    }
  }
}
function A6(e14, t19, d6, a10, y5, B3) {
  switch (e14) {
    case e6.POSITION: {
      s4(3 === t19.size);
      const f9 = y5.getField(e14, i5);
      s4(!!f9, `No buffer view for ${e14}`), f9 && b3(t19, d6, f9, B3);
      break;
    }
    case e6.NORMAL: {
      s4(3 === t19.size);
      const f9 = y5.getField(e14, i5);
      s4(!!f9, `No buffer view for ${e14}`), f9 && O10(t19, a10, f9, B3);
      break;
    }
    case e6.NORMALCOMPRESSED: {
      s4(2 === t19.size);
      const f9 = y5.getField(e14, q2);
      s4(!!f9, `No buffer view for ${e14}`), f9 && u11(t19, f9, B3);
      break;
    }
    case e6.UV0: {
      s4(2 === t19.size);
      const f9 = y5.getField(e14, u4);
      s4(!!f9, `No buffer view for ${e14}`), f9 && u11(t19, f9, B3);
      break;
    }
    case e6.COLOR:
    case e6.SYMBOLCOLOR: {
      const o20 = y5.getField(e14, x);
      s4(!!o20, `No buffer view for ${e14}`), s4(3 === t19.size || 4 === t19.size), !o20 || 3 !== t19.size && 4 !== t19.size || S5(t19, t19.size, o20, B3);
      break;
    }
    case e6.COLORFEATUREATTRIBUTE: {
      const f9 = y5.getField(e14, y2);
      s4(!!f9, `No buffer view for ${e14}`), s4(1 === t19.size), f9 && 1 === t19.size && N5(t19, f9, B3);
      break;
    }
    case e6.TANGENT: {
      s4(4 === t19.size);
      const f9 = y5.getField(e14, c);
      s4(!!f9, `No buffer view for ${e14}`), f9 && h9(t19, d6, f9, B3);
      break;
    }
    case e6.PROFILERIGHT:
    case e6.PROFILEUP:
    case e6.PROFILEVERTEXANDNORMAL:
    case e6.FEATUREVALUE: {
      s4(4 === t19.size);
      const f9 = y5.getField(e14, c);
      s4(!!f9, `No buffer view for ${e14}`), f9 && p5(t19, f9, B3);
    }
  }
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultBufferWriter.js
var r16 = class {
  constructor(t19) {
    this.vertexBufferLayout = t19;
  }
  elementCount(e14) {
    return e14.attributes.get(e6.POSITION).indices.length;
  }
  write(t19, r18, i13, o20, s15) {
    E6(i13, this.vertexBufferLayout, t19, r18, o20, s15);
  }
};

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/StencilUtils.js
var i12 = { func: O3.LESS };
var s14 = { func: O3.ALWAYS };
var e13 = { mask: 255 };
var f8 = { function: { func: O3.ALWAYS, ref: N.OutlineVisualElementMask, mask: N.OutlineVisualElementMask }, operation: { fail: I.KEEP, zFail: I.KEEP, zPass: I.ZERO } };
var o18 = { function: { func: O3.ALWAYS, ref: N.OutlineVisualElementMask, mask: N.OutlineVisualElementMask }, operation: { fail: I.KEEP, zFail: I.KEEP, zPass: I.REPLACE } };
var P4 = { function: { func: O3.EQUAL, ref: N.OutlineVisualElementMask, mask: N.OutlineVisualElementMask }, operation: { fail: I.KEEP, zFail: I.KEEP, zPass: I.KEEP } };
var m6 = { function: { func: O3.NOTEQUAL, ref: N.OutlineVisualElementMask, mask: N.OutlineVisualElementMask }, operation: { fail: I.KEEP, zFail: I.KEEP, zPass: I.KEEP } };

// ../node_modules/@arcgis/core/views/3d/webgl-engine/materials/pbrUtils.js
function u12({ normalTexture: u13, metallicRoughnessTexture: n12, metallicFactor: r18, roughnessFactor: t19, emissiveTexture: o20, emissiveFactor: s15, occlusionTexture: c13 }) {
  return null == u13 && null == n12 && null == o20 && (null == s15 || G(s15, l3)) && null == c13 && (null == t19 || 1 === t19) && (null == r18 || 1 === r18);
}
var r17 = [1, 1, 0.5];
var t16 = [0, 0.6, 0.2];
var o19 = [0, 1, 0.2];

// ../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/DefaultMaterialTechnique.js
var q5 = class extends f4 {
  constructor() {
    super(...arguments), this.isSchematic = false, this.usePBR = false, this.mrrFactors = e4(r17), this.hasVertexColors = false, this.hasSymbolColors = false, this.doubleSided = false, this.doubleSidedType = "normal", this.cullFace = e11.Back, this.isInstanced = false, this.hasInstancedColor = false, this.emissiveFactor = r2(0, 0, 0), this.instancedDoublePrecision = false, this.normalType = a4.Attribute, this.receiveShadows = true, this.receiveAmbientOcclusion = true, this.castShadows = true, this.shadowMappingEnabled = false, this.ambient = r2(0.2, 0.2, 0.2), this.diffuse = r2(0.8, 0.8, 0.8), this.externalColor = r5(1, 1, 1, 1), this.colorMixMode = "multiply", this.opacity = 1, this.layerOpacity = 1, this.origin = n3(), this.hasSlicePlane = false, this.hasSliceHighlight = true, this.offsetTransparentBackfaces = false, this.vvSize = null, this.vvColor = null, this.vvOpacity = null, this.vvSymbolAnchor = null, this.vvSymbolRotationMatrix = null, this.modelTransformation = null, this.transparent = false, this.writeDepth = true, this.customDepthTest = n9.Less, this.textureAlphaMode = s7.Blend, this.textureAlphaCutoff = o11, this.textureAlphaPremultiplied = false, this.hasOccludees = false, this.renderOccluded = h3.Occlude, this.isDecoration = false;
  }
};
var E7 = class _E extends r10 {
  initializeConfiguration(e14, t19) {
    t19.spherical = e14.viewingMode === l7.Global, t19.doublePrecisionRequiresObfuscation = e14.rctx.driverTest.doublePrecisionRequiresObfuscation.result, t19.textureCoordinateType = t19.hasColorTexture || t19.hasMetallicRoughnessTexture || t19.hasEmissionTexture || t19.hasOcclusionTexture || t19.hasNormalTexture ? d.Default : d.None, t19.objectAndLayerIdColorInstanced = t19.instanced;
  }
  initializeProgram(e14) {
    return this._initializeProgram(e14, _E.shader);
  }
  _initializeProgram(e14, t19) {
    return new r11(e14.rctx, t19.get().build(this.configuration), O4);
  }
  _makePipeline(e14, t19) {
    const i13 = this.configuration, r18 = e14 === o9.NONE, s15 = e14 === o9.FrontFace;
    return S2({ blending: i13.output === o5.Color && i13.transparent ? r18 ? A3 : c10(e14) : null, culling: R7(i13) ? h4(i13.cullFace) : null, depthTest: { func: f7(e14, I5(i13.customDepthTest)) }, depthWrite: (r18 || s15) && i13.writeDepth ? o10 : null, drawBuffers: i13.output === o5.Depth ? { buffers: [f.NONE] } : s12(e14), colorWrite: _5, stencilWrite: i13.hasOccludees ? e13 : null, stencilTest: i13.hasOccludees ? t19 ? o18 : f8 : null, polygonOffset: r18 || s15 ? null : _10(i13.enableOffset) });
  }
  initializePipeline() {
    return this._occludeePipelineState = this._makePipeline(this.configuration.transparencyPassType, true), this._makePipeline(this.configuration.transparencyPassType, false);
  }
  getPipeline(e14) {
    return e14 ? this._occludeePipelineState : super.getPipeline();
  }
};
function I5(e14) {
  return e14 === n9.Lequal ? O3.LEQUAL : O3.LESS;
}
function R7(e14) {
  return e14.cullFace !== e11.None || !e14.hasSlicePlane && (!e14.transparent && !e14.doubleSidedMode);
}
E7.shader = new t12(J, () => import("./DefaultMaterial.glsl-ML7WISQM.js"));

// ../node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration.js
var t17 = class extends O5 {
};
e([r12({ constValue: true })], t17.prototype, "hasSliceHighlight", void 0), e([r12({ constValue: false })], t17.prototype, "hasSliceInVertexProgram", void 0), e([r12({ constValue: a3.Pass })], t17.prototype, "pbrTextureBindType", void 0);

// ../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration.js
var c12 = class extends t17 {
  constructor() {
    super(...arguments), this.output = o5.Color, this.alphaDiscardMode = s7.Opaque, this.doubleSidedMode = i8.None, this.pbrMode = c4.Disabled, this.cullFace = e11.None, this.transparencyPassType = o9.NONE, this.normalType = a4.Attribute, this.textureCoordinateType = d.None, this.customDepthTest = n9.Less, this.spherical = false, this.hasVertexColors = false, this.hasSymbolColors = false, this.hasVerticalOffset = false, this.hasSlicePlane = false, this.hasSliceHighlight = true, this.hasColorTexture = false, this.hasMetallicRoughnessTexture = false, this.hasEmissionTexture = false, this.hasOcclusionTexture = false, this.hasNormalTexture = false, this.hasScreenSizePerspective = false, this.hasVertexTangents = false, this.hasOccludees = false, this.multipassEnabled = false, this.hasModelTransformation = false, this.offsetBackfaces = false, this.vvSize = false, this.vvColor = false, this.receiveShadows = false, this.receiveAmbientOcclusion = false, this.textureAlphaPremultiplied = false, this.instanced = false, this.instancedColor = false, this.objectAndLayerIdColorInstanced = false, this.instancedDoublePrecision = false, this.doublePrecisionRequiresObfuscation = false, this.writeDepth = true, this.transparent = false, this.enableOffset = true, this.cullAboveGround = false, this.snowCover = false, this.hasColorTextureTransform = false, this.hasEmissionTextureTransform = false, this.hasNormalTextureTransform = false, this.hasOcclusionTextureTransform = false, this.hasMetallicRoughnessTextureTransform = false;
  }
};
e([r12({ count: o5.COUNT })], c12.prototype, "output", void 0), e([r12({ count: s7.COUNT })], c12.prototype, "alphaDiscardMode", void 0), e([r12({ count: i8.COUNT })], c12.prototype, "doubleSidedMode", void 0), e([r12({ count: c4.COUNT })], c12.prototype, "pbrMode", void 0), e([r12({ count: e11.COUNT })], c12.prototype, "cullFace", void 0), e([r12({ count: o9.COUNT })], c12.prototype, "transparencyPassType", void 0), e([r12({ count: a4.COUNT })], c12.prototype, "normalType", void 0), e([r12({ count: d.COUNT })], c12.prototype, "textureCoordinateType", void 0), e([r12({ count: n9.COUNT })], c12.prototype, "customDepthTest", void 0), e([r12()], c12.prototype, "spherical", void 0), e([r12()], c12.prototype, "hasVertexColors", void 0), e([r12()], c12.prototype, "hasSymbolColors", void 0), e([r12()], c12.prototype, "hasVerticalOffset", void 0), e([r12()], c12.prototype, "hasSlicePlane", void 0), e([r12()], c12.prototype, "hasSliceHighlight", void 0), e([r12()], c12.prototype, "hasColorTexture", void 0), e([r12()], c12.prototype, "hasMetallicRoughnessTexture", void 0), e([r12()], c12.prototype, "hasEmissionTexture", void 0), e([r12()], c12.prototype, "hasOcclusionTexture", void 0), e([r12()], c12.prototype, "hasNormalTexture", void 0), e([r12()], c12.prototype, "hasScreenSizePerspective", void 0), e([r12()], c12.prototype, "hasVertexTangents", void 0), e([r12()], c12.prototype, "hasOccludees", void 0), e([r12()], c12.prototype, "multipassEnabled", void 0), e([r12()], c12.prototype, "hasModelTransformation", void 0), e([r12()], c12.prototype, "offsetBackfaces", void 0), e([r12()], c12.prototype, "vvSize", void 0), e([r12()], c12.prototype, "vvColor", void 0), e([r12()], c12.prototype, "receiveShadows", void 0), e([r12()], c12.prototype, "receiveAmbientOcclusion", void 0), e([r12()], c12.prototype, "textureAlphaPremultiplied", void 0), e([r12()], c12.prototype, "instanced", void 0), e([r12()], c12.prototype, "instancedColor", void 0), e([r12()], c12.prototype, "objectAndLayerIdColorInstanced", void 0), e([r12()], c12.prototype, "instancedDoublePrecision", void 0), e([r12()], c12.prototype, "doublePrecisionRequiresObfuscation", void 0), e([r12()], c12.prototype, "writeDepth", void 0), e([r12()], c12.prototype, "transparent", void 0), e([r12()], c12.prototype, "enableOffset", void 0), e([r12()], c12.prototype, "cullAboveGround", void 0), e([r12()], c12.prototype, "snowCover", void 0), e([r12()], c12.prototype, "hasColorTextureTransform", void 0), e([r12()], c12.prototype, "hasEmissionTextureTransform", void 0), e([r12()], c12.prototype, "hasNormalTextureTransform", void 0), e([r12()], c12.prototype, "hasOcclusionTextureTransform", void 0), e([r12()], c12.prototype, "hasMetallicRoughnessTextureTransform", void 0), e([r12({ constValue: false })], c12.prototype, "occlusionPass", void 0), e([r12({ constValue: true })], c12.prototype, "hasVvInstancing", void 0), e([r12({ constValue: false })], c12.prototype, "useCustomDTRExponentForWater", void 0), e([r12({ constValue: false })], c12.prototype, "supportsTextureAtlas", void 0), e([r12({ constValue: true })], c12.prototype, "useFillLights", void 0);

// ../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/RealisticTreeTechnique.js
var t18 = class _t extends E7 {
  initializeConfiguration(i13, a10) {
    super.initializeConfiguration(i13, a10), a10.hasMetallicRoughnessTexture = false, a10.hasEmissionTexture = false, a10.hasOcclusionTexture = false, a10.hasNormalTexture = false, a10.hasModelTransformation = false, a10.normalType = a4.Attribute, a10.doubleSidedMode = i8.WindingOrder, a10.hasVertexTangents = false;
  }
  initializeProgram(e14) {
    return this._initializeProgram(e14, _t.shader);
  }
};
t18.shader = new t12(R2, () => import("./RealisticTree.glsl-YZCHNAF7.js"));

// ../node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultMaterial.js
var j6 = class extends c5 {
  constructor(e14) {
    super(e14, D3), this.supportsEdges = true, this.produces = /* @__PURE__ */ new Map([[E5.OPAQUE_MATERIAL, (e15) => (n6(e15) || r7(e15)) && !this.parameters.transparent], [E5.TRANSPARENT_MATERIAL, (e15) => (n6(e15) || r7(e15)) && this.parameters.transparent && this.parameters.writeDepth], [E5.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL, (e15) => (n6(e15) || r7(e15)) && this.parameters.transparent && !this.parameters.writeDepth]]), this._configuration = new c12(), this._vertexBufferLayout = N6(this.parameters);
  }
  isVisibleForOutput(e14) {
    return e14 !== o5.Shadow && e14 !== o5.ShadowExcludeHighlight && e14 !== o5.ShadowHighlight || this.parameters.castShadows;
  }
  isVisible() {
    const e14 = this.parameters;
    if (!super.isVisible() || 0 === e14.layerOpacity) return false;
    const { hasInstancedColor: t19, hasVertexColors: r18, hasSymbolColors: s15, vvColor: a10 } = e14, i13 = "replace" === e14.colorMixMode, o20 = e14.opacity > 0, n12 = e14.externalColor && e14.externalColor[3] > 0, h10 = t19 || a10 || s15;
    return r18 && h10 ? i13 || o20 : r18 ? i13 ? n12 : o20 : h10 ? i13 || o20 : i13 ? n12 : o20;
  }
  getConfiguration(e14, t19) {
    return this._configuration.output = e14, this._configuration.hasNormalTexture = !!this.parameters.normalTextureId, this._configuration.hasColorTexture = !!this.parameters.textureId, this._configuration.hasVertexTangents = this.parameters.hasVertexTangents, this._configuration.instanced = this.parameters.isInstanced, this._configuration.instancedDoublePrecision = this.parameters.instancedDoublePrecision, this._configuration.vvSize = !!this.parameters.vvSize, this._configuration.hasVerticalOffset = null != this.parameters.verticalOffset, this._configuration.hasScreenSizePerspective = null != this.parameters.screenSizePerspective, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.hasSliceHighlight = this.parameters.hasSliceHighlight, this._configuration.alphaDiscardMode = this.parameters.textureAlphaMode, this._configuration.normalType = this.parameters.normalType, this._configuration.transparent = this.parameters.transparent, this._configuration.writeDepth = this.parameters.writeDepth, null != this.parameters.customDepthTest && (this._configuration.customDepthTest = this.parameters.customDepthTest), this._configuration.hasOccludees = this.parameters.hasOccludees, this._configuration.cullFace = this.parameters.hasSlicePlane ? e11.None : this.parameters.cullFace, this._configuration.multipassEnabled = t19.multipassEnabled, this._configuration.cullAboveGround = t19.multipassTerrain.cullAboveGround, this._configuration.hasModelTransformation = null != this.parameters.modelTransformation, e14 === o5.Color && (this._configuration.hasVertexColors = this.parameters.hasVertexColors, this._configuration.hasSymbolColors = this.parameters.hasSymbolColors, this.parameters.treeRendering ? this._configuration.doubleSidedMode = i8.WindingOrder : this._configuration.doubleSidedMode = this.parameters.doubleSided && "normal" === this.parameters.doubleSidedType ? i8.View : this.parameters.doubleSided && "winding-order" === this.parameters.doubleSidedType ? i8.WindingOrder : i8.None, this._configuration.instancedColor = this.parameters.hasInstancedColor, this._configuration.receiveShadows = this.parameters.receiveShadows && this.parameters.shadowMappingEnabled, this._configuration.receiveAmbientOcclusion = this.parameters.receiveAmbientOcclusion && null != t19.ssao, this._configuration.vvColor = !!this.parameters.vvColor, this._configuration.textureAlphaPremultiplied = !!this.parameters.textureAlphaPremultiplied, this._configuration.pbrMode = this.parameters.usePBR ? this.parameters.isSchematic ? c4.Schematic : c4.Normal : c4.Disabled, this._configuration.hasMetallicRoughnessTexture = !!this.parameters.metallicRoughnessTextureId, this._configuration.hasEmissionTexture = !!this.parameters.emissiveTextureId, this._configuration.hasOcclusionTexture = !!this.parameters.occlusionTextureId, this._configuration.offsetBackfaces = !(!this.parameters.transparent || !this.parameters.offsetTransparentBackfaces), this._configuration.transparencyPassType = t19.transparencyPassType, this._configuration.enableOffset = t19.camera.relativeElevation < E4, this._configuration.snowCover = this.hasSnowCover(t19), this._configuration.hasColorTextureTransform = !!this.parameters.colorTextureTransformMatrix, this._configuration.hasNormalTextureTransform = !!this.parameters.normalTextureTransformMatrix, this._configuration.hasEmissionTextureTransform = !!this.parameters.emissiveTextureTransformMatrix, this._configuration.hasOcclusionTextureTransform = !!this.parameters.occlusionTextureTransformMatrix, this._configuration.hasMetallicRoughnessTextureTransform = !!this.parameters.metallicRoughnessTextureTransformMatrix), this._configuration;
  }
  hasSnowCover(e14) {
    return null != e14.weather && e14.weatherVisible && "snowy" === e14.weather.type && "enabled" === e14.weather.snowCover;
  }
  intersect(h10, l13, u13, m7, p6, f9) {
    if (null != this.parameters.verticalOffset) {
      const h11 = u13.camera;
      o2(W, l13[12], l13[13], l13[14]);
      let f10 = null;
      switch (u13.viewingMode) {
        case l7.Global:
          f10 = z(G5, W);
          break;
        case l7.Local:
          f10 = r3(G5, z4);
      }
      let d6 = 0;
      const g4 = e5(k2, W, h11.eye), T6 = s3(g4), _11 = g(g4, g4, 1 / T6);
      let x4 = null;
      this.parameters.screenSizePerspective && (x4 = P(f10, _11)), d6 += o8(h11, T6, this.parameters.verticalOffset, x4 ?? 0, this.parameters.screenSizePerspective), g(f10, f10, d6), S(H3, f10, u13.transform.inverseRotation), m7 = e5(V5, m7, H3), p6 = e5(B2, p6, H3);
    }
    p4(h10, u13, m7, p6, d5(u13.verticalOffset), f9);
  }
  createGLMaterial(e14) {
    return new E8(e14);
  }
  createBufferWriter() {
    return new r16(this._vertexBufferLayout);
  }
};
var E8 = class extends u7 {
  constructor(e14) {
    super({ ...e14, ...e14.material.parameters });
  }
  _updateShadowState(e14) {
    e14.shadowMap.enabled !== this._material.parameters.shadowMappingEnabled && this._material.setParameters({ shadowMappingEnabled: e14.shadowMap.enabled });
  }
  _updateOccludeeState(e14) {
    e14.hasOccludees !== this._material.parameters.hasOccludees && this._material.setParameters({ hasOccludees: e14.hasOccludees });
  }
  beginSlot(t19) {
    this._output === o5.Color && (this._updateShadowState(t19), this._updateOccludeeState(t19));
    const r18 = this._material.parameters;
    this.updateTexture(r18.textureId);
    const s15 = t19.camera.viewInverseTransposeMatrix;
    return o2(r18.origin, s15[3], s15[7], s15[11]), this._material.setParameters(this.textureBindParameters), this.ensureTechnique(r18.treeRendering ? t18 : E7, t19);
  }
};
var L4 = class extends q5 {
  constructor() {
    super(...arguments), this.initTextureTransparent = false, this.treeRendering = false, this.hasVertexTangents = false;
  }
};
var D3 = new L4();
function N6(e14) {
  const t19 = H2().vec3f(e6.POSITION);
  e14.normalType === a4.Compressed ? t19.vec2i16(e6.NORMALCOMPRESSED, { glNormalized: true }) : t19.vec3f(e6.NORMAL), e14.hasVertexTangents && t19.vec4f(e6.TANGENT);
  return (e14.textureId || e14.normalTextureId || e14.metallicRoughnessTextureId || e14.emissiveTextureId || e14.occlusionTextureId) && t19.vec2f(e6.UV0), e14.hasVertexColors && t19.vec4u8(e6.COLOR), e14.hasSymbolColors && t19.vec4u8(e6.SYMBOLCOLOR), has("enable-feature:objectAndLayerId-rendering") && t19.vec4u8(e6.OBJECTANDLAYERIDCOLOR), t19;
}
var V5 = n3();
var B2 = n3();
var z4 = r2(0, 0, 1);
var G5 = n3();
var H3 = n3();
var W = n3();
var k2 = n3();

// ../node_modules/@arcgis/core/views/3d/layers/graphics/wosrLoader.js
var v4 = () => n.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");
async function A7(e14, t19) {
  const n12 = await j7(e14, t19), s15 = await E9(n12.textureDefinitions ?? {}, t19);
  let a10 = 0;
  for (const r18 in s15) if (s15.hasOwnProperty(r18)) {
    const e15 = s15[r18];
    a10 += (e15 == null ? void 0 : e15.image) ? e15.image.width * e15.image.height * 4 : 0;
  }
  return { resource: n12, textures: s15, size: a10 + e2(n12) };
}
async function j7(r18, n12) {
  const s15 = n12 == null ? void 0 : n12.streamDataRequester;
  if (s15) return I6(r18, s15, n12);
  const a10 = await _(U2(r18, n12));
  if (true === a10.ok) return a10.value.data;
  a(a10.error), P5(a10.error);
}
async function I6(e14, r18, n12) {
  const s15 = await _(r18.request(e14, "json", n12));
  if (true === s15.ok) return s15.value;
  a(s15.error), P5(s15.error.details.url);
}
function P5(e14) {
  throw new s("", `Request for object resource failed: ${e14}`);
}
function M4(e14) {
  const t19 = e14.params, r18 = t19.topology;
  let n12 = true;
  switch (t19.vertexAttributes || (v4().warn("Geometry must specify vertex attributes"), n12 = false), t19.topology) {
    case "PerAttributeArray":
      break;
    case "Indexed":
    case null:
    case void 0: {
      const e15 = t19.faces;
      if (e15) {
        if (t19.vertexAttributes) for (const r19 in t19.vertexAttributes) {
          const t20 = e15[r19];
          (t20 == null ? void 0 : t20.values) ? (null != t20.valueType && "UInt32" !== t20.valueType && (v4().warn(`Unsupported indexed geometry indices type '${t20.valueType}', only UInt32 is currently supported`), n12 = false), null != t20.valuesPerElement && 1 !== t20.valuesPerElement && (v4().warn(`Unsupported indexed geometry values per element '${t20.valuesPerElement}', only 1 is currently supported`), n12 = false)) : (v4().warn(`Indexed geometry does not specify face indices for '${r19}' attribute`), n12 = false);
        }
      } else v4().warn("Indexed geometries must specify faces"), n12 = false;
      break;
    }
    default:
      v4().warn(`Unsupported topology '${r18}'`), n12 = false;
  }
  e14.params.material || (v4().warn("Geometry requires material"), n12 = false);
  const s15 = e14.params.vertexAttributes;
  for (const a10 in s15) {
    s15[a10].values || (v4().warn("Geometries with externally defined attributes are not yet supported"), n12 = false);
  }
  return n12;
}
function T5(e14, t19) {
  var _a, _b;
  const r18 = new Array(), n12 = new Array(), s15 = new Array(), o20 = new t10(), u13 = e14.resource, c13 = r4.parse(u13.version || "1.0", "wosr");
  q6.validate(c13);
  const p6 = u13.model.name, g4 = u13.model.geometries, h10 = u13.materialDefinitions ?? {}, v5 = e14.textures;
  let A8 = 0;
  const j8 = /* @__PURE__ */ new Map();
  for (let a10 = 0; a10 < g4.length; a10++) {
    const e15 = g4[a10];
    if (!M4(e15)) continue;
    const i13 = k3(e15), u14 = e15.params.vertexAttributes, c14 = [], p7 = (t20) => {
      if ("PerAttributeArray" === e15.params.topology) return null;
      const r19 = e15.params.faces;
      for (const e16 in r19) if (e16 === t20) return r19[e16].values;
      return null;
    }, I7 = u14[e6.POSITION], P6 = I7.values.length / I7.valuesPerElement;
    for (const t20 in u14) {
      const e16 = u14[t20], r19 = e16.values, n13 = p7(t20) ?? l5(P6);
      c14.push([t20, new t6(r19, n13, e16.valuesPerElement, true)]);
    }
    const T6 = i13.texture, U5 = v5 && v5[T6];
    if (U5 && !j8.has(T6)) {
      const { image: e16, parameters: t20 } = U5, r19 = new N2(e16, t20);
      n12.push(r19), j8.set(T6, r19);
    }
    const E10 = j8.get(T6), q7 = E10 ? E10.id : void 0, R8 = i13.material;
    let B3 = o20.get(R8, T6);
    if (null == B3) {
      const e16 = h10[R8.substring(R8.lastIndexOf("/") + 1)].params;
      1 === e16.transparency && (e16.transparency = 0);
      const r19 = U5 && U5.alphaChannelUsage, n13 = e16.transparency > 0 || "transparency" === r19 || "maskAndTransparency" === r19, s16 = U5 ? O11(U5.alphaChannelUsage) : void 0, a11 = { ambient: e4(e16.diffuse), diffuse: e4(e16.diffuse), opacity: 1 - (e16.transparency || 0), transparent: n13, textureAlphaMode: s16, textureAlphaCutoff: 0.33, textureId: q7, initTextureTransparent: true, doubleSided: true, cullFace: e11.None, colorMixMode: e16.externalColorMixMode || "tint", textureAlphaPremultiplied: (U5 == null ? void 0 : U5.parameters.preMultiplyAlpha) ?? false };
      (t19 == null ? void 0 : t19.materialParameters) && Object.assign(a11, t19.materialParameters), B3 = new j6(a11), o20.set(R8, T6, B3);
    }
    s15.push(B3);
    const C4 = new I3(B3, c14);
    A8 += ((_b = (_a = c14.find((e16) => e16[0] === e6.POSITION)) == null ? void 0 : _a[1]) == null ? void 0 : _b.indices.length) ?? 0, r18.push(C4);
  }
  return { engineResources: [{ name: p6, stageResources: { textures: n12, materials: s15, geometries: r18 }, pivotOffset: u13.model.pivotOffset, numberOfVertices: A8, lodThreshold: null }], referenceBoundingBox: U4(r18) };
}
function U4(e14) {
  const t19 = P2();
  return e14.forEach((e15) => {
    const r18 = e15.boundingInfo;
    null != r18 && (h(t19, r18.bbMin), h(t19, r18.bbMax));
  }), t19;
}
async function E9(e14, t19) {
  const r18 = new Array();
  for (const a10 in e14) {
    const n13 = e14[a10], s16 = n13.images[0].data;
    if (!s16) {
      v4().warn("Externally referenced texture data is not yet supported");
      continue;
    }
    const o20 = n13.encoding + ";base64," + s16, i13 = "/textureDefinitions/" + a10, l13 = "rgba" === n13.channels ? n13.alphaChannelUsage || "transparency" : "none", u13 = { noUnpackFlip: true, wrap: { s: D.REPEAT, t: D.REPEAT }, preMultiplyAlpha: O11(l13) !== s7.Opaque }, c13 = (t19 == null ? void 0 : t19.disableTextures) ? Promise.resolve(null) : t11(o20, t19);
    r18.push(c13.then((e15) => ({ refId: i13, image: e15, parameters: u13, alphaChannelUsage: l13 })));
  }
  const n12 = await Promise.all(r18), s15 = {};
  for (const a10 of n12) s15[a10.refId] = a10;
  return s15;
}
function O11(e14) {
  switch (e14) {
    case "mask":
      return s7.Mask;
    case "maskAndTransparency":
      return s7.MaskBlend;
    case "none":
      return s7.Opaque;
    default:
      return s7.Blend;
  }
}
function k3(e14) {
  const t19 = e14.params;
  return { id: 1, material: t19.material, texture: t19.texture, region: t19.texture };
}
var q6 = new r4(1, 2, "wosr");

// ../node_modules/@arcgis/core/views/3d/layers/graphics/objectResourceUtils.js
async function te(t19, r18) {
  var _a;
  const o20 = re(a2(t19));
  if ("wosr" === o20.fileType) {
    const e14 = await (r18.cache ? r18.cache.loadWOSR(o20.url, r18) : A7(o20.url, r18)), { engineResources: t20, referenceBoundingBox: s16 } = T5(e14, r18);
    return { lods: t20, referenceBoundingBox: s16, isEsriSymbolResource: false, isWosr: true };
  }
  const s15 = await (r18.cache ? r18.cache.loadGLTF(o20.url, r18, !!r18.usePBR) : l8(new n8(r18.streamDataRequester), o20.url, r18, r18.usePBR)), i13 = (_a = s15.model.meta) == null ? void 0 : _a.ESRI_proxyEllipsoid, n12 = s15.meta.isEsriSymbolResource && null != i13 && "EsriRealisticTreesStyle" === s15.meta.ESRI_webstyle;
  n12 && !s15.customMeta.esriTreeRendering && (s15.customMeta.esriTreeRendering = true, ae(s15, i13));
  const l13 = !!r18.usePBR, a10 = s15.meta.isEsriSymbolResource ? { usePBR: l13, isSchematic: false, treeRendering: n12, mrrFactors: [...o19] } : { usePBR: l13, isSchematic: false, treeRendering: false, mrrFactors: [...r17] }, u13 = { ...r18.materialParameters, treeRendering: n12 }, { engineResources: c13, referenceBoundingBox: m7 } = oe(s15, a10, u13, r18.skipHighLods && null == o20.specifiedLodIndex ? { skipHighLods: true } : { skipHighLods: false, singleLodIndex: o20.specifiedLodIndex });
  return { lods: c13, referenceBoundingBox: m7, isEsriSymbolResource: s15.meta.isEsriSymbolResource, isWosr: false };
}
function re(e14) {
  const t19 = e14.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);
  if (t19) return { fileType: "gltf", url: t19[1], specifiedLodIndex: null != t19[4] ? Number(t19[4]) : null };
  return e14.match(/(.*\.(json|json\.gz))$/) ? { fileType: "wosr", url: e14, specifiedLodIndex: null } : { fileType: "unknown", url: e14, specifiedLodIndex: null };
}
function oe(e14, t19, r18, o20) {
  const s15 = e14.model, i13 = new Array(), n12 = /* @__PURE__ */ new Map(), l13 = /* @__PURE__ */ new Map(), a10 = s15.lods.length, u13 = P2();
  return s15.lods.forEach((e15, c13) => {
    const m7 = true === o20.skipHighLods && (a10 > 1 && 0 === c13 || a10 > 3 && 1 === c13) || false === o20.skipHighLods && null != o20.singleLodIndex && c13 !== o20.singleLodIndex;
    if (m7 && 0 !== c13) return;
    const f9 = new t13(e15.name, e15.lodThreshold, [0, 0, 0]);
    e15.parts.forEach((e16) => {
      const o21 = m7 ? new j6({}) : se(s15, e16, f9, t19, r18, n12, l13), { geometry: i14, vertexCount: a11 } = ie(e16, null != o21 ? o21 : new j6({})), d6 = i14.boundingInfo;
      null != d6 && 0 === c13 && (h(u13, d6.bbMin), h(u13, d6.bbMax)), null != o21 && (f9.stageResources.geometries.push(i14), f9.numberOfVertices += a11);
    }), m7 || i13.push(f9);
  }), { engineResources: i13, referenceBoundingBox: u13 };
}
function se(e14, t19, r18, o20, s15, i13, n12) {
  var _a, _b;
  const a10 = t19.material + (t19.attributes.normal ? "_normal" : "") + (t19.attributes.color ? "_color" : "") + (t19.attributes.texCoord0 ? "_texCoord0" : "") + (t19.attributes.tangent ? "_tangent" : ""), u13 = e14.materials.get(t19.material), c13 = null != t19.attributes.texCoord0, m7 = null != t19.attributes.normal;
  if (null == u13) return null;
  const f9 = le(u13.alphaMode);
  if (!i13.has(a10)) {
    if (c13) {
      const t20 = (t21, r20 = false) => {
        if (null != t21 && !n12.has(t21)) {
          const o21 = e14.textures.get(t21);
          if (null != o21) {
            const e15 = o21.data;
            n12.set(t21, new N2(r8(e15) ? e15.data : e15, { ...o21.parameters, preMultiplyAlpha: !r8(e15) && r20, encoding: r8(e15) && null != e15.encoding ? e15.encoding : void 0 }));
          }
        }
      };
      t20(u13.textureColor, f9 !== s7.Opaque), t20(u13.textureNormal), t20(u13.textureOcclusion), t20(u13.textureEmissive), t20(u13.textureMetallicRoughness);
    }
    const r19 = u13.color[0] ** (1 / o7), d7 = u13.color[1] ** (1 / o7), p6 = u13.color[2] ** (1 / o7), g4 = u13.emissiveFactor[0] ** (1 / o7), x4 = u13.emissiveFactor[1] ** (1 / o7), b4 = u13.emissiveFactor[2] ** (1 / o7), h10 = null != u13.textureColor && c13 ? n12.get(u13.textureColor) : null, T6 = u12({ normalTexture: u13.textureNormal, metallicRoughnessTexture: u13.textureMetallicRoughness, metallicFactor: u13.metallicFactor, roughnessFactor: u13.roughnessFactor, emissiveTexture: u13.textureEmissive, emissiveFactor: u13.emissiveFactor, occlusionTexture: u13.textureOcclusion }), y5 = null != ((_a = u13.normalTextureTransform) == null ? void 0 : _a.scale) ? (_b = u13.normalTextureTransform) == null ? void 0 : _b.scale : l4;
    i13.set(a10, new j6({ ...o20, transparent: f9 === s7.Blend, customDepthTest: n9.Lequal, textureAlphaMode: f9, textureAlphaCutoff: u13.alphaCutoff, diffuse: [r19, d7, p6], ambient: [r19, d7, p6], opacity: u13.opacity, doubleSided: u13.doubleSided, doubleSidedType: "winding-order", cullFace: u13.doubleSided ? e11.None : e11.Back, hasVertexColors: !!t19.attributes.color, hasVertexTangents: !!t19.attributes.tangent, normalType: m7 ? a4.Attribute : a4.ScreenDerivative, castShadows: true, receiveShadows: u13.receiveShadows, receiveAmbientOcclusion: u13.receiveAmbientOcclustion, textureId: null != h10 ? h10.id : void 0, colorMixMode: u13.colorMixMode, normalTextureId: null != u13.textureNormal && c13 ? n12.get(u13.textureNormal).id : void 0, textureAlphaPremultiplied: null != h10 && !!h10.parameters.preMultiplyAlpha, occlusionTextureId: null != u13.textureOcclusion && c13 ? n12.get(u13.textureOcclusion).id : void 0, emissiveTextureId: null != u13.textureEmissive && c13 ? n12.get(u13.textureEmissive).id : void 0, metallicRoughnessTextureId: null != u13.textureMetallicRoughness && c13 ? n12.get(u13.textureMetallicRoughness).id : void 0, emissiveFactor: [g4, x4, b4], mrrFactors: T6 ? [...t16] : [u13.metallicFactor, u13.roughnessFactor, o20.mrrFactors[2]], isSchematic: T6, colorTextureTransformMatrix: s8(u13.colorTextureTransform), normalTextureTransformMatrix: s8(u13.normalTextureTransform), scale: [y5[0], y5[1]], occlusionTextureTransformMatrix: s8(u13.occlusionTextureTransform), emissiveTextureTransformMatrix: s8(u13.emissiveTextureTransform), metallicRoughnessTextureTransformMatrix: s8(u13.metallicRoughnessTextureTransform), ...s15 }));
  }
  const d6 = i13.get(a10);
  if (r18.stageResources.materials.push(d6), c13) {
    const e15 = (e16) => {
      null != e16 && r18.stageResources.textures.push(n12.get(e16));
    };
    e15(u13.textureColor), e15(u13.textureNormal), e15(u13.textureOcclusion), e15(u13.textureEmissive), e15(u13.textureMetallicRoughness);
  }
  return d6;
}
function ie(e14, s15) {
  const i13 = e14.attributes.position.count, n12 = o6(e14.indices || i13, e14.primitiveType), l13 = t4(3 * i13), { typedBuffer: a10, typedBufferStride: u13 } = e14.attributes.position;
  e9(l13, a10, e14.transform, 3, u13);
  const c13 = [[e6.POSITION, new t6(l13, n12, 3, true)]];
  if (null != e14.attributes.normal) {
    const o20 = t4(3 * i13), { typedBuffer: s16, typedBufferStride: l14 } = e14.attributes.normal;
    j(ne, e14.transform), f2(o20, s16, ne, 3, l14), _3(ne) && l6(o20, o20), c13.push([e6.NORMAL, new t6(o20, n12, 3, true)]);
  }
  if (null != e14.attributes.tangent) {
    const r18 = t4(4 * i13), { typedBuffer: s16, typedBufferStride: l14 } = e14.attributes.tangent;
    n4(ne, e14.transform), n5(r18, s16, ne, 4, l14), _3(ne) && l6(r18, r18, 4), c13.push([e6.TANGENT, new t6(r18, n12, 4, true)]);
  }
  if (null != e14.attributes.texCoord0) {
    const t19 = t4(2 * i13), { typedBuffer: r18, typedBufferStride: o20 } = e14.attributes.texCoord0;
    n7(t19, r18, 2, o20), c13.push([e6.UV0, new t6(t19, n12, 2, true)]);
  }
  const m7 = e14.attributes.color;
  if (null != m7) {
    const t19 = new Uint8Array(4 * i13);
    4 === m7.elementCount ? m7 instanceof c ? s5(t19, m7, 255) : m7 instanceof x ? t8(t19, m7) : m7 instanceof L && s5(t19, m7, 1 / 256) : (t19.fill(255), m7 instanceof i5 ? o4(t19, m7.typedBuffer, 255, 4, m7.typedBufferStride) : e14.attributes.color instanceof O2 ? t7(t19, m7.typedBuffer, 4, e14.attributes.color.typedBufferStride) : e14.attributes.color instanceof E && o4(t19, m7.typedBuffer, 1 / 256, 4, m7.typedBufferStride)), c13.push([e6.COLOR, new t6(t19, n12, 4, true)]);
  }
  return { geometry: new I3(s15, c13), vertexCount: i13 };
}
var ne = e7();
function le(e14) {
  switch (e14) {
    case "BLEND":
      return s7.Blend;
    case "MASK":
      return s7.Mask;
    case "OPAQUE":
    case null:
    case void 0:
      return s7.Opaque;
  }
}
function ae(e14, t19) {
  for (let r18 = 0; r18 < e14.model.lods.length; ++r18) {
    const o20 = e14.model.lods[r18];
    for (const s15 of o20.parts) {
      const o21 = s15.attributes.normal;
      if (null == o21) return;
      const l13 = s15.attributes.position, g4 = l13.count, x4 = n3(), b4 = n3(), h10 = n3(), y5 = new Uint8Array(4 * g4), v5 = new Float64Array(3 * g4), R8 = h2(e8(), s15.transform);
      let j8 = 0, B3 = 0;
      for (let i13 = 0; i13 < g4; i13++) {
        l13.getVec(i13, b4), o21.getVec(i13, x4), O(b4, b4, s15.transform), e5(h10, b4, t19.center), i3(h10, h10, t19.radius);
        const n12 = h10[2], p6 = s3(h10), g5 = Math.min(0.45 + 0.55 * p6 * p6, 1);
        i3(h10, h10, t19.radius), null !== R8 && O(h10, h10, R8), z(h10, h10), r18 + 1 !== e14.model.lods.length && e14.model.lods.length > 1 && A(h10, h10, x4, n12 > -1 ? 0.2 : Math.min(-4 * n12 - 3.8, 1)), v5[j8] = h10[0], v5[j8 + 1] = h10[1], v5[j8 + 2] = h10[2], j8 += 3, y5[B3] = 255 * g5, y5[B3 + 1] = 255 * g5, y5[B3 + 2] = 255 * g5, y5[B3 + 3] = 255, B3 += 4;
      }
      s15.attributes.normal = new i5(v5), s15.attributes.color = new x(y5);
    }
  }
}
export {
  te as fetch,
  oe as gltfToEngineResources,
  re as parseUrl
};
//# sourceMappingURL=objectResourceUtils-Z7UXHD6B.js.map
