import {
  t
} from "./chunk-QPPXYQ3P.js";
import {
  m,
  n,
  n2
} from "./chunk-OBN3TJ5S.js";
import {
  Ze
} from "./chunk-4X27YGEY.js";
import "./chunk-KW3Q5OC2.js";
import "./chunk-XNYIPE5U.js";
import "./chunk-YHUE64L3.js";
import "./chunk-QP7JUYAO.js";
import "./chunk-25PFK4XY.js";
import "./chunk-M6HMVFJK.js";
import "./chunk-NRWI2SUH.js";
import "./chunk-IFLXRJZP.js";
import "./chunk-PS567YZP.js";
import "./chunk-NGPLQQSE.js";
import "./chunk-HN3UL7DT.js";
import "./chunk-IEANCNX6.js";
import "./chunk-MUYRQ7CH.js";
import "./chunk-GPH64EJR.js";
import "./chunk-U6JPKU6C.js";
import "./chunk-FY5GOH3U.js";
import "./chunk-AMKKU676.js";
import "./chunk-QBW6ZJYD.js";
import "./chunk-S7J6OTBX.js";
import "./chunk-GMJ4G37M.js";
import "./chunk-CSCLMZ7J.js";
import "./chunk-BIJ6AA2G.js";
import "./chunk-FTURJXD3.js";
import "./chunk-LNOEFEG3.js";
import "./chunk-TJWXOPWU.js";
import "./chunk-T7UJMFMF.js";
import "./chunk-4SCOCLA2.js";
import "./chunk-WF67GKPJ.js";
import "./chunk-PVGZCS2Z.js";
import "./chunk-4HOM27T6.js";
import "./chunk-FO4JQZA5.js";
import "./chunk-XEELLOJE.js";
import {
  d
} from "./chunk-647CGSDX.js";
import "./chunk-EELMLJ53.js";
import "./chunk-JVNKXKH7.js";
import "./chunk-ZT5UNVCE.js";
import "./chunk-2FW7ECQ2.js";
import "./chunk-LGQJAMGK.js";
import "./chunk-PVAXLXWO.js";
import "./chunk-D6KE2FST.js";
import "./chunk-W3XB5XWO.js";
import "./chunk-6QBE4YDH.js";
import "./chunk-QG2IIIZW.js";
import "./chunk-LXDJBJSP.js";
import "./chunk-OPCT64AO.js";
import "./chunk-4BM24IVD.js";
import "./chunk-5LNCGIUN.js";
import "./chunk-CFIKP7ET.js";
import "./chunk-VEAHCP5W.js";
import "./chunk-WO4V65CJ.js";
import "./chunk-QUNQAVSE.js";
import "./chunk-HNXXFTFZ.js";
import "./chunk-KVPS4KFB.js";
import "./chunk-NSXZC33R.js";
import "./chunk-E7HFITKU.js";
import "./chunk-ZFQCSBZ4.js";
import "./chunk-4PAHN45R.js";
import "./chunk-CRUGTXEH.js";
import "./chunk-CPGVDDHW.js";
import "./chunk-VEOZVJAT.js";
import "./chunk-3D32E2TW.js";
import "./chunk-ACWF4COQ.js";
import "./chunk-P35RWHDU.js";
import "./chunk-G5U2OA3R.js";
import "./chunk-OIFKYPGO.js";
import "./chunk-JNGB7HKP.js";
import "./chunk-NREDFKHH.js";
import "./chunk-DCOKV3EO.js";
import "./chunk-CZ3DCLKN.js";
import "./chunk-7TO4QD67.js";
import "./chunk-DZNQTDMC.js";
import "./chunk-ZRA2NDCA.js";
import "./chunk-RM4VMFVT.js";
import "./chunk-JJIIUFER.js";
import "./chunk-ITGBXG45.js";
import "./chunk-LLJZCFHW.js";
import "./chunk-VIUFBDIY.js";
import "./chunk-TXIL3QUC.js";
import "./chunk-2ASAB4KA.js";
import "./chunk-EA74CF7B.js";
import "./chunk-IGNUVZ34.js";
import "./chunk-LTSQHA4C.js";
import "./chunk-YUQFVZCH.js";
import "./chunk-TQBRYTUC.js";
import "./chunk-T4EIRKFE.js";
import "./chunk-OHUWK5XV.js";
import "./chunk-PHVKM5OH.js";
import "./chunk-KQ5GHUVQ.js";
import "./chunk-RTULPMO3.js";
import "./chunk-AJ6PR43V.js";
import "./chunk-6LV4OO46.js";
import "./chunk-ZK2DM5OJ.js";
import "./chunk-JQIB7GFW.js";
import {
  d as d2
} from "./chunk-CJJCN7PA.js";
import "./chunk-IJUFAIOF.js";
import "./chunk-MNMU4ARP.js";
import "./chunk-7OW2VNCC.js";
import "./chunk-AFBYZF6Q.js";
import "./chunk-IJ42YN7D.js";
import "./chunk-4AGGGL2W.js";
import "./chunk-FJPG3YI6.js";
import "./chunk-BJHLU2MM.js";
import "./chunk-E5KBRIJQ.js";
import "./chunk-Z32PAECZ.js";
import "./chunk-TW7VY7XV.js";
import {
  i
} from "./chunk-CAC7FEOV.js";
import "./chunk-KK4UI5LV.js";
import "./chunk-BL2UGYYZ.js";
import "./chunk-Q4D7WYWB.js";
import "./chunk-NYWHVRZC.js";
import "./chunk-ZH4RVBER.js";
import "./chunk-UGXIDNPX.js";
import {
  C
} from "./chunk-FADA7L64.js";
import "./chunk-YTTIKQNA.js";
import "./chunk-PNUUOKAJ.js";
import "./chunk-7PMYO342.js";
import "./chunk-4K4GIBGP.js";
import "./chunk-WMMHQ2SA.js";
import "./chunk-AZ7WOCBW.js";
import "./chunk-3DBICPHD.js";
import "./chunk-7R5XEKR3.js";
import "./chunk-ZK4LSXOH.js";
import "./chunk-XFBTC3BA.js";
import "./chunk-XFU3BDEI.js";
import "./chunk-IZXTMJPP.js";
import "./chunk-5MMVRBZL.js";
import "./chunk-RS5OZZZ5.js";
import "./chunk-VRHSV3YE.js";
import "./chunk-OVORXUCO.js";
import "./chunk-WLUQPLAY.js";
import "./chunk-BTSZKQPH.js";
import "./chunk-AL3F322A.js";
import "./chunk-6N5YXCNN.js";
import "./chunk-MJ2NSPP7.js";
import "./chunk-6YSPJNLC.js";
import "./chunk-66KCMKB5.js";
import "./chunk-ZART2Y5J.js";
import "./chunk-F4OBDVPS.js";
import "./chunk-X3IFQMC4.js";
import "./chunk-4ZEH5SNV.js";
import "./chunk-Z6R2SP3D.js";
import "./chunk-K4UOG562.js";
import "./chunk-WC4SPMPL.js";
import "./chunk-TJUEGVVG.js";
import "./chunk-FXNOKZ3B.js";
import "./chunk-GEH2VXFC.js";
import "./chunk-BJY5ADVY.js";
import "./chunk-VMWKLHJD.js";
import "./chunk-5AEITAWU.js";
import "./chunk-G36SOMYZ.js";
import {
  a,
  s2 as s
} from "./chunk-YNL57W4I.js";
import "./chunk-2PA5UPTB.js";
import "./chunk-XZXEUADC.js";

// ../node_modules/@arcgis/core/arcade.js
var p = null;
function f(e, t2, a2, n3 = {}) {
  const o = t2.elementType, s2 = "value", c = "array" === o.type ? [{ name: s2, type: o.type, elementType: o.elementType }] : "dictionary" === o.type ? [{ name: s2, type: o.type, properties: o.properties }] : [{ name: s2, type: o.type }];
  return new t(e.map((e2) => {
    const t3 = {};
    return b(t3, c, { [s2]: e2 }, a2, n3), t3[s2];
  }));
}
function m2(e, t2, r = {}) {
  const a2 = e instanceof d ? new Ze({ source: e.features, geometryType: e.geometryType, fields: e.fields, spatialReference: e.spatialReference }) : e;
  return t2.constructFeatureSet(a2, r.spatialReference, null, true, r.lruCache, r.interceptor);
}
function y(e, t2, r = {}) {
  const { spatialReference: a2, interceptor: n3, lruCache: o } = r;
  return "string" == typeof e ? t2.createFeatureSetCollectionFromService(e, a2, o, n3) : t2.createFeatureSetCollectionFromMap(e, a2, o, n3);
}
function d3(e, t2, r, a2 = {}) {
  const n3 = {};
  return b(n3, t2.properties, e, r, a2), new p.Dictionary(n3);
}
function b(e, r, a2, n3, c = {}) {
  const i2 = {};
  for (const t2 of Object.keys(a2)) i2[t2.toLowerCase()] = a2[t2];
  for (const l of r) {
    const r2 = l.name.toLowerCase();
    if (c.variablesPreProcessed) e[r2] = i2[r2];
    else switch (l.type) {
      case "array": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : f(t2, l, n3, c);
        break;
      }
      case "feature": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : p.Feature.createFromGraphic(t2, c == null ? void 0 : c.timeZone);
        break;
      }
      case "featureSet": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : n3 ? m2(t2, n3, c) : null;
        break;
      }
      case "featureSetCollection": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : n3 ? y(t2, n3, c) : null;
        break;
      }
      case "dictionary": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : d3(t2, l, n3, c);
        break;
      }
      case "date": {
        const a3 = i2[r2];
        e[r2] = a3 ? a3 instanceof m ? a3 : (c == null ? void 0 : c.timeZone) ? m.dateJSAndZoneToArcadeDate(a3, c == null ? void 0 : c.timeZone) : m.dateJSToArcadeDate(a3) : null;
        break;
      }
      case "dateOnly": {
        const t2 = i2[r2];
        e[r2] = t2 ? t2 instanceof n ? t2 : n.fromReader(t2) : null;
        break;
      }
      case "time": {
        const t2 = i2[r2];
        e[r2] = t2 ? t2 instanceof n2 ? t2 : n2.fromReader(t2) : null;
        break;
      }
      case "knowledgeGraph":
      case "geometry":
      case "boolean":
      case "text":
      case "number":
        e[r2] = i2[r2];
    }
  }
}
function v(e, t2) {
  for (const r of e) t2.push(r), "dictionary" === r.type && v(r.properties, t2);
  return t2;
}
function S(e, t2, r, a2, n3) {
  const { spatialReference: o, interceptor: s2, lruCache: c, console: l, abortSignal: u, timeZone: p2, services: f2 = { portal: C.getDefault() } } = r, m3 = { vars: {}, spatialReference: o, interceptor: s2, timeZone: p2, lrucache: c, useAsync: n3, services: f2, console: l, abortSignal: u };
  return t2 ? (b(m3.vars, e.variables, t2, a2, r), m3) : m3;
}
function g(t2, r) {
  switch (r.getArcadeType(t2)) {
    case "number":
    case "text":
    case "boolean":
    case "point":
    case "polygon":
    case "polyline":
    case "multipoint":
    case "extent":
      return t2;
    case "date":
      return t2.toJSDate();
    case "time":
    case "dateOnly":
      return t2.toString();
    case "feature": {
      const r2 = (t2.type, t2), a2 = "geometry" in r2 ? r2.geometry() : null, n3 = "readAttributes" in r2 ? r2.readAttributes() : r2.attributes;
      return new d2({ geometry: a2, attributes: n3 });
    }
    case "dictionary": {
      const e = t2, a2 = e.attributes, n3 = {};
      for (const t3 of Object.keys(a2)) n3[t3] = g(e.field(t3), r);
      return n3;
    }
    case "array":
      return ("toArray" in t2 ? t2.toArray() : t2).map((e) => g(e, r));
  }
  return t2;
}
var w = { variables: [{ name: "$feature", type: "feature" }, { name: "$layer", type: "featureSet" }, { name: "$datastore", type: "featureSetCollection" }, { name: "$map", type: "featureSetCollection" }, { name: "$userInput", type: "geometry" }, { name: "$graph", type: "knowledgeGraph" }] };
var $ = { variables: [{ name: "$feature", type: "feature" }, { name: "$aggregatedFeatures", type: "featureSet" }] };
var h = /* @__PURE__ */ new Map([["aggregate-field", { variables: [{ name: "$feature", type: "feature" }] }], ["form-constraint", { variables: [{ name: "$feature", type: "feature" }] }], ["feature-z", { variables: [{ name: "$feature", type: "feature" }] }], ["field-calculation", { variables: [{ name: "$feature", type: "feature" }, { name: "$datastore", type: "featureSetCollection" }] }], ["form-calculation", { variables: [{ name: "$feature", type: "feature" }, { name: "$originalFeature", type: "feature" }, { name: "$layer", type: "featureSet" }, { name: "$featureSet", type: "featureSet" }, { name: "$datastore", type: "featureSetCollection" }, { name: "$map", type: "featureSetCollection" }, { name: "$editContext", type: "dictionary", properties: [{ name: "editType", type: "text" }] }] }], ["labeling", { variables: [{ name: "$feature", type: "feature" }] }], ["popup", w], ["popup-element", w], ["feature-reduction-popup", $], ["feature-reduction-popup-element", $], ["visualization", { variables: [{ name: "$feature", type: "feature" }, { name: "$view", type: "dictionary", properties: [{ name: "scale", type: "number" }] }] }]]);
function C2(e) {
  const t2 = h.get(e);
  if (!t2) {
    const t3 = Array.from(h.keys()).map((e2) => `'${e2}'`).join(", ");
    throw new s("createArcadeProfile:invalid-profile-name", `Invalid profile name '${e}'. You must specify one of the following values: ${t3}`);
  }
  return a(t2);
}
async function A(e, t2, r = {}) {
  p || (p = await i());
  const { arcade: n3, arcadeUtils: o } = p, { loadScriptDependencies: s2, referencesMember: c, scriptIsAsync: i2 } = n3, l = v(t2.variables, []), f2 = l.filter((e2) => "featureSet" === e2.type || "featureSetCollection" === e2.type).map((e2) => e2.name.toLowerCase()), m3 = n3.parseScript(e, f2);
  if (!m3) throw new s("arcade:invalid-script", "Unable to create SyntaxTree");
  const y2 = o.extractFieldNames(m3), d4 = n3.scriptTouchesGeometry(m3), b2 = l.map((e2) => e2.name.toLowerCase()).filter((e2) => c(m3, e2)), w2 = i2(m3, f2);
  await s2(m3, w2, f2);
  const $2 = { vars: {}, spatialReference: null, useAsync: w2 };
  for (const a2 of b2) $2.vars[a2] = "any";
  const { lruCache: h2 } = r, C3 = n3.compileScript(m3, $2), A2 = n3.featureSetUtils(), { services: j } = r;
  return { execute: (e2, r2 = {}) => {
    if (w2) throw new s("arcade:invalid-execution-mode", "Cannot execute the script in synchronous mode");
    const n4 = C3(S(t2, e2, { lruCache: h2, ...r2 }, A2, w2));
    return r2.rawOutput ? n4 : g(n4, o);
  }, executeAsync: async (e2, r2 = {}) => {
    const a2 = await C3(S(t2, e2, { lruCache: h2, services: j, ...r2 }, A2, w2));
    return r2.rawOutput ? a2 : g(a2, o);
  }, isAsync: w2, variablesUsed: b2, fieldsUsed: y2, geometryUsed: d4, syntaxTree: m3 };
}
export {
  A as createArcadeExecutor,
  C2 as createArcadeProfile
};
//# sourceMappingURL=arcade-RDVZPZXF.js.map
