{
  "version": 3,
  "sources": ["../../../../node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from\"../../Error.js\";import{createMD5Hash as r}from\"../../MD5.js\";import{isMultiOriginJSONMixin as e}from\"../../multiOriginJSONSupportUtils.js\";import{isAbsolute as o,isBlobProtocol as s,join as n,blobUrlToBlob as i,getPathExtension as p}from\"../../urlUtils.js\";import{generateUUID as c}from\"../../uuid.js\";import{getPropertyMetadata as u}from\"../metadata.js\";import{nameToId as a}from\"../PropertyOrigin.js\";import{propertyJSONMeta as l}from\"./property.js\";import{getResourceContentExtension as m}from\"../../../portal/support/resourceExtension.js\";import{r as d,t as f,M as y,i as g,p as h,b as v}from\"../../../chunks/persistableUrlUtils.js\";function j(t){const r=t?.origins??[void 0];return(e,o)=>{const s=U(t,e,o);for(const t of r){const r=l(e,t,o);for(const t in s)r[t]=s[t]}}}function U(t,r,e){if(\"resource\"===t?.type)return w(t,r,e);switch(t?.type??\"other\"){case\"other\":return{read:!0,write:!0};case\"url\":{const{read:t,write:r}=v;return{read:t,write:r}}}}function w(t,r,n){const i=u(r,n);return{type:String,read:(t,r,e)=>{const o=d(t,r,e);return i.type===String?o:\"function\"==typeof i.type?new i.type({url:o}):void 0},write:{writer(r,p,c,u){if(!u?.resources)return\"string\"==typeof r?void(p[c]=f(r,u)):void(p[c]=r.write({},u));const l=x(r),m=f(l,{...u,verifyItemRelativeUrls:u?.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},y.NO),d=i.type!==String&&(!e(this)||u?.origin&&this.originIdOf(n)>a(u.origin)),h={object:this,propertyName:n,value:r,targetUrl:m,dest:p,targetPropertyName:c,context:u,params:t};u?.portalItem&&m&&!o(m)?d&&t?.contentAddressed?I(h):d?N(h):P(h):u?.portalItem&&(null==m||null!=g(m)||s(m)||d)?I(h):p[c]=m}}}}function I(e){const{targetUrl:o,params:p,value:u,context:a,dest:l,targetPropertyName:d}=e;if(!a.portalItem)return;const f=h(o),y=S(u,o,a);if(p?.contentAddressed&&\"json\"!==y.type)return void a.messages?.push(new t(\"persistable:contentAddressingUnsupported\",`Property \"${d}\" is trying to serializing a resource with content of type ${y.type} with content addressing. Content addressing is only supported for json resources.`,{content:y}));const g=p?.contentAddressed&&\"json\"===y.type?r(y.jsonString):f?.filename??c(),v=n(p?.prefix??f?.prefix,g),j=`${v}.${m(y)}`;if(p?.contentAddressed&&a.resources&&\"json\"===y.type){const t=a.resources.toKeep.find((({resource:t})=>t.path===j))??a.resources.toAdd.find((({resource:t})=>t.path===j));if(t)return void(l[d]=t.resource.itemRelativeUrl)}const U=a.portalItem.resourceFromPath(j);s(o)&&a.resources&&a.resources.pendingOperations.push(i(o).then((t=>{U.path=`${v}.${m({type:\"blob\",blob:t})}`,l[d]=U.itemRelativeUrl})).catch((()=>{})));const w=p?.compress??!1;a.resources&&b({...e,resource:U,content:y,compress:w,updates:a.resources.toAdd}),l[d]=U.itemRelativeUrl}function N(t){const{context:r,targetUrl:e,params:o,value:s,dest:n,targetPropertyName:i}=t;if(!r.portalItem)return;const c=r.portalItem.resourceFromPath(e),u=S(s,e,r),a=m(u),l=p(c.path),d=o?.compress??!1;a===l?(r.resources&&b({...t,resource:c,content:u,compress:d,updates:r.resources.toUpdate}),n[i]=e):I(t)}function P({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function b({object:t,propertyName:r,updates:e,resource:o,content:s,compress:n}){const i=e=>{O(t,r,e)};e.push({resource:o,content:s,compress:n,finish:i})}function S(t,r,e){return\"string\"==typeof t?{type:\"url\",url:r}:{type:\"json\",jsonString:JSON.stringify(t.toJSON(e))}}function x(t){return null==t?null:\"string\"==typeof t?t:t.url}function O(t,r,e){\"string\"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{j as persistable};\n"],
  "mappings": "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",
  "names": ["o", "s", "U", "t", "r", "n", "i", "p", "x", "m", "d", "P", "f", "y", "g", "j", "w", "e"]
}
