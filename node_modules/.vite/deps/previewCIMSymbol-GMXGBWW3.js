import {
  i
} from "./chunk-34GIATYY.js";
import {
  l
} from "./chunk-RWRVBUZL.js";
import {
  t
} from "./chunk-IDO3G6OO.js";
import "./chunk-YVOD4VRJ.js";
import {
  K,
  ee,
  tt
} from "./chunk-CWKNMWWX.js";
import "./chunk-JSBYWL75.js";
import "./chunk-W366AY2Q.js";
import "./chunk-2UJLW7H2.js";
import "./chunk-CRF5P7HT.js";
import "./chunk-Y55T56UT.js";
import "./chunk-TCGVPS3X.js";
import "./chunk-A2WMIQD6.js";
import "./chunk-ZVC7ZICV.js";
import "./chunk-YH5YACEX.js";
import "./chunk-QKCF7BZB.js";
import "./chunk-O45ZPWWN.js";
import "./chunk-CYGO6TZX.js";
import "./chunk-3B3ZQPEJ.js";
import "./chunk-KRKDK2RA.js";
import {
  y
} from "./chunk-GMJ4G37M.js";
import "./chunk-LGQJAMGK.js";
import {
  V
} from "./chunk-D6KE2FST.js";
import "./chunk-OPCT64AO.js";
import "./chunk-WO4V65CJ.js";
import "./chunk-QUNQAVSE.js";
import "./chunk-VEOZVJAT.js";
import "./chunk-3D32E2TW.js";
import "./chunk-JNGB7HKP.js";
import "./chunk-NREDFKHH.js";
import "./chunk-DCOKV3EO.js";
import "./chunk-YUQFVZCH.js";
import "./chunk-T4EIRKFE.js";
import "./chunk-JQIB7GFW.js";
import "./chunk-7OW2VNCC.js";
import "./chunk-AFBYZF6Q.js";
import "./chunk-IJ42YN7D.js";
import "./chunk-4AGGGL2W.js";
import "./chunk-FJPG3YI6.js";
import "./chunk-BJHLU2MM.js";
import "./chunk-E5KBRIJQ.js";
import "./chunk-Z32PAECZ.js";
import "./chunk-TW7VY7XV.js";
import "./chunk-CAC7FEOV.js";
import "./chunk-KK4UI5LV.js";
import {
  e,
  u
} from "./chunk-BL2UGYYZ.js";
import "./chunk-Q4D7WYWB.js";
import "./chunk-NYWHVRZC.js";
import "./chunk-ZH4RVBER.js";
import "./chunk-UGXIDNPX.js";
import "./chunk-FADA7L64.js";
import "./chunk-YTTIKQNA.js";
import "./chunk-PNUUOKAJ.js";
import "./chunk-7PMYO342.js";
import "./chunk-4K4GIBGP.js";
import "./chunk-WMMHQ2SA.js";
import "./chunk-AZ7WOCBW.js";
import "./chunk-3DBICPHD.js";
import "./chunk-7R5XEKR3.js";
import "./chunk-ZK4LSXOH.js";
import "./chunk-XFBTC3BA.js";
import "./chunk-XFU3BDEI.js";
import "./chunk-IZXTMJPP.js";
import "./chunk-5MMVRBZL.js";
import "./chunk-RS5OZZZ5.js";
import "./chunk-VRHSV3YE.js";
import "./chunk-OVORXUCO.js";
import "./chunk-WLUQPLAY.js";
import "./chunk-BTSZKQPH.js";
import "./chunk-AL3F322A.js";
import "./chunk-6N5YXCNN.js";
import "./chunk-MJ2NSPP7.js";
import "./chunk-6YSPJNLC.js";
import "./chunk-66KCMKB5.js";
import "./chunk-ZART2Y5J.js";
import "./chunk-F4OBDVPS.js";
import "./chunk-X3IFQMC4.js";
import "./chunk-4ZEH5SNV.js";
import "./chunk-Z6R2SP3D.js";
import "./chunk-K4UOG562.js";
import "./chunk-WC4SPMPL.js";
import "./chunk-TJUEGVVG.js";
import "./chunk-FXNOKZ3B.js";
import "./chunk-GEH2VXFC.js";
import "./chunk-BJY5ADVY.js";
import "./chunk-VMWKLHJD.js";
import "./chunk-5AEITAWU.js";
import "./chunk-G36SOMYZ.js";
import "./chunk-YNL57W4I.js";
import "./chunk-2PA5UPTB.js";
import "./chunk-XZXEUADC.js";

// ../node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js
var n = 96 / 72;
var o = class {
  constructor(t2) {
    this._spatialReference = t2, this._imageDataCanvas = null, this._cimResourceManager = new i();
  }
  get _canvas() {
    return this._imageDataCanvas || (this._imageDataCanvas = document.createElement("canvas")), this._imageDataCanvas;
  }
  get resourceManager() {
    return this._cimResourceManager;
  }
  async rasterizeCIMSymbolAsync(e2, t2, i2, n2, o2, l2, c2, m2, g) {
    if (!e2) return null;
    const { data: y3 } = e2;
    if (!y3 || "CIMSymbolReference" !== y3.type || !y3.symbol) return null;
    const { symbol: u3 } = y3;
    l2 || (l2 = V(u3));
    const d = await y.resolveSymbolOverrides(y3, t2, this._spatialReference, o2, l2, c2, m2), w = this._cimResourceManager, p2 = [];
    ee.fetchResources(d, w, p2), ee.fetchFonts(d, w, p2), p2.length > 0 && await Promise.all(p2);
    const { width: b, height: f2 } = i2, M = h(l2, b, f2, n2), C = ee.getEnvelope(d, M, w);
    if (!C) return null;
    let R = 1, v = 0, I = 0;
    switch (u3.type) {
      case "CIMPointSymbol":
      case "CIMTextSymbol":
        {
          let e3 = 1;
          C.width > b && (e3 = b / C.width);
          let t3 = 1;
          C.height > f2 && (t3 = f2 / C.height), "preview" === n2 && (C.width < b && (e3 = b / C.width), C.height < f2 && (t3 = f2 / C.height)), R = Math.min(e3, t3), v = C.x + C.width / 2, I = C.y + C.height / 2;
        }
        break;
      case "CIMLineSymbol":
        {
          (g || C.height > f2) && (R = f2 / C.height), I = C.y + C.height / 2;
          const e3 = C.x * R + b / 2, t3 = (C.x + C.width) * R + b / 2, { paths: i3 } = M;
          i3[0][0][0] -= e3 / R, i3[0][2][0] -= (t3 - b) / R;
        }
        break;
      case "CIMPolygonSymbol": {
        v = C.x + C.width / 2, I = C.y + C.height / 2;
        const e3 = C.x * R + b / 2, t3 = (C.x + C.width) * R + b / 2, i3 = C.y * R + f2 / 2, r = (C.y + C.height) * R + f2 / 2, { rings: a } = M;
        e3 < 0 && (a[0][0][0] -= e3, a[0][3][0] -= e3, a[0][4][0] -= e3), i3 < 0 && (a[0][0][1] += i3, a[0][1][1] += i3, a[0][4][1] += i3), t3 > b && (a[0][1][0] -= t3 - b, a[0][2][0] -= t3 - b), r > f2 && (a[0][2][1] += r - f2, a[0][3][1] += r - f2);
      }
    }
    const S = { type: "cim", data: { type: "CIMSymbolReference", symbol: d } };
    return this.rasterize(S, b, f2, v, I, R, l2, 1, M);
  }
  rasterize(e2, r, a, o2, l2, c2, m2, g = 0, y3 = null) {
    const { data: u3 } = e2;
    if (!u3 || "CIMSymbolReference" !== u3.type || !u3.symbol) return null;
    const { symbol: d } = u3, w = this._canvas, p2 = (window.devicePixelRatio || 1) * n;
    w.width = r * p2, w.height = a * p2, m2 || (m2 = V(d)), y3 || (y3 = h(m2, r, a, "legend")), w.width += 2 * g, w.height += 2 * g;
    const b = w.getContext("2d", { willReadFrequently: true }), f2 = K.createIdentity();
    f2.translate(-o2, -l2), f2.scale(c2 * p2, -c2 * p2), f2.translate(r * p2 / 2 + g, a * p2 / 2 + g), b.clearRect(0, 0, w.width, w.height);
    return new tt(b, this._cimResourceManager, f2, true).drawSymbol(d, y3), b.getImageData(0, 0, w.width, w.height);
  }
};
function h(e2, t2, i2, r) {
  const a = 1, s2 = -t2 / 2 + a, n2 = t2 / 2 - a, o2 = i2 / 2 - a, h3 = -i2 / 2 + a;
  switch (e2) {
    case "esriGeometryPoint":
      return { x: 0, y: 0 };
    case "esriGeometryPolyline":
      return { paths: [[[s2, 0], [0, 0], [n2, 0]]] };
    default:
      return "legend" === r ? { rings: [[[s2, o2], [n2, 0], [n2, h3], [s2, h3], [s2, o2]]] } : { rings: [[[s2, o2], [n2, o2], [n2, h3], [s2, h3], [s2, o2]]] };
  }
}

// ../node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js
var s = new o(null);
var c = e(t.size);
var m = e(t.maxSize);
var u2 = e(t.lineWidth);
var f = 1;
async function h2(e2, t2, i2) {
  const l2 = t2 == null ? void 0 : t2.size;
  let r = null != l2 && "object" == typeof l2 && "width" in l2 ? l2.width : l2, n2 = null != l2 && "object" == typeof l2 && "height" in l2 ? l2.height : l2;
  if (null == r || null == n2) if ("esriGeometryPolygon" === i2) r = c, n2 = c;
  else {
    const l3 = await y2(e2, t2, i2);
    l3 && (r = l3.width, n2 = l3.height), "esriGeometryPolyline" === i2 && (r = u2), r = null != r && isFinite(r) ? Math.min(r, m) : c, n2 = null != n2 && isFinite(n2) ? Math.max(Math.min(n2, m), f) : c;
  }
  return "legend" === t2.style && "esriGeometryPolyline" === i2 && (r = u2), { width: r, height: n2 };
}
async function y2(e2, t2, l2) {
  const { feature: n2, fieldMap: a, viewParams: o2 } = t2.cimOptions || t2, c2 = await y.resolveSymbolOverrides(e2.data, n2, null, a, l2, null, o2);
  if (!c2) return null;
  (e2 = e2.clone()).data = { type: "CIMSymbolReference", symbol: c2 }, e2.data.primitiveOverrides = void 0;
  const m2 = [];
  return ee.fetchResources(c2, s.resourceManager, m2), ee.fetchFonts(c2, s.resourceManager, m2), m2.length > 0 && await Promise.all(m2), ee.getEnvelope(c2, null, s.resourceManager);
}
async function p(e2, i2 = {}) {
  var _a;
  const { node: l2, opacity: r, symbolConfig: a } = i2, c2 = null != a && "object" == typeof a && "isSquareFill" in a && a.isSquareFill, m2 = i2.cimOptions || i2, u3 = m2.geometryType || V((_a = e2 == null ? void 0 : e2.data) == null ? void 0 : _a.symbol), f2 = await h2(e2, i2, u3), { feature: y3, fieldMap: p2 } = m2, d = c2 || "esriGeometryPolygon" !== u3 ? "preview" : "legend", g = await s.rasterizeCIMSymbolAsync(e2, y3, f2, d, p2, u3, null, m2.viewParams, m2.allowScalingUp);
  if (!g) return null;
  const { width: w, height: b } = g, v = document.createElement("canvas");
  v.width = w, v.height = b;
  v.getContext("2d").putImageData(g, 0, 0);
  const M = u(f2.width), j = u(f2.height), S = new Image(M, j);
  S.src = v.toDataURL(), S.ariaLabel = i2.ariaLabel ?? null, S.alt = i2.ariaLabel ?? "", null != r && (S.style.opacity = `${r}`);
  let C = S;
  if (null != i2.effectView) {
    const e3 = { shape: { type: "image", x: 0, y: 0, width: M, height: j, src: S.src }, fill: null, stroke: null, offset: [0, 0] };
    C = l([[e3]], [M, j], { effectView: i2.effectView, ariaLabel: i2.ariaLabel });
  }
  return l2 && C && l2.appendChild(C), C;
}
export {
  p as previewCIMSymbol
};
//# sourceMappingURL=previewCIMSymbol-GMXGBWW3.js.map
