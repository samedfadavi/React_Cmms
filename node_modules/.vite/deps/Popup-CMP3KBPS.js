import {
  n as n5
} from "./chunk-SB76Q4D6.js";
import "./chunk-T5UGK7QV.js";
import "./chunk-RWRVBUZL.js";
import "./chunk-IDO3G6OO.js";
import {
  r as r5
} from "./chunk-63PKDBJA.js";
import "./chunk-M34OMJ77.js";
import "./chunk-NYSNGPJM.js";
import {
  D as D2,
  N as N3,
  R,
  g2 as g3,
  h as h2
} from "./chunk-YVOD4VRJ.js";
import {
  s as s8
} from "./chunk-4TEPLCXX.js";
import {
  a as a2
} from "./chunk-TPYC4AVC.js";
import {
  E as E2
} from "./chunk-IOHBILME.js";
import "./chunk-5EVRQBNQ.js";
import "./chunk-TTOHDCA7.js";
import "./chunk-F6WID7U3.js";
import "./chunk-MTDWQK7X.js";
import "./chunk-ZPZCSP4J.js";
import "./chunk-5YPRHJQA.js";
import "./chunk-ZVC7ZICV.js";
import "./chunk-FGBBSER4.js";
import "./chunk-BPQ42BUB.js";
import {
  N as N2,
  Z
} from "./chunk-MGJTYDNO.js";
import {
  e as e4,
  o as o3,
  t2 as t
} from "./chunk-3QQTJWPA.js";
import "./chunk-QKCF7BZB.js";
import "./chunk-P3MZKJDB.js";
import "./chunk-JWA73VK6.js";
import {
  B,
  e2,
  r as r3
} from "./chunk-VWJLGMHU.js";
import {
  r as r4
} from "./chunk-YYWBDW7S.js";
import {
  i2 as i4,
  n2
} from "./chunk-3B3ZQPEJ.js";
import {
  b as b2,
  f as f2,
  g as g2,
  v as v3
} from "./chunk-KRKDK2RA.js";
import "./chunk-GP37RDGU.js";
import "./chunk-I4UBGMTI.js";
import "./chunk-3XW4ZFBO.js";
import "./chunk-P5HR6D5U.js";
import {
  Ze
} from "./chunk-4X27YGEY.js";
import "./chunk-KW3Q5OC2.js";
import "./chunk-XNYIPE5U.js";
import "./chunk-YHUE64L3.js";
import "./chunk-QP7JUYAO.js";
import "./chunk-25PFK4XY.js";
import "./chunk-M6HMVFJK.js";
import "./chunk-NRWI2SUH.js";
import "./chunk-IFLXRJZP.js";
import "./chunk-PS567YZP.js";
import "./chunk-NGPLQQSE.js";
import "./chunk-HN3UL7DT.js";
import "./chunk-IEANCNX6.js";
import "./chunk-MUYRQ7CH.js";
import "./chunk-GPH64EJR.js";
import "./chunk-U6JPKU6C.js";
import "./chunk-FY5GOH3U.js";
import "./chunk-AMKKU676.js";
import "./chunk-QBW6ZJYD.js";
import {
  l as l2
} from "./chunk-S7J6OTBX.js";
import "./chunk-GMJ4G37M.js";
import "./chunk-CSCLMZ7J.js";
import "./chunk-BIJ6AA2G.js";
import "./chunk-FTURJXD3.js";
import "./chunk-LNOEFEG3.js";
import "./chunk-TJWXOPWU.js";
import "./chunk-T7UJMFMF.js";
import "./chunk-4SCOCLA2.js";
import "./chunk-WF67GKPJ.js";
import {
  c
} from "./chunk-PVGZCS2Z.js";
import "./chunk-4HOM27T6.js";
import "./chunk-FO4JQZA5.js";
import "./chunk-XEELLOJE.js";
import "./chunk-647CGSDX.js";
import "./chunk-EELMLJ53.js";
import {
  d as d4
} from "./chunk-JVNKXKH7.js";
import "./chunk-ZT5UNVCE.js";
import "./chunk-2FW7ECQ2.js";
import "./chunk-LGQJAMGK.js";
import "./chunk-PVAXLXWO.js";
import "./chunk-D6KE2FST.js";
import "./chunk-W3XB5XWO.js";
import "./chunk-6QBE4YDH.js";
import "./chunk-QG2IIIZW.js";
import "./chunk-LXDJBJSP.js";
import "./chunk-OPCT64AO.js";
import "./chunk-4BM24IVD.js";
import "./chunk-5LNCGIUN.js";
import "./chunk-CFIKP7ET.js";
import "./chunk-VEAHCP5W.js";
import "./chunk-WO4V65CJ.js";
import "./chunk-QUNQAVSE.js";
import "./chunk-HNXXFTFZ.js";
import "./chunk-KVPS4KFB.js";
import "./chunk-NSXZC33R.js";
import "./chunk-E7HFITKU.js";
import "./chunk-ZFQCSBZ4.js";
import "./chunk-4PAHN45R.js";
import "./chunk-CRUGTXEH.js";
import "./chunk-CPGVDDHW.js";
import "./chunk-VEOZVJAT.js";
import "./chunk-3D32E2TW.js";
import "./chunk-ACWF4COQ.js";
import "./chunk-P35RWHDU.js";
import "./chunk-G5U2OA3R.js";
import "./chunk-OIFKYPGO.js";
import "./chunk-JNGB7HKP.js";
import "./chunk-NREDFKHH.js";
import "./chunk-DCOKV3EO.js";
import "./chunk-CZ3DCLKN.js";
import "./chunk-7TO4QD67.js";
import "./chunk-DZNQTDMC.js";
import "./chunk-44DGTEO5.js";
import "./chunk-URNMKNS6.js";
import "./chunk-3QWMYL5A.js";
import "./chunk-MB5H6D2S.js";
import "./chunk-LVH66MEH.js";
import "./chunk-4FW6GTBF.js";
import "./chunk-E5ZJCKHO.js";
import "./chunk-ZRA2NDCA.js";
import "./chunk-RM4VMFVT.js";
import "./chunk-JJIIUFER.js";
import "./chunk-ITGBXG45.js";
import {
  b as b3,
  m
} from "./chunk-LLJZCFHW.js";
import "./chunk-VIUFBDIY.js";
import "./chunk-TXIL3QUC.js";
import "./chunk-2ASAB4KA.js";
import {
  f as f3
} from "./chunk-EA74CF7B.js";
import "./chunk-IGNUVZ34.js";
import "./chunk-LTSQHA4C.js";
import "./chunk-YUQFVZCH.js";
import "./chunk-TQBRYTUC.js";
import "./chunk-T4EIRKFE.js";
import "./chunk-OHUWK5XV.js";
import {
  O as O2
} from "./chunk-PHVKM5OH.js";
import "./chunk-KQ5GHUVQ.js";
import {
  K,
  N,
  V as V2
} from "./chunk-RTULPMO3.js";
import "./chunk-AJ6PR43V.js";
import "./chunk-6LV4OO46.js";
import "./chunk-ZK2DM5OJ.js";
import "./chunk-JQIB7GFW.js";
import {
  d as d5
} from "./chunk-CJJCN7PA.js";
import {
  I,
  a as a3,
  c as c2,
  c2 as c3,
  c3 as c4,
  i3 as i6,
  i4 as i7,
  n as n4,
  p as p2,
  p2 as p3
} from "./chunk-IJUFAIOF.js";
import {
  s as s7
} from "./chunk-MNMU4ARP.js";
import "./chunk-7OW2VNCC.js";
import "./chunk-AFBYZF6Q.js";
import {
  S as S2
} from "./chunk-IJ42YN7D.js";
import "./chunk-4AGGGL2W.js";
import {
  i as i5
} from "./chunk-FJPG3YI6.js";
import "./chunk-BJHLU2MM.js";
import "./chunk-E5KBRIJQ.js";
import "./chunk-Z32PAECZ.js";
import "./chunk-TW7VY7XV.js";
import {
  Ge,
  be,
  i as i8,
  je,
  pe
} from "./chunk-CAC7FEOV.js";
import "./chunk-KK4UI5LV.js";
import "./chunk-BL2UGYYZ.js";
import "./chunk-Q4D7WYWB.js";
import "./chunk-NYWHVRZC.js";
import "./chunk-ZH4RVBER.js";
import "./chunk-UGXIDNPX.js";
import "./chunk-FADA7L64.js";
import "./chunk-YTTIKQNA.js";
import "./chunk-PNUUOKAJ.js";
import {
  C,
  P,
  d as d2,
  p,
  v as v2,
  w
} from "./chunk-7PMYO342.js";
import {
  i as i3,
  l,
  s as s4
} from "./chunk-4K4GIBGP.js";
import "./chunk-WMMHQ2SA.js";
import {
  E,
  g,
  j,
  o as o2
} from "./chunk-AZ7WOCBW.js";
import {
  V
} from "./chunk-3DBICPHD.js";
import "./chunk-7R5XEKR3.js";
import {
  o
} from "./chunk-ZK4LSXOH.js";
import "./chunk-XFBTC3BA.js";
import {
  s as s5
} from "./chunk-XFU3BDEI.js";
import "./chunk-IZXTMJPP.js";
import "./chunk-5MMVRBZL.js";
import "./chunk-RS5OZZZ5.js";
import "./chunk-VRHSV3YE.js";
import "./chunk-OVORXUCO.js";
import "./chunk-WLUQPLAY.js";
import "./chunk-BTSZKQPH.js";
import "./chunk-AL3F322A.js";
import {
  e as e3
} from "./chunk-6N5YXCNN.js";
import "./chunk-MJ2NSPP7.js";
import "./chunk-6YSPJNLC.js";
import {
  _,
  d as d3
} from "./chunk-66KCMKB5.js";
import "./chunk-ZART2Y5J.js";
import "./chunk-F4OBDVPS.js";
import {
  D2 as D
} from "./chunk-X3IFQMC4.js";
import {
  s as s6
} from "./chunk-4ZEH5SNV.js";
import "./chunk-Z6R2SP3D.js";
import {
  n as n3
} from "./chunk-K4UOG562.js";
import {
  U
} from "./chunk-WC4SPMPL.js";
import {
  S,
  i as i2,
  y
} from "./chunk-TJUEGVVG.js";
import "./chunk-FXNOKZ3B.js";
import {
  a3 as a,
  r as r2,
  s2 as s3
} from "./chunk-GEH2VXFC.js";
import {
  e
} from "./chunk-BJY5ADVY.js";
import {
  A,
  b,
  d,
  f,
  h,
  k,
  v
} from "./chunk-VMWKLHJD.js";
import {
  u
} from "./chunk-5AEITAWU.js";
import "./chunk-G36SOMYZ.js";
import {
  i,
  n2 as n,
  r,
  s2
} from "./chunk-YNL57W4I.js";
import {
  O,
  s
} from "./chunk-2PA5UPTB.js";
import "./chunk-XZXEUADC.js";

// ../node_modules/@arcgis/core/core/throttle.js
function e5(e16, t11, l14, n18) {
  let o7 = null, p14 = 1e3;
  "number" == typeof t11 ? (p14 = t11, n18 = l14) : (o7 = t11 ?? null, p14 = l14);
  let r8, u10 = 0;
  const a10 = () => {
    u10 = 0, e16.apply(n18, r8);
  }, c18 = (...e17) => {
    o7 && o7.apply(n18, e17), r8 = e17, p14 ? u10 || (u10 = setTimeout(a10, p14)) : a10();
  };
  return c18.remove = () => {
    u10 && (clearTimeout(u10), u10 = 0);
  }, c18.forceUpdate = () => {
    u10 && (clearTimeout(u10), a10());
  }, c18.hasPendingUpdates = () => !!u10, c18;
}

// ../node_modules/@arcgis/core/geometry/support/geometryUtils.js
function n6(e16) {
  var _a;
  switch (e16 == null ? void 0 : e16.type) {
    case "point":
      return e16;
    case "extent":
      return e16.center;
    case "polygon":
      return e16.centroid;
    case "multipoint":
    case "polyline":
      return (_a = e16.extent) == null ? void 0 : _a.center;
    default:
      return null;
  }
}

// ../node_modules/@arcgis/core/support/actions/actionUtils.js
function n7(i12) {
  return i12 ? { backgroundImage: `url(${i12})` } : {};
}
function e6({ action: t11, feature: n18 }) {
  const e16 = n18 == null ? void 0 : n18.attributes, o7 = "image" in t11 ? t11.image : void 0;
  return o7 && e16 ? s4(o7, e16) : o7 ?? "";
}

// ../node_modules/@arcgis/core/core/quantityUtils.js
function a4(t11, u10) {
  return { type: D(u10), value: t11, unit: u10 };
}
function l3(t11, u10) {
  return { type: D(u10), value: t11, unit: u10 };
}
function o4(t11, u10, e16 = "arithmetic") {
  return { type: D(u10), value: t11, unit: u10, rotationType: e16 };
}
var h3 = a4(0, "meters");
var d6 = l3(0, "square-meters");
var T = o4(0, "radians");
var U2 = o4(0, "degrees");
var j3 = o4(0, "degrees", "geographic");

// ../node_modules/@arcgis/core/core/unitFormatUtils.js
var O3 = ["B", "kB", "MB", "GB", "TB"];
function T3(n18, r8) {
  let e16 = 0 === (r8 = Math.round(r8)) ? 0 : Math.floor(Math.log(r8) / Math.log(E2.KILOBYTES));
  e16 = e3(e16, 0, O3.length - 1);
  const s17 = l(r8 / E2.KILOBYTES ** e16, { maximumFractionDigits: 2 });
  return r(n18.units.bytes[O3[e16]], { fileSize: s17 });
}

// ../node_modules/@arcgis/core/widgets/Feature/support/featureUtils.js
var y2 = "esri.widgets.Feature.support.featureUtils";
var m3 = () => n.getLogger(y2);
var g4 = /href=(""|'')/gi;
var h4 = /(\{([^{\r\n]+)\})/g;
var b4 = /'/g;
var I3 = /^\s*expression\//i;
var T4 = /(\n)/gi;
var w3 = /[\u00A0-\u9999<>&]/gim;
var F2 = /href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi;
var N4 = /^(?:mailto:|tel:)/;
var j4 = "relationships/";
var Z2 = E("short-date-short-time");
function L(e16) {
  if (null != e16) return (e16.sourceLayer || e16.layer) ?? void 0;
}
async function E3({ type: e16, value: t11, event: n18 }) {
  try {
    return "function" == typeof t11 ? t11(n18) : t11;
  } catch (r8) {
    return void m3().error("error", `An error occurred when calling the "${e16}" function`, { error: r8, graphic: n18.graphic, value: t11 });
  }
}
function v5(e16 = "") {
  if (e16) return !N4.test(e16.trim().toLowerCase());
}
function x(e16) {
  return !!e16 && I3.test(e16);
}
function A3(e16, t11) {
  if (!t11 || !x(t11) || !e16) return;
  const n18 = t11.replace(I3, "").toLowerCase();
  return e16.find(({ name: e17 }) => e17.toLowerCase() === n18);
}
function C2(e16, t11) {
  const n18 = A3(t11, e16 == null ? void 0 : e16.fieldName);
  return n18 ? n18.title || null : e16 ? e16.label || e16.fieldName : null;
}
function M(e16, t11) {
  const n18 = t11.get(e16.toLowerCase());
  return `{${(n18 == null ? void 0 : n18.fieldName) || e16}}`;
}
function U3(e16) {
  return e16.replaceAll(g4, "");
}
function q(e16, t11) {
  const n18 = $(t11, e16);
  return n18 ? n18.name : e16;
}
function R2(e16, t11) {
  return e16 && e16.map((e17) => q(e17, t11));
}
function $(e16, t11) {
  return e16 && "function" == typeof e16.getField && t11 ? e16.getField(t11) ?? null : null;
}
function k2(e16) {
  return `${e16}`.trim();
}
function D3({ attributes: e16, globalAttributes: t11, layer: n18, text: r8, expressionAttributes: i12, fieldInfoMap: o7 }) {
  return r8 ? z({ formattedAttributes: t11, template: Q(r8, { ...t11, ...i12, ...e16 }, n18), fieldInfoMap: o7 }) : "";
}
function z({ formattedAttributes: e16, template: n18, fieldInfoMap: r8 }) {
  return k2(U3(r(r(n18, (e17) => M(e17, r8)), e16)));
}
function O4(e16, t11, n18 = false) {
  const r8 = t11[e16];
  if ("string" == typeof r8) {
    const i12 = "%27", o7 = (n18 ? encodeURIComponent(r8) : r8).replaceAll(b4, i12);
    t11[e16] = o7;
  }
}
function G(e16, t11 = false) {
  const n18 = { ...e16 };
  return Object.keys(n18).forEach((e17) => O4(e17, n18, t11)), n18;
}
function S3(e16, n18, r8) {
  const i12 = (n18 = k2(n18)) && "{" !== n18[0];
  return r(e16, G(r8, i12 || false));
}
function P3(e16, t11) {
  return e16.replaceAll(h4, (e17, n18, r8) => {
    const i12 = $(t11, r8);
    return i12 ? `{${i12.name}}` : n18;
  });
}
function Q(e16, t11, n18) {
  const r8 = P3(e16, n18);
  return r8 ? r8.replaceAll(F2, (e17, n19, r9) => S3(e17, n19 || r9, t11)) : r8;
}
function _2(e16, t11) {
  if ("string" == typeof e16 && t11 && null == t11.dateFormat && (null != t11.places || null != t11.digitSeparator)) {
    const t12 = Number(e16);
    if (!isNaN(t12)) return t12;
  }
  return e16;
}
function H(e16) {
  return null != e16 && "object" == typeof e16 && "fieldsIndex" in e16 && "geometryType" in e16 && "getField" in e16 && "load" in e16 && "loaded" in e16 && "objectIdField" in e16 && "spatialReference" in e16 && "type" in e16 && ("feature" === e16.type || "scene" === e16.type || "sublayer" === e16.type) && "when" in e16;
}
function B2(e16) {
  return null != e16 && "object" == typeof e16 && "createQuery" in e16 && "queryFeatureCount" in e16 && "queryObjectIds" in e16 && "queryRelatedFeatures" in e16 && "queryRelatedFeaturesCount" in e16 && "relationships" in e16;
}
function J2(e16) {
  return H(e16) && B2(e16);
}
function V3(e16, t11) {
  var _a;
  const { fieldInfos: n18, fieldName: r8, preventPlacesFormatting: l14, layer: u10, timeZone: s17 } = t11, c18 = Y(n18, r8), d12 = $(u10, r8);
  if (c18 && !Ge(r8)) {
    const t12 = d12 == null ? void 0 : d12.type, n19 = (_a = c18.format) == null ? void 0 : _a.dateFormat;
    if ("date" === t12 || "date-only" === t12 || "time-only" === t12 || "timestamp-offset" === t12 || n19) return N2(e16, { format: n19, fieldType: t12, timeZoneOptions: { layerTimeZone: u10 && "preferredTimeZone" in u10 ? u10.preferredTimeZone : null, viewTimeZone: s17, datesInUnknownTimezone: !(!u10 || !("datesInUnknownTimezone" in u10)) && !!u10.datesInUnknownTimezone } });
  }
  const p14 = c18 == null ? void 0 : c18.format;
  return "string" == typeof e16 && Ge(r8) && p14 ? W(e16, p14) : "string" == typeof (e16 = _2(e16, p14)) || null == e16 || null == p14 ? ae(e16) : l(e16, l14 ? { ...i3(p14), minimumFractionDigits: 0, maximumFractionDigits: 20 } : i3(p14));
}
function W(e16, t11) {
  return e16 = e16.trim(), /\d{2}-\d{2}/.test(e16) ? e16 : e16.includes(",") ? X(e16, ",", ", ", t11) : e16.includes(";") ? X(e16, ";", "; ", t11) : e16.includes(" ") ? X(e16, " ", " ", t11) : l(Number(e16), i3(t11));
}
function X(e16, t11, n18, r8) {
  return e16.trim().split(t11).map((e17) => l(Number(e17), i3(r8))).join(n18);
}
function Y(e16, t11) {
  if ((e16 == null ? void 0 : e16.length) && t11) return e16.find((e17) => {
    var _a;
    return ((_a = e17.fieldName) == null ? void 0 : _a.toLowerCase()) === t11.toLowerCase();
  });
}
function ee({ fieldName: e16, graphic: t11, layer: n18 }) {
  if (de(e16)) return null;
  if (!n18 || "function" != typeof n18.getFeatureType) return null;
  const { typeIdField: r8 } = n18;
  if (!r8 || e16 !== r8) return null;
  const i12 = n18.getFeatureType(t11);
  return i12 ? i12.name : null;
}
function te({ fieldName: e16, value: t11, graphic: n18, layer: r8 }) {
  if (de(e16)) return null;
  if (!r8 || "function" != typeof r8.getFieldDomain) return null;
  const i12 = n18 && r8.getFieldDomain(e16, { feature: n18 });
  return i12 && "coded-value" === i12.type ? i12.getName(t11) : null;
}
function ne(e16, t11, n18, i12) {
  const { creatorField: o7, creationDateField: a10, editorField: l14, editDateField: u10 } = e16;
  if (!t11) return;
  const s17 = g(i12 && "preferredTimeZone" in i12 ? i12.preferredTimeZone : null, !(!i12 || !("datesInUnknownTimezone" in i12)) && !!i12.datesInUnknownTimezone, n18, Z2, "date"), f10 = { ...Z2, ...s17 }, c18 = t11[u10];
  if ("number" == typeof c18) {
    const e17 = t11[l14];
    return { type: "edit", date: j(c18, f10), user: e17 };
  }
  const d12 = t11[a10];
  if ("number" == typeof d12) {
    const e17 = t11[o7];
    return { type: "create", date: j(d12, f10), user: e17 };
  }
  return null;
}
function re(e16, t11) {
  const n18 = /* @__PURE__ */ new Map();
  if (!e16) return n18;
  for (const r8 of e16) {
    if (!r8.fieldName) continue;
    const e17 = q(r8.fieldName, t11);
    r8.fieldName = e17, n18.set(e17.toLowerCase(), r8);
  }
  return n18;
}
function ie(e16) {
  const t11 = [];
  if (!e16) return t11;
  const { fieldInfos: n18, content: r8 } = e16;
  return n18 && t11.push(...n18), r8 && Array.isArray(r8) ? (r8.forEach((e17) => {
    if ("fields" === e17.type) {
      const n19 = e17 == null ? void 0 : e17.fieldInfos;
      n19 && t11.push(...n19);
    }
  }), t11) : t11;
}
function oe(e16) {
  return e16.replaceAll(w3, (e17) => `&#${e17.charCodeAt(0)};`);
}
function ae(e16) {
  return "string" == typeof e16 ? e16.replaceAll(T4, '<br class="esri-text-new-line" />') : e16;
}
function le(e16) {
  var _a;
  const { value: t11, fieldName: n18, fieldInfos: r8, fieldInfoMap: i12, layer: o7, graphic: a10, timeZone: l14 } = e16;
  if (null == t11) return "";
  const s17 = te({ fieldName: n18, value: t11, graphic: a10, layer: o7 });
  if (s17) return s17;
  const d12 = ee({ fieldName: n18, graphic: a10, layer: o7 });
  if (d12) return d12;
  if (i12.get(n18.toLowerCase())) return V3(t11, { fieldInfos: r8 || Array.from(i12.values()), fieldName: n18, layer: o7, timeZone: l14 });
  const p14 = (_a = o7 == null ? void 0 : o7.fieldsIndex) == null ? void 0 : _a.get(n18);
  return p14 && (Z(p14) || be(p14)) ? N2(t11, { fieldType: p14.type, timeZoneOptions: { layerTimeZone: o7 && "preferredTimeZone" in o7 ? o7.preferredTimeZone : null, viewTimeZone: l14, datesInUnknownTimezone: !(!o7 || !("datesInUnknownTimezone" in o7)) && !!o7.datesInUnknownTimezone } }) : ae(t11);
}
function ue({ fieldInfos: e16, attributes: t11, layer: n18, graphic: r8, fieldInfoMap: i12, relatedInfos: o7, timeZone: a10 }) {
  const l14 = {};
  return o7 == null ? void 0 : o7.forEach((t12) => me({ attributes: l14, relatedInfo: t12, fieldInfoMap: i12, fieldInfos: e16, layer: n18, timeZone: a10 })), t11 && Object.keys(t11).forEach((o8) => {
    const u10 = t11[o8];
    l14[o8] = le({ fieldName: o8, fieldInfos: e16, fieldInfoMap: i12, layer: n18, value: u10, graphic: r8, timeZone: a10 });
  }), l14;
}
async function se(e16, t11) {
  var _a, _b;
  const { layer: n18, graphic: r8, outFields: i12, objectIds: o7, returnGeometry: a10, spatialReference: l14 } = e16, u10 = o7[0];
  if ("number" != typeof u10 && "string" != typeof u10) {
    const e17 = "Could not query required fields for the specified feature. The feature's ID is invalid.", t12 = { layer: n18, graphic: r8, objectId: u10, requiredFields: i12 };
    return m3().warn(e17, t12), null;
  }
  if (!((_b = (_a = O2(n18)) == null ? void 0 : _a.operations) == null ? void 0 : _b.supportsQuery)) {
    const e17 = "The specified layer cannot be queried. The following fields will not be available.", t12 = { layer: n18, graphic: r8, requiredFields: i12, returnGeometry: a10 };
    return m3().warn(e17, t12), null;
  }
  const f10 = n18.createQuery();
  f10.objectIds = o7, f10.outFields = (i12 == null ? void 0 : i12.length) ? i12 : [n18.objectIdField], f10.returnGeometry = !!a10, f10.returnZ = !!a10, f10.returnM = !!a10, f10.outSpatialReference = l14;
  return (await n18.queryFeatures(f10, t11)).features[0];
}
async function fe(e16) {
  var _a;
  if (!((_a = e16.expressionInfos) == null ? void 0 : _a.length)) return false;
  const t11 = await i8(), { arcadeUtils: { hasGeometryFunctions: n18 } } = t11;
  return n18(e16);
}
async function ce({ graphic: e16, popupTemplate: t11, layer: n18, spatialReference: r8 }, i12) {
  if (!n18 || !t11) return;
  if ("function" == typeof n18.load && await n18.load(i12), !e16.attributes) return;
  const o7 = n18.objectIdField, a10 = e16.attributes[o7];
  if (null == a10) return;
  const u10 = [a10], s17 = await t11.getRequiredFields(n18.fieldsIndex), f10 = je(s17, e16), c18 = f10 ? [] : s17.includes(o7) ? s17 : [...s17, o7], d12 = t11.returnGeometry || await fe(t11);
  if (f10 && !d12) return;
  const p14 = await se({ layer: n18, graphic: e16, outFields: c18, objectIds: u10, returnGeometry: d12, spatialReference: r8 }, i12);
  p14 && (p14.geometry && (e16.geometry = p14.geometry), p14.attributes && (e16.attributes = { ...e16.attributes, ...p14.attributes }));
}
function de(e16 = "") {
  return !!e16 && e16.includes(j4);
}
function pe2(e16) {
  return e16 ? `${j4}${e16.layerId}/${e16.fieldName}` : "";
}
function ye({ attributes: e16, graphic: t11, relatedInfo: n18, fieldInfos: r8, fieldInfoMap: i12, layer: o7, timeZone: a10 }) {
  e16 && t11 && n18 && Object.keys(t11.attributes).forEach((l14) => {
    const u10 = pe2({ layerId: n18.relation.id.toString(), fieldName: l14 }), s17 = t11.attributes[l14];
    e16[u10] = le({ fieldName: u10, fieldInfos: r8, fieldInfoMap: i12, layer: o7, value: s17, graphic: t11, timeZone: a10 });
  });
}
function me({ attributes: e16, relatedInfo: t11, fieldInfoMap: n18, fieldInfos: r8, layer: i12, timeZone: o7 }) {
  var _a, _b;
  e16 && t11 && ((_a = t11.relatedFeatures) == null ? void 0 : _a.forEach((a10) => ye({ attributes: e16, graphic: a10, relatedInfo: t11, fieldInfoMap: n18, fieldInfos: r8, layer: i12, timeZone: o7 })), (_b = t11.relatedStatsFeatures) == null ? void 0 : _b.forEach((a10) => ye({ attributes: e16, graphic: a10, relatedInfo: t11, fieldInfoMap: n18, fieldInfos: r8, layer: i12, timeZone: o7 })));
}
var ge = (e16) => {
  if (!e16) return false;
  const t11 = e16.toUpperCase();
  return t11.includes("CURRENT_TIMESTAMP") || t11.includes("CURRENT_DATE") || t11.includes("CURRENT_TIME");
};
var he = ({ layer: e16, method: t11, query: n18, definitionExpression: r8 }) => {
  var _a, _b;
  if (!((_b = (_a = e16.capabilities) == null ? void 0 : _a.query) == null ? void 0 : _b.supportsCacheHint) || "attachments" === t11) return;
  const i12 = null != n18.where ? n18.where : null, o7 = null != n18.geometry ? n18.geometry : null;
  ge(r8) || ge(i12) || "extent" === (o7 == null ? void 0 : o7.type) || "tile" === n18.resultType || (n18.cacheHint = true);
};
var be2 = ({ query: e16, layer: t11, method: n18 }) => {
  he({ layer: t11, method: n18, query: e16, definitionExpression: `${t11.definitionExpression} ${t11.serviceDefinitionExpression ?? ""}` });
};
var Ie = ({ queryPayload: e16, layer: t11, method: n18 }) => {
  he({ layer: t11, method: n18, query: e16, definitionExpression: `${t11.definitionExpression} ${t11.serviceDefinitionExpression ?? ""}` });
};
function Te(e16, t11, n18) {
  var _a, _b;
  return e16 && t11 && n18 ? "sublayer" === t11.type ? Fe({ layers: (_a = t11.layer) == null ? void 0 : _a.sublayers, map: e16, relatedLayer: t11, relationship: n18 }) || Fe({ layers: (_b = t11.layer) == null ? void 0 : _b.subtables, map: e16, relatedLayer: t11, relationship: n18 }) : Fe({ layers: e16.allLayers, map: e16, relatedLayer: t11, relationship: n18 }) || Fe({ layers: e16.allTables, map: e16, relatedLayer: t11, relationship: n18 }) : null;
}
function we(e16, t11) {
  return e16 == null ? void 0 : e16.allTables.find((e17) => {
    var _a;
    return "feature" === e17.type && e17.layerId === t11.id && e17.url === ((_a = t11.layer) == null ? void 0 : _a.url);
  });
}
function Fe({ map: e16, relationship: t11, relationship: { relatedTableId: n18 }, relatedLayer: r8, layers: i12 }) {
  var _a;
  if (!i12) return null;
  for (const o7 of i12) {
    if ("map-image" === o7.type) {
      const n19 = Fe({ layers: o7.sublayers, map: e16, relatedLayer: r8, relationship: t11 }) || Fe({ layers: o7.subtables, map: e16, relatedLayer: r8, relationship: t11 });
      if (n19) return n19;
      continue;
    }
    if (!J2(o7)) continue;
    if ("sublayer" === r8.type) {
      if (o7 !== r8 && o7.id === n18) return o7.isTable ? we(e16, o7) : o7;
      continue;
    }
    const i13 = "scene" === r8.type && r8.associatedLayer ? r8.associatedLayer.url : r8.url;
    if (!i13) return null;
    if ("sublayer" !== o7.type) {
      if (o7 !== r8 && o7.url === i13 && o7.layerId === n18) return o7;
    } else if (o7 !== r8 && ((_a = o7.layer) == null ? void 0 : _a.url) === i13 && o7.id === n18) return o7.isTable ? we(e16, o7) : o7;
  }
  return null;
}

// ../node_modules/@arcgis/core/widgets/Attachments/AttachmentsViewModel.js
var m4 = { editing: false, operations: { add: true, update: true, delete: true } };
var f5 = V.ofType(a2);
var u2 = class extends S {
  constructor(t11) {
    super(t11), this._getAttachmentsPromise = null, this._attachmentLayer = null, this.capabilities = { ...m4 }, this.activeAttachmentInfo = null, this.activeFileInfo = null, this.attachmentInfos = new f5(), this.fileInfos = new V(), this.graphic = null, this.mode = "view", this.filesEnabled = false, this.addHandles(d2(() => this.graphic, () => this._graphicChanged(), P));
  }
  destroy() {
    this._attachmentLayer = null, this.graphic = null;
  }
  castCapabilities(t11) {
    return { ...m4, ...t11 };
  }
  get state() {
    return this._getAttachmentsPromise ? "loading" : this.graphic ? "ready" : "disabled";
  }
  get supportsResizeAttachments() {
    const { graphic: t11 } = this;
    if (!t11) return false;
    const e16 = t11.layer || t11.sourceLayer;
    return (e16 == null ? void 0 : e16.loaded) && "capabilities" in e16 && e16.capabilities && "operations" in e16.capabilities && "supportsResizeAttachments" in e16.capabilities.operations && e16.capabilities.operations.supportsResizeAttachments || false;
  }
  async getAttachments() {
    const { _attachmentLayer: t11, attachmentInfos: e16 } = this;
    if (!t11 || "function" != typeof t11.queryAttachments) throw new s2("invalid-layer", "getAttachments(): A valid layer is required.");
    const a10 = this._getObjectId(), i12 = new c({ objectIds: [a10], returnMetadata: true }), r8 = [], s17 = t11.queryAttachments(i12).then((t12) => t12[a10] || r8).catch(() => r8);
    this._getAttachmentsPromise = s17, this.notifyChange("state");
    const o7 = await s17;
    return e16.destroyAll(), o7.length && e16.addMany(o7), this._getAttachmentsPromise = null, this.notifyChange("state"), o7;
  }
  async addAttachment(t11, e16 = this.graphic) {
    var _a;
    const { _attachmentLayer: a10, attachmentInfos: i12, capabilities: r8 } = this;
    if (!e16) throw new s2("invalid-graphic", "addAttachment(): A valid graphic is required.", { graphic: e16 });
    if (!t11) throw new s2("invalid-attachment", "addAttachment(): An attachment is required.", { attachment: t11 });
    if (!((_a = r8.operations) == null ? void 0 : _a.add)) throw new s2("invalid-capabilities", "addAttachment(): add capabilities are required.");
    if (!a10 || "function" != typeof a10.addAttachment) throw new s2("invalid-layer", "addAttachment(): A valid layer is required.");
    const s17 = a10.addAttachment(e16, t11).then((t12) => this._queryAttachment(t12.objectId, e16)), o7 = await s17;
    return i12.add(o7), o7;
  }
  async deleteAttachment(t11) {
    var _a;
    const { _attachmentLayer: e16, attachmentInfos: a10, graphic: i12, capabilities: r8 } = this;
    if (!t11) throw new s2("invalid-attachment-info", "deleteAttachment(): An attachmentInfo is required.", { attachmentInfo: t11 });
    if (!((_a = r8.operations) == null ? void 0 : _a.delete)) throw new s2("invalid-capabilities", "deleteAttachment(): delete capabilities are required.");
    if (!e16 || "function" != typeof e16.deleteAttachments) throw new s2("invalid-layer", "deleteAttachment(): A valid layer is required.");
    if (!i12) throw new s2("invalid-graphic", "deleteAttachment(): A graphic is required.");
    const s17 = e16.deleteAttachments(i12, [t11.id]).then(() => t11), o7 = await s17;
    return a10.remove(o7), o7.destroy(), o7;
  }
  async updateAttachment(t11, e16 = this.activeAttachmentInfo) {
    var _a;
    const { _attachmentLayer: a10, attachmentInfos: i12, graphic: r8, capabilities: s17 } = this;
    if (!t11) throw new s2("invalid-attachment", "updateAttachment(): An attachment is required.", { attachment: t11 });
    if (!e16) throw new s2("invalid-attachment-info", "updateAttachment(): An attachmentInfo is required.", { attachmentInfo: e16 });
    if (!((_a = s17.operations) == null ? void 0 : _a.update)) throw new s2("invalid-capabilities", "updateAttachment(): Update capabilities are required.");
    const o7 = i12.indexOf(e16);
    if (!a10 || "function" != typeof a10.updateAttachment) throw new s2("invalid-layer", "updateAttachment(): A valid layer is required.");
    if (!r8) throw new s2("invalid-graphic", "updateAttachment(): A graphic is required.");
    const c18 = a10.updateAttachment(r8, e16.id, t11).then((t12) => this._queryAttachment(t12.objectId)), h14 = await c18;
    return i12.splice(o7, 1, h14), h14;
  }
  async commitFiles() {
    return await Promise.all(this.fileInfos.items.map((t11) => this.addAttachment(t11.form))), this.fileInfos.removeAll(), this.getAttachments();
  }
  addFile(t11, e16) {
    if (!t11 || !e16) return null;
    const a10 = { file: t11, form: e16 };
    return this.fileInfos.add(a10), a10;
  }
  updateFile(t11, e16, a10 = this.activeFileInfo) {
    if (!t11 || !e16 || !a10) return null;
    const i12 = this.fileInfos.indexOf(a10);
    return i12 > -1 && this.fileInfos.splice(i12, 1, { file: t11, form: e16 }), this.fileInfos.items[i12];
  }
  deleteFile(t11) {
    const e16 = this.fileInfos.find((e17) => e17.file === t11);
    return e16 ? (this.fileInfos.remove(e16), e16) : null;
  }
  async _queryAttachment(t11, e16) {
    const { _attachmentLayer: a10 } = this;
    if (!t11 || !(a10 == null ? void 0 : a10.queryAttachments)) throw new s2("invalid-attachment-id", "Could not query attachment.");
    const i12 = this._getObjectId(e16), r8 = new c({ objectIds: [i12], attachmentsWhere: `AttachmentId=${t11}`, returnMetadata: true });
    return a10.queryAttachments(r8).then((t12) => t12[i12][0]);
  }
  _getObjectId(t11 = this.graphic) {
    return (t11 == null ? void 0 : t11.getObjectId()) ?? null;
  }
  _graphicChanged() {
    this.graphic && (this._setAttachmentLayer(), this.getAttachments().catch(() => {
    }));
  }
  _setAttachmentLayer() {
    const { graphic: t11 } = this, e16 = L(t11);
    this._attachmentLayer = e16 ? "scene" === e16.type && null != e16.associatedLayer ? e16.associatedLayer : e16 : null;
  }
};
e([y()], u2.prototype, "capabilities", void 0), e([s6("capabilities")], u2.prototype, "castCapabilities", null), e([y()], u2.prototype, "activeAttachmentInfo", void 0), e([y()], u2.prototype, "activeFileInfo", void 0), e([y({ readOnly: true, type: f5 })], u2.prototype, "attachmentInfos", void 0), e([y()], u2.prototype, "fileInfos", void 0), e([y({ type: d5 })], u2.prototype, "graphic", void 0), e([y()], u2.prototype, "mode", void 0), e([y({ readOnly: true })], u2.prototype, "state", null), e([y()], u2.prototype, "filesEnabled", void 0), e([y({ readOnly: true })], u2.prototype, "supportsResizeAttachments", null), u2 = e([a("esri.widgets.Attachments.AttachmentsViewModel")], u2);
var y3 = u2;

// ../node_modules/@arcgis/core/widgets/Attachments/support/attachmentUtils.js
function e7(i12) {
  const e16 = i12.toLowerCase();
  return "image/bmp" === e16 || "image/emf" === e16 || "image/exif" === e16 || "image/gif" === e16 || "image/x-icon" === e16 || "image/jpeg" === e16 || "image/png" === e16 || "image/tiff" === e16 || "image/x-wmf" === e16;
}
function p4(e16) {
  const p14 = n3("esri/themes/base/images/files/");
  return e16 ? "text/plain" === e16 ? `${p14}text-32.svg` : "application/pdf" === e16 ? `${p14}pdf-32.svg` : "text/csv" === e16 ? `${p14}csv-32.svg` : "application/gpx+xml" === e16 ? `${p14}gpx-32.svg` : "application/x-dwf" === e16 ? `${p14}cad-32.svg` : "application/postscript" === e16 || "application/json" === e16 || "text/xml" === e16 || "model/vrml" === e16 ? `${p14}code-32.svg` : "application/x-zip-compressed" === e16 || "application/x-7z-compressed" === e16 || "application/x-gzip" === e16 || "application/x-tar" === e16 || "application/x-gtar" === e16 || "application/x-bzip2" === e16 || "application/gzip" === e16 || "application/x-compress" === e16 || "application/x-apple-diskimage" === e16 || "application/x-rar-compressed" === e16 || "application/zip" === e16 ? `${p14}zip-32.svg` : e16.includes("image/") ? `${p14}image-32.svg` : e16.includes("audio/") ? `${p14}sound-32.svg` : e16.includes("video/") ? `${p14}video-32.svg` : e16.includes("msexcel") || e16.includes("ms-excel") || e16.includes("spreadsheetml") ? `${p14}excel-32.svg` : e16.includes("msword") || e16.includes("ms-word") || e16.includes("wordprocessingml") ? `${p14}word-32.svg` : e16.includes("powerpoint") || e16.includes("presentationml") ? `${p14}report-32.svg` : `${p14}generic-32.svg` : `${p14}generic-32.svg`;
}

// ../node_modules/@arcgis/core/widgets/support/legacyIcon.js
var i9 = { checkMark: "esri-icon-check-mark", close: "esri-icon-close", collapse: "esri-icon-collapse", down: "esri-icon-down", downArrow: "esri-icon-down-arrow", dragHorizontal: "esri-icon-drag-horizontal", dragVertical: "esri-icon-drag-vertical", duplicate: "esri-icon-duplicate", expand: "esri-icon-expand", fontFallbackText: "esri-icon-font-fallback-text", forward: "esri-icon-forward", handleVertical: "esri-icon-handle-vertical", icon: "esri-icon", left: "esri-icon-left", loadingIndicator: "esri-icon-loading-indicator", locateCircled: "esri-icon-locate-circled", minus: "esri-icon-minus", noticeTriangle: "esri-icon-notice-triangle", pause: "esri-icon-pause", play: "esri-icon-play", plus: "esri-icon-plus", radioChecked: "esri-icon-radio-checked", radioUnchecked: "esri-icon-radio-unchecked", refresh: "esri-icon-refresh", reverse: "esri-icon-reverse", right: "esri-icon-right", search: "esri-icon-search", swap: "esri-icon-swap", table: "esri-icon-table", trash: "esri-icon-trash", up: "esri-icon-up", upArrow: "esri-icon-up-arrow", upDownArrows: "esri-icon-up-down-arrows", urbanModel: "esri-icon-urban-model", zoomInMagnifyingGlass: "esri-icon-zoom-in-magnifying-glass", zoomToObject: "esri-icon-zoom-to-object" };

// ../node_modules/@arcgis/core/widgets/Attachments.js
var A4 = { addButton: true, addSubmitButton: true, cancelAddButton: true, cancelUpdateButton: true, deleteButton: true, errorMessage: true, progressBar: true, updateButton: true };
var w4 = "esri-attachments";
var F3 = { base: w4, loaderContainer: `${w4}__loader-container`, loader: `${w4}__loader`, fadeIn: `${w4}--fade-in`, container: `${w4}__container`, containerList: `${w4}__container--list`, containerPreview: `${w4}__container--preview`, actions: `${w4}__actions`, deleteButton: `${w4}__delete-button`, addAttachmentButton: `${w4}__add-attachment-button`, errorMessage: `${w4}__error-message`, items: `${w4}__items`, item: `${w4}__item`, itemButton: `${w4}__item-button`, itemMask: `${w4}__item-mask`, itemMaskIcon: `${w4}__item-mask--icon`, itemImage: `${w4}__image`, itemImageResizable: `${w4}__image--resizable`, itemLabel: `${w4}__label`, itemFilename: `${w4}__filename`, itemChevronIcon: `${w4}__item-chevron-icon`, itemLink: `${w4}__item-link`, itemLinkOverlay: `${w4}__item-link-overlay`, itemLinkOverlayIcon: `${w4}__item-link-overlay-icon`, itemEditIcon: `${w4}__item-edit-icon`, itemAddIcon: `${w4}__item-add-icon`, itemAddButton: `${w4}__item-add-button`, formNode: `${w4}__form-node`, fileFieldset: `${w4}__file-fieldset`, fileLabel: `${w4}__file-label`, fileName: `${w4}__file-name`, fileInput: `${w4}__file-input`, metadata: `${w4}__metadata`, metadataFieldset: `${w4}__metadata-fieldset`, progressBar: `${w4}__progress-bar` };
var k3 = window.CSS;
var M2 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this.displayType = "auto", this.messages = null, this.messagesUnits = null, this.selectedFile = null, this.submitting = false, this.viewModel = null, this.visibleElements = { ...A4 }, this._supportsImageOrientation = k3 && k3.supports && k3.supports("image-orientation", "from-image"), this._addAttachmentForm = null, this._updateAttachmentForm = null;
  }
  normalizeCtorArgs(e16) {
    return (e16 == null ? void 0 : e16.viewModel) || (e16 = { viewModel: new y3(), ...e16 }), e16;
  }
  initialize() {
    this.addHandles([v2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.attachmentInfos;
    }, "change", () => this.scheduleRender()), v2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.fileInfos;
    }, "change", () => this.scheduleRender()), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.mode;
    }, () => this._modeChanged(), P)]);
  }
  loadDependencies() {
    return r3({ icon: () => import("./calcite-icon-VRKLQJOU.js") });
  }
  get capabilities() {
    return this.viewModel.capabilities;
  }
  set capabilities(e16) {
    this.viewModel.capabilities = e16;
  }
  get effectiveDisplayType() {
    const { displayType: e16 } = this;
    return e16 && "auto" !== e16 ? e16 : this.viewModel.supportsResizeAttachments ? "preview" : "list";
  }
  get graphic() {
    return this.viewModel.graphic;
  }
  set graphic(e16) {
    this.viewModel.graphic = e16;
  }
  get icon() {
    return "attachment";
  }
  set icon(e16) {
    this._overrideIfSome("icon", e16);
  }
  get label() {
    var _a;
    return ((_a = this.messages) == null ? void 0 : _a.widgetLabel) ?? "";
  }
  set label(e16) {
    this._overrideIfSome("label", e16);
  }
  castVisibleElements(e16) {
    return { ...A4, ...e16 };
  }
  addAttachment() {
    const { _addAttachmentForm: e16, viewModel: s17 } = this;
    return this._set("submitting", true), this._set("error", null), s17.addAttachment(e16).then((e17) => (this._set("submitting", false), this._set("error", null), s17.mode = "view", e17)).catch((e17) => {
      throw this._set("submitting", false), this._set("error", new s2("attachments:add-attachment", this.messages.addErrorMessage, e17)), e17;
    });
  }
  deleteAttachment(e16) {
    const { viewModel: s17 } = this;
    return this._set("submitting", true), this._set("error", null), s17.deleteAttachment(e16).then((e17) => (this._set("submitting", false), this._set("error", null), s17.mode = "view", e17)).catch((e17) => {
      throw this._set("submitting", false), this._set("error", new s2("attachments:delete-attachment", this.messages.deleteErrorMessage, e17)), e17;
    });
  }
  updateAttachment() {
    const { viewModel: e16 } = this, { _updateAttachmentForm: s17 } = this;
    return this._set("submitting", true), this._set("error", null), e16.updateAttachment(s17).then((t11) => (this._set("submitting", false), this._set("error", null), e16.mode = "view", t11)).catch((e17) => {
      throw this._set("submitting", false), this._set("error", new s2("attachments:update-attachment", this.messages.updateErrorMessage, e17)), e17;
    });
  }
  addFile() {
    const e16 = this.viewModel.addFile(this.selectedFile, this._addAttachmentForm);
    return this.viewModel.mode = "view", e16;
  }
  updateFile() {
    const { viewModel: e16 } = this, t11 = e16.updateFile(this.selectedFile, this._updateAttachmentForm, e16.activeFileInfo);
    return e16.mode = "view", t11;
  }
  deleteFile(e16) {
    var _a;
    const t11 = this.viewModel.deleteFile(e16 || ((_a = this.viewModel.activeFileInfo) == null ? void 0 : _a.file));
    return this.viewModel.mode = "view", t11;
  }
  render() {
    const { submitting: e16, viewModel: t11 } = this, { state: s17 } = t11;
    return n2("div", { class: this.classes(F3.base, e4.widget) }, e16 ? this._renderProgressBar() : null, "loading" === s17 ? this._renderLoading() : this._renderAttachments(), this._renderErrorMessage());
  }
  _renderErrorMessage() {
    const { error: e16, visibleElements: t11 } = this;
    return e16 && t11.errorMessage ? n2("div", { class: F3.errorMessage, key: "error-message" }, e16.message) : null;
  }
  _renderAttachments() {
    const { activeFileInfo: e16, mode: t11, activeAttachmentInfo: s17 } = this.viewModel;
    return "add" === t11 ? this._renderAddForm() : "edit" === t11 ? this._renderDetailsForm(s17 || e16) : this._renderAttachmentContainer();
  }
  _renderLoading() {
    return n2("div", { class: F3.loaderContainer, key: "loader" }, n2("div", { class: F3.loader }));
  }
  _renderProgressBar() {
    return this.visibleElements.progressBar ? n2("div", { class: F3.progressBar, key: "progress-bar" }) : null;
  }
  _renderAddForm() {
    const { submitting: e16, selectedFile: t11 } = this, s17 = e16 || !t11, i12 = this.visibleElements.cancelAddButton ? n2("button", { bind: this, class: this.classes(e4.button, e4.buttonTertiary, e4.buttonSmall, e4.buttonHalf, e16 && e4.buttonDisabled), disabled: e16, onclick: this._cancelForm, type: "button" }, this.messages.cancel) : null, a10 = this.visibleElements.addSubmitButton ? n2("button", { class: this.classes(e4.button, e4.buttonSecondary, e4.buttonSmall, e4.buttonHalf, { [e4.buttonDisabled]: s17 }), disabled: s17, type: "submit" }, this.messages.add) : null, n18 = t11 ? n2("span", { class: F3.fileName, key: "file-name" }, t11.name) : null, l14 = n2("form", { afterCreate: b2, afterRemoved: v3, bind: this, "data-node-ref": "_addAttachmentForm", onsubmit: this._submitAddAttachment }, n2("fieldset", { class: F3.fileFieldset }, n18, n2("label", { class: this.classes(F3.fileLabel, e4.button, e4.buttonSecondary) }, t11 ? this.messages.changeFile : this.messages.selectFile, n2("input", { bind: this, class: F3.fileInput, name: "attachment", onchange: this._handleFileInputChange, type: "file" }))), a10, i12);
    return n2("div", { class: F3.formNode, key: "add-form-container" }, l14);
  }
  _renderDetailsForm(e16) {
    var _a, _b, _c;
    const { visibleElements: t11, viewModel: s17, selectedFile: i12, submitting: a10 } = this, { capabilities: l14 } = s17, r8 = a10 || !i12;
    let o7, d12, c18, m12;
    i12 ? (o7 = i12.type, d12 = i12.name, c18 = i12.size) : e16 && "file" in e16 ? (o7 = e16.file.type, d12 = e16.file.name, c18 = e16.file.size) : e16 && "contentType" in e16 && (o7 = e16.contentType, d12 = e16.name, c18 = e16.size, m12 = e16.url);
    const h14 = l14.editing && ((_a = l14.operations) == null ? void 0 : _a.delete) && t11.deleteButton ? n2("button", { bind: this, class: this.classes(e4.button, e4.buttonSmall, e4.buttonTertiary, F3.deleteButton, { [e4.buttonDisabled]: a10 }), disabled: a10, key: "delete-button", onclick: (t12) => this._submitDeleteAttachment(t12, e16), type: "button" }, this.messages.delete) : void 0, u10 = l14.editing && ((_b = l14.operations) == null ? void 0 : _b.update) && t11.updateButton ? n2("button", { class: this.classes(e4.button, e4.buttonSmall, e4.buttonThird, { [e4.buttonDisabled]: r8 }), disabled: r8, key: "update-button", type: "submit" }, this.messages.update) : void 0, b10 = this.visibleElements.cancelUpdateButton ? n2("button", { bind: this, class: this.classes(e4.button, e4.buttonSmall, e4.buttonTertiary, e4.buttonThird, { [e4.buttonDisabled]: a10 }), disabled: a10, key: "cancel-button", onclick: this._cancelForm, type: "button" }, this.messages.cancel) : void 0, f10 = l14.editing && ((_c = l14.operations) == null ? void 0 : _c.update) ? n2("fieldset", { class: F3.fileFieldset, key: "file" }, n2("span", { class: F3.fileName, key: "file-name" }, d12), n2("label", { class: this.classes(F3.fileLabel, e4.button, e4.buttonSecondary) }, this.messages.changeFile, n2("input", { bind: this, class: F3.fileInput, name: "attachment", onchange: this._handleFileInputChange, type: "file" }))) : void 0, v12 = n2("fieldset", { class: F3.metadataFieldset, key: "size" }, n2("label", null, T3(this.messagesUnits, c18 ?? 0))), A8 = n2("fieldset", { class: F3.metadataFieldset, key: "content-type" }, n2("label", null, o7)), w13 = null != m12 ? n2("a", { class: F3.itemLink, href: m12, rel: "noreferrer", target: "_blank" }, this._renderImageMask(e16, 400), n2("div", { class: F3.itemLinkOverlay }, n2("span", { class: F3.itemLinkOverlayIcon }, n2("calcite-icon", { icon: "launch" })))) : this._renderImageMask(e16, 400), k8 = n2("form", { afterCreate: b2, afterRemoved: v3, bind: this, "data-node-ref": "_updateAttachmentForm", onsubmit: (t12) => this._submitUpdateAttachment(t12, e16) }, n2("div", { class: F3.metadata }, v12, A8), f10, n2("div", { class: F3.actions }, h14, b10, u10));
    return n2("div", { class: F3.formNode, key: "edit-form-container" }, w13, k8);
  }
  _renderImageMask(e16, t11) {
    return e16 ? "file" in e16 ? this._renderGenericImageMask(e16.file.name, e16.file.type) : this._renderImageMaskForAttachment(e16, t11) : null;
  }
  _renderGenericImageMask(e16, t11) {
    const { supportsResizeAttachments: s17 } = this.viewModel, i12 = p4(t11), a10 = { [F3.itemImageResizable]: s17 };
    return n2("div", { class: this.classes(F3.itemMaskIcon, F3.itemMask), key: i12 }, n2("img", { alt: e16, class: this.classes(a10, F3.itemImage), src: i12, title: e16 }));
  }
  _renderImageMaskForAttachment(e16, t11) {
    const { supportsResizeAttachments: s17 } = this.viewModel;
    if (!e16) return null;
    const { contentType: i12, name: a10, url: n18 } = e16;
    if (!s17 || !e7(i12)) return this._renderGenericImageMask(a10, i12);
    const l14 = this._getCSSTransform(e16), r8 = l14 ? { transform: l14, "image-orientation": "none" } : {}, o7 = `${n18}${(n18 == null ? void 0 : n18.includes("?")) ? "&" : "?"}w=${t11}`, d12 = { [F3.itemImageResizable]: s17 };
    return n2("div", { class: this.classes(F3.itemMask), key: o7 }, n2("img", { alt: a10, class: this.classes(d12, F3.itemImage), src: o7, styles: r8, title: a10 }));
  }
  _renderFile(e16) {
    const { file: t11 } = e16;
    return n2("li", { class: F3.item, key: t11 }, n2("button", { "aria-label": this.messages.attachmentDetails, bind: this, class: F3.itemButton, key: "details-button", onclick: () => this._startEditFile(e16), title: this.messages.attachmentDetails, type: "button" }, this._renderImageMask(e16), n2("label", { class: F3.itemLabel }, n2("span", { class: F3.itemFilename }, t11.name || this.messages.noTitle), n2("span", { "aria-hidden": "true", class: this.classes(F3.itemChevronIcon, g2(this.container) ? i9.left : i9.right) }))));
  }
  _renderAttachmentInfo({ attachmentInfo: e16, displayType: t11 }) {
    const { viewModel: s17, effectiveDisplayType: i12 } = this, { capabilities: a10, supportsResizeAttachments: n18 } = s17, { contentType: l14, name: r8, url: o7 } = e16, d12 = this._renderImageMask(e16, "list" === t11 ? 48 : 400), c18 = a10.editing ? n2("span", { "aria-hidden": "true", class: this.classes(F3.itemChevronIcon, g2(this.container) ? i9.left : i9.right) }) : null, m12 = [d12, "preview" === i12 && n18 && e7(l14) ? null : n2("label", { class: F3.itemLabel }, n2("span", { class: F3.itemFilename }, r8 || this.messages.noTitle), c18)], u10 = a10.editing ? n2("button", { "aria-label": this.messages.attachmentDetails, bind: this, class: F3.itemButton, "data-attachment-info-id": e16.id, key: "details-button", onclick: () => this._startEditAttachment(e16), title: this.messages.attachmentDetails, type: "button" }, m12) : n2("a", { class: F3.itemButton, href: o7 ?? void 0, key: "details-link", rel: "noreferrer", target: "_blank" }, m12);
    return n2("li", { class: F3.item, key: e16 }, u10);
  }
  _renderAttachmentContainer() {
    var _a;
    const { effectiveDisplayType: e16, viewModel: t11, visibleElements: s17 } = this, { attachmentInfos: i12, capabilities: a10, fileInfos: n18 } = t11, l14 = !!(i12 == null ? void 0 : i12.length), r8 = !!(n18 == null ? void 0 : n18.length), o7 = { [F3.containerList]: "preview" !== e16, [F3.containerPreview]: "preview" === e16 }, d12 = a10.editing && ((_a = a10.operations) == null ? void 0 : _a.add) && s17.addButton ? n2("button", { bind: this, class: this.classes(e4.button, e4.buttonTertiary, F3.addAttachmentButton), onclick: () => this._startAddAttachment(), type: "button" }, n2("span", { "aria-hidden": "true", class: this.classes(F3.itemAddIcon, i9.plus) }), this.messages.add) : void 0, c18 = l14 ? n2("ul", { class: F3.items, key: "attachments-list" }, i12.toArray().map((t12) => this._renderAttachmentInfo({ attachmentInfo: t12, displayType: e16 }))) : void 0, m12 = r8 ? n2("ul", { class: F3.items, key: "file-list" }, n18.toArray().map((e17) => this._renderFile(e17))) : void 0, h14 = r8 || l14 ? void 0 : n2("div", { class: e4.empty }, this.messages.noAttachments);
    return n2("div", { class: this.classes(F3.container, o7), key: "attachments-container" }, c18, m12, h14, d12);
  }
  _modeChanged() {
    this._set("error", null), this._set("selectedFile", null);
  }
  _handleFileInputChange(e16) {
    var _a;
    const t11 = e16.target, s17 = (_a = t11.files) == null ? void 0 : _a.item(0);
    this._set("selectedFile", s17);
  }
  _submitDeleteAttachment(e16, t11) {
    e16.preventDefault(), t11 && ("file" in t11 ? this.deleteFile(t11.file) : t11 && this.deleteAttachment(t11));
  }
  _submitAddAttachment(e16) {
    e16.preventDefault(), this.viewModel.filesEnabled ? this.addFile() : this.addAttachment();
  }
  _submitUpdateAttachment(e16, t11) {
    e16.preventDefault(), t11 && "file" in t11 ? this.updateFile() : this.updateAttachment();
  }
  _startEditAttachment(e16) {
    const { viewModel: t11 } = this;
    t11.activeFileInfo = null, t11.activeAttachmentInfo = e16, t11.mode = "edit";
  }
  _startEditFile(e16) {
    const { viewModel: t11 } = this;
    t11.activeAttachmentInfo = null, t11.activeFileInfo = e16, t11.mode = "edit";
  }
  _startAddAttachment() {
    this.viewModel.mode = "add";
  }
  _cancelForm(e16) {
    e16.preventDefault(), this.viewModel.mode = "view";
  }
  _getCSSTransform(e16) {
    const { orientationInfo: t11 } = e16;
    return !this._supportsImageOrientation && t11 ? [t11.rotation ? `rotate(${t11.rotation}deg)` : "", t11.mirrored ? "scaleX(-1)" : ""].join(" ") : "";
  }
};
e([y()], M2.prototype, "capabilities", null), e([y()], M2.prototype, "displayType", void 0), e([y({ readOnly: true })], M2.prototype, "effectiveDisplayType", null), e([y()], M2.prototype, "graphic", null), e([y()], M2.prototype, "icon", null), e([y()], M2.prototype, "label", null), e([y(), e2("esri/widgets/Attachments/t9n/Attachments")], M2.prototype, "messages", void 0), e([y(), e2("esri/core/t9n/Units")], M2.prototype, "messagesUnits", void 0), e([y({ readOnly: true })], M2.prototype, "selectedFile", void 0), e([y({ readOnly: true })], M2.prototype, "submitting", void 0), e([y({ readOnly: true })], M2.prototype, "error", void 0), e([y({ type: y3 })], M2.prototype, "viewModel", void 0), e([y()], M2.prototype, "visibleElements", void 0), e([s6("visibleElements")], M2.prototype, "castVisibleElements", null), M2 = e([a("esri.widgets.Attachments")], M2);
var I4 = M2;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel.js
var s9 = class extends y3 {
  constructor(t11) {
    super(t11), this.description = null, this.title = null;
  }
};
e([y()], s9.prototype, "description", void 0), e([y()], s9.prototype, "title", void 0), s9 = e([a("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")], s9);
var c5 = s9;

// ../node_modules/@arcgis/core/widgets/support/Heading.js
function e8({ level: r8, class: e16, ...n18 }, l14) {
  const a10 = s10(r8);
  return n2(`h${a10}`, { ...n18, "aria-level": String(a10), class: f2(e4.heading, e16), role: "heading" }, l14);
}
function s10(t11) {
  return e3(Math.ceil(t11), 1, 6);
}

// ../node_modules/@arcgis/core/widgets/Feature/support/FeatureElementInfo.js
var n8 = "esri-feature-element-info";
var p5 = { base: n8, title: `${n8}__title`, description: `${n8}__description` };
var c6 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this.description = null, this.headingLevel = 2, this.title = null;
  }
  render() {
    return n2("div", { class: p5.base }, this._renderTitle(), this._renderDescription());
  }
  _renderTitle() {
    const { title: e16 } = this;
    return e16 ? n2(e8, { class: p5.title, innerHTML: e16, level: this.headingLevel }) : null;
  }
  _renderDescription() {
    const { description: e16 } = this;
    return e16 ? n2("div", { class: p5.description, innerHTML: e16, key: "description" }) : null;
  }
};
e([y()], c6.prototype, "description", void 0), e([y()], c6.prototype, "headingLevel", void 0), e([y()], c6.prototype, "title", void 0), c6 = e([a("esri.widgets.Feature.support.FeatureElementInfo")], c6);
var l4 = c6;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureAttachments.js
var d7 = { base: "esri-feature-attachments" };
var h5 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this._featureElementInfo = null, this.attachmentsWidget = new I4(), this.headingLevel = 2, this.viewModel = new c5();
  }
  initialize() {
    this._featureElementInfo = new l4(), this.addHandles([d2(() => {
      var _a, _b;
      return [(_a = this.viewModel) == null ? void 0 : _a.description, (_b = this.viewModel) == null ? void 0 : _b.title, this.headingLevel];
    }, () => this._setupFeatureElementInfo(), P), d2(() => this.viewModel, (e16) => this.attachmentsWidget.viewModel = e16, P)]);
  }
  destroy() {
    var _a;
    this.attachmentsWidget.viewModel = null, this.attachmentsWidget.destroy(), (_a = this._featureElementInfo) == null ? void 0 : _a.destroy();
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e16) {
    this.viewModel.description = e16;
  }
  get displayType() {
    return this.attachmentsWidget.displayType;
  }
  set displayType(e16) {
    this.attachmentsWidget.displayType = e16;
  }
  get graphic() {
    return this.viewModel.graphic;
  }
  set graphic(e16) {
    this.viewModel.graphic = e16;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e16) {
    this.viewModel.title = e16;
  }
  render() {
    var _a;
    const { attachmentsWidget: e16 } = this;
    return n2("div", { class: d7.base }, (_a = this._featureElementInfo) == null ? void 0 : _a.render(), e16 == null ? void 0 : e16.render());
  }
  _setupFeatureElementInfo() {
    var _a;
    const { description: e16, title: t11, headingLevel: i12 } = this;
    (_a = this._featureElementInfo) == null ? void 0 : _a.set({ description: e16, title: t11, headingLevel: i12 });
  }
};
e([y({ readOnly: true })], h5.prototype, "attachmentsWidget", void 0), e([y()], h5.prototype, "description", null), e([y()], h5.prototype, "displayType", null), e([y()], h5.prototype, "graphic", null), e([y()], h5.prototype, "headingLevel", void 0), e([y()], h5.prototype, "title", null), e([y({ type: c5 })], h5.prototype, "viewModel", void 0), h5 = e([a("esri.widgets.Feature.FeatureAttachments")], h5);
var c7 = h5;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureContent/FeatureContentViewModel.js
var c8 = class extends S {
  constructor(t11) {
    super(t11), this._loadingPromise = null, this.created = null, this.creator = null, this.destroyer = null, this.graphic = null, this.addHandles(d2(() => this.creator, (t12) => {
      this._destroyContent(), this._createContent(t12);
    }, P));
  }
  destroy() {
    this._destroyContent();
  }
  get state() {
    return this._loadingPromise ? "loading" : "ready";
  }
  _destroyContent() {
    const { created: t11, graphic: e16, destroyer: r8 } = this;
    t11 && e16 && (E3({ type: "content", value: r8, event: { graphic: e16 } }), this._set("created", null));
  }
  async _createContent(t11) {
    const e16 = this.graphic;
    if (!e16 || !t11) return;
    const r8 = E3({ type: "content", value: t11, event: { graphic: e16 } });
    this._loadingPromise = r8, this.notifyChange("state");
    const o7 = await r8;
    r8 === this._loadingPromise && (this._loadingPromise = null, this.notifyChange("state"), this._set("created", o7));
  }
};
e([y({ readOnly: true })], c8.prototype, "created", void 0), e([y()], c8.prototype, "creator", void 0), e([y()], c8.prototype, "destroyer", void 0), e([y({ type: d5 })], c8.prototype, "graphic", void 0), e([y({ readOnly: true })], c8.prototype, "state", null), c8 = e([a("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")], c8);
var p6 = c8;

// ../node_modules/@arcgis/core/widgets/support/decorators/vmEvent.js
function e9(e16) {
  return (a10) => {
    a10.hasOwnProperty("_delegatedEventNames") || (a10._delegatedEventNames = a10._delegatedEventNames ? a10._delegatedEventNames.slice() : []);
    const n18 = a10._delegatedEventNames, r8 = Array.isArray(e16) ? e16 : t2(e16);
    n18.push(...r8);
  };
}
function t2(e16) {
  return e16.split(",").map((e17) => e17.trim());
}

// ../node_modules/@arcgis/core/widgets/support/widget.js
function e10(e16) {
  return e16 && "function" == typeof e16.render;
}
function t4(e16) {
  return e16 && "function" == typeof e16.postMixInProperties && "function" == typeof e16.buildRendering && "function" == typeof e16.postCreate && "function" == typeof e16.startup;
}

// ../node_modules/@arcgis/core/widgets/Feature/FeatureContent.js
var n10 = "esri-feature-content";
var c10 = { base: n10, loaderContainer: `${n10}__loader-container`, loader: `${n10}__loader` };
var l5 = class extends B {
  constructor(e16, r8) {
    super(e16, r8), this.viewModel = null, this._addTargetToAnchors = (e17) => {
      Array.from(e17.querySelectorAll("a")).forEach((e18) => {
        v5(e18.href) && !e18.hasAttribute("target") && e18.setAttribute("target", "_blank");
      });
    };
  }
  get creator() {
    var _a;
    return (_a = this.viewModel) == null ? void 0 : _a.creator;
  }
  set creator(e16) {
    this.viewModel && (this.viewModel.creator = e16);
  }
  get graphic() {
    var _a;
    return (_a = this.viewModel) == null ? void 0 : _a.graphic;
  }
  set graphic(e16) {
    this.viewModel && (this.viewModel.graphic = e16);
  }
  render() {
    var _a;
    const e16 = (_a = this.viewModel) == null ? void 0 : _a.state;
    return n2("div", { class: c10.base }, "loading" === e16 ? this._renderLoading() : this._renderCreated());
  }
  _renderLoading() {
    return n2("div", { class: c10.loaderContainer, key: "loader" }, n2("div", { class: c10.loader }));
  }
  _renderCreated() {
    var _a;
    const e16 = (_a = this.viewModel) == null ? void 0 : _a.created;
    return e16 ? e16 instanceof HTMLElement ? n2("div", { afterCreate: this._attachToNode, bind: e16, key: e16 }) : e10(e16) ? n2("div", { key: e16 }, !e16.destroyed && e16.render()) : n2("div", { afterCreate: this._addTargetToAnchors, innerHTML: e16, key: e16 }) : null;
  }
  _attachToNode(e16) {
    const r8 = this;
    e16.appendChild(r8);
  }
};
e([y()], l5.prototype, "creator", null), e([y()], l5.prototype, "graphic", null), e([y({ type: p6 })], l5.prototype, "viewModel", void 0), l5 = e([a("esri.widgets.Feature.FeatureContent")], l5);
var p7 = l5;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureFields/FeatureFieldsViewModel.js
var l6 = class extends S {
  constructor(o7) {
    super(o7), this.attributes = null, this.expressionInfos = null, this.description = null, this.fieldInfos = null, this.title = null;
  }
  get formattedFieldInfos() {
    const { expressionInfos: o7, fieldInfos: e16 } = this, t11 = [];
    return e16 == null ? void 0 : e16.forEach((e17) => {
      if (!(!e17.hasOwnProperty("visible") || e17.visible)) return;
      const s17 = e17.clone();
      s17.label = C2(s17, o7), t11.push(s17);
    }), t11;
  }
};
e([y()], l6.prototype, "attributes", void 0), e([y({ type: [i7] })], l6.prototype, "expressionInfos", void 0), e([y()], l6.prototype, "description", void 0), e([y({ type: [n4] })], l6.prototype, "fieldInfos", void 0), e([y({ readOnly: true })], l6.prototype, "formattedFieldInfos", null), e([y()], l6.prototype, "title", void 0), l6 = e([a("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")], l6);
var n11 = l6;

// ../node_modules/@arcgis/core/widgets/support/uriUtils.js
var s11 = [{ pattern: /^\s*(https?:\/\/([^\s]+))\s*$/i, target: "_blank", label: "{messages.view}" }, { pattern: /^\s*(tel:([^\s]+))\s*$/i, label: "{hierPart}" }, { pattern: /^\s*(mailto:([^\s]+))\s*$/i, label: "{hierPart}" }, { pattern: /^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "App Studio Player" }, { pattern: /^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Collector" }, { pattern: /^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Explorer" }, { pattern: /^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Navigator" }, { pattern: /^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Survey123" }, { pattern: /^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Trek2There" }, { pattern: /^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Workforce" }, { pattern: /^\s*(iform:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "iForm" }, { pattern: /^\s*(flow:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "FlowFinity" }, { pattern: /^\s*(lfmobile:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Laserfische" }, { pattern: /^\s*(mspbi:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Microsoft Power Bi" }];
function a6(a10, p14) {
  if ("string" != typeof p14 || !p14) return p14;
  const r8 = s11.find((e16) => e16.pattern.test(p14));
  if (!r8) return p14;
  const t11 = p14.match(r8.pattern), n18 = t11 == null ? void 0 : t11[2], l14 = r(r(r8.label, { messages: a10, hierPart: n18 }), { appName: r8.appName }), i12 = r8.target ? ` target="${r8.target}"` : "", o7 = "_blank" === r8.target ? ' rel="noreferrer"' : "";
  return p14.replace(r8.pattern, `<a${i12} href="$1"${o7}>${l14}</a>`);
}

// ../node_modules/@arcgis/core/widgets/Feature/FeatureFields.js
var u3 = "esri-feature-fields";
var m6 = { base: u3, fieldHeader: `${u3}__field-header`, fieldData: `${u3}__field-data`, fieldDataDate: `${u3}__field-data--date` };
var c11 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this._featureElementInfo = null, this.viewModel = new n11(), this.messages = null, this.messagesURIUtils = null;
  }
  initialize() {
    this._featureElementInfo = new l4(), this.addHandles(d2(() => {
      var _a, _b;
      return [(_a = this.viewModel) == null ? void 0 : _a.description, (_b = this.viewModel) == null ? void 0 : _b.title];
    }, () => this._setupFeatureElementInfo(), P));
  }
  destroy() {
    var _a;
    (_a = this._featureElementInfo) == null ? void 0 : _a.destroy();
  }
  get attributes() {
    return this.viewModel.attributes;
  }
  set attributes(e16) {
    this.viewModel.attributes = e16;
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e16) {
    this.viewModel.description = e16;
  }
  get expressionInfos() {
    return this.viewModel.expressionInfos;
  }
  set expressionInfos(e16) {
    this.viewModel.expressionInfos = e16;
  }
  get fieldInfos() {
    return this.viewModel.fieldInfos;
  }
  set fieldInfos(e16) {
    this.viewModel.fieldInfos = e16;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e16) {
    this.viewModel.title = e16;
  }
  render() {
    var _a;
    return n2("div", { class: m6.base }, (_a = this._featureElementInfo) == null ? void 0 : _a.render(), this._renderFields());
  }
  _renderFieldInfo(e16, t11) {
    var _a;
    const { attributes: s17 } = this.viewModel, i12 = e16.fieldName || "", r8 = e16.label || i12, o7 = s17 ? null == s17[i12] ? "" : s17[i12] : "", l14 = !!((_a = e16.format) == null ? void 0 : _a.dateFormat), n18 = "number" == typeof o7 && !l14 ? this._forceLTR(o7) : a6(this.messagesURIUtils, o7), d12 = { [m6.fieldDataDate]: l14 };
    return n2("tr", { key: `fields-element-info-row-${i12}-${t11}` }, n2("th", { class: m6.fieldHeader, innerHTML: r8, key: `fields-element-info-row-header-${i12}-${t11}` }), n2("td", { class: this.classes(m6.fieldData, d12), innerHTML: n18, key: `fields-element-info-row-data-${i12}-${t11}` }));
  }
  _renderFields() {
    const { formattedFieldInfos: e16 } = this.viewModel;
    return (e16 == null ? void 0 : e16.length) ? n2("table", { class: e4.table, summary: this.messages.fieldsSummary }, n2("tbody", null, e16.map((e17, t11) => this._renderFieldInfo(e17, t11)))) : null;
  }
  _setupFeatureElementInfo() {
    var _a;
    const { description: e16, title: t11 } = this;
    (_a = this._featureElementInfo) == null ? void 0 : _a.set({ description: e16, title: t11 });
  }
  _forceLTR(e16) {
    return `&lrm;${e16}`;
  }
};
e([y()], c11.prototype, "attributes", null), e([y()], c11.prototype, "description", null), e([y()], c11.prototype, "expressionInfos", null), e([y()], c11.prototype, "fieldInfos", null), e([y()], c11.prototype, "title", null), e([y({ type: n11, nonNullable: true })], c11.prototype, "viewModel", void 0), e([y(), e2("esri/widgets/Feature/t9n/Feature")], c11.prototype, "messages", void 0), e([y(), e2("esri/widgets/support/t9n/uriUtils")], c11.prototype, "messagesURIUtils", void 0), c11 = e([a("esri.widgets.Feature.FeatureFields")], c11);
var h7 = c11;

// ../node_modules/@arcgis/core/widgets/Legend/support/heatmapRampUtils.js
function r6(r8) {
  if (!r8.colorStops) return [];
  const e16 = [...r8.colorStops].filter((o7) => {
    var _a;
    return ((_a = o7.color) == null ? void 0 : _a.a) > 0;
  });
  let t11 = e16.length - 1;
  if (e16 && e16[0]) {
    const r9 = e16[t11];
    r9 && 1 !== r9.ratio && (e16.push(new l2({ ratio: 1, color: r9.color })), t11++);
  }
  return e16.map((o7, e17) => {
    var _a, _b;
    let l14 = "";
    return 0 === e17 ? l14 = ((_a = r8.legendOptions) == null ? void 0 : _a.minLabel) || "low" : e17 === t11 && (l14 = ((_b = r8.legendOptions) == null ? void 0 : _b.maxLabel) || "high"), { color: o7.color, label: l14, ratio: o7.ratio };
  }).reverse();
}

// ../node_modules/@arcgis/core/renderers/support/utils.js
var v6 = E("short-date");
async function w6(e16, l14, t11) {
  r2(e16, l14, () => []).push(...t11);
}
async function x2(l14) {
  var _a, _b;
  const t11 = /* @__PURE__ */ new Map();
  if (!l14) return t11;
  if ("visualVariables" in l14 && l14.visualVariables) {
    const e16 = l14.visualVariables.filter((e17) => "color" === e17.type);
    for (const l15 of e16) {
      const e17 = (await r5(l15) ?? []).map((e18) => e18.color);
      await w6(t11, l15.field || l15.valueExpression, e17);
    }
  }
  if ("heatmap" === l14.type) {
    const e16 = r6(l14).map((e17) => e17.color);
    await w6(t11, l14.field || l14.valueExpression, e16);
  } else if ("pie-chart" === l14.type) {
    for (const e16 of l14.attributes) await w6(t11, e16.field || e16.valueExpression, [e16.color]);
    await w6(t11, "default", [(_a = l14 == null ? void 0 : l14.othersCategory) == null ? void 0 : _a.color, h2(l14.backgroundFillSymbol, null)]);
  } else if ("dot-density" === l14.type) {
    for (const e16 of l14.attributes) await w6(t11, e16.field || e16.valueExpression, [e16.color]);
    await w6(t11, "default", [l14.backgroundColor]);
  } else if ("unique-value" === l14.type) if ("predominance" === ((_b = l14.authoringInfo) == null ? void 0 : _b.type)) for (const e16 of l14.uniqueValueInfos ?? []) await w6(t11, e16.value.toString(), [h2(e16.symbol, null)]);
  else {
    const e16 = (l14.uniqueValueInfos ?? []).map((e17) => h2(e17.symbol, null)), { field: i12, field2: o7, field3: a10, valueExpression: n18 } = l14;
    (i12 || n18) && await w6(t11, i12 || n18, e16), o7 && await w6(t11, o7, e16), a10 && await w6(t11, a10, e16);
  }
  else if ("class-breaks" === l14.type) {
    const e16 = l14.classBreakInfos.map((e17) => h2(e17.symbol, null)), { field: i12, valueExpression: o7 } = l14;
    await w6(t11, i12 ?? o7, e16);
  } else "simple" === l14.type && await w6(t11, "default", [h2(l14.symbol, null)]);
  return "defaultSymbol" in l14 && l14.defaultSymbol && await w6(t11, "default", [h2(l14.defaultSymbol, null)]), t11.forEach((l15, i12) => {
    const o7 = s(l15.filter(Boolean), (e16, l16) => JSON.stringify(e16) === JSON.stringify(l16));
    t11.set(i12, o7);
  }), t11;
}

// ../node_modules/@arcgis/core/widgets/Feature/support/relatedFeatureUtils.js
var f6 = "esri.widgets.Feature.support.relatedFeatureUtils";
var m7 = () => n.getLogger(f6);
var d8 = /* @__PURE__ */ new Map();
function y4(e16) {
  if (!de(e16)) return null;
  const [t11, r8] = e16.split("/").slice(1);
  return { layerId: t11, fieldName: r8 };
}
function j6(e16, t11) {
  if (!t11.relationships) return null;
  let r8 = null;
  const { relationships: o7 } = t11;
  return o7.some((t12) => t12.id === parseInt(e16, 10) && (r8 = t12, true)), r8;
}
function g5({ originRelationship: e16, relationships: t11, layerId: r8 }) {
  return t11.find(({ relatedTableId: t12, id: o7 }) => `${t12}` === r8 && o7 === (e16 == null ? void 0 : e16.id)) ?? null;
}
function h8(e16, t11) {
  const r8 = t11.toLowerCase();
  for (const o7 in e16) if (o7.toLowerCase() === r8) return e16[o7];
  return null;
}
function F4(e16, t11) {
  const r8 = j6(e16, t11);
  if (!r8) return;
  return { url: `${t11.url}/${r8.relatedTableId}`, sourceSpatialReference: t11.spatialReference, relation: r8, relatedFields: [], outStatistics: [] };
}
function I5(e16, t11) {
  if (!t11) return;
  if (!e16) return;
  const { features: r8, statsFeatures: o7 } = e16, i12 = r8 == null ? void 0 : r8.value;
  t11.relatedFeatures = i12 ? i12.features : [];
  const s17 = o7 == null ? void 0 : o7.value;
  t11.relatedStatsFeatures = s17 ? s17.features : [];
}
function S4(e16, t11, r8, o7) {
  var _a;
  const i12 = new d4();
  return i12.outFields = ["*"], i12.relationshipId = "number" == typeof t11.id ? t11.id : parseInt(t11.id, 10), i12.objectIds = [e16.attributes[r8.objectIdField]], i12.gdbVersion = r8.gdbVersion ?? null, i12.historicMoment = r8.historicMoment ?? null, ((_a = r8.queryRelatedFeatures) == null ? void 0 : _a.call(r8, i12, o7)) ?? Promise.resolve({});
}
function b5(e16, t11, r8) {
  let o7 = 0;
  const i12 = [];
  for (; o7 < t11.length; ) i12.push(`${e16} IN (${t11.slice(o7, r8 + o7)})`), o7 += r8;
  return i12.join(" OR ");
}
function w7(e16) {
  return e16 ? s(e16) : void 0;
}
function R3(e16) {
  return e16 ? s(e16, (e17, t11) => JSON.stringify(e17.toJSON()) === JSON.stringify(t11.toJSON())) : void 0;
}
async function U4(e16, t11, r8, o7) {
  const i12 = r8.layerId.toString(), { layerInfo: u10, relation: p14, relatedFields: c18, outStatistics: f10, url: m12, sourceSpatialReference: d12 } = t11, y10 = w7(c18), j10 = R3(f10);
  if (!u10 || !p14) return null;
  const F9 = g5({ originRelationship: p14, relationships: u10.relationships, layerId: i12 });
  if ((F9 == null ? void 0 : F9.relationshipTableId) && F9.keyFieldInRelationshipTable) {
    const t12 = (await S4(e16, F9, r8, o7))[e16.attributes[r8.objectIdField]];
    if (!t12) return null;
    const i13 = t12.features.map((e17) => e17.attributes[u10.objectIdField]);
    if ((j10 == null ? void 0 : j10.length) && u10.supportsStatistics) {
      const e17 = new b3();
      e17.where = b5(u10.objectIdField, i13, 1e3), e17.outFields = y10, e17.outStatistics = j10, e17.sourceSpatialReference = d12;
      const r9 = { features: Promise.resolve(t12), statsFeatures: s8(m12, e17) };
      return v(r9);
    }
  }
  const I10 = F9 == null ? void 0 : F9.keyField;
  if (I10) {
    const t12 = pe(v7(u10.fields, I10)), i13 = h8(e16.attributes, p14.keyField), c19 = t12 ? `${I10}=${i13}` : `${I10}='${i13}'`, f11 = r8.historicMoment, g11 = r8.gdbVersion, F10 = s8(m12, new b3({ where: c19, outFields: y10, sourceSpatialReference: d12, historicMoment: f11, gdbVersion: g11 }), o7), S5 = !!(j10 == null ? void 0 : j10.length) && u10.supportsStatistics ? s8(m12, new b3({ where: c19, outFields: y10, outStatistics: j10, sourceSpatialReference: d12 }), o7) : null, b10 = { features: F10 };
    return S5 && (b10.statsFeatures = S5), v(b10);
  }
  return null;
}
function $2(t11, r8) {
  return U(t11, { query: { f: "json" }, signal: r8 == null ? void 0 : r8.signal });
}
function N5({ relatedInfos: e16, layer: t11 }, o7) {
  const n18 = {};
  return e16.forEach((e17, o8) => {
    const { relation: i12 } = e17;
    if (!i12) {
      const e18 = new s2("relation-required", "A relation is required on a layer to retrieve related records.");
      throw m7().error(e18), e18;
    }
    const { relatedTableId: s17 } = i12;
    if ("number" != typeof s17) {
      const e18 = new s2("A related table ID is required on a layer to retrieve related records.");
      throw m7().error(e18), e18;
    }
    const l14 = `${t11.url}/${s17}`, a10 = d8.get(l14), u10 = a10 ?? $2(l14);
    a10 || d8.set(l14, u10), n18[o8] = u10;
  }), h(v(n18), o7);
}
function T6({ graphic: e16, relatedInfos: t11, layer: r8 }, o7) {
  const i12 = {};
  return t11.forEach((t12, s17) => {
    t12.layerInfo && (i12[s17] = U4(e16, t12, r8, o7));
  }), v(i12);
}
function q2({ relatedInfo: e16, fieldName: t11, fieldInfo: r8 }) {
  var _a, _b;
  if ((_a = e16.relatedFields) == null ? void 0 : _a.push(t11), r8.statisticType) {
    const o7 = new m({ statisticType: r8.statisticType, onStatisticField: t11, outStatisticFieldName: t11 });
    (_b = e16.outStatistics) == null ? void 0 : _b.push(o7);
  }
}
function v7(e16, t11) {
  if (null != e16) {
    t11 = t11.toLowerCase();
    for (const r8 of e16) if (r8 && r8.name.toLowerCase() === t11) return r8;
  }
  return null;
}

// ../node_modules/@arcgis/core/widgets/Feature/FeatureMedia/FeatureMediaViewModel.js
var I6 = { chartAnimation: true };
var v8 = class extends S {
  constructor(t11) {
    super(t11), this.abilities = { ...I6 }, this.activeMediaInfoIndex = 0, this.attributes = null, this.description = null, this.fieldInfoMap = null, this.formattedAttributes = null, this.expressionAttributes = null, this.isAggregate = false, this.layer = null, this.mediaInfos = null, this.popupTemplate = null, this.relatedInfos = null, this.title = null;
  }
  castAbilities(t11) {
    return { ...I6, ...t11 };
  }
  get activeMediaInfo() {
    return this.formattedMediaInfos[this.activeMediaInfoIndex] || null;
  }
  get formattedMediaInfos() {
    return this._formatMediaInfos() || [];
  }
  get formattedMediaInfoCount() {
    return this.formattedMediaInfos.length;
  }
  setActiveMedia(t11) {
    this._setContentElementMedia(t11);
  }
  next() {
    this._pageContentElementMedia(1);
  }
  previous() {
    this._pageContentElementMedia(-1);
  }
  _setContentElementMedia(t11) {
    const { formattedMediaInfoCount: e16 } = this, i12 = (t11 + e16) % e16;
    this.activeMediaInfoIndex = i12;
  }
  _pageContentElementMedia(t11) {
    const { activeMediaInfoIndex: e16 } = this, i12 = e16 + t11;
    this._setContentElementMedia(i12);
  }
  _formatMediaInfos() {
    const { mediaInfos: t11, layer: e16 } = this, o7 = this.attributes ?? {}, r8 = this.formattedAttributes ?? {}, a10 = this.expressionAttributes ?? {}, s17 = this.fieldInfoMap ?? /* @__PURE__ */ new Map();
    return (t11 == null ? void 0 : t11.map((t12) => {
      const i12 = t12 == null ? void 0 : t12.clone();
      if (!i12) return null;
      if (i12.title = D3({ attributes: o7, fieldInfoMap: s17, globalAttributes: r8, expressionAttributes: a10, layer: e16, text: i12.title }), i12.caption = D3({ attributes: o7, fieldInfoMap: s17, globalAttributes: r8, expressionAttributes: a10, layer: e16, text: i12.caption }), i12.altText = D3({ attributes: o7, fieldInfoMap: s17, globalAttributes: r8, expressionAttributes: a10, layer: e16, text: i12.altText }), "image" === i12.type) {
        if (!i12.value) return;
        return this._setImageValue({ value: i12.value, formattedAttributes: r8, layer: e16 }), i12.value.sourceURL ? i12 : void 0;
      }
      if ("pie-chart" === i12.type || "line-chart" === i12.type || "column-chart" === i12.type || "bar-chart" === i12.type) {
        if (!i12.value) return;
        return this._setChartValue({ value: i12.value, chartType: i12.type, attributes: o7, formattedAttributes: r8, layer: e16, expressionAttributes: a10 }), i12;
      }
      return null;
    }).filter(O)) ?? [];
  }
  _setImageValue(t11) {
    const e16 = this.fieldInfoMap ?? /* @__PURE__ */ new Map(), { value: i12, formattedAttributes: o7, layer: r8 } = t11, { linkURL: a10, sourceURL: s17 } = i12;
    if (s17) {
      const t12 = P3(s17, r8);
      i12.sourceURL = z({ formattedAttributes: o7, template: t12, fieldInfoMap: e16 });
    }
    if (a10) {
      const t12 = P3(a10, r8);
      i12.linkURL = z({ formattedAttributes: o7, template: t12, fieldInfoMap: e16 });
    }
  }
  _setChartValue(t11) {
    const { value: e16, attributes: i12, formattedAttributes: o7, chartType: r8, layer: a10, expressionAttributes: s17 } = t11, { popupTemplate: l14, relatedInfos: n18 } = this, { fields: p14, normalizeField: d12 } = e16, m12 = a10;
    e16.fields = R2(p14, m12), d12 && (e16.normalizeField = q(d12, m12));
    if (!p14.some((t12) => !!(null != o7[t12] || de(t12) && (n18 == null ? void 0 : n18.size)))) return;
    const h14 = (l14 == null ? void 0 : l14.fieldInfos) ?? [];
    p14.forEach((t12, a11) => {
      var _a;
      const l15 = (_a = e16.colors) == null ? void 0 : _a[a11];
      if (de(t12)) return void (e16.series = [...e16.series, ...this._getRelatedChartInfos({ fieldInfos: h14, fieldName: t12, formattedAttributes: o7, chartType: r8, value: e16, color: l15 })]);
      const n19 = this._getChartOption({ value: e16, attributes: i12, chartType: r8, formattedAttributes: o7, expressionAttributes: s17, fieldName: t12, fieldInfos: h14, color: l15 });
      e16.series.push(n19);
    });
  }
  _getRelatedChartInfos(t11) {
    var _a;
    const { fieldInfos: e16, fieldName: i12, formattedAttributes: o7, chartType: r8, value: a10, color: s17 } = t11, l14 = [], n18 = y4(i12), p14 = n18 && ((_a = this.relatedInfos) == null ? void 0 : _a.get(n18.layerId.toString()));
    if (!p14) return l14;
    const { relatedFeatures: d12, relation: u10 } = p14;
    if (!u10 || !d12) return l14;
    const { cardinality: f10 } = u10;
    d12.forEach((t12) => {
      const { attributes: p15 } = t12;
      p15 && Object.keys(p15).forEach((t13) => {
        t13 === n18.fieldName && l14.push(this._getChartOption({ value: a10, attributes: p15, formattedAttributes: o7, fieldName: i12, chartType: r8, relatedFieldName: t13, hasMultipleRelatedFeatures: (d12 == null ? void 0 : d12.length) > 1, fieldInfos: e16, color: s17 }));
      });
    });
    return "one-to-many" === f10 || "many-to-many" === f10 ? l14 : [l14[0]];
  }
  _getTooltip({ label: t11, value: e16, chartType: i12 }) {
    return "pie-chart" === i12 ? `${t11}` : `${t11}: ${e16}`;
  }
  _getChartOption(t11) {
    var _a;
    const { value: e16, attributes: i12, formattedAttributes: o7, expressionAttributes: r8, fieldName: a10, relatedFieldName: n18, fieldInfos: p14, chartType: d12, hasMultipleRelatedFeatures: u10, color: I10 } = t11, v12 = this.layer, M7 = this.fieldInfoMap ?? /* @__PURE__ */ new Map(), { normalizeField: A8, tooltipField: g11 } = e16, x5 = A8 ? de(A8) ? i12[y4(A8).fieldName] : i12[A8] : null, _5 = x(a10) && r8 && void 0 !== r8[a10] ? r8[a10] : n18 && void 0 !== i12[n18] ? i12[n18] : void 0 !== i12[a10] ? i12[a10] : o7[a10], C7 = new p2({ fieldName: a10, color: I10, value: void 0 === _5 ? null : _5 && x5 ? _5 / x5 : _5 });
    if (de(a10)) {
      const t12 = M7.get(a10.toLowerCase()), e17 = g11 && M7.get(g11.toLowerCase()), r9 = (t12 == null ? void 0 : t12.fieldName) ?? a10, s17 = u10 && g11 ? y4(g11).fieldName : (e17 == null ? void 0 : e17.fieldName) ?? g11, l14 = u10 && s17 ? i12[s17] : o7[s17] ?? (t12 == null ? void 0 : t12.label) ?? (t12 == null ? void 0 : t12.fieldName) ?? n18, p15 = u10 && n18 ? i12[n18] : o7[r9];
      return C7.tooltip = this._getTooltip({ label: l14, value: p15, chartType: d12 }), C7;
    }
    const T11 = Y(p14, a10), N6 = q(a10, v12), F9 = g11 && void 0 !== o7[g11] ? o7[g11] : C2(T11 || new n4({ fieldName: N6 }), (_a = this.popupTemplate) == null ? void 0 : _a.expressionInfos), j10 = o7[N6];
    return C7.tooltip = this._getTooltip({ label: F9, value: j10, chartType: d12 }), C7;
  }
};
e([y()], v8.prototype, "abilities", void 0), e([s6("abilities")], v8.prototype, "castAbilities", null), e([y()], v8.prototype, "activeMediaInfoIndex", void 0), e([y({ readOnly: true })], v8.prototype, "activeMediaInfo", null), e([y()], v8.prototype, "attributes", void 0), e([y()], v8.prototype, "description", void 0), e([y()], v8.prototype, "fieldInfoMap", void 0), e([y()], v8.prototype, "formattedAttributes", void 0), e([y()], v8.prototype, "expressionAttributes", void 0), e([y({ readOnly: true })], v8.prototype, "formattedMediaInfos", null), e([y()], v8.prototype, "isAggregate", void 0), e([y()], v8.prototype, "layer", void 0), e([y({ readOnly: true })], v8.prototype, "formattedMediaInfoCount", null), e([y()], v8.prototype, "mediaInfos", void 0), e([y()], v8.prototype, "popupTemplate", void 0), e([y()], v8.prototype, "relatedInfos", void 0), e([y()], v8.prototype, "title", void 0), v8 = e([a("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")], v8);
var M3 = v8;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureMedia.js
var v9 = "esri-feature-media";
var g6 = { base: v9, mediaContainer: `${v9}__container`, mediaItemContainer: `${v9}__item-container`, mediaItem: `${v9}__item`, mediaItemText: `${v9}__item-text`, mediaItemTitle: `${v9}__item-title`, mediaItemCaption: `${v9}__item-caption`, mediaNavigation: `${v9}__item-navigation`, mediaPagination: `${v9}__pagination`, mediaPaginationText: `${v9}__pagination-text`, mediaPrevious: `${v9}__previous`, mediaPreviousIconLTR: `${v9}__previous-icon`, mediaPreviousIconRTL: `${v9}__previous-icon--rtl`, mediaNext: `${v9}__next`, mediaNextIconLTR: `${v9}__next-icon`, mediaNextIconRTL: `${v9}__next-icon--rtl`, mediaChart: `${v9}__chart`, mediaPaginationButton: `${v9}__pagination-button`, mediaPaginationIcon: `${v9}__pagination-icon`, mediaChartRendered: `${v9}__chart--rendered` };
var M4 = 15;
var w8 = "category";
var I7 = "value";
var A6 = "rgba(50, 50, 50, 1)";
var C3 = 250;
var y5 = 500;
var x3 = 200;
var T7 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this._refreshTimer = null, this._refreshIntervalInfo = null, this._featureElementInfo = null, this._chartRootMap = /* @__PURE__ */ new WeakMap(), this.viewModel = new M3(), this.messages = null, this._disposeChart = (e17) => {
      var _a;
      (_a = this._chartRootMap.get(e17)) == null ? void 0 : _a.dispose(), this._chartRootMap.delete(e17);
    }, this._createChart = async (e17) => {
      const { destroyed: t12, viewModel: i12 } = this;
      if (t12 || !i12 || !e17) return;
      const { createRoot: r8 } = await import("./chartUtilsAm5-PN2LQ5EY.js"), a10 = await r8(e17);
      this._chartRootMap.set(e17, a10), this._renderChart({ mediaInfo: i12.activeMediaInfo, root: a10 });
    };
  }
  initialize() {
    this._featureElementInfo = new l4(), this.addHandles([d2(() => {
      var _a, _b;
      return [(_a = this.viewModel) == null ? void 0 : _a.activeMediaInfo, (_b = this.viewModel) == null ? void 0 : _b.activeMediaInfoIndex];
    }, () => this._setupMediaRefreshTimer(), P), d2(() => {
      var _a, _b;
      return [(_a = this.viewModel) == null ? void 0 : _a.description, (_b = this.viewModel) == null ? void 0 : _b.title];
    }, () => this._setupFeatureElementInfo(), P)]);
  }
  loadDependencies() {
    return r3({ icon: () => import("./calcite-icon-VRKLQJOU.js") });
  }
  destroy() {
    var _a;
    this._clearMediaRefreshTimer(), (_a = this._featureElementInfo) == null ? void 0 : _a.destroy();
  }
  get attributes() {
    return this.viewModel.attributes;
  }
  set attributes(e16) {
    this.viewModel.attributes = e16;
  }
  get activeMediaInfoIndex() {
    return this.viewModel.activeMediaInfoIndex;
  }
  set activeMediaInfoIndex(e16) {
    this.viewModel.activeMediaInfoIndex = e16;
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e16) {
    this.viewModel.description = e16;
  }
  get fieldInfoMap() {
    return this.viewModel.fieldInfoMap;
  }
  set fieldInfoMap(e16) {
    this.viewModel.fieldInfoMap = e16;
  }
  get layer() {
    return this.viewModel.layer;
  }
  set layer(e16) {
    this.viewModel.layer = e16;
  }
  get mediaInfos() {
    return this.viewModel.mediaInfos;
  }
  set mediaInfos(e16) {
    this.viewModel.mediaInfos = e16;
  }
  get popupTemplate() {
    return this.viewModel.popupTemplate;
  }
  set popupTemplate(e16) {
    this.viewModel.popupTemplate = e16;
  }
  get relatedInfos() {
    return this.viewModel.relatedInfos;
  }
  set relatedInfos(e16) {
    this.viewModel.relatedInfos = e16;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e16) {
    this.viewModel.title = e16;
  }
  render() {
    var _a;
    return n2("div", { bind: this, class: g6.base, onkeyup: this._handleMediaKeyup }, (_a = this._featureElementInfo) == null ? void 0 : _a.render(), this._renderMedia());
  }
  _renderMedia() {
    const { formattedMediaInfoCount: e16, activeMediaInfoIndex: t11 } = this.viewModel, i12 = this._renderMediaText();
    return e16 ? n2("div", { class: g6.mediaContainer, key: "media-element-container" }, this._renderMediaInfo(), n2("div", { class: g6.mediaNavigation }, i12, e16 > 1 ? n2("div", { class: g6.mediaPagination }, this._renderMediaPageButton("previous"), n2("span", { class: g6.mediaPaginationText }, s4(this.messages.pageText, { index: t11 + 1, total: e16 })), this._renderMediaPageButton("next")) : null)) : null;
  }
  _renderMediaText() {
    const { activeMediaInfo: e16 } = this.viewModel;
    if (!e16) return null;
    const t11 = e16 && e16.title ? n2("div", { class: g6.mediaItemTitle, innerHTML: e16.title, key: "media-title" }) : null, i12 = e16 && e16.caption ? n2("div", { class: g6.mediaItemCaption, innerHTML: e16.caption, key: "media-caption" }) : null;
    return t11 || i12 ? n2("div", { class: g6.mediaItemText, key: "media-text" }, t11, i12) : null;
  }
  _renderImageMediaInfo(e16) {
    if (!e16.value) return null;
    const { _refreshIntervalInfo: t11 } = this, { activeMediaInfoIndex: i12, formattedMediaInfoCount: r8 } = this.viewModel, { value: a10, refreshInterval: s17, altText: o7, title: n18, type: l14 } = e16, { sourceURL: d12, linkURL: c18 } = a10, h14 = v5(c18 ?? void 0) ? "_blank" : "_self", p14 = "_blank" === h14 ? "noreferrer" : "", f10 = s17 ? t11 : null, _5 = f10 ? f10.timestamp : 0, v12 = f10 ? f10.sourceURL : d12, g11 = n2("img", { alt: o7 || n18, key: `media-${l14}-${i12}-${r8}-${_5}`, src: v12 ?? void 0 });
    return (c18 ? n2("a", { href: c18, rel: p14, target: h14, title: n18 }, g11) : null) ?? g11;
  }
  _renderChartMediaInfo(e16) {
    const { activeMediaInfoIndex: t11, formattedMediaInfoCount: i12 } = this.viewModel;
    return n2("div", { afterCreate: this._createChart, afterRemoved: this._disposeChart, bind: this, class: g6.mediaChart, key: `media-${e16.type}-${t11}-${i12}` });
  }
  _renderMediaInfoType() {
    const { activeMediaInfo: e16 } = this.viewModel;
    return e16 ? "image" === e16.type ? this._renderImageMediaInfo(e16) : e16.type.includes("chart") ? this._renderChartMediaInfo(e16) : null : null;
  }
  _renderMediaInfo() {
    const { activeMediaInfo: e16 } = this.viewModel;
    return e16 ? n2("div", { class: g6.mediaItemContainer, key: "media-container" }, n2("div", { class: g6.mediaItem, key: "media-item-container" }, this._renderMediaInfoType())) : null;
  }
  _renderMediaPageButton(e16) {
    if (this.viewModel.formattedMediaInfoCount < 2) return null;
    const t11 = "previous" === e16, i12 = t11 ? this.messages.previous : this.messages.next, r8 = t11 ? "chevron-left" : "chevron-right", a10 = t11 ? "media-previous" : "media-next", s17 = t11 ? this._previous : this._next;
    return n2("button", { "aria-label": i12, bind: this, class: g6.mediaPaginationButton, key: a10, onclick: s17, tabIndex: 0, title: i12, type: "button" }, n2("calcite-icon", { class: g6.mediaPaginationIcon, icon: r8, scale: "s" }));
  }
  _setupFeatureElementInfo() {
    var _a;
    const { description: e16, title: t11 } = this;
    (_a = this._featureElementInfo) == null ? void 0 : _a.set({ description: e16, title: t11 });
  }
  _next() {
    this.viewModel.next();
  }
  _previous() {
    this.viewModel.previous();
  }
  _getRenderer() {
    if (!this.viewModel) return;
    const { isAggregate: e16, layer: t11 } = this.viewModel;
    return e16 && (t11 == null ? void 0 : t11.featureReduction) && "renderer" in t11.featureReduction ? t11.featureReduction.renderer : t11 == null ? void 0 : t11.renderer;
  }
  async _getSeriesColors(e16) {
    const { colorAm5: t11 } = await import("./chartCommon-6TFNKMIP.js"), i12 = /* @__PURE__ */ new Map();
    return e16.forEach((e17) => {
      e17.color && i12.set(e17, t11(e17.color.toCss(true)));
    }), i12;
  }
  async _getRendererColors() {
    const { colorAm5: e16 } = await import("./chartCommon-6TFNKMIP.js"), t11 = /* @__PURE__ */ new Map(), i12 = this._getRenderer(), r8 = "default";
    if (!i12) return t11;
    const a10 = await x2(i12);
    a10.delete(r8);
    return Array.from(a10.values()).every((e17) => 1 === (e17 == null ? void 0 : e17.length)) ? (Array.from(a10.keys()).forEach((i13) => {
      var _a, _b;
      const r9 = (_b = (_a = a10.get(i13)) == null ? void 0 : _a[0]) == null ? void 0 : _b.toCss(true);
      r9 && t11.set(i13, e16(r9));
    }), t11) : t11;
  }
  _handleMediaKeyup(e16) {
    const { key: t11 } = e16;
    "ArrowLeft" === t11 && (e16.stopPropagation(), this.viewModel.previous()), "ArrowRight" === t11 && (e16.stopPropagation(), this.viewModel.next());
  }
  _canAnimateChart() {
    return !!this.viewModel && (!!this.viewModel.abilities.chartAnimation && !o3());
  }
  _getChartAnimationMS() {
    return this._canAnimateChart() ? C3 : 0;
  }
  _getChartSeriesAnimationMS() {
    return this._canAnimateChart() ? y5 : 0;
  }
  async _renderChart(e16) {
    const { root: t11, mediaInfo: i12 } = e16, { value: r8, type: a10 } = i12, { ResponsiveThemeAm5: s17, DarkThemeAm5: o7, AnimatedThemeAm5: n18, ColorSetAm5: l14, ThemeAm5: d12, esriChartColorSet: m12 } = await import("./chartCommon-6TFNKMIP.js"), c18 = d12.new(t11);
    c18.rule("ColorSet").set("colors", m12), c18.rule("ColorSet").set("reuse", true);
    const h14 = [s17.new(t11), c18];
    r4() && h14.push(o7.new(t11)), this._canAnimateChart() && h14.push(n18.new(t11)), t11.setThemes(h14);
    const p14 = await this._getRendererColors(), u10 = await this._getSeriesColors(r8.series), _5 = l14.new(t11, {}), v12 = u10.get(r8.series[0]), g11 = v12 ? { lineSettings: { stroke: v12 } } : void 0, M7 = r8.series.map((e17, t12) => {
      const i13 = u10.get(e17) || p14.get(e17.fieldName) || _5.getIndex(t12);
      return { [w8]: e17.tooltip, [I7]: e17.value, columnSettings: { fill: i13, stroke: i13 }, ...g11 };
    }).filter((e17) => "pie-chart" !== a10 || null != e17.value && e17.value > 0);
    "pie-chart" === a10 ? this._createPieChart(e16, M7) : this._createXYChart(e16, M7);
  }
  _getDirection() {
    return g2(this.container) ? "rtl" : "ltr";
  }
  _isInversed() {
    return !!g2(this.container);
  }
  async _customizeChartTooltip(e16, t11 = "horizontal") {
    var _a;
    const { colorAm5: i12 } = await import("./chartCommon-6TFNKMIP.js");
    e16.setAll({ pointerOrientation: t11 }), (_a = e16.get("background")) == null ? void 0 : _a.setAll({ stroke: i12(A6) }), e16.label.setAll({ direction: this._getDirection(), oversizedBehavior: "wrap", maxWidth: x3 });
  }
  async _createPieChart(e16, t11) {
    const { TooltipAm5: i12 } = await import("./chartCommon-6TFNKMIP.js"), { PieChartAm5: r8, PieSeriesAm5: a10 } = await import("./pieChart-TXHKZ6K5.js"), { mediaInfo: s17, root: o7 } = e16, { title: n18 } = s17, l14 = 5, d12 = (s17 == null ? void 0 : s17.altText) || (s17 == null ? void 0 : s17.title) || "", m12 = o7.container.children.push(r8.new(o7, { ariaLabel: d12, focusable: true, paddingBottom: l14, paddingTop: l14, paddingLeft: l14, paddingRight: l14 })), c18 = "{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})", h14 = i12.new(o7, { labelText: c18 }), p14 = m12.series.push(a10.new(o7, { name: n18, valueField: I7, categoryField: w8, tooltip: h14 }));
    p14.ticks.template.set("forceHidden", true), p14.labels.template.set("forceHidden", true), p14.slices.template.states.create("active", { shiftRadius: l14 }), this._customizeChartTooltip(h14), p14.slices.template.setAll({ ariaLabel: c18, focusable: true, templateField: "columnSettings" }), p14.data.setAll(t11), p14.appear(this._getChartSeriesAnimationMS()), m12.appear(this._getChartAnimationMS()), m12.root.dom.classList.toggle(g6.mediaChartRendered, true);
  }
  _getMinSeriesValue(e16) {
    let t11 = 0;
    return e16.forEach((e17) => t11 = Math.min(e17.value, t11)), t11;
  }
  async _createColumnChart(e16, t11, i12) {
    const { TooltipAm5: r8, ScrollbarAm5: a10 } = await import("./chartCommon-6TFNKMIP.js"), { CategoryAxisAm5: s17, AxisRendererXAm5: o7, ValueAxisAm5: n18, AxisRendererYAm5: l14, ColumnSeriesAm5: d12 } = await import("./xyChart-SEMPMHG2.js"), { mediaInfo: m12, root: c18 } = t11, { value: h14, title: p14 } = m12;
    e16.setAll({ wheelX: "panX", wheelY: "zoomX" });
    const u10 = e16.xAxes.push(s17.new(c18, { renderer: o7.new(c18, { inversed: this._isInversed() }), categoryField: w8 }));
    u10.get("renderer").labels.template.setAll({ forceHidden: true });
    const f10 = e16.yAxes.push(n18.new(c18, { renderer: l14.new(c18, { inside: false }), min: this._getMinSeriesValue(h14.series) }));
    f10.get("renderer").labels.template.setAll({ direction: this._getDirection() });
    const _5 = "{categoryX}", v12 = r8.new(c18, { labelText: _5 }), g11 = e16.series.push(d12.new(c18, { name: p14, xAxis: u10, yAxis: f10, valueYField: I7, categoryXField: w8, tooltip: v12 }));
    this._customizeChartTooltip(v12), g11.columns.template.setAll({ ariaLabel: _5, focusable: true, templateField: "columnSettings" }), h14.series.length > M4 && e16.set("scrollbarX", a10.new(c18, { orientation: "horizontal" })), u10.data.setAll(i12), g11.data.setAll(i12), g11.appear(this._getChartSeriesAnimationMS()), e16.appear(this._getChartAnimationMS());
  }
  async _createBarChart(e16, t11, i12) {
    const { TooltipAm5: r8, ScrollbarAm5: a10 } = await import("./chartCommon-6TFNKMIP.js"), { CategoryAxisAm5: s17, AxisRendererXAm5: o7, ValueAxisAm5: n18, AxisRendererYAm5: l14, ColumnSeriesAm5: d12 } = await import("./xyChart-SEMPMHG2.js"), { mediaInfo: m12, root: c18 } = t11, { value: h14, title: p14 } = m12;
    e16.setAll({ wheelX: "panY", wheelY: "zoomY" });
    const u10 = e16.yAxes.push(s17.new(c18, { renderer: l14.new(c18, { inversed: true }), categoryField: w8 }));
    u10.get("renderer").labels.template.setAll({ forceHidden: true });
    const f10 = e16.xAxes.push(n18.new(c18, { renderer: o7.new(c18, { inside: false, inversed: this._isInversed() }), min: this._getMinSeriesValue(h14.series) }));
    f10.get("renderer").labels.template.setAll({ direction: this._getDirection() });
    const _5 = "{categoryY}", v12 = r8.new(c18, { labelText: _5 }), g11 = e16.series.push(d12.new(c18, { name: p14, xAxis: f10, yAxis: u10, valueXField: I7, categoryYField: w8, tooltip: v12 }));
    this._customizeChartTooltip(v12, "vertical"), g11.columns.template.setAll({ ariaLabel: _5, focusable: true, templateField: "columnSettings" }), h14.series.length > M4 && e16.set("scrollbarY", a10.new(c18, { orientation: "vertical" })), u10.data.setAll(i12), g11.data.setAll(i12), g11.appear(this._getChartSeriesAnimationMS()), e16.appear(this._getChartAnimationMS());
  }
  async _createLineChart(e16, t11, i12) {
    var _a, _b, _c;
    const { TooltipAm5: r8, ScrollbarAm5: a10 } = await import("./chartCommon-6TFNKMIP.js"), { CategoryAxisAm5: s17, AxisRendererXAm5: o7, ValueAxisAm5: n18, AxisRendererYAm5: l14, LineSeriesAm5: d12 } = await import("./xyChart-SEMPMHG2.js"), { root: m12, mediaInfo: c18 } = t11, { value: h14, title: p14 } = c18;
    e16.setAll({ wheelX: "panX", wheelY: "zoomX" });
    const u10 = e16.xAxes.push(s17.new(m12, { renderer: o7.new(m12, { inversed: this._isInversed() }), categoryField: w8 }));
    u10.get("renderer").labels.template.setAll({ forceHidden: true });
    const f10 = e16.yAxes.push(n18.new(m12, { renderer: l14.new(m12, { inside: false }), min: this._getMinSeriesValue(h14.series) }));
    f10.get("renderer").labels.template.setAll({ direction: this._getDirection() });
    const _5 = "{categoryX}", v12 = (_b = (_a = i12[0]) == null ? void 0 : _a.lineSettings) == null ? void 0 : _b.stroke, g11 = r8.new(m12, { getFillFromSprite: !v12, labelText: _5 });
    v12 && ((_c = g11.get("background")) == null ? void 0 : _c.setAll({ fill: v12 }));
    const A8 = e16.series.push(d12.new(m12, { name: p14, xAxis: u10, yAxis: f10, valueYField: I7, categoryXField: w8, tooltip: g11 }));
    A8.strokes.template.setAll({ templateField: "lineSettings" }), this._customizeChartTooltip(g11, "vertical"), h14.series.length > M4 && e16.set("scrollbarX", a10.new(m12, { orientation: "horizontal" })), u10.data.setAll(i12), A8.data.setAll(i12), A8.appear(this._getChartSeriesAnimationMS()), e16.appear(this._getChartAnimationMS());
  }
  async _createXYChart(e16, t11) {
    const { XYChartAm5: i12, XYCursorAm5: r8 } = await import("./xyChart-SEMPMHG2.js"), { root: a10, mediaInfo: s17 } = e16, { type: o7 } = s17, n18 = (s17 == null ? void 0 : s17.altText) || (s17 == null ? void 0 : s17.title) || "", l14 = a10.container.children.push(i12.new(a10, { ariaLabel: n18, focusable: true, panX: true, panY: true }));
    l14.set("cursor", r8.new(a10, {})), "column-chart" === o7 && await this._createColumnChart(l14, e16, t11), "bar-chart" === o7 && await this._createBarChart(l14, e16, t11), "line-chart" === o7 && await this._createLineChart(l14, e16, t11), l14.root.dom.classList.toggle(g6.mediaChartRendered, true);
  }
  _clearMediaRefreshTimer() {
    const { _refreshTimer: e16 } = this;
    e16 && (clearTimeout(e16), this._refreshTimer = null);
  }
  _updateMediaInfoTimestamp(e16) {
    const t11 = Date.now();
    this._refreshIntervalInfo = { timestamp: t11, sourceURL: e16 && this._getImageSource(e16, t11) };
  }
  _setupMediaRefreshTimer() {
    this._clearMediaRefreshTimer();
    const { activeMediaInfo: e16 } = this.viewModel;
    "image" === (e16 == null ? void 0 : e16.type) && (e16 == null ? void 0 : e16.refreshInterval) > 0 && this._setRefreshTimeout(e16);
  }
  _setRefreshTimeout(e16) {
    const { refreshInterval: t11, value: i12 } = e16, r8 = 6e4 * t11;
    this._updateMediaInfoTimestamp(i12.sourceURL);
    const a10 = setInterval(() => {
      this._updateMediaInfoTimestamp(i12.sourceURL);
    }, r8);
    this._refreshTimer = a10;
  }
  _getImageSource(e16, t11) {
    const i12 = e16.includes("?") ? "&" : "?", [r8, a10 = ""] = e16.split("#");
    return `${r8}${i12}timestamp=${t11}${a10 ? "#" : ""}${a10}`;
  }
};
e([y()], T7.prototype, "_refreshIntervalInfo", void 0), e([y()], T7.prototype, "attributes", null), e([y()], T7.prototype, "activeMediaInfoIndex", null), e([y()], T7.prototype, "description", null), e([y()], T7.prototype, "fieldInfoMap", null), e([y()], T7.prototype, "layer", null), e([y()], T7.prototype, "mediaInfos", null), e([y()], T7.prototype, "popupTemplate", null), e([y()], T7.prototype, "relatedInfos", null), e([y()], T7.prototype, "title", null), e([y({ type: M3 })], T7.prototype, "viewModel", void 0), e([y(), e2("esri/widgets/Feature/t9n/Feature")], T7.prototype, "messages", void 0), T7 = e([a("esri.widgets.Feature.FeatureMedia")], T7);
var b6 = T7;

// ../node_modules/@arcgis/core/widgets/Feature/support/arcadeFeatureUtils.js
var n12 = "esri.widgets.Feature.support.arcadeFeatureUtils";
var s12 = () => n.getLogger(n12);
function p8(e16) {
  return "string" == typeof e16 ? ae(oe(e16)) : Array.isArray(e16) ? c13(e16) : "esri.arcade.Dictionary" === (e16 == null ? void 0 : e16.declaredClass) ? u5(e16) : e16;
}
function c13(e16) {
  return `<ul class="esri-widget__list">${e16.map((e17) => `<li>${"string" == typeof e17 ? ae(oe(e17)) : e17}</li>`).join("")}</ul>`;
}
function u5(e16) {
  const r8 = e16.keys().map((r9) => {
    const t11 = e16.field(r9);
    return `<tr><th>${r9}</th><td>${"string" == typeof t11 ? ae(oe(t11)) : t11}</td></tr>`;
  }).join("");
  return `<table class="${e4.table}">${r8}</table>`;
}
function l7() {
  return import("./arcade-RDVZPZXF.js");
}
function d9(e16) {
  return "createQuery" in e16 && "queryFeatures" in e16;
}
async function y6({ graphic: e16, view: r8, options: t11 }) {
  const { isAggregate: a10, layer: o7 } = e16;
  if (!a10 || !o7 || "2d" !== (r8 == null ? void 0 : r8.type)) return [];
  const i12 = await r8.whenLayerView(o7);
  if (!d9(i12)) return [];
  const n18 = i12.createQuery(), s17 = e16.getObjectId();
  n18.aggregateIds = null != s17 ? [s17] : [];
  const { features: p14 } = await i12.queryFeatures(n18, t11);
  return p14;
}
function f7({ layer: e16, aggregatedFeatures: r8, interceptor: a10 }) {
  const { fields: o7, objectIdField: i12, geometryType: n18, spatialReference: s17, displayField: p14 } = e16;
  return new Ze({ fields: o7, objectIdField: i12, geometryType: n18, spatialReference: s17, displayField: p14, interceptor: a10, ..."feature" === e16.type ? { templates: e16.templates, typeIdField: e16.typeIdField, types: e16.types } : null, source: r8 });
}
async function g7({ expressionInfo: e16, arcade: r8, interceptor: t11, spatialReference: a10, map: o7, graphic: i12, location: n18, view: p14, options: c18 }) {
  var _a;
  if (!(e16 == null ? void 0 : e16.expression)) return null;
  const { isAggregate: u10 } = i12, l14 = (i12.sourceLayer || i12.layer) ?? void 0, d12 = u10 ? "feature-reduction-popup" : "popup", g11 = r8.createArcadeProfile(d12), m12 = r8.createArcadeExecutor(e16.expression, g11).catch((r9) => s12().error("arcade-executor-error", { error: r9, expressionInfo: e16 })), [w13, h14] = await Promise.all([y6({ graphic: i12, view: p14, options: c18 }), m12]);
  if (!h14) return null;
  const F9 = "feature-reduction-popup" === d12 ? f7({ layer: l14, aggregatedFeatures: w13, interceptor: t11 }) : void 0, $4 = { ..."feature-reduction-popup" === d12 ? { $aggregatedFeatures: F9 } : { $datastore: l14 == null ? void 0 : l14.url, $layer: "feature" === (l14 == null ? void 0 : l14.type) || "subtype-sublayer" === (l14 == null ? void 0 : l14.type) || "catalog-footprint" === (l14 == null ? void 0 : l14.type) || "oriented-imagery" === (l14 == null ? void 0 : l14.type) ? l14 : "scene" === (l14 == null ? void 0 : l14.type) && null != l14.associatedLayer ? l14.associatedLayer : void 0, $map: o7, $userInput: n18, $graph: "knowledge-graph-sublayer" === (l14 == null ? void 0 : l14.type) ? (_a = l14 == null ? void 0 : l14.parentCompositeLayer) == null ? void 0 : _a.knowledgeGraph : void 0 }, $feature: i12 }, v12 = { abortSignal: (c18 == null ? void 0 : c18.signal) ?? void 0, interceptor: t11 ?? void 0, rawOutput: true, spatialReference: a10 ?? void 0, timeZone: p14 == null ? void 0 : p14.timeZone };
  return await h14.executeAsync($4, v12).catch((r9) => s12().error("arcade-execution-error", { error: r9, graphic: i12, expressionInfo: e16 })).finally(() => F9 == null ? void 0 : F9.destroy());
}
async function m8({ expressionInfos: e16, spatialReference: t11, graphic: a10, interceptor: o7, map: i12, view: n18, location: s17, options: c18 }) {
  if (!(e16 == null ? void 0 : e16.length)) return {};
  const u10 = await l7(), d12 = {};
  for (const r8 of e16) d12[`expression/${r8.name}`] = g7({ expressionInfo: r8, arcade: u10, interceptor: o7, spatialReference: t11, map: i12, graphic: a10, location: s17, view: n18, options: c18 });
  const y10 = await v(d12), f10 = {};
  for (const r8 in y10) f10[r8] = p8(y10[r8].value);
  return f10;
}

// ../node_modules/@arcgis/core/widgets/Feature/FeatureExpression/FeatureExpressionViewModel.js
var w9 = 1;
var j7 = class extends S {
  constructor(t11) {
    super(t11), this._abortController = null, this.expressionInfo = null, this.graphic = null, this.contentElement = null, this.contentElementViewModel = null, this.interceptor = null, this.location = null, this.view = null, this._cancelQuery = () => {
      const { _abortController: t12 } = this;
      t12 && t12.abort(), this._abortController = null;
    }, this._createVM = () => {
      var _a, _b;
      const t12 = (_a = this.contentElement) == null ? void 0 : _a.type;
      (_b = this.contentElementViewModel) == null ? void 0 : _b.destroy();
      const e16 = "fields" === t12 ? new n11() : "media" === t12 ? new M3() : "text" === t12 ? new p6() : null;
      this._set("contentElementViewModel", e16);
    }, this._compile = async () => {
      this._cancelQuery();
      const t12 = new AbortController();
      this._abortController = t12, await this._compileExpression(), this._abortController === t12 && (this._abortController = null);
    }, this._compileThrottled = e5(this._compile, w9, this), this._compileExpression = async () => {
      const { expressionInfo: t12, graphic: e16, interceptor: o7, spatialReference: r8, map: n18, location: i12, view: s17, _abortController: l14 } = this;
      if (!t12 || !e16) return void this._set("contentElement", null);
      const m12 = await l7();
      if (l14 !== this._abortController) return;
      const h14 = await g7({ arcade: m12, expressionInfo: t12, graphic: e16, location: i12, interceptor: o7, map: n18, spatialReference: r8, view: s17 });
      if (!h14 || "esri.arcade.Dictionary" !== h14.declaredClass) return void this._set("contentElement", null);
      const d12 = await h14.castAsJsonAsync(l14 == null ? void 0 : l14.signal), u10 = d12 == null ? void 0 : d12.type, _5 = "media" === u10 ? I.fromJSON(d12) : "text" === u10 ? c3.fromJSON(d12) : "fields" === u10 ? c2.fromJSON(d12) : null;
      this._set("contentElement", _5);
    }, this.addHandles([d2(() => [this.expressionInfo, this.graphic, this.map, this.spatialReference, this.view], () => this._compileThrottled(), P), d2(() => [this.contentElement], () => this._createVM(), P)]);
  }
  initialize() {
    this.addHandles(this._compileThrottled);
  }
  destroy() {
    var _a;
    this._cancelQuery(), (_a = this.contentElementViewModel) == null ? void 0 : _a.destroy(), this._set("contentElementViewModel", null), this._set("contentElement", null);
  }
  get spatialReference() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.spatialReference) ?? null;
  }
  set spatialReference(t11) {
    this._override("spatialReference", t11);
  }
  get state() {
    const { _abortController: t11, contentElement: e16, contentElementViewModel: o7 } = this;
    return t11 ? "loading" : e16 || o7 ? "ready" : "disabled";
  }
  get map() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.map) ?? null;
  }
  set map(t11) {
    this._override("map", t11);
  }
};
e([y()], j7.prototype, "_abortController", void 0), e([y({ type: i6 })], j7.prototype, "expressionInfo", void 0), e([y({ type: d5 })], j7.prototype, "graphic", void 0), e([y({ readOnly: true })], j7.prototype, "contentElement", void 0), e([y({ readOnly: true })], j7.prototype, "contentElementViewModel", void 0), e([y()], j7.prototype, "interceptor", void 0), e([y({ type: _ })], j7.prototype, "location", void 0), e([y()], j7.prototype, "spatialReference", null), e([y({ readOnly: true })], j7.prototype, "state", null), e([y()], j7.prototype, "map", null), e([y()], j7.prototype, "view", void 0), j7 = e([a("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")], j7);
var C4 = j7;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureExpression.js
var m9 = "esri-feature";
var u6 = { base: `${m9}-expression`, loadingSpinnerContainer: `${m9}__loading-container` };
var g8 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this._contentWidget = null, this.viewModel = new C4();
  }
  initialize() {
    this.addHandles(d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.contentElementViewModel;
    }, () => this._setupExpressionWidget(), P));
  }
  loadDependencies() {
    return r3({ loader: () => import("./calcite-loader-3OF54TOV.js") });
  }
  destroy() {
    this._destroyContentWidget();
  }
  render() {
    var _a;
    const { state: e16 } = this.viewModel;
    return n2("div", { class: u6.base }, "loading" === e16 ? this._renderLoading() : "disabled" === e16 ? null : (_a = this._contentWidget) == null ? void 0 : _a.render());
  }
  _renderLoading() {
    return n2("div", { class: u6.loadingSpinnerContainer, key: "loading-container" }, n2("calcite-loader", { inline: true, label: "" }));
  }
  _destroyContentWidget() {
    const { _contentWidget: e16 } = this;
    e16 && (e16.viewModel = null, e16.destroy()), this._contentWidget = null;
  }
  _setupExpressionWidget() {
    const { contentElementViewModel: e16, contentElement: t11 } = this.viewModel, o7 = t11 == null ? void 0 : t11.type;
    this._destroyContentWidget();
    const s17 = e16 ? "fields" === o7 ? new h7({ viewModel: e16 }) : "media" === o7 ? new b6({ viewModel: e16 }) : "text" === o7 ? new p7({ viewModel: e16 }) : null : null;
    this._contentWidget = s17, this.scheduleRender();
  }
};
e([y({ type: C4 })], g8.prototype, "viewModel", void 0), g8 = e([a("esri.widgets.Feature.FeatureExpression")], g8);
var h9 = g8;

// ../node_modules/@arcgis/core/widgets/FeatureForm/featureFormUtils.js
var M5;
!function(e16) {
  e16.TOO_SHORT = "length-validation-error::too-short", e16.TOO_LONG = "length-validation-error::too-long";
}(M5 || (M5 = {}));
var Y2 = (e16) => {
  var _a;
  const t11 = [];
  if (e16.formTemplate) {
    const { description: n18, title: r8 } = e16.formTemplate;
    (_a = e16.fields) == null ? void 0 : _a.forEach((e17) => {
      const i12 = r8 && i(r8, e17.name), s17 = n18 && i(n18, e17.name);
      (i12 || s17) && t11.push(e17.name);
    });
  }
  return t11;
};

// ../node_modules/@arcgis/core/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel.js
var g9 = 100;
var _3 = class extends i5(s7(S)) {
  constructor(e16) {
    super(e16), this._loaded = false, this._queryAbortController = null, this._queryPageAbortController = null, this._queryFeatureCountAbortController = null, this.featuresPerPage = 10, this.description = null, this.graphic = null, this.layer = null, this.map = null, this.orderByFields = null, this.featureCount = 0, this.relationshipId = null, this.showAllEnabled = false, this.title = null, this._cancelQuery = () => {
      const { _queryAbortController: e17 } = this;
      e17 && e17.abort(), this._queryAbortController = null;
    }, this._cancelQueryFeatureCount = () => {
      const { _queryFeatureCountAbortController: e17 } = this;
      e17 && e17.abort(), this._queryFeatureCountAbortController = null;
    }, this._cancelQueryPage = () => {
      const { _queryPageAbortController: e17 } = this;
      e17 && e17.abort(), this._queryPageAbortController = null;
    }, this._queryController = async () => {
      this._cancelQuery();
      const e17 = new AbortController();
      this._queryAbortController = e17, await d(this._query()), this._queryAbortController === e17 && (this._queryAbortController = null);
    }, this._queryFeatureCountController = async () => {
      this._loaded = false, this._cancelQueryFeatureCount();
      const e17 = new AbortController();
      this._queryFeatureCountAbortController = e17, await d(this._queryFeatureCount()), this._queryFeatureCountAbortController === e17 && (this._queryFeatureCountAbortController = null), this._loaded = true;
    }, this._queryPageController = async () => {
      const e17 = new AbortController();
      this._queryPageAbortController = e17, await d(this._queryPage()), this._queryPageAbortController === e17 && (this._queryPageAbortController = null);
    }, this._queryDebounced = k(this._queryController, g9), this._queryFeatureCountDebounced = k(this._queryFeatureCountController, g9), this._queryPageDebounced = k(this._queryPageController, g9), this._query = async () => {
      const { _queryAbortController: e17, relatedFeatures: t11 } = this;
      this.featureCount && (this._destroyRelatedFeatureViewModels(), this.featurePage = 1, t11.destroyAll(), this.destroyed || t11.addMany(this._sliceFeatures(await this._queryRelatedFeatures({ signal: e17 == null ? void 0 : e17.signal }))));
    }, this.addHandles([d2(() => {
      var _a;
      return [this.displayCount, this.graphic, this.layer, (_a = this.layer) == null ? void 0 : _a.loaded, this.map, this.orderByFields, this.relationshipId, this.featuresPerPage, this.showAllEnabled, this.canQuery, this.featureCount];
    }, () => this._queryDebounced(), P), d2(() => [this.featurePage, this.showAllEnabled], () => this._queryPageDebounced()), d2(() => [this.layer, this.relationshipId, this.objectId, this.canQuery], () => this._queryFeatureCountDebounced())]);
  }
  destroy() {
    this._destroyRelatedFeatureViewModels(), this.relatedFeatures.destroyAll(), this._cancelQuery(), this._cancelQueryFeatureCount(), this._cancelQueryPage();
  }
  set featurePage(e16) {
    const { featuresPerPage: t11, featureCount: r8 } = this, o7 = 1, l14 = Math.ceil(r8 / t11) || 1;
    this._set("featurePage", Math.min(Math.max(e16, o7), l14));
  }
  get featurePage() {
    return this._get("featurePage");
  }
  get orderByFieldsFixedCasing() {
    const { orderByFields: e16, relatedLayer: t11 } = this;
    return e16 && (t11 == null ? void 0 : t11.loaded) ? e16.map((e17) => {
      const r8 = e17.clone();
      return r8.field = q(e17.field, t11), r8;
    }) : e16 ?? [];
  }
  get supportsCacheHint() {
    var _a, _b, _c;
    return !!((_c = (_b = (_a = this.layer) == null ? void 0 : _a.capabilities) == null ? void 0 : _b.queryRelated) == null ? void 0 : _c.supportsCacheHint);
  }
  get canLoad() {
    return !!this.map && null != this.relationshipId && "number" == typeof this.objectId;
  }
  get canQuery() {
    var _a, _b;
    const e16 = (_b = (_a = this.layer) == null ? void 0 : _a.capabilities) == null ? void 0 : _b.queryRelated;
    return !!(this.relatedLayer && this.relationship && null != this.relationshipId && null != this.objectId && (e16 == null ? void 0 : e16.supportsCount) && (e16 == null ? void 0 : e16.supportsPagination));
  }
  get itemDescriptionFieldName() {
    var _a;
    return ((_a = this.orderByFieldsFixedCasing[0]) == null ? void 0 : _a.field) || null;
  }
  set displayCount(e16) {
    const t11 = 0, r8 = 10;
    this._set("displayCount", Math.min(Math.max(e16, t11), r8));
  }
  get displayCount() {
    return this._get("displayCount");
  }
  get objectId() {
    var _a, _b;
    return (this.objectIdField && ((_b = (_a = this.graphic) == null ? void 0 : _a.attributes) == null ? void 0 : _b[this.objectIdField])) ?? null;
  }
  get objectIdField() {
    var _a;
    return ((_a = this.layer) == null ? void 0 : _a.objectIdField) || null;
  }
  get relatedFeatures() {
    return this._get("relatedFeatures") || new V();
  }
  get relatedLayer() {
    const { layer: e16, map: t11, relationship: r8 } = this;
    return (e16 == null ? void 0 : e16.loaded) && t11 && r8 ? Te(t11, e16, r8) ?? null : null;
  }
  get relationship() {
    var _a;
    const { relationshipId: e16, layer: t11 } = this;
    return null != e16 ? ((_a = t11 == null ? void 0 : t11.relationships) == null ? void 0 : _a.find(({ id: t12 }) => t12 === e16)) ?? null : null;
  }
  get relatedFeatureViewModels() {
    return this._get("relatedFeatureViewModels") || new V();
  }
  get state() {
    const { _queryAbortController: e16, _queryFeatureCountAbortController: t11, _queryPageAbortController: r8, canQuery: o7, _loaded: l14, canLoad: s17 } = this;
    return t11 || s17 && !l14 ? "loading" : e16 || r8 ? "querying" : o7 ? "ready" : "disabled";
  }
  getRelatedFeatureByObjectId(e16) {
    return this.relatedFeatures.find((t11) => t11.getObjectId() === e16);
  }
  refresh() {
    this._queryFeatureCountDebounced();
  }
  _destroyRelatedFeatureViewModels() {
    var _a;
    (_a = this.relatedFeatureViewModels) == null ? void 0 : _a.destroyAll();
  }
  async _queryFeatureCount() {
    const { layer: e16, relatedLayer: t11, relationshipId: r8, objectId: o7, _queryFeatureCountAbortController: l14, canQuery: s17, supportsCacheHint: a10 } = this;
    if (await (e16 == null ? void 0 : e16.load()), await (t11 == null ? void 0 : t11.load()), !s17 || !e16 || !t11 || null == o7) return void this._set("featureCount", 0);
    const i12 = t11.createQuery(), { historicMoment: n18, gdbVersion: u10 } = e16, d12 = new d4({ cacheHint: a10, gdbVersion: u10, historicMoment: n18, relationshipId: r8, returnGeometry: false, objectIds: [o7], where: i12.where ?? void 0 }), h14 = await e16.queryRelatedFeaturesCount(d12, { signal: l14 == null ? void 0 : l14.signal });
    this._set("featureCount", h14[o7] || 0);
  }
  _sliceFeatures(e16) {
    const { showAllEnabled: t11, displayCount: r8 } = this;
    return t11 ? e16 : r8 ? e16.slice(0, r8) : [];
  }
  async _queryPage() {
    const { relatedFeatures: e16, featurePage: t11, showAllEnabled: r8, _queryPageAbortController: o7, featureCount: l14 } = this;
    !r8 || t11 < 2 || !l14 || e16.addMany(await this._queryRelatedFeatures({ signal: o7 == null ? void 0 : o7.signal }));
  }
  async _queryRelatedFeatures(e16) {
    var _a;
    const { orderByFieldsFixedCasing: t11, showAllEnabled: r8, featuresPerPage: l14, displayCount: s17, layer: a10, relationshipId: i12, featurePage: n18, featureCount: u10, relatedLayer: d12, supportsCacheHint: h14 } = this, { canQuery: y10, objectId: c18 } = this;
    if (!y10 || !a10 || !d12 || null == c18) return [];
    const C7 = r8 ? ((n18 - 1) * l14 + u10) % u10 : 0, g11 = r8 ? l14 : s17, _5 = d12.objectIdField, F9 = [...t11.map((e17) => e17.field), ...Y2(d12), _5].filter(O), m12 = t11.map((e17) => `${e17.field} ${e17.order}`), f10 = d12.createQuery(), { historicMoment: q4, gdbVersion: A8 } = a10, P4 = new d4({ orderByFields: m12, start: C7, num: g11, outFields: F9, cacheHint: h14, historicMoment: q4, gdbVersion: A8, relationshipId: i12, returnGeometry: false, objectIds: [c18], where: f10.where ?? void 0 }), w13 = await a10.queryRelatedFeatures(P4, { signal: e16 == null ? void 0 : e16.signal }), j10 = ((_a = w13[c18]) == null ? void 0 : _a.features) || [];
    return j10.forEach((e17) => {
      e17.sourceLayer = d12, e17.layer = d12;
    }), j10;
  }
};
e([y()], _3.prototype, "_loaded", void 0), e([y()], _3.prototype, "_queryAbortController", void 0), e([y()], _3.prototype, "_queryPageAbortController", void 0), e([y()], _3.prototype, "_queryFeatureCountAbortController", void 0), e([y({ value: 1 })], _3.prototype, "featurePage", null), e([y()], _3.prototype, "featuresPerPage", void 0), e([y({ readOnly: true })], _3.prototype, "orderByFieldsFixedCasing", null), e([y({ readOnly: true })], _3.prototype, "supportsCacheHint", null), e([y({ readOnly: true })], _3.prototype, "canLoad", null), e([y({ readOnly: true })], _3.prototype, "canQuery", null), e([y()], _3.prototype, "description", void 0), e([y({ readOnly: true })], _3.prototype, "itemDescriptionFieldName", null), e([y({ value: 3 })], _3.prototype, "displayCount", null), e([y({ type: d5 })], _3.prototype, "graphic", void 0), e([y()], _3.prototype, "layer", void 0), e([y()], _3.prototype, "map", void 0), e([y({ readOnly: true })], _3.prototype, "objectId", null), e([y({ readOnly: true })], _3.prototype, "objectIdField", null), e([y()], _3.prototype, "orderByFields", void 0), e([y({ readOnly: true })], _3.prototype, "relatedFeatures", null), e([y({ readOnly: true })], _3.prototype, "relatedLayer", null), e([y({ readOnly: true })], _3.prototype, "relationship", null), e([y()], _3.prototype, "featureCount", void 0), e([y({ readOnly: true })], _3.prototype, "relatedFeatureViewModels", null), e([y()], _3.prototype, "relationshipId", void 0), e([y()], _3.prototype, "showAllEnabled", void 0), e([y()], _3.prototype, "state", null), e([y()], _3.prototype, "title", void 0), _3 = e([a("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")], _3);
var F6 = _3;

// ../node_modules/@arcgis/core/widgets/Feature/FeatureRelationship.js
var w10 = "esri-feature";
var b7 = `${w10}-relationship`;
var f8 = { base: b7, listContainer: `${b7}__list`, listItem: `${b7}__list-item`, listItemHidden: `${b7}__list-item--hidden`, listContainerQuerying: `${b7}__list--querying`, featureObserver: `${w10}__feature-observer`, stickySpinnerContainer: `${w10}__sticky-loading-container`, loadingSpinnerContainer: `${w10}__loading-container` };
var y7 = { title: true, description: true };
var F7 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this._featureElementInfo = null, this._relatedFeatureIntersectionObserverNode = null, this._relatedFeatureIntersectionObserver = new IntersectionObserver(([e17]) => {
      (e17 == null ? void 0 : e17.isIntersecting) && this._increaseFeaturePage();
    }, { root: window.document }), this.headingLevel = 2, this.viewModel = new F6(), this.messages = null, this.messagesCommon = null, this.visibleElements = { ...y7 }, this._increaseFeaturePage = () => {
      const { state: e17, showAllEnabled: t12, relatedFeatures: s17, featuresPerPage: r8, featurePage: i12 } = this.viewModel;
      "ready" === e17 && t12 && s17.length >= r8 * i12 && this.viewModel.featurePage++;
    };
  }
  initialize() {
    this._featureElementInfo = new l4(), this.addHandles([d2(() => [this.viewModel.description, this.viewModel.title, this.headingLevel], () => this._setupFeatureElementInfo(), P), d2(() => [this.viewModel.state, this.viewModel.showAllEnabled, this._relatedFeatureIntersectionObserverNode], () => this._handleRelatedFeatureObserverChange()), v2(() => this.viewModel.relatedFeatureViewModels, "change", () => this._setupRelatedFeatureViewModels())]);
  }
  loadDependencies() {
    return r3({ icon: () => import("./calcite-icon-VRKLQJOU.js"), list: () => import("./calcite-list-I4SFG3PL.js"), "list-item": () => import("./calcite-list-item-5HYCUKDY.js"), loader: () => import("./calcite-loader-3OF54TOV.js"), notice: () => import("./calcite-notice-NY6XLCNV.js") });
  }
  destroy() {
    this._unobserveRelatedFeatureObserver(), this._featureElementInfo = u(this._featureElementInfo);
  }
  get displayShowAllButton() {
    const { showAllEnabled: e16, featureCount: t11, displayCount: s17, state: r8 } = this.viewModel;
    return !e16 && !!t11 && "ready" === r8 && (t11 > s17 || 0 === s17);
  }
  get displayListItems() {
    return this.displayShowAllButton || this.viewModel.relatedFeatureViewModels.length > 0;
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e16) {
    this.viewModel.description = e16;
  }
  get featureCountDescription() {
    const { messages: e16 } = this, { featureCount: t11 } = this.viewModel;
    return s4(e16 == null ? void 0 : e16.numberRecords, { number: t11 });
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e16) {
    this.viewModel.title = e16;
  }
  castVisibleElements(e16) {
    return { ...y7, ...e16 };
  }
  render() {
    var _a;
    const { state: e16 } = this.viewModel;
    return n2("div", { class: this.classes(f8.base, e4.widget) }, (_a = this._featureElementInfo) == null ? void 0 : _a.render(), "loading" === e16 ? this._renderLoading() : "disabled" === e16 ? this._renderRelationshipNotFound() : this._renderRelatedFeatures());
  }
  _renderStickyLoading() {
    return "querying" === this.viewModel.state ? n2("div", { class: f8.stickySpinnerContainer, key: "sticky-loader" }, this._renderLoadingIcon()) : null;
  }
  _renderLoadingIcon() {
    return n2("calcite-loader", { inline: true, label: "" });
  }
  _renderLoading() {
    return n2("div", { class: f8.loadingSpinnerContainer, key: "loading-container" }, this._renderLoadingIcon());
  }
  _renderShowAllIconNode() {
    return n2("calcite-icon", { icon: "list", scale: "s", slot: "content-end" });
  }
  _renderChevronIconNode() {
    const e16 = g2(this.container) ? "chevron-left" : "chevron-right";
    return n2("calcite-icon", { icon: e16, scale: "s", slot: "content-end" });
  }
  _renderRelatedFeature(e16) {
    var _a;
    const { itemDescriptionFieldName: t11 } = this.viewModel, s17 = e16.title;
    e16.description = t11 && ((_a = e16.formattedAttributes) == null ? void 0 : _a.global[t11]);
    const r8 = "loading" === e16.state;
    return n2("calcite-list-item", { class: this.classes(f8.listItem, { [f8.listItemHidden]: r8 }), description: e16.description ?? "", key: e16.uid, label: s17, onCalciteListItemSelect: () => this.emit("select-record", { featureViewModel: e16 }) }, this._renderChevronIconNode());
  }
  _renderShowAllListItem() {
    var _a;
    return this.displayShowAllButton ? n2("calcite-list-item", { description: this.featureCountDescription, key: "show-all-item", label: (_a = this.messages) == null ? void 0 : _a.showAll, onCalciteListItemSelect: () => this.emit("show-all-records") }, this._renderShowAllIconNode()) : null;
  }
  _renderNoRelatedFeaturesMessage() {
    var _a;
    return n2("calcite-notice", { icon: "information", key: "no-related-features-message", kind: "brand", open: true, scale: "s", width: "full" }, n2("div", { slot: "message" }, (_a = this.messages) == null ? void 0 : _a.noRelatedFeatures));
  }
  _renderFeatureObserver() {
    return n2("div", { afterCreate: this._relatedFeatureIntersectionObserverCreated, bind: this, class: f8.featureObserver, key: "feature-observer" });
  }
  _renderList() {
    const { relatedFeatureViewModels: e16 } = this.viewModel;
    return n2("calcite-list", null, e16.toArray().map((e17) => this._renderRelatedFeature(e17)), this._renderShowAllListItem());
  }
  _renderRelatedFeatures() {
    const { displayListItems: e16 } = this, { state: t11 } = this.viewModel;
    return n2("div", { class: this.classes(f8.listContainer, { [f8.listContainerQuerying]: "querying" === t11 }), key: "list-container" }, e16 ? this._renderList() : "ready" === t11 ? this._renderNoRelatedFeaturesMessage() : null, this._renderStickyLoading(), this._renderFeatureObserver());
  }
  _renderRelationshipNotFound() {
    var _a;
    return n2("calcite-notice", { icon: "exclamation-mark-triangle", key: "relationship-not-found", kind: "danger", open: true, scale: "s", width: "full" }, n2("div", { slot: "message" }, (_a = this.messages) == null ? void 0 : _a.relationshipNotFound));
  }
  _setupRelatedFeatureViewModels() {
    const { relatedFeatureViewModels: e16 } = this.viewModel, t11 = "related-feature-viewmodels";
    this.removeHandles(t11), e16 == null ? void 0 : e16.forEach((e17) => {
      this.addHandles(d2(() => [e17.title, e17.state], () => this.scheduleRender(), P), t11);
    }), this.scheduleRender();
  }
  _setupFeatureElementInfo() {
    var _a;
    const { headingLevel: e16, visibleElements: t11 } = this, s17 = t11.description && this.description, r8 = t11.title && this.title;
    (_a = this._featureElementInfo) == null ? void 0 : _a.set({ description: s17, title: r8, headingLevel: e16 });
  }
  async _handleRelatedFeatureObserverChange() {
    this._unobserveRelatedFeatureObserver();
    const { state: e16, showAllEnabled: t11 } = this.viewModel;
    await A(0), this._relatedFeatureIntersectionObserverNode && "ready" === e16 && t11 && this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode);
  }
  _relatedFeatureIntersectionObserverCreated(e16) {
    this._relatedFeatureIntersectionObserverNode = e16;
  }
  _unobserveRelatedFeatureObserver() {
    this._relatedFeatureIntersectionObserverNode && this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode);
  }
};
e([y()], F7.prototype, "_relatedFeatureIntersectionObserverNode", void 0), e([y({ readOnly: true })], F7.prototype, "displayShowAllButton", null), e([y({ readOnly: true })], F7.prototype, "displayListItems", null), e([y()], F7.prototype, "description", null), e([y({ readOnly: true })], F7.prototype, "featureCountDescription", null), e([y()], F7.prototype, "headingLevel", void 0), e([y()], F7.prototype, "title", null), e([y({ type: F6 })], F7.prototype, "viewModel", void 0), e([y(), e2("esri/widgets/Feature/t9n/Feature")], F7.prototype, "messages", void 0), e([y(), e2("esri/t9n/common")], F7.prototype, "messagesCommon", void 0), e([y()], F7.prototype, "visibleElements", void 0), e([s6("visibleElements")], F7.prototype, "castVisibleElements", null), F7 = e([a("esri.widgets.Feature.FeatureRelationship")], F7);
var I8 = F7;

// ../node_modules/@arcgis/core/arcade/featureset/support/FeatureSetQueryInterceptor.js
var e11 = class {
  constructor(e16, a10) {
    this.preLayerQueryCallback = e16, this.preRequestCallback = a10, this.preLayerQueryCallback || (this.preLayerQueryCallback = (e17) => {
    }), this.preRequestCallback || (this.preLayerQueryCallback = (e17) => {
    });
  }
};

// ../node_modules/@arcgis/core/widgets/Feature/FeatureViewModel.js
var G2;
var z2 = 1;
var J3 = "content-view-models";
var K3 = "relationship-view-models";
var W2 = { attachmentsContent: true, chartAnimation: true, customContent: true, expressionContent: true, fieldsContent: true, mediaContent: true, textContent: true, relationshipContent: true };
var X2 = G2 = class extends s7(S) {
  constructor(e16) {
    super(e16), this._error = null, this._featureAbortController = null, this._graphicChangedThrottled = e5(this._graphicChanged, z2, this), this._expressionAttributes = null, this._graphicExpressionAttributes = null, this.abilities = { ...W2 }, this.content = null, this.contentViewModels = [], this.description = null, this.defaultPopupTemplateEnabled = false, this.formattedAttributes = null, this.lastEditInfo = null, this.location = null, this.relatedInfos = /* @__PURE__ */ new Map(), this.title = "", this.view = null, this._isAllowedContentType = (e17) => {
      const { abilities: t11 } = this;
      return "attachments" === e17.type && !!t11.attachmentsContent || "custom" === e17.type && !!t11.customContent || "fields" === e17.type && !!t11.fieldsContent || "media" === e17.type && !!t11.mediaContent || "text" === e17.type && !!t11.textContent || "expression" === e17.type && !!t11.expressionContent || "relationship" === e17.type && !!t11.relationshipContent;
    }, this.addHandles(d2(() => [this.graphic, this._effectivePopupTemplate, this.abilities, this.timeZone], () => this._graphicChangedThrottled(), P));
  }
  initialize() {
    this.addHandles(this._graphicChangedThrottled);
  }
  destroy() {
    this._clear(), this._cancelFeatureQuery(), this._error = null, this.graphic = null, this._destroyContentViewModels(), this.relatedInfos.clear();
  }
  get _effectivePopupTemplate() {
    return null != this.graphic ? this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled) : null;
  }
  get _fieldInfoMap() {
    return re(ie(this._effectivePopupTemplate), this._sourceLayer);
  }
  get _sourceLayer() {
    return L(this.graphic);
  }
  castAbilities(e16) {
    return { ...W2, ...e16 };
  }
  get isTable() {
    var _a;
    return ((_a = this._sourceLayer) == null ? void 0 : _a.isTable) || false;
  }
  get state() {
    return this.graphic ? this._error ? "error" : this.waitingForContent ? "loading" : "ready" : "disabled";
  }
  set graphic(e16) {
    this._set("graphic", (e16 == null ? void 0 : e16.clone()) ?? null);
  }
  get spatialReference() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.spatialReference) ?? null;
  }
  set spatialReference(e16) {
    this._override("spatialReference", e16);
  }
  get timeZone() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.timeZone) ?? o2;
  }
  set timeZone(e16) {
    this._overrideIfSome("timeZone", e16);
  }
  get map() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.map) || null;
  }
  set map(e16) {
    this._override("map", e16);
  }
  get waitingForContent() {
    return !!this._featureAbortController;
  }
  setActiveMedia(e16, t11) {
    const i12 = this.contentViewModels[e16];
    i12 instanceof M3 && i12.setActiveMedia(t11);
  }
  nextMedia(e16) {
    const t11 = this.contentViewModels[e16];
    t11 instanceof M3 && t11.next();
  }
  previousMedia(e16) {
    const t11 = this.contentViewModels[e16];
    t11 instanceof M3 && t11.previous();
  }
  async updateGeometry() {
    var _a;
    const { graphic: e16, spatialReference: t11, _sourceLayer: i12 } = this;
    await (i12 == null ? void 0 : i12.load());
    const r8 = i12 == null ? void 0 : i12.objectIdField;
    if (!r8 || !e16 || !i12) return;
    const o7 = (_a = e16 == null ? void 0 : e16.attributes) == null ? void 0 : _a[r8];
    if (null == o7) return;
    const s17 = [o7];
    if (!e16.geometry) {
      const r9 = await se({ layer: i12, graphic: e16, outFields: [], objectIds: s17, returnGeometry: true, spatialReference: t11 }), o8 = r9 == null ? void 0 : r9.geometry;
      o8 && (e16.geometry = o8);
    }
  }
  _clear() {
    this._set("title", ""), this._set("content", null), this._set("formattedAttributes", null);
  }
  async _graphicChanged() {
    this._cancelFeatureQuery(), this._error = null, this._clear();
    const { graphic: e16 } = this;
    if (!e16) return;
    const t11 = new AbortController();
    this._featureAbortController = t11;
    try {
      await this._queryFeature({ signal: t11.signal });
    } catch (i12) {
      b(i12) || (this._error = i12, n.getLogger(this).error("error", "The popupTemplate could not be displayed for this feature.", { error: i12, graphic: e16, popupTemplate: this._effectivePopupTemplate }));
    }
    this._featureAbortController === t11 && (this._featureAbortController = null);
  }
  _cancelFeatureQuery() {
    const { _featureAbortController: e16 } = this;
    e16 && e16.abort(), this._featureAbortController = null;
  }
  _compileContentElement(e16, t11) {
    return "attachments" === e16.type ? this._compileAttachments(e16, t11) : "custom" === e16.type ? this._compileCustom(e16, t11) : "fields" === e16.type ? this._compileFields(e16, t11) : "media" === e16.type ? this._compileMedia(e16, t11) : "text" === e16.type ? this._compileText(e16, t11) : "expression" === e16.type ? this._compileExpression(e16, t11) : "relationship" === e16.type ? this._compileRelationship(e16, t11) : void 0;
  }
  _compileContent(e16) {
    if (this._destroyContentViewModels(), this.graphic) return Array.isArray(e16) ? e16.filter(this._isAllowedContentType).map((e17, t11) => this._compileContentElement(e17, t11)).filter(O) : "string" == typeof e16 ? this._compileText(new c3({ text: e16 }), 0).text : e16;
  }
  _destroyContentViewModels() {
    this.removeHandles(K3), this.removeHandles(J3), this.contentViewModels.forEach((e16) => e16 && !e16.destroyed && e16.destroy()), this._set("contentViewModels", []);
  }
  _matchesFeature(e16, t11) {
    var _a;
    const i12 = (_a = e16 == null ? void 0 : e16.graphic) == null ? void 0 : _a.getObjectId(), r8 = t11 == null ? void 0 : t11.getObjectId();
    return null != i12 && null != r8 && i12 === r8;
  }
  _setRelatedFeaturesViewModels({ relatedFeatureViewModels: e16, relatedFeatures: t11, map: i12 }) {
    const { view: r8, spatialReference: o7, timeZone: s17 } = this;
    t11 == null ? void 0 : t11.filter(Boolean).forEach((t12) => {
      e16.some((e17) => this._matchesFeature(e17, t12)) || e16.add(new G2({ abilities: { relationshipContent: false }, map: i12, view: r8, spatialReference: o7, timeZone: s17, graphic: t12 }));
    }), e16.forEach((i13) => {
      const r9 = t11 == null ? void 0 : t11.find((e17) => this._matchesFeature(i13, e17));
      r9 || e16.remove(i13);
    });
  }
  _setExpressionContentVM(e16, t11) {
    const i12 = this.formattedAttributes, { contentElement: r8, contentElementViewModel: o7 } = e16, s17 = r8 == null ? void 0 : r8.type;
    o7 && s17 && ("fields" === s17 && (this._createFieldsFormattedAttributes({ contentElement: r8, contentElementIndex: t11, formattedAttributes: i12 }), o7.set(this._createFieldsVMParams(r8, t11))), "media" === s17 && (this._createMediaFormattedAttributes({ contentElement: r8, contentElementIndex: t11, formattedAttributes: i12 }), o7.set(this._createMediaVMParams(r8, t11))), "text" === s17 && o7.set(this._createTextVMParams(r8)));
  }
  _compileRelationship(e16, t11) {
    const { displayCount: i12, orderByFields: r8, relationshipId: o7, title: s17, description: n18 } = e16, { _sourceLayer: a10, graphic: l14, map: p14 } = this;
    if (!J2(a10)) return;
    const d12 = new F6({ displayCount: i12, graphic: l14, orderByFields: r8, relationshipId: o7, layer: a10, map: p14, ...this._compileTitleAndDesc({ title: s17, description: n18 }) });
    return this.contentViewModels[t11] = d12, this.addHandles(v2(() => d12.relatedFeatures, "change", () => this._setRelatedFeaturesViewModels(d12)), K3), e16;
  }
  _compileExpression(e16, t11) {
    const { expressionInfo: i12 } = e16, { graphic: r8, map: o7, spatialReference: s17, view: n18, location: a10 } = this, l14 = new C4({ expressionInfo: i12, graphic: r8, interceptor: G2.interceptor, map: o7, spatialReference: s17, view: n18, location: a10 });
    return this.contentViewModels[t11] = l14, this.addHandles(d2(() => l14.contentElementViewModel, () => this._setExpressionContentVM(l14, t11), P), J3), e16;
  }
  _compileAttachments(e16, t11) {
    const { graphic: i12 } = this, { description: r8, title: o7 } = e16;
    return this.contentViewModels[t11] = new c5({ graphic: i12, ...this._compileTitleAndDesc({ title: o7, description: r8 }) }), e16;
  }
  _compileCustom(e16, t11) {
    const { graphic: i12 } = this, { creator: r8, destroyer: o7 } = e16;
    return this.contentViewModels[t11] = new p6({ graphic: i12, creator: r8, destroyer: o7 }), e16;
  }
  _compileTitleAndDesc({ title: e16, description: t11 }) {
    const { _fieldInfoMap: i12, _sourceLayer: r8, graphic: o7, formattedAttributes: s17 } = this, n18 = o7 == null ? void 0 : o7.attributes, a10 = this._expressionAttributes, l14 = s17.global;
    return { title: D3({ attributes: n18, fieldInfoMap: i12, globalAttributes: l14, expressionAttributes: a10, layer: r8, text: e16 }), description: D3({ attributes: n18, fieldInfoMap: i12, globalAttributes: l14, expressionAttributes: a10, layer: r8, text: t11 }) };
  }
  _createFieldsVMParams(e16, t11) {
    const i12 = this._effectivePopupTemplate, r8 = this.formattedAttributes, o7 = { ...r8 == null ? void 0 : r8.global, ...r8 == null ? void 0 : r8.content[t11] }, s17 = (e16 == null ? void 0 : e16.fieldInfos) || (i12 == null ? void 0 : i12.fieldInfos), n18 = s17 == null ? void 0 : s17.filter(({ fieldName: e17 }) => !!e17 && (x(e17) || de(e17) || o7.hasOwnProperty(e17))), a10 = i12 == null ? void 0 : i12.expressionInfos, { description: l14, title: p14 } = e16;
    return { attributes: o7, expressionInfos: a10, fieldInfos: n18, ...this._compileTitleAndDesc({ title: p14, description: l14 }) };
  }
  _compileFields(e16, t11) {
    const i12 = e16.clone(), r8 = new n11(this._createFieldsVMParams(e16, t11));
    return this.contentViewModels[t11] = r8, i12.fieldInfos = r8.formattedFieldInfos.slice(0), i12;
  }
  _createMediaVMParams(e16, t11) {
    const { abilities: i12, graphic: r8, _fieldInfoMap: o7, _effectivePopupTemplate: s17, relatedInfos: n18, _sourceLayer: a10, _expressionAttributes: l14 } = this, p14 = this.formattedAttributes, c18 = (r8 == null ? void 0 : r8.attributes) ?? {}, { description: d12, mediaInfos: u10, title: h14 } = e16;
    return { abilities: { chartAnimation: i12.chartAnimation }, activeMediaInfoIndex: e16.activeMediaInfoIndex || 0, attributes: c18, isAggregate: r8 == null ? void 0 : r8.isAggregate, layer: a10, fieldInfoMap: o7, formattedAttributes: { ...p14 == null ? void 0 : p14.global, ...p14 == null ? void 0 : p14.content[t11] }, expressionAttributes: l14, mediaInfos: u10, popupTemplate: s17, relatedInfos: n18, ...this._compileTitleAndDesc({ title: h14, description: d12 }) };
  }
  _compileMedia(e16, t11) {
    const i12 = e16.clone(), r8 = new M3(this._createMediaVMParams(e16, t11));
    return i12.mediaInfos = r8.formattedMediaInfos.slice(0), this.contentViewModels[t11] = r8, i12;
  }
  _createTextVMParams(e16) {
    var _a;
    const { graphic: t11, _fieldInfoMap: i12, _sourceLayer: r8, _expressionAttributes: o7 } = this;
    if (e16 && e16.text) {
      const s17 = (t11 == null ? void 0 : t11.attributes) ?? {}, n18 = ((_a = this.formattedAttributes) == null ? void 0 : _a.global) ?? {};
      e16.text = D3({ attributes: s17, fieldInfoMap: i12, globalAttributes: n18, expressionAttributes: o7, layer: r8, text: e16.text });
    }
    return { graphic: t11, creator: e16.text };
  }
  _compileText(e16, t11) {
    const i12 = e16.clone();
    return this.contentViewModels[t11] = new p6(this._createTextVMParams(i12)), i12;
  }
  _compileLastEditInfo() {
    const { _effectivePopupTemplate: e16, _sourceLayer: t11, graphic: i12, timeZone: r8 } = this;
    if (!e16) return;
    const { lastEditInfoEnabled: o7 } = e16, s17 = t11 == null ? void 0 : t11.editFieldsInfo;
    return o7 && s17 ? ne(s17, i12 == null ? void 0 : i12.attributes, r8, t11) : void 0;
  }
  _compileTitle(e16) {
    var _a;
    const { _fieldInfoMap: t11, _sourceLayer: i12, graphic: r8, _expressionAttributes: o7 } = this, s17 = (r8 == null ? void 0 : r8.attributes) ?? {}, n18 = ((_a = this.formattedAttributes) == null ? void 0 : _a.global) ?? {};
    return D3({ attributes: s17, fieldInfoMap: t11, globalAttributes: n18, expressionAttributes: o7, layer: i12, text: e16 });
  }
  async _getTitle() {
    const { _effectivePopupTemplate: e16, graphic: t11 } = this;
    return t11 ? E3({ type: "title", value: e16 == null ? void 0 : e16.title, event: { graphic: t11 } }) : null;
  }
  async _getContent() {
    const { _effectivePopupTemplate: e16, graphic: t11 } = this;
    return t11 ? E3({ type: "content", value: e16 == null ? void 0 : e16.content, event: { graphic: t11 } }) : null;
  }
  async _queryFeature(e16) {
    const { _featureAbortController: t11, _sourceLayer: i12, graphic: r8, _effectivePopupTemplate: o7 } = this, s17 = this.map, n18 = this.view, a10 = this.spatialReference, p14 = this.location;
    if (t11 !== this._featureAbortController || !r8) return;
    await ce({ graphic: r8, popupTemplate: o7, layer: i12, spatialReference: a10 }, e16);
    const { content: { value: c18 }, title: { value: d12 } } = await v({ content: this._getContent(), title: this._getTitle() }), { expressionAttributes: { value: u10 } } = await v({ checkForRelatedFeatures: this._checkForRelatedFeatures(e16), expressionAttributes: m8({ expressionInfos: o7 == null ? void 0 : o7.expressionInfos, spatialReference: a10, graphic: r8, map: s17, interceptor: G2.interceptor, view: n18, options: e16, location: p14 }) });
    t11 === this._featureAbortController && r8 && (this._expressionAttributes = u10, this._graphicExpressionAttributes = { ...r8.attributes, ...u10 }, this._set("formattedAttributes", this._createFormattedAttributes(c18)), this._set("title", this._compileTitle(d12)), this._set("lastEditInfo", this._compileLastEditInfo() || null), this._set("content", this._compileContent(c18) || null));
  }
  _createMediaFormattedAttributes({ contentElement: e16, contentElementIndex: t11, formattedAttributes: i12 }) {
    const { _effectivePopupTemplate: r8, graphic: o7, relatedInfos: s17, _sourceLayer: n18, _fieldInfoMap: a10, _graphicExpressionAttributes: l14, timeZone: p14 } = this;
    i12.content[t11] = ue({ fieldInfos: r8 == null ? void 0 : r8.fieldInfos, graphic: o7, attributes: { ...l14, ...e16.attributes }, layer: n18, fieldInfoMap: a10, relatedInfos: s17, timeZone: p14 });
  }
  _createFieldsFormattedAttributes({ contentElement: e16, contentElementIndex: t11, formattedAttributes: i12 }) {
    if (e16.fieldInfos) {
      const { graphic: r8, relatedInfos: o7, _sourceLayer: s17, _fieldInfoMap: n18, _graphicExpressionAttributes: a10, timeZone: l14 } = this;
      i12.content[t11] = ue({ fieldInfos: e16.fieldInfos, graphic: r8, attributes: { ...a10, ...e16.attributes }, layer: s17, fieldInfoMap: n18, relatedInfos: o7, timeZone: l14 });
    }
  }
  _createFormattedAttributes(e16) {
    const { _effectivePopupTemplate: t11, graphic: i12, relatedInfos: r8, _sourceLayer: o7, _fieldInfoMap: s17, _graphicExpressionAttributes: n18, timeZone: a10 } = this, l14 = t11 == null ? void 0 : t11.fieldInfos, p14 = { global: ue({ fieldInfos: l14, graphic: i12, attributes: n18, layer: o7, fieldInfoMap: s17, relatedInfos: r8, timeZone: a10 }), content: [] };
    return Array.isArray(e16) && e16.forEach((e17, t12) => {
      "fields" === e17.type && this._createFieldsFormattedAttributes({ contentElement: e17, contentElementIndex: t12, formattedAttributes: p14 }), "media" === e17.type && this._createMediaFormattedAttributes({ contentElement: e17, contentElementIndex: t12, formattedAttributes: p14 });
    }), p14;
  }
  _checkForRelatedFeatures(e16) {
    const { graphic: t11, _effectivePopupTemplate: i12 } = this;
    return this._queryRelatedInfos(t11, ie(i12), e16);
  }
  async _queryRelatedInfos(e16, t11, i12) {
    const { relatedInfos: r8, _sourceLayer: o7 } = this;
    r8.clear();
    const s17 = null != (o7 == null ? void 0 : o7.associatedLayer) ? await (o7 == null ? void 0 : o7.associatedLayer.load(i12)) : o7;
    if (!s17 || !e16) return;
    const n18 = t11.filter((e17) => !!e17.fieldName && de(e17.fieldName));
    if (!(n18 == null ? void 0 : n18.length)) return;
    t11.forEach((e17) => this._configureRelatedInfo(e17, s17));
    const a10 = await N5({ relatedInfos: r8, layer: s17 }, i12);
    Object.keys(a10).forEach((e17) => {
      var _a;
      const t12 = r8.get(e17.toString()), i13 = (_a = a10[e17]) == null ? void 0 : _a.value;
      t12 && i13 && (t12.layerInfo = i13.data);
    });
    const l14 = await T6({ graphic: e16, relatedInfos: r8, layer: s17 }, i12);
    Object.keys(l14).forEach((e17) => {
      var _a;
      I5((_a = l14[e17]) == null ? void 0 : _a.value, r8.get(e17.toString()));
    });
  }
  _configureRelatedInfo(e16, t11) {
    const { relatedInfos: i12 } = this, r8 = y4(e16.fieldName || "");
    if (!r8) return;
    const { layerId: o7, fieldName: s17 } = r8;
    if (!o7) return;
    const n18 = i12.get(o7.toString()) || F4(o7, t11);
    n18 && (q2({ relatedInfo: n18, fieldName: s17, fieldInfo: e16 }), this.relatedInfos.set(o7, n18));
  }
};
X2.interceptor = new e11(be2, Ie), e([y()], X2.prototype, "_error", void 0), e([y()], X2.prototype, "_featureAbortController", void 0), e([y({ readOnly: true })], X2.prototype, "_effectivePopupTemplate", null), e([y({ readOnly: true })], X2.prototype, "_fieldInfoMap", null), e([y({ readOnly: true })], X2.prototype, "_sourceLayer", null), e([y()], X2.prototype, "abilities", void 0), e([s6("abilities")], X2.prototype, "castAbilities", null), e([y({ readOnly: true })], X2.prototype, "content", void 0), e([y({ readOnly: true })], X2.prototype, "contentViewModels", void 0), e([y()], X2.prototype, "description", void 0), e([y({ type: Boolean })], X2.prototype, "defaultPopupTemplateEnabled", void 0), e([y({ readOnly: true })], X2.prototype, "isTable", null), e([y({ readOnly: true })], X2.prototype, "state", null), e([y({ readOnly: true })], X2.prototype, "formattedAttributes", void 0), e([y({ type: d5, value: null })], X2.prototype, "graphic", null), e([y({ readOnly: true })], X2.prototype, "lastEditInfo", void 0), e([y({ type: _ })], X2.prototype, "location", void 0), e([y({ readOnly: true })], X2.prototype, "relatedInfos", void 0), e([y()], X2.prototype, "spatialReference", null), e([y()], X2.prototype, "timeZone", null), e([y({ readOnly: true })], X2.prototype, "title", void 0), e([y()], X2.prototype, "map", null), e([y({ readOnly: true })], X2.prototype, "waitingForContent", null), e([y()], X2.prototype, "view", void 0), X2 = G2 = e([a("esri.widgets.Feature.FeatureViewModel")], X2);
var Y3 = X2;

// ../node_modules/@arcgis/core/widgets/Feature/resources.js
var e12 = "esri-feature";
var t6 = { base: e12, container: `${e12}__size-container`, title: `${e12}__title`, main: `${e12}__main-container`, btn: `${e12}__button`, icon: `${e12}__icon`, content: `${e12}__content`, contentNode: `${e12}__content-node`, contentNodeText: `${e12}__content-node--text`, contentElement: `${e12}__content-element`, text: `${e12}__text`, lastEditedInfo: `${e12}__last-edited-info`, fields: `${e12}__fields`, fieldHeader: `${e12}__field-header`, fieldData: `${e12}__field-data`, fieldDataDate: `${e12}__field-data--date`, loadingSpinnerContainer: `${e12}__loading-container` };

// ../node_modules/@arcgis/core/widgets/Feature/support/FeatureContentMixin.js
var n14 = (n18) => {
  let i12 = class extends n18 {
    constructor() {
      super(...arguments), this.renderNodeContent = (e16) => e10(e16) && !e16.destroyed ? n2("div", { class: t6.contentNode, key: e16 }, e16.render()) : e16 instanceof HTMLElement ? n2("div", { afterCreate: this._attachToNode, bind: e16, class: t6.contentNode, key: e16 }) : t4(e16) ? n2("div", { afterCreate: this._attachToNode, bind: e16.domNode, class: t6.contentNode, key: e16 }) : null;
    }
    _attachToNode(e16) {
      const o7 = this;
      e16.appendChild(o7);
    }
  };
  return i12 = e([a("esri.widgets.Feature.support.FeatureContentMixin")], i12), i12;
};

// ../node_modules/@arcgis/core/widgets/Feature.js
var b8;
var j8 = { title: true, content: true, lastEditedInfo: true };
var C5 = "relationship-handles";
var F8 = b8 = class extends n14(B) {
  constructor(e16, t11) {
    super(e16, t11), this._contentWidgets = [], this.flowItems = null, this.headingLevel = 2, this.messages = null, this.messagesCommon = null, this.visibleElements = { ...j8 }, this.viewModel = new Y3();
  }
  initialize() {
    this.addHandles(d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.contentViewModels;
    }, () => this._setupContentWidgets(), P));
  }
  loadDependencies() {
    return r3({ notice: () => import("./calcite-notice-NY6XLCNV.js"), loader: () => import("./calcite-loader-3OF54TOV.js") });
  }
  destroy() {
    this._destroyContentWidgets();
  }
  get graphic() {
    return this.viewModel.graphic;
  }
  set graphic(e16) {
    this.viewModel.graphic = e16;
  }
  get defaultPopupTemplateEnabled() {
    return this.viewModel.defaultPopupTemplateEnabled;
  }
  set defaultPopupTemplateEnabled(e16) {
    this.viewModel.defaultPopupTemplateEnabled = e16;
  }
  get isTable() {
    return this.viewModel.isTable;
  }
  get icon() {
    return "polygon";
  }
  set icon(e16) {
    this._overrideIfSome("icon", e16);
  }
  get label() {
    var _a;
    return ((_a = this.messages) == null ? void 0 : _a.widgetLabel) ?? "";
  }
  set label(e16) {
    this._overrideIfSome("label", e16);
  }
  get spatialReference() {
    return this.viewModel.spatialReference;
  }
  set spatialReference(e16) {
    this.viewModel.spatialReference = e16;
  }
  get timeZone() {
    return this.viewModel.timeZone;
  }
  set timeZone(e16) {
    this.viewModel.timeZone = e16;
  }
  get title() {
    return this.viewModel.title;
  }
  castVisibleElements(e16) {
    return { ...j8, ...e16 };
  }
  get map() {
    return this.viewModel.map;
  }
  set map(e16) {
    this.viewModel.map = e16;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e16) {
    this.viewModel.view = e16;
  }
  setActiveMedia(e16, t11) {
    return this.viewModel.setActiveMedia(e16, t11);
  }
  nextMedia(e16) {
    return this.viewModel.nextMedia(e16);
  }
  previousMedia(e16) {
    return this.viewModel.previousMedia(e16);
  }
  render() {
    const { state: e16 } = this.viewModel, t11 = n2("div", { class: t6.container, key: "container" }, this._renderTitle(), "error" === e16 ? this._renderError() : "loading" === e16 ? this._renderLoading() : this._renderContentContainer());
    return n2("div", { class: this.classes(t6.base, e4.widget) }, t11);
  }
  _renderError() {
    const { messagesCommon: e16, messages: t11, visibleElements: s17 } = this;
    return n2("calcite-notice", { icon: "exclamation-mark-circle", kind: "danger", open: true, scale: "s" }, s17.title ? n2("div", { key: "error-title", slot: "title" }, e16.errorMessage) : null, n2("div", { key: "error-message", slot: "message" }, t11.loadingError));
  }
  _renderLoading() {
    return n2("div", { class: t6.loadingSpinnerContainer, key: "loading-container" }, n2("calcite-loader", { inline: true, label: "" }));
  }
  _renderContentContainer() {
    const { visibleElements: e16 } = this;
    return e16.content ? n2("div", { class: t6.main }, [this._renderContent(), this._renderLastEditInfo()]) : null;
  }
  _renderTitle() {
    const { visibleElements: e16, title: t11 } = this;
    return e16.title ? n2(e8, { class: t6.title, innerHTML: t11, level: this.headingLevel }) : null;
  }
  _renderContent() {
    const e16 = this.viewModel.content, t11 = "content";
    if (!e16) return null;
    if (Array.isArray(e16)) return e16.length ? n2("div", { class: t6.contentNode, key: `${t11}-content-elements` }, e16.map(this._renderContentElement, this)) : null;
    if ("string" == typeof e16) {
      const e17 = this._contentWidgets[0];
      return !e17 || e17.destroyed ? null : n2("div", { class: this.classes(t6.contentNode, t6.contentNodeText), key: `${t11}-content` }, e17.render());
    }
    return this.renderNodeContent(e16);
  }
  _renderContentElement(e16, t11) {
    var _a;
    const { visibleElements: s17 } = this;
    if ("boolean" != typeof s17.content && !((_a = s17.content) == null ? void 0 : _a[e16.type])) return null;
    switch (e16.type) {
      case "attachments":
        return this._renderAttachments(t11);
      case "custom":
        return this._renderCustom(e16, t11);
      case "fields":
        return this._renderFields(t11);
      case "media":
        return this._renderMedia(t11);
      case "text":
        return this._renderText(e16, t11);
      case "expression":
        return this._renderExpression(t11);
      case "relationship":
        return this._renderRelationship(t11);
      default:
        return null;
    }
  }
  _renderAttachments(e16) {
    const t11 = this._contentWidgets[e16];
    if (!t11 || t11.destroyed) return null;
    const { state: s17, attachmentInfos: i12 } = t11.viewModel;
    return "loading" === s17 || i12.length > 0 ? n2("div", { class: this.classes(t6.contentElement), key: this._buildKey("attachments-element", e16) }, t11.render()) : null;
  }
  _renderRelationship(e16) {
    const t11 = this._contentWidgets[e16];
    return t11 && !t11.destroyed && this.flowItems ? n2("div", { class: t6.contentElement, key: this._buildKey("relationship-element", e16) }, t11.render()) : null;
  }
  _renderExpression(e16) {
    const t11 = this._contentWidgets[e16];
    return !t11 || t11.destroyed ? null : n2("div", { class: t6.contentElement, key: this._buildKey("expression-element", e16) }, t11.render());
  }
  _renderCustom(e16, t11) {
    const { creator: s17 } = e16, i12 = this._contentWidgets[t11];
    return !i12 || i12.destroyed ? null : s17 ? n2("div", { class: t6.contentElement, key: this._buildKey("custom-element", t11) }, i12.render()) : null;
  }
  _renderFields(e16) {
    const t11 = this._contentWidgets[e16];
    return !t11 || t11.destroyed ? null : n2("div", { class: t6.contentElement, key: this._buildKey("fields-element", e16) }, t11.render());
  }
  _renderMedia(e16) {
    const t11 = this._contentWidgets[e16];
    return !t11 || t11.destroyed ? null : n2("div", { class: t6.contentElement, key: this._buildKey("media-element", e16) }, t11.render());
  }
  _renderLastEditInfo() {
    const { visibleElements: e16, messages: t11 } = this, { lastEditInfo: s17 } = this.viewModel;
    if (!s17 || !e16.lastEditedInfo) return null;
    const { date: i12, user: n18 } = s17, r8 = "edit" === s17.type ? n18 ? t11.lastEditedByUser : t11.lastEdited : n18 ? t11.lastCreatedByUser : t11.lastCreated, o7 = s4(r8, { date: i12, user: n18 });
    return n2("div", { class: this.classes(t6.lastEditedInfo, t6.contentElement), key: "edit-info-element" }, o7);
  }
  _renderText(e16, t11) {
    const s17 = e16.text, i12 = this._contentWidgets[t11];
    return !i12 || i12.destroyed ? null : s17 ? n2("div", { class: this.classes(t6.contentElement, t6.text), key: this._buildKey("text-element", t11) }, i12.render()) : null;
  }
  _buildKey(e16, ...t11) {
    var _a, _b;
    return `${e16}__${((_b = (_a = this.viewModel) == null ? void 0 : _a.graphic) == null ? void 0 : _b.uid) || "0"}-${t11.join("-")}`;
  }
  _destroyContentWidget(e16) {
    e16 && (e16.viewModel = null, !e16.destroyed && e16.destroy());
  }
  _destroyContentWidgets() {
    this.removeHandles(C5), this._contentWidgets.forEach((e16) => this._destroyContentWidget(e16)), this._contentWidgets = [];
  }
  _addFeatureRelationshipHandles(e16) {
    const { flowItems: t11, visibleElements: i12 } = this;
    this.addHandles([v2(() => e16, "select-record", ({ featureViewModel: e17 }) => {
      t11 && (e17.abilities = { relationshipContent: true }, t11.push(new b8({ flowItems: t11, viewModel: e17, visibleElements: i12 })));
    }), v2(() => e16, "show-all-records", () => {
      if (!t11) return;
      const { viewModel: s17 } = e16;
      s17.showAllEnabled = true;
      const i13 = new I8({ visibleElements: { title: false, description: false }, viewModel: s17 });
      this._addFeatureRelationshipHandles(i13), t11.push(i13);
    })], C5);
  }
  _setupContentWidgets() {
    var _a;
    this._destroyContentWidgets();
    const { headingLevel: e16, visibleElements: t11 } = this, s17 = (_a = this.viewModel) == null ? void 0 : _a.content, { contentViewModels: i12 } = this.viewModel;
    if (Array.isArray(s17)) s17.forEach((s18, n18) => {
      if ("attachments" === s18.type && (this._contentWidgets[n18] = new c7({ displayType: s18.displayType, headingLevel: t11.title && e16 < 6 ? e16 + 1 : e16, viewModel: i12[n18] })), "fields" === s18.type && (this._contentWidgets[n18] = new h7({ viewModel: i12[n18] })), "media" === s18.type && (this._contentWidgets[n18] = new b6({ viewModel: i12[n18] })), "text" === s18.type && (this._contentWidgets[n18] = new p7({ viewModel: i12[n18] })), "custom" === s18.type && (this._contentWidgets[n18] = new p7({ viewModel: i12[n18] })), "expression" === s18.type && (this._contentWidgets[n18] = new h9({ viewModel: i12[n18] })), "relationship" === s18.type) {
        const e17 = new I8({ viewModel: i12[n18] });
        this._addFeatureRelationshipHandles(e17), this._contentWidgets[n18] = e17;
      }
    }, this);
    else {
      const e17 = i12[0];
      e17 && !e17.destroyed && (this._contentWidgets[0] = new p7({ viewModel: e17 }));
    }
    this.scheduleRender();
  }
};
e([y()], F8.prototype, "graphic", null), e([y()], F8.prototype, "defaultPopupTemplateEnabled", null), e([y()], F8.prototype, "flowItems", void 0), e([y()], F8.prototype, "headingLevel", void 0), e([y({ readOnly: true })], F8.prototype, "isTable", null), e([y()], F8.prototype, "icon", null), e([y()], F8.prototype, "label", null), e([y(), e2("esri/widgets/Feature/t9n/Feature")], F8.prototype, "messages", void 0), e([y(), e2("esri/t9n/common")], F8.prototype, "messagesCommon", void 0), e([y()], F8.prototype, "spatialReference", null), e([y()], F8.prototype, "timeZone", null), e([y({ readOnly: true })], F8.prototype, "title", null), e([y()], F8.prototype, "visibleElements", void 0), e([s6("visibleElements")], F8.prototype, "castVisibleElements", null), e([y()], F8.prototype, "map", null), e([y()], F8.prototype, "view", null), e([y({ type: Y3 })], F8.prototype, "viewModel", void 0), F8 = b8 = e([a("esri.widgets.Feature")], F8);
var W3 = F8;

// ../node_modules/@arcgis/core/widgets/support/AnchorElementViewModel.js
var c14 = class extends o.EventedAccessor {
  constructor(e16) {
    super(e16), this.location = null, this.screenLocationEnabled = false, this.view = null, this.addHandles([p(() => {
      const e17 = this.screenLocationEnabled ? this.view : null;
      return e17 ? [e17.size, "3d" === e17.type ? e17.camera : e17.viewpoint] : null;
    }, () => this.notifyChange("screenLocation")), d2(() => this.screenLocation, (e17, o7) => {
      null != e17 && null != o7 && this.emit("view-change");
    })]);
  }
  destroy() {
    this.view = null;
  }
  get screenLocation() {
    const { location: e16, view: o7, screenLocationEnabled: t11 } = this, r8 = o7 == null ? void 0 : o7.spatialReference, s17 = r8 ? V2(e16, r8).geometry : null;
    return t11 && s17 && (o7 == null ? void 0 : o7.ready) ? o7.toScreen(s17) : null;
  }
};
e([y()], c14.prototype, "location", void 0), e([y()], c14.prototype, "screenLocation", null), e([y()], c14.prototype, "screenLocationEnabled", void 0), e([y()], c14.prototype, "view", void 0), c14 = e([a("esri.widgets.support.AnchorElementViewModel")], c14);
var l9 = c14;

// ../node_modules/@arcgis/core/widgets/Spinner/SpinnerViewModel.js
var t7 = class extends l9 {
  constructor(o7) {
    super(o7), this.visible = false;
  }
};
e([y()], t7.prototype, "visible", void 0), t7 = e([a("esri.widgets.Spinner.SpinnerViewModel")], t7);
var p9 = t7;

// ../node_modules/@arcgis/core/widgets/Spinner.js
var a8 = "esri-spinner";
var c15 = { base: a8, spinnerStart: `${a8}--start`, spinnerFinish: `${a8}--finish` };
var p10 = class extends B {
  constructor(i12, e16) {
    super(i12, e16), this._animationDelay = 500, this._animationPromise = null, this.viewModel = new p9();
  }
  initialize() {
    this.addHandles(d2(() => this.visible, (i12) => this._visibleChange(i12)));
  }
  destroy() {
    this._animationPromise = null;
  }
  get location() {
    return this.viewModel.location;
  }
  set location(i12) {
    this.viewModel.location = i12;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(i12) {
    this.viewModel.view = i12;
  }
  get visible() {
    return this.viewModel.visible;
  }
  set visible(i12) {
    this.viewModel.visible = i12;
  }
  show(i12) {
    const { location: e16, promise: t11 } = i12 ?? {};
    e16 && (this.viewModel.location = e16), this.visible = true;
    const s17 = () => this.hide();
    t11 && t11.catch(() => {
    }).then(s17);
  }
  hide() {
    this.visible = false;
  }
  render() {
    const { visible: i12 } = this, { screenLocation: e16 } = this.viewModel, t11 = !!e16, s17 = i12 && t11, o7 = !i12 && t11, r8 = { [c15.spinnerStart]: s17, [c15.spinnerFinish]: o7 }, n18 = this._getPositionStyles();
    return n2("div", { class: this.classes(c15.base, r8), styles: n18 });
  }
  _visibleChange(i12) {
    if (i12) return void (this.viewModel.screenLocationEnabled = true);
    const t11 = A(this._animationDelay);
    this._animationPromise = t11, t11.catch(() => {
    }).then(() => {
      this._animationPromise === t11 && (this.viewModel.screenLocationEnabled = false, this._animationPromise = null);
    });
  }
  _getPositionStyles() {
    const { screenLocation: i12, view: e16 } = this.viewModel;
    if (null == e16 || null == i12) return {};
    const { padding: t11 } = e16;
    return { left: i12.x - t11.left + "px", top: i12.y - t11.top + "px" };
  }
};
e([y()], p10.prototype, "location", null), e([y()], p10.prototype, "view", null), e([y({ type: p9 })], p10.prototype, "viewModel", void 0), e([y()], p10.prototype, "visible", null), p10 = e([a("esri.widgets.Spinner")], p10);
var h11 = p10;

// ../node_modules/@arcgis/core/widgets/Features/css.js
var e13 = "esri-features";
var n15 = { icon: `${e13}__icon`, actionImage: `${e13}__action-image`, base: e13, container: `${e13}__container`, contentContainer: `${e13}__content-container`, contentFeature: `${e13}__content-feature`, flowItemCollapsed: `${e13}__flow-item--collapsed`, header: `${e13}__header`, footer: `${e13}__footer`, featureMenuObserver: `${e13}__feature-menu-observer`, actionExit: `${e13}__action--exit`, loader: `${e13}__loader`, featuresHeading: `${e13}__heading`, paginationActionBar: `${e13}__pagination-action-bar`, paginationPrevious: `${e13}__pagination-previous`, paginationNext: `${e13}__pagination-next` };

// ../node_modules/@arcgis/core/widgets/Features/FeaturesRelatedRecords.js
var n16 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this.messages = null, this.closed = false, this.closable = true, this._handleOpenRelatedFeature = (e17) => {
      this.emit("open-related-feature", { feature: e17 });
    };
  }
  loadDependencies() {
    return r3({ action: () => import("./calcite-action-XVSOVITL.js"), "flow-item": () => import("./calcite-flow-item-LVS7Y4RB.js") });
  }
  render() {
    const { flowItems: e16 } = this, t11 = e16 == null ? void 0 : e16.toArray();
    return n2(i4, null, t11 == null ? void 0 : t11.map((e17) => this._renderRelatedRecordsFlowItem(e17)));
  }
  _handleCloseClick() {
    this.emit("close");
  }
  _handleExitClick() {
    this.emit("exit");
  }
  _handleRelatedRecordsBackClick() {
    var _a;
    const e16 = (_a = this.flowItems) == null ? void 0 : _a.pop();
    e16 && ("showAllEnabled" in e16.viewModel && (e16.viewModel.showAllEnabled = false), e16 && (e16.viewModel = null, e16.destroy()));
  }
  _renderRelatedRecordsFlowItem(e16) {
    var _a;
    const { messages: t11, closable: o7, closed: s17 } = this, r8 = "graphic" in e16 && !e16.isTable && ((_a = e16.graphic) == null ? void 0 : _a.geometry), l14 = t11.exitRelatedRecords, a10 = t11.selectFeature;
    return n2("calcite-flow-item", { bind: this, closable: o7, closed: s17, description: this._getRelatedRecordsFlowItemDescription(e16), heading: e16.title ?? "", key: `flow-item-${e16.viewModel.uid}`, onCalciteFlowItemBack: (e17) => {
      e17.preventDefault(), this._handleRelatedRecordsBackClick();
    }, onCalciteFlowItemClose: this._handleCloseClick }, n2("calcite-action", { appearance: "transparent", bind: this, class: n15.actionExit, icon: "move-up", key: "exit-related-records-action", onclick: this._handleExitClick, slot: "header-actions-start", text: l14, title: l14 }), r8 ? n2("calcite-action", { appearance: "transparent", bind: this, icon: "zoom-to-object", key: "open-related-feature-action", onclick: () => this._handleOpenRelatedFeature(e16), slot: "header-actions-end", text: a10, title: a10 }) : null, n2("div", { class: n15.container }, e16.render()));
  }
  _getRelatedRecordsFlowItemDescription(e16) {
    return "featureCountDescription" in e16 ? e16.featureCountDescription : e16.viewModel.description ?? "";
  }
};
e([y()], n16.prototype, "flowItems", void 0), e([y(), e2("esri/widgets/Features/t9n/Features")], n16.prototype, "messages", void 0), e([y()], n16.prototype, "closed", void 0), e([y()], n16.prototype, "closable", void 0), n16 = e([a("esri.widgets.Features.FeaturesRelatedRecords")], n16);
var d10 = n16;

// ../node_modules/@arcgis/core/core/ReactiveSet.js
var s13 = class {
  constructor(t11) {
    this._observable = new s5(), this._set = new Set(t11);
  }
  get size() {
    return s3(this._observable), this._set.size;
  }
  add(t11) {
    const e16 = this._set.size;
    return this._set.add(t11), this._set.size !== e16 && this._observable.notify(), this;
  }
  clear() {
    this._set.size > 0 && (this._set.clear(), this._observable.notify());
  }
  delete(t11) {
    const e16 = this._set.delete(t11);
    return e16 && this._observable.notify(), e16;
  }
  entries() {
    return s3(this._observable), this._set.entries();
  }
  forEach(e16, s17) {
    s3(this._observable), this._set.forEach((t11, r8) => e16.call(s17, t11, r8, this), s17);
  }
  has(e16) {
    return s3(this._observable), this._set.has(e16);
  }
  keys() {
    return s3(this._observable), this._set.keys();
  }
  values() {
    return s3(this._observable), this._set.values();
  }
  [Symbol.iterator]() {
    return s3(this._observable), this._set[Symbol.iterator]();
  }
  get [Symbol.toStringTag]() {
    return this._set[Symbol.toStringTag];
  }
};

// ../node_modules/@arcgis/core/layers/LayerConstants.js
var o5 = "OBJECTID";

// ../node_modules/@arcgis/core/widgets/Legend/styles/support/relationshipUtils.js
var b9 = "esri-relationship-ramp";
var u7 = `${b9}--diamond`;
var c16 = `${b9}--square`;
var p11 = { diamondContainer: `${u7}__container`, diamondLeftCol: `${u7}__left-column`, diamondRightCol: `${u7}__right-column`, diamondMidCol: `${u7}__middle-column`, diamondMidColLabel: `${u7}__middle-column--label`, diamondMidColRamp: `${u7}__middle-column--ramp`, squareTable: `${c16}__table`, squareTableRow: `${c16}__table-row`, squareTableCell: `${c16}__table-cell`, squareTableLabel: `${c16}__table-label`, squareTableLabelLeftBottom: `${c16}__table-label--left-bottom`, squareTableLabelRightBottom: `${c16}__table-label--right-bottom`, squareTableLabelLeftTop: `${c16}__table-label--left-top`, squareTableLabelRightTop: `${c16}__table-label--right-top` };

// ../node_modules/@arcgis/core/symbols/support/symbolUtils.js
function k5(e16) {
  return e16 && "opacity" in e16 ? e16.opacity * k5(e16.parent) : 1;
}
async function L4(t11, l14) {
  var _a;
  if (!t11) return;
  const a10 = t11.sourceLayer, i12 = (null != l14 && l14.useSourceLayer ? a10 : t11.layer) ?? a10, s17 = k5(i12);
  if (null != t11.symbol && (null == l14 || true !== l14.ignoreGraphicSymbol)) {
    const e16 = "web-style" === t11.symbol.type ? await N3(t11.symbol, { ...l14, cache: null != l14 ? l14.webStyleCache : null }) : t11.symbol.clone();
    return g3(e16, null, s17), e16;
  }
  const u10 = (l14 == null ? void 0 : l14.renderer) ?? C6(i12);
  let f10 = u10 && "getSymbolAsync" in u10 ? await u10.getSymbolAsync(t11, l14) : null;
  if (!f10) return;
  if (f10 = "web-style" === f10.type ? await f10.fetchSymbol({ ...l14, cache: null != l14 ? l14.webStyleCache : null }) : f10.clone(), !u10 || !("visualVariables" in u10) || !((_a = u10.visualVariables) == null ? void 0 : _a.length)) return g3(f10, null, s17), f10;
  if ("arcadeRequiredForVisualVariables" in u10 && u10.arcadeRequiredForVisualVariables && null == (l14 == null ? void 0 : l14.arcade)) {
    const t12 = { ...l14 };
    t12.arcade = await i8(), l14 = t12;
  }
  const { getColor: p14, getOpacity: h14, getAllSizes: y10, getRotationAngle: d12 } = await import("./visualVariableUtils-UXXQJZUU.js"), m12 = [], b10 = [], g11 = [], w13 = [];
  for (const e16 of u10.visualVariables) switch (e16.type) {
    case "color":
      m12.push(e16);
      break;
    case "opacity":
      b10.push(e16);
      break;
    case "rotation":
      w13.push(e16);
      break;
    case "size":
      e16.target || g11.push(e16);
  }
  const v12 = !!m12.length && m12[m12.length - 1], S5 = v12 ? p14(v12, t11, l14) : null, V4 = !!b10.length && b10[b10.length - 1];
  let L6 = V4 ? h14(V4, t11, l14) : null;
  if (null != s17 && (L6 = null != L6 ? L6 * s17 : s17), g3(f10, S5, L6), g11.length) {
    const e16 = y10(g11, t11, l14);
    await R(f10, e16);
  }
  for (const e16 of w13) D2(f10, d12(e16, t11, l14), e16.axis);
  return f10;
}
function C6(e16) {
  if (e16) return "renderer" in e16 ? e16.renderer : void 0;
}

// ../node_modules/@arcgis/core/widgets/Popup/actions.js
var i11 = V.ofType({ key: "type", defaultKeyValue: "button", base: p3, typeMap: { button: c4, toggle: a3 } });
var n17 = new c4({ icon: "magnifying-glass-plus", id: "zoom-to-feature", title: "{messages.zoom}", className: i9.zoomInMagnifyingGlass });
var r7 = new c4({ icon: "trash", id: "remove-selected-feature", title: "{messages.remove}", className: i9.trash });
var l11 = new c4({ icon: "magnifying-glass-plus", id: "zoom-to-clustered-features", title: "{messages.zoom}", className: i9.zoomInMagnifyingGlass });
var m10 = new a3({ icon: "table", id: "browse-clustered-features", title: "{messages.browseClusteredFeatures}", className: i9.table, value: false });

// ../node_modules/@arcgis/core/widgets/Popup/actionUtils.js
var s14 = "esri.widgets.Popup.PopupViewModel";
var c17 = () => n.getLogger(s14);
var u9 = (t11) => {
  const { event: s17, view: c18, viewModel: u10 } = t11, { action: l14 } = s17;
  if (!l14) return Promise.reject(new s2("trigger-action:missing-arguments", "Event has no action"));
  const { disabled: d12, id: g11 } = l14;
  if (!g11) return Promise.reject(new s2("trigger-action:invalid-action", "action.id is missing"));
  if (d12) return Promise.reject(new s2("trigger-action:invalid-action", "Action is disabled"));
  if (g11 === n17.id) return w12(u10).catch(f);
  if (g11 === l11.id) return f9(u10);
  if (g11 === m10.id) return u10.browseClusterEnabled = !u10.browseClusterEnabled, u10.featureMenuOpen = u10.browseClusterEnabled, Promise.resolve();
  if (g11 === r7.id) {
    u10.visible = false;
    const { selectedFeature: t12 } = u10;
    if (!t12) return Promise.reject(new s2(`trigger-action:${r7.id}`, "selectedFeature is required", { selectedFeature: t12 }));
    const { sourceLayer: r8 } = t12;
    return r8 ? r8.remove(t12) : c18 == null ? void 0 : c18.graphics.remove(t12), Promise.resolve();
  }
  return Promise.resolve();
};
function l12(e16) {
  const { selectedFeature: t11, location: r8, view: o7 } = e16;
  return o7 ? t11 ?? r8 ?? null : null;
}
function d11(e16) {
  var _a, _b;
  return !!e16 && e16.isAggregate && "cluster" === ((_b = (_a = e16.sourceLayer) == null ? void 0 : _a.featureReduction) == null ? void 0 : _b.type);
}
async function g10(e16, t11) {
  if ("3d" !== (t11 == null ? void 0 : t11.type) || !e16 || "esri.Graphic" !== e16.declaredClass) return true;
  const r8 = t11.getViewForGraphic(e16);
  if (r8 && "whenGraphicBounds" in r8) {
    let t12 = null;
    try {
      t12 = await r8.whenGraphicBounds(e16, { useViewElevation: true });
    } catch (o7) {
    }
    return !t12 || !t12.boundingBox || t12.boundingBox[0] === t12.boundingBox[3] && t12.boundingBox[1] === t12.boundingBox[4] && t12.boundingBox[2] === t12.boundingBox[5];
  }
  return true;
}
async function w12(t11) {
  var _a;
  const { location: r8, selectedFeature: i12, view: n18, zoomFactor: a10 } = t11, s17 = l12(t11);
  if (!n18 || !s17) {
    const t12 = new s2("zoom-to:invalid-target-or-view", "Cannot zoom to location without a target and view.", { target: s17, view: n18 });
    throw c17().error(t12), t12;
  }
  const u10 = n18.scale / a10, d12 = (_a = t11.selectedFeature) == null ? void 0 : _a.geometry, w13 = d12 ?? r8, f10 = null != w13 && "point" === w13.type && await g10(i12, n18);
  n17.active = true, n17.disabled = true;
  try {
    await t11.zoomTo({ target: { target: s17, scale: f10 ? u10 : void 0 } });
  } catch (v12) {
    const t12 = new s2("zoom-to:invalid-graphic", "Could not zoom to the location of the graphic.", { graphic: i12 });
    c17().error(t12);
  } finally {
    n17.active = false, n17.disabled = false, t11.zoomToLocation = null, f10 && (t11.location = w13);
  }
}
async function f9(t11) {
  const { selectedFeature: r8, view: o7 } = t11;
  if ("2d" !== (o7 == null ? void 0 : o7.type)) {
    const t12 = new s2("zoomToCluster:invalid-view", "View must be 2d MapView.", { view: o7 });
    throw c17().error(t12), t12;
  }
  if (!r8 || !d11(r8)) {
    const t12 = new s2("zoomToCluster:invalid-selectedFeature", "Selected feature must represent an aggregate/cluster graphic.", { selectedFeature: r8 });
    throw c17().error(t12), t12;
  }
  const [n18, a10] = await p12(o7, r8);
  l11.active = true, l11.disabled = true;
  const { extent: s17 } = await n18.queryExtent(a10);
  s17 && await t11.zoomTo({ target: s17 }), l11.active = false, l11.disabled = false;
}
async function v11(e16) {
  const { view: t11, selectedFeature: r8 } = e16;
  if (!t11 || !r8) return;
  const [o7, i12] = await p12(t11, r8), { extent: n18 } = await o7.queryExtent(i12);
  e16.selectedClusterBoundaryFeature.geometry = n18, t11.graphics.add(e16.selectedClusterBoundaryFeature);
}
async function m11(e16) {
  const { selectedFeature: t11, view: r8 } = e16;
  if (!r8 || !t11) return;
  const [o7, i12] = await p12(r8, t11);
  m10.active = true, m10.disabled = true;
  const { features: a10 } = await o7.queryFeatures(i12);
  m10.active = false, m10.disabled = false, m10.value = true, e16 == null ? void 0 : e16.open({ features: [t11].concat(a10), featureMenuOpen: true });
}
async function p12(e16, t11) {
  const r8 = await e16.whenLayerView(t11.sourceLayer), o7 = r8.createQuery(), i12 = t11.getObjectId();
  return o7.aggregateIds = null != i12 ? [i12] : [], [r8, o7];
}
function y9(e16) {
  m10.value = false;
  const t11 = e16.features.filter((e17) => d11(e17));
  t11.length && (e16.features = t11);
}

// ../node_modules/@arcgis/core/widgets/Features/FeaturesViewModel.js
var H2 = "location-scale-handle";
var B3 = () => [n17.clone()];
var U5 = () => [l11.clone(), m10.clone()];
var G3 = null;
function Z3(e16, t11) {
  return "building-scene" === e16 || "2d" === t11 && ("map-image" === e16 || "tile" === e16 || "imagery" === e16 || "imagery-tile" === e16);
}
var z3 = class extends t(l9) {
  constructor(e16) {
    super(e16), this._pendingPromises = new s13(), this._fetchFeaturesController = null, this._highlightSelectedFeaturePromise = null, this._highlightActiveFeaturePromise = null, this._selectedClusterFeature = null, this.actions = new i11(), this.activeFeature = null, this.autoCloseEnabled = false, this.browseClusterEnabled = false, this.content = null, this.defaultPopupTemplateEnabled = false, this.featurePage = null, this.featuresPerPage = 20, this.featureMenuOpen = false, this.featureViewModelAbilities = null, this.featureViewModels = [], this.highlightEnabled = true, this.includeDefaultActions = true, this.selectedClusterBoundaryFeature = new d5({ symbol: new S2({ outline: { width: 1.5, color: "cyan" }, style: "none" }) }), this.title = null, this.updateLocationEnabled = false, this.view = null, this.visible = false, this.zoomFactor = 4, this.zoomToLocation = null, this._debouncedLocationUpdate = k(async (e17) => {
      var _a, _b, _c, _d;
      const { spatialReference: t11 } = this, i12 = (_b = (_a = this.selectedFeature) == null ? void 0 : _a.geometry) == null ? void 0 : _b.type, s17 = this.location ?? e17;
      if (i12 && "mesh" !== i12 && t11 && s17 && this.selectedFeature) if ("point" !== i12) try {
        const e18 = this.selectedFeature;
        let i13 = e18.geometry;
        const r8 = this._getHighlightLayer(e18), o7 = e18.getObjectId();
        if (!r8 || !this.view) return;
        if (o7) {
          const e19 = (_c = this.view) == null ? void 0 : _c.allLayerViews.find((e20) => e20.layer.uid === r8.uid);
          if (!e19 || !("queryFeatures" in e19)) return;
          const s18 = e19.createQuery();
          s18.outSpatialReference = t11, s18.objectIds = [o7], s18.returnGeometry = true;
          const { features: a10 } = await e19.queryFeatures(s18);
          i13 = (_d = a10[0]) == null ? void 0 : _d.geometry;
        }
        if (!i13 || "mesh" === i13.type) return;
        if (i13 = K(i13, t11), G3 || (G3 = await import("./geometryEngineAsync-4DGQNTG2.js")), !await G3.intersects(i13, s17)) {
          const t12 = (await G3.nearestCoordinate(i13, s17)).coordinate ?? s17;
          this.selectedFeature === e18 && (this.location = t12);
        }
      } catch (o7) {
        b(o7) || n.getLogger(this).error(o7);
      }
      else this.location = n6(this.selectedFeature.geometry) ?? s17;
    });
  }
  initialize() {
    this.addHandles([this.on("view-change", () => this._autoClose()), d2(() => [this.highlightEnabled, this.selectedFeature, this.visible, this.view], () => this._highlightSelectedFeature()), d2(() => [this.highlightEnabled, this.activeFeature, this.visible, this.view], () => this._highlightActiveFeature()), d2(() => {
      var _a, _b;
      return (_b = (_a = this.view) == null ? void 0 : _a.animation) == null ? void 0 : _b.state;
    }, (e16) => this._animationStateChange(e16)), d2(() => this.location, (e16) => this._locationChange(e16)), d2(() => this.selectedFeature, (e16) => this._selectedFeatureChange(e16)), d2(() => [this.selectedFeatureIndex, this.featureCount, this.featuresPerPage], () => this._selectedFeatureIndexChange()), d2(() => [this.featurePage, this.selectedFeatureIndex, this.featureCount, this.featuresPerPage, this.featureViewModels], () => this._setGraphicOnFeatureViewModels()), d2(() => this.featureViewModels, () => this._featureViewModelsChange()), this.on("trigger-action", (e16) => u9({ event: e16, viewModel: this, view: this.view })), p(() => !this.waitingForResult, () => this._waitingForResultChange(), C), d2(() => [this.features, this.map, this.spatialReference, this.timeZone], () => this._updateFeatureVMs()), d2(() => {
      var _a;
      return (_a = this.view) == null ? void 0 : _a.scale;
    }, () => this._viewScaleChange()), p(() => !this.visible, () => this.browseClusterEnabled = false), d2(() => this.browseClusterEnabled, (e16) => e16 ? this.enableClusterBrowsing() : this.disableClusterBrowsing())]);
  }
  destroy() {
    this._cancelFetchingFeatures(), this._pendingPromises.clear(), this.browseClusterEnabled = false, this.view = null, this.map = null, this.spatialReference = null, this.timeZone = null;
  }
  get active() {
    return !(!this.visible || this.waitingForResult);
  }
  get allActions() {
    const e16 = this._get("allActions") || new i11();
    e16.removeAll();
    const { actions: t11, defaultActions: i12, defaultPopupTemplateEnabled: s17, includeDefaultActions: r8, selectedFeature: o7 } = this, a10 = r8 ? i12.concat(t11) : t11, n18 = o7 && ("function" == typeof o7.getEffectivePopupTemplate && o7.getEffectivePopupTemplate(s17) || o7.popupTemplate), l14 = n18 == null ? void 0 : n18.actions, u10 = (n18 == null ? void 0 : n18.overwriteActions) ? l14 : (l14 == null ? void 0 : l14.concat(a10)) ?? a10;
    return u10 == null ? void 0 : u10.filter(Boolean).forEach((t12) => e16.add(t12)), e16;
  }
  get defaultActions() {
    const e16 = this._get("defaultActions") || new i11();
    return e16.removeAll(), e16.addMany(d11(this.selectedFeature) ? U5() : B3()), e16;
  }
  get featureCount() {
    return this.features.length;
  }
  set features(e16) {
    const t11 = e16 || [];
    this._set("features", t11);
    const { pendingPromisesCount: i12, promiseCount: s17, selectedFeatureIndex: r8 } = this, o7 = s17 && t11.length;
    o7 && i12 && -1 === r8 ? this.selectedFeatureIndex = 0 : o7 && -1 !== r8 || (this.selectedFeatureIndex = t11.length ? 0 : -1);
  }
  set location(e16) {
    var _a, _b;
    let t11 = e16;
    const i12 = (_a = this.spatialReference) == null ? void 0 : _a.isWebMercator, s17 = (_b = e16 == null ? void 0 : e16.spatialReference) == null ? void 0 : _b.isWGS84;
    s17 && i12 && (t11 = d3(e16)), this._set("location", t11);
  }
  get map() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.map) ?? null;
  }
  set map(e16) {
    this._override("map", e16);
  }
  get pendingPromisesCount() {
    return this._pendingPromises.size;
  }
  get promiseCount() {
    return this.promises.length;
  }
  get promises() {
    return this._get("promises") || [];
  }
  set promises(e16) {
    this._pendingPromises.clear(), this.features = [], Array.isArray(e16) && e16.length ? (this._set("promises", e16), (e16 = e16.slice(0)).forEach((e17) => this._pendingPromises.add(e17)), e16.reduce((e17, t11) => e17.finally(() => t11.then((e18) => {
      this._pendingPromises.has(t11) && this._updateFeatures(e18);
    }).finally(() => this._pendingPromises.delete(t11)).catch(() => {
    })), Promise.resolve())) : this._set("promises", []);
  }
  get selectedFeature() {
    const { features: e16, selectedFeatureIndex: t11 } = this;
    if (-1 === t11) return null;
    return e16[t11] || null;
  }
  get selectedFeatureIndex() {
    const e16 = this._get("selectedFeatureIndex");
    return "number" == typeof e16 ? e16 : -1;
  }
  set selectedFeatureIndex(e16) {
    const { featureCount: t11 } = this;
    e16 = isNaN(e16) || e16 < -1 || !t11 ? -1 : (e16 + t11) % t11, this.activeFeature = null, this._set("selectedFeatureIndex", e16);
  }
  get selectedFeatureViewModel() {
    return this.featureViewModels[this.selectedFeatureIndex] || null;
  }
  get spatialReference() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.spatialReference) ?? null;
  }
  set spatialReference(e16) {
    this._override("spatialReference", e16);
  }
  get state() {
    const { view: e16, map: t11 } = this;
    return e16 ? e16.ready ? "ready" : "disabled" : t11 ? "ready" : "disabled";
  }
  get timeZone() {
    var _a;
    return ((_a = this.view) == null ? void 0 : _a.timeZone) ?? o2;
  }
  set timeZone(e16) {
    this._overrideIfSome("timeZone", e16);
  }
  get waitingForContents() {
    return this.featureViewModels.some((e16) => e16.waitingForContent);
  }
  get waitingForResult() {
    return !(!(!!this._fetchFeaturesController || this.pendingPromisesCount > 0) || 0 !== this.featureCount);
  }
  centerAtLocation() {
    const { view: e16 } = this, t11 = l12(this);
    return t11 && e16 ? this.callGoTo({ target: { target: t11, scale: e16.scale } }) : Promise.reject(new s2("center-at-location:invalid-target-or-view", "Cannot center at a location without a target and view.", { target: t11, view: e16 }));
  }
  zoomTo(e16) {
    return this.callGoTo(e16);
  }
  clear() {
    this.set({ promises: [], features: [], content: null, title: null, location: null, activeFeature: null });
  }
  fetchFeatures(e16, t11) {
    var _a;
    const { view: i12 } = this;
    if (!i12 || !e16) throw new s2("fetch-features:invalid-screenpoint-or-view", "Cannot fetch features without a screenPoint and view.", { screenPoint: e16, view: i12 });
    return i12.fetchPopupFeatures(e16, { pointerType: (_a = t11 == null ? void 0 : t11.event) == null ? void 0 : _a.pointerType, defaultPopupTemplateEnabled: this.defaultPopupTemplateEnabled, signal: t11 == null ? void 0 : t11.signal });
  }
  open(e16) {
    const t11 = { updateLocationEnabled: false, promises: [], fetchFeatures: false, ...e16, visible: true }, { fetchFeatures: i12 } = t11;
    delete t11.fetchFeatures, i12 && this._setFetchFeaturesPromises(t11.location);
    const s17 = ["actionsMenuOpen", "collapsed"];
    for (const r8 of s17) delete t11[r8];
    this.set(t11);
  }
  triggerAction(e16) {
    const t11 = this.allActions.at(e16);
    t11 && !t11.disabled && this.emit("trigger-action", { action: t11 });
  }
  next() {
    return this.selectedFeatureIndex++, this;
  }
  previous() {
    return this.selectedFeatureIndex--, this;
  }
  disableClusterBrowsing() {
    y9(this), this._clearBrowsedClusterGraphics();
  }
  async enableClusterBrowsing() {
    const { view: e16, selectedFeature: t11 } = this;
    "2d" === (e16 == null ? void 0 : e16.type) ? d11(t11) ? (await v11(this), await m11(this)) : n.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.", t11) : n.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.", t11);
  }
  handleViewClick(e16) {
    this._fetchFeaturesAndOpen(e16);
  }
  _animationStateChange(e16) {
    this.zoomToLocation || (n17.disabled = "waiting-for-target" === e16);
  }
  _clearBrowsedClusterGraphics() {
    var _a, _b;
    const e16 = [this.selectedClusterBoundaryFeature, this._selectedClusterFeature].filter(O);
    (_b = (_a = this.view) == null ? void 0 : _a.graphics) == null ? void 0 : _b.removeMany(e16), this._selectedClusterFeature = null, this.selectedClusterBoundaryFeature.geometry = null;
  }
  _viewScaleChange() {
    if (d11(this.selectedFeature)) return this.browseClusterEnabled = false, this.visible = false, void this.clear();
    this.browseClusterEnabled && (this.features = this.selectedFeature ? [this.selectedFeature] : []);
  }
  _locationChange(e16) {
    const { selectedFeature: t11, updateLocationEnabled: i12, view: s17 } = this;
    s17 && i12 && e16 && (!t11 || t11.geometry) && this.centerAtLocation();
  }
  _selectedFeatureIndexChange() {
    this.featurePage = this.featureCount > 1 ? Math.floor(this.selectedFeatureIndex / this.featuresPerPage) + 1 : null;
  }
  _featureViewModelsChange() {
    this.featurePage = this.featureCount > 1 ? 1 : null;
  }
  _setGraphicOnFeatureViewModels() {
    const { features: e16, featureCount: t11, featurePage: i12, featuresPerPage: s17, featureViewModels: r8 } = this;
    if (null === i12) return;
    const o7 = ((i12 - 1) * s17 + t11) % t11, a10 = o7 + s17;
    r8.slice(o7, a10).forEach((t12, i13) => {
      t12 && (t12.graphic ?? (t12.graphic = e16[o7 + i13]));
    });
  }
  async _selectedFeatureChange(e16) {
    var _a, _b;
    const { location: t11, updateLocationEnabled: i12, view: s17 } = this;
    if (!e16 || !s17) return;
    if (this.browseClusterEnabled) {
      if (this._selectedClusterFeature && (s17.graphics.remove(this._selectedClusterFeature), this._selectedClusterFeature = null), d11(e16)) return;
      return e16.symbol = await L4(e16), this._selectedClusterFeature = e16, void s17.graphics.add(this._selectedClusterFeature);
    }
    const r8 = (_a = e16.sourceLayer) == null ? void 0 : _a.type;
    if ("map-image" !== r8 && "imagery" !== r8 && "imagery-tile" !== r8 || (e16.symbol = await L4(e16)), !i12 && t11 || !e16.geometry) {
      if (i12 && !e16.geometry) {
        await this.centerAtLocation();
        const e17 = (_b = s17.center) == null ? void 0 : _b.clone();
        e17 && (this.location = e17);
      }
    } else this.location = n6(e16.geometry);
  }
  _waitingForResultChange() {
    !this.featureCount && this.promises && (this.visible = false);
  }
  async _setFetchFeaturesPromises(e16) {
    const { pendingFeatures: t11 } = await this._fetchFeaturesWithController({ mapPoint: e16 });
    this.promises = t11;
  }
  _destroyFeatureVMs() {
    this.featureViewModels.forEach((e16) => e16 && !e16.destroyed && e16.destroy()), this._set("featureViewModels", []);
  }
  _updateFeatureVMs() {
    const { selectedFeature: e16, features: t11, featureViewModels: i12, view: s17, spatialReference: r8, map: o7, timeZone: a10, location: n18 } = this;
    if (d11(e16) || (this.browseClusterEnabled = false), this._destroyFeatureVMs(), !(t11 == null ? void 0 : t11.length)) return;
    const l14 = i12.slice(0), u10 = [];
    t11.forEach((t12, i13) => {
      if (!t12) return;
      let h14 = null;
      if (l14.some((e17, i14) => (e17 && e17.graphic === t12 && (h14 = e17, l14.splice(i14, 1)), !!h14)), h14) u10[i13] = h14;
      else {
        const l15 = new Y3({ abilities: this.featureViewModelAbilities, defaultPopupTemplateEnabled: this.defaultPopupTemplateEnabled, spatialReference: r8, graphic: t12 === e16 ? t12 : null, location: n18, map: o7, view: s17, timeZone: a10 });
        u10[i13] = l15;
      }
    }), l14.forEach((e17) => e17 && !e17.destroyed && e17.destroy()), this._set("featureViewModels", u10);
  }
  async _getScreenPoint(e16, t11) {
    const { spatialReference: i12, view: s17 } = this;
    if (!s17) return null;
    await (s17 == null ? void 0 : s17.when());
    const r8 = e16 == null ? void 0 : e16.spatialReference;
    return r8 && i12 ? (await N(r8, i12, null, t11), s17.toScreen(e16)) : null;
  }
  _cancelFetchingFeatures() {
    const e16 = this._fetchFeaturesController;
    e16 && e16.abort(), this._fetchFeaturesController = null;
  }
  async _projectScreenPointAndFetchFeatures({ mapPoint: e16, screenPoint: t11, event: i12, signal: s17 }) {
    return this.fetchFeatures(t11 ?? await this._getScreenPoint(e16 ?? this.location, { signal: s17 }), { signal: s17, event: i12 });
  }
  _fetchFeaturesWithController({ mapPoint: e16, screenPoint: t11, event: i12 }) {
    this._cancelFetchingFeatures();
    const s17 = new AbortController(), { signal: r8 } = s17;
    this._fetchFeaturesController = s17;
    const o7 = this._projectScreenPointAndFetchFeatures({ mapPoint: e16, screenPoint: t11, signal: r8, event: i12 });
    return o7.catch(() => {
    }).then(() => {
      this._fetchFeaturesController = null;
    }), o7;
  }
  async _fetchFeaturesAndOpen(e16) {
    const { mapPoint: t11, screenPoint: i12 } = e16, { view: s17 } = this;
    this.removeHandles(H2), this.addHandles([d2(() => {
      var _a;
      return (_a = this.view) == null ? void 0 : _a.scale;
    }, () => this._debouncedLocationUpdate(t11).catch((e17) => {
      b(e17) || n.getLogger(this).error(e17);
    })), p(() => !this.visible, () => {
      this.removeHandles(H2);
    }, { once: true })], H2);
    const { pendingFeatures: o7 } = await this._fetchFeaturesWithController({ mapPoint: t11, screenPoint: i12, event: e16 });
    (s17 == null ? void 0 : s17.popup) && "open" in s17.popup && s17.popup.open({ location: t11 ?? void 0, promises: o7 });
  }
  _autoClose() {
    this.autoCloseEnabled && (this.visible = false);
  }
  async _getLayerView(e16, t11) {
    return await e16.when(), e16.whenLayerView(t11);
  }
  _getHighlightLayer(e16) {
    const { layer: t11, sourceLayer: i12 } = e16;
    return i12 && "layer" in i12 && i12.layer ? i12.layer : "map-notes" === (i12 == null ? void 0 : i12.type) || "subtype-group" === (i12 == null ? void 0 : i12.type) ? i12 : t11;
  }
  _getHighlightTarget(e16, t11, i12) {
    if (Z3(t11.type, i12)) return e16;
    const s17 = e16.getObjectId();
    if (null != s17) return s17;
    const r8 = "imagery" === t11.type ? void 0 : "objectIdField" in t11 ? t11.objectIdField || o5 : null, o7 = e16.attributes;
    return o7 && r8 && o7[r8] || e16;
  }
  _mapIncludesLayer(e16) {
    var _a, _b;
    return !!((_b = (_a = this.map) == null ? void 0 : _a.allLayers) == null ? void 0 : _b.includes(e16));
  }
  async _highlightActiveFeature() {
    const e16 = "highlight-active-feature";
    this.removeHandles(e16);
    const { highlightEnabled: t11, view: i12, activeFeature: s17, visible: r8 } = this;
    if (!(s17 && i12 && t11 && r8)) return;
    const o7 = this._getHighlightLayer(s17);
    if (!(o7 && o7 instanceof f3 && this._mapIncludesLayer(o7))) return;
    const a10 = this._getLayerView(i12, o7);
    this._highlightActiveFeaturePromise = a10;
    const n18 = await a10;
    if (!(n18 && n5(n18) && this._highlightActiveFeaturePromise === a10 && this.activeFeature && this.highlightEnabled)) return;
    const l14 = n18.highlight(this._getHighlightTarget(s17, o7, i12.type));
    this.addHandles(l14, e16);
  }
  async _highlightSelectedFeature() {
    const e16 = "highlight-selected-feature";
    this.removeHandles(e16);
    const { selectedFeature: t11, highlightEnabled: i12, view: s17, visible: r8 } = this;
    if (!(t11 && s17 && i12 && r8)) return;
    const o7 = this._getHighlightLayer(t11);
    if (!(o7 && o7 instanceof f3 && this._mapIncludesLayer(o7))) return;
    const a10 = this._getLayerView(s17, o7);
    this._highlightSelectedFeaturePromise = a10;
    const n18 = await a10;
    if (!(n18 && n5(n18) && this._highlightSelectedFeaturePromise === a10 && this.selectedFeature && this.highlightEnabled && this.visible)) return;
    const l14 = n18.highlight(this._getHighlightTarget(t11, o7, s17.type));
    this.addHandles(l14, e16);
  }
  _updateFeatures(e16) {
    const { features: t11 } = this, i12 = e16.filter((e17) => !t11.includes(e17));
    (i12 == null ? void 0 : i12.length) && (this.features = t11.concat(i12));
  }
};
e([y()], z3.prototype, "_fetchFeaturesController", void 0), e([y({ type: i11 })], z3.prototype, "actions", void 0), e([y({ readOnly: true })], z3.prototype, "active", null), e([y()], z3.prototype, "activeFeature", void 0), e([y({ readOnly: true })], z3.prototype, "allActions", null), e([y()], z3.prototype, "autoCloseEnabled", void 0), e([y()], z3.prototype, "browseClusterEnabled", void 0), e([y()], z3.prototype, "content", void 0), e([y({ type: i11, readOnly: true })], z3.prototype, "defaultActions", null), e([y({ type: Boolean })], z3.prototype, "defaultPopupTemplateEnabled", void 0), e([y({ readOnly: true })], z3.prototype, "featureCount", null), e([y()], z3.prototype, "featurePage", void 0), e([y({ value: [] })], z3.prototype, "features", null), e([y()], z3.prototype, "featuresPerPage", void 0), e([y()], z3.prototype, "featureMenuOpen", void 0), e([y()], z3.prototype, "featureViewModelAbilities", void 0), e([y({ readOnly: true })], z3.prototype, "featureViewModels", void 0), e([y()], z3.prototype, "highlightEnabled", void 0), e([y()], z3.prototype, "includeDefaultActions", void 0), e([y({ type: _ })], z3.prototype, "location", null), e([y()], z3.prototype, "map", null), e([y({ readOnly: true })], z3.prototype, "pendingPromisesCount", null), e([y({ readOnly: true })], z3.prototype, "promiseCount", null), e([y()], z3.prototype, "promises", null), e([y({ readOnly: true })], z3.prototype, "selectedClusterBoundaryFeature", void 0), e([y({ value: null, readOnly: true })], z3.prototype, "selectedFeature", null), e([y({ value: -1 })], z3.prototype, "selectedFeatureIndex", null), e([y({ readOnly: true })], z3.prototype, "selectedFeatureViewModel", null), e([y({ readOnly: true })], z3.prototype, "state", null), e([y()], z3.prototype, "timeZone", null), e([y()], z3.prototype, "title", void 0), e([y()], z3.prototype, "updateLocationEnabled", void 0), e([y()], z3.prototype, "view", void 0), e([y()], z3.prototype, "visible", void 0), e([y({ readOnly: true })], z3.prototype, "waitingForContents", null), e([y({ readOnly: true })], z3.prototype, "waitingForResult", null), e([y()], z3.prototype, "zoomFactor", void 0), e([y()], z3.prototype, "zoomToLocation", void 0), e([y()], z3.prototype, "centerAtLocation", null), z3 = e([a("esri.widgets.Features.FeaturesViewModel")], z3);
var W4 = z3;

// ../node_modules/@arcgis/core/widgets/Features/FeaturesVisibleElements.js
var s15 = class extends S {
  constructor() {
    super(...arguments), this.actionBar = true, this.closeButton = true, this.collapseButton = false, this.featureNavigation = true, this.featureListLayerTitle = true, this.flow = true, this.heading = true, this.spinner = true;
  }
};
e([y({ type: Boolean, nonNullable: true })], s15.prototype, "actionBar", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "closeButton", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "collapseButton", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "featureNavigation", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "featureListLayerTitle", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "flow", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "heading", void 0), e([y({ type: Boolean, nonNullable: true })], s15.prototype, "spinner", void 0), s15 = e([a("esri.widgets.Features.FeaturesVisibleElements")], s15);
var l13 = s15;

// ../node_modules/@arcgis/core/widgets/Features.js
var O5 = "selected-index";
var x4 = 0;
var T10 = "features-spinner";
var j9 = 50;
function k6(e16) {
  return (e16 == null ? void 0 : e16.declaredClass.startsWith("esri.layers.")) ?? false;
}
var E6 = class extends n14(B) {
  constructor(e16, i12) {
    super(e16, i12), this._featureMenuIntersectionObserverCallback = ([e17]) => {
      (e17 == null ? void 0 : e17.isIntersecting) && null != this.viewModel.featurePage && this.viewModel.featurePage++;
    }, this._featureMenuIntersectionObserver = new IntersectionObserver(this._featureMenuIntersectionObserverCallback, { root: window.document }), this._featureMenuIntersectionObserverNode = null, this._focusOn = null, this._spinner = null, this._feature = null, this._relatedRecordsFlowItems = new V(), this._relatedRecordsWidget = new d10({ flowItems: this._relatedRecordsFlowItems }), this._rootFlowItemNode = null, this._featureMenuViewportNode = null, this._actionBarMenuNode = null, this.collapsed = false, this.featureNavigationTop = false, this.headerActions = new i11(), this.headingLevel = 2, this.messages = null, this.messagesCommon = null, this.responsiveActionsEnabled = false, this.viewModel = new W4(), this.visibleElements = new l13(), this._renderAction = (e17, t11) => {
      const i13 = this._getActionTitle(e17), { type: o7, active: s17, uid: r8, disabled: n18, indicator: a10 } = e17;
      return e17.visible ? n2("calcite-action", { active: "toggle" === o7 && e17.value, appearance: "solid", bind: this, "data-action-uid": r8, disabled: n18, icon: this._getActionIcon(e17), indicator: a10, key: `action-${t11}`, loading: s17, onclick: this._triggerAction, scale: "s", text: i13, title: this._hideActionText ? i13 : void 0 }, this._getFallbackIcon(e17)) : null;
    }, this._openFeatureMenu = () => {
      this.featureMenuOpen = true, this._focusOn = "menu-flow-item";
    }, this._previousFeature = () => {
      this.viewModel.selectedFeatureIndex--;
    }, this._nextFeature = () => {
      this.viewModel.selectedFeatureIndex++;
    }, this._handleFeatureMenuBack = () => {
      this.featureMenuOpen && (this._focusOn = "root-flow-item", this.featureMenuOpen = false);
    }, this._focusFlowItemNode = (e17) => {
      this._focusOn === e17 && requestAnimationFrame(async () => {
        var _a, _b;
        switch (e17) {
          case "menu-flow-item":
            await ((_a = this._featureMenuViewportNode) == null ? void 0 : _a.setFocus());
            break;
          case "root-flow-item":
            await ((_b = this._rootFlowItemNode) == null ? void 0 : _b.setFocus());
        }
        this._focusOn = null;
      });
    }, this._focusFlowItemNodeThrottled = e5(this._focusFlowItemNode, j9), this._displaySpinnerThrottled = e5(() => this._displaySpinner(), x4), this._addSelectedFeatureIndexHandle(), this.addHandles([this._displaySpinnerThrottled, this._focusFlowItemNodeThrottled, d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.active;
    }, () => this._toggleScreenLocationEnabled()), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.active;
    }, (e17) => this._relatedRecordsWidget.closed = !e17), d2(() => {
      var _a;
      return (_a = this.visibleElements) == null ? void 0 : _a.closeButton;
    }, (e17) => this._relatedRecordsWidget.closable = e17), d2(() => {
      var _a;
      return (_a = this.visibleElements) == null ? void 0 : _a.spinner;
    }, (e17) => this._spinnerEnabledChange(e17)), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.view;
    }, (e17, t11) => this._viewChange(e17, t11)), d2(() => {
      var _a, _b;
      return (_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.ready;
    }, (e17, t11) => this._viewReadyChange(e17 ?? false, t11 ?? false)), d2(() => {
      var _a, _b;
      return [(_a = this.viewModel) == null ? void 0 : _a.waitingForResult, (_b = this.viewModel) == null ? void 0 : _b.location];
    }, () => {
      this._hideSpinner(), this._displaySpinnerThrottled();
    }), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.screenLocation;
    }, () => this._closeOpenActionMenu()), d2(() => this.selectedFeatureWidget, () => this._destroyRelatedRecordsFlowItemWidgets()), d2(() => {
      var _a;
      const e17 = (_a = this.selectedFeatureWidget) == null ? void 0 : _a.viewModel;
      return [e17 == null ? void 0 : e17.title, e17 == null ? void 0 : e17.state];
    }, () => this._setTitleFromFeatureWidget()), d2(() => {
      var _a;
      const e17 = (_a = this.selectedFeatureWidget) == null ? void 0 : _a.viewModel;
      return [e17 == null ? void 0 : e17.content, e17 == null ? void 0 : e17.state];
    }, () => this._setContentFromFeatureWidget()), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.featureViewModels;
    }, () => this._featureMenuViewportScrollTop()), this._relatedRecordsWidget.on("close", () => this.close()), this._relatedRecordsWidget.on("exit", () => this._destroyRelatedRecordsFlowItemWidgets()), this._relatedRecordsWidget.on("open-related-feature", ({ feature: e17 }) => this._openRelatedFeature(e17))]);
  }
  loadDependencies() {
    return r3({ action: () => import("./calcite-action-XVSOVITL.js"), "action-bar": () => import("./calcite-action-bar-G6HDZOEE.js"), "action-group": () => import("./calcite-action-group-PPVXDDI6.js"), button: () => import("./calcite-button-PKF5XM3M.js"), flow: () => import("./calcite-flow-2WJ5HKF6.js"), "flow-item": () => import("./calcite-flow-item-LVS7Y4RB.js"), list: () => import("./calcite-list-I4SFG3PL.js"), "list-item": () => import("./calcite-list-item-5HYCUKDY.js"), "list-item-group": () => import("./calcite-list-item-group-L4LIA76C.js"), loader: () => import("./calcite-loader-3OF54TOV.js") });
  }
  destroy() {
    var _a, _b;
    this._destroyRelatedRecordsFlowItemWidgets(), this._destroySelectedFeatureWidget(), this._destroySpinner(), this._unobserveFeatureMenuObserver(), (_a = this._featureMenuIntersectionObserver) == null ? void 0 : _a.disconnect(), (_b = this._relatedRecordsWidget) == null ? void 0 : _b.destroy();
  }
  get _hideActionText() {
    var _a;
    if (!this.responsiveActionsEnabled) return false;
    const e16 = (_a = this.view) == null ? void 0 : _a.widthBreakpoint;
    return "xsmall" === e16 || "small" === e16 || "medium" === e16;
  }
  get _featureNavigationVisible() {
    return this.viewModel.active && this.viewModel.featureCount > 1 && this.visibleElements.featureNavigation;
  }
  get _isCollapsed() {
    return this._collapseEnabled && this.collapsed;
  }
  get _collapseEnabled() {
    return this.visibleElements.collapseButton && !!this.title && !!this.content;
  }
  get active() {
    return this.viewModel.active;
  }
  get content() {
    return this.viewModel.content;
  }
  set content(e16) {
    this.viewModel.content = e16;
  }
  get icon() {
    return null;
  }
  get featureMenuOpen() {
    return this.viewModel.featureMenuOpen;
  }
  set featureMenuOpen(e16) {
    this.viewModel.featureMenuOpen = e16;
  }
  get features() {
    return this.viewModel.features;
  }
  set features(e16) {
    this.viewModel.features = e16;
  }
  get goToOverride() {
    return this.viewModel.goToOverride;
  }
  set goToOverride(e16) {
    this.viewModel.goToOverride = e16;
  }
  get location() {
    return this.viewModel.location;
  }
  set location(e16) {
    this.viewModel.location = e16;
  }
  get label() {
    var _a;
    return ((_a = this.messages) == null ? void 0 : _a.widgetLabel) ?? "";
  }
  set label(e16) {
    this._overrideIfSome("label", e16);
  }
  get map() {
    return this.viewModel.map;
  }
  set map(e16) {
    this.viewModel.map = e16;
  }
  get promises() {
    return this.viewModel.promises;
  }
  set promises(e16) {
    this.viewModel.promises = e16;
  }
  get selectedFeature() {
    return this.viewModel.selectedFeature;
  }
  get selectedFeatureIndex() {
    return this.viewModel.selectedFeatureIndex;
  }
  set selectedFeatureIndex(e16) {
    this.viewModel.selectedFeatureIndex = e16;
  }
  get selectedFeatureWidget() {
    const { _feature: e16, headingLevel: t11, _relatedRecordsFlowItems: i12, timeZone: o7, spatialReference: s17, map: r8 } = this, { selectedFeatureViewModel: n18 } = this.viewModel, a10 = { title: false };
    return n18 ? (e16 ? (e16.viewModel = n18, e16.visibleElements = a10) : this._feature = new W3({ flowItems: i12, headingLevel: t11 + 1, timeZone: o7, spatialReference: s17, map: r8, viewModel: n18, visibleElements: a10 }), this._feature) : null;
  }
  get spatialReference() {
    return this.viewModel.spatialReference;
  }
  set spatialReference(e16) {
    this.viewModel.spatialReference = e16;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e16) {
    this.viewModel.title = e16;
  }
  get timeZone() {
    return this.viewModel.timeZone;
  }
  set timeZone(e16) {
    this.viewModel.timeZone = e16;
  }
  get updateLocationEnabled() {
    return this.viewModel.updateLocationEnabled;
  }
  set updateLocationEnabled(e16) {
    this.viewModel.updateLocationEnabled = e16;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e16) {
    this.viewModel.view = e16;
  }
  get visible() {
    return this.viewModel.visible;
  }
  set visible(e16) {
    this.viewModel.visible = e16;
  }
  blur() {
    var _a;
    const { active: e16 } = this.viewModel;
    e16 ? (_a = this._rootFlowItemNode) == null ? void 0 : _a.blur() : n.getLogger(this).warn("Features can only be blurred when currently active.");
  }
  clear() {
    return this.viewModel.clear();
  }
  close() {
    this.viewModel.visible = false;
  }
  fetchFeatures(e16, t11) {
    return this.viewModel.fetchFeatures(e16, t11);
  }
  focus() {
    const { active: e16 } = this.viewModel;
    e16 ? this._setFocusOn() : n.getLogger(this).warn("Features can only be focused when currently active.");
  }
  next() {
    return this.viewModel.next();
  }
  open(e16) {
    this.removeHandles(O5);
    const t11 = { collapsed: (e16 == null ? void 0 : e16.collapsed) ?? false };
    this.set(t11), this.viewModel.open(e16), this.addHandles(p(() => !this.viewModel.waitingForResult, () => this._addSelectedFeatureIndexHandle(), { once: true }));
  }
  previous() {
    return this.viewModel.previous();
  }
  triggerAction(e16) {
    return this.viewModel.triggerAction(e16);
  }
  render() {
    return n2("div", { bind: this, class: this.classes(n15.base, e4.widget, e4.panel), onkeydown: this._onMainKeydown }, this._renderHeader(), this._renderContentContainer());
  }
  _renderFeatureNavigation() {
    return [this._renderPagination(), this._renderFeatureMenuButton()];
  }
  _renderHeader() {
    return !this.featureMenuOpen && this.featureNavigationTop && this._featureNavigationVisible ? n2("div", { class: n15.header, key: "header-actions" }, this._renderFeatureNavigation()) : null;
  }
  _renderFooter() {
    return this.featureMenuOpen || this.featureNavigationTop || !this._featureNavigationVisible ? null : n2("div", { class: n15.footer, key: "footer-actions", slot: "footer" }, this._renderFeatureNavigation());
  }
  _renderFeatureMenuButton() {
    const { messages: e16, viewModel: t11 } = this, { featureCount: i12, selectedFeatureIndex: o7, pendingPromisesCount: s17 } = t11;
    return n2("calcite-action", { appearance: "solid", bind: this, icon: "list", key: "feature-menu-button", label: e16.selectFeature, loading: s17 > 0, onclick: this._openFeatureMenu, scale: "s", text: s4(e16.pageText, { index: l(o7 + 1), total: l(i12) }), textEnabled: true, title: e16.selectFeature });
  }
  _renderPagination() {
    const { previous: e16, next: t11 } = this.messagesCommon.pagination;
    return n2("calcite-action-bar", { class: n15.paginationActionBar, expandDisabled: true, key: "pagination-action-bar", layout: "horizontal", overflowActionsDisabled: true, scale: "s" }, n2("calcite-action-group", { scale: "s" }, n2("calcite-action", { appearance: "solid", class: n15.paginationPrevious, icon: "chevron-left", iconFlipRtl: true, label: e16, onclick: this._previousFeature, scale: "s", text: e16, title: e16 }), n2("calcite-action", { appearance: "solid", icon: "chevron-right", iconFlipRtl: true, label: t11, onclick: this._nextFeature, scale: "s", text: t11, title: t11 })));
  }
  _renderFeatureMenuItem(e16) {
    const { selectedFeatureViewModel: t11, featureViewModels: i12 } = this.viewModel, o7 = e16 === t11, s17 = i12.indexOf(e16);
    return n2("calcite-list-item", { bind: this, "data-feature-index": s17, key: `feature-menu-item-${e16.uid}`, onblur: this._removeActiveFeature, onfocus: this._setActiveFeature, onmouseleave: this._removeActiveFeature, onmouseover: this._setActiveFeature, selected: o7, onCalciteListItemSelect: this._selectFeature }, n2("span", { innerHTML: e16.title || this.messagesCommon.untitled, slot: "content" }));
  }
  _groupResultsByLayer() {
    const { featureViewModels: e16 } = this.viewModel, t11 = /* @__PURE__ */ new Map();
    return e16.forEach((e17) => {
      const i12 = e17 == null ? void 0 : e17.graphic;
      if (!i12) return;
      const { layer: o7, sourceLayer: s17 } = i12, r8 = (k6(o7) ? o7 : null) || (k6(s17) ? s17 : null), n18 = t11.get(r8) ?? [];
      t11.set(r8, [...n18, e17]);
    }), t11;
  }
  _renderFeatureMenu() {
    const { featureViewModels: e16 } = this.viewModel, t11 = this._groupResultsByLayer();
    return e16.length ? n2("calcite-list", { selectionAppearance: "icon", selectionMode: "single" }, Array.from(t11.keys(), (e17) => {
      var _a;
      const i12 = (_a = t11.get(e17)) == null ? void 0 : _a.map((e18) => this._renderFeatureMenuItem(e18)), o7 = e17 ? e17.title ?? this.messagesCommon.untitled : null;
      return this.visibleElements.featureListLayerTitle && null !== o7 ? n2("calcite-list-item-group", { heading: o7, key: (e17 == null ? void 0 : e17.uid) || "map-graphics" }, i12) : i12;
    })) : null;
  }
  _renderHeaderAction(e16, t11) {
    const i12 = e16.title || "";
    return e16.visible ? n2("calcite-action", { active: "toggle" === e16.type && e16.value, appearance: "solid", bind: this, "data-action-uid": e16.uid, disabled: e16.disabled, icon: e16.icon ?? void 0, indicator: e16.indicator, key: `header-action-${t11}`, loading: e16.active, onclick: this._triggerHeaderAction, slot: "header-actions-end", text: i12, title: i12 }) : null;
  }
  _renderHeaderActions() {
    return this.headerActions.map((e16, t11) => this._renderHeaderAction(e16, t11)).toArray();
  }
  _renderContentFeature() {
    const { headingLevel: e16, visibleElements: t11, _isCollapsed: i12, _collapseEnabled: o7, featureNavigationTop: s17 } = this, { title: r8, active: n18 } = this.viewModel, a10 = t11.heading && r8 ? r8 : "";
    return n2("calcite-flow-item", { afterCreate: this._storeRootFlowItemNode, afterUpdate: this._focusRootFlowItemNode, bind: this, class: this.classes({ [n15.contentFeature]: true, [n15.flowItemCollapsed]: i12 }), closable: t11.closeButton, closed: !n18, collapsed: i12, collapseDirection: s17 ? "down" : "up", collapsible: o7, headingLevel: e16, key: "root-flow-item", onCalciteFlowItemClose: this.close, onCalciteFlowItemToggle: this._handleCollapseToggle }, a10 ? n2(e8, { class: this.classes(n15.featuresHeading, e4.heading), innerHTML: a10, key: "header-content", level: this.headingLevel, slot: "header-content" }) : null, this._renderHeaderActions(), this._renderActionBar(), i12 ? null : n2("div", { class: this.classes(n15.container, n15.contentContainer) }, this._renderContent()), this._renderFooter());
  }
  _renderFeatureMenuContainer() {
    const { viewModel: e16, featureMenuOpen: t11, messages: i12, messagesCommon: o7 } = this, { active: s17, featureViewModels: r8, pendingPromisesCount: n18 } = e16;
    return t11 ? n2("calcite-flow-item", { afterCreate: this._storeFeatureMenuFlowItemNode, afterUpdate: this._focusFeatureMenuFlowItemNode, bind: this, closable: false, closed: !s17, description: s4(i12.total, { total: r8.length }), heading: i12.selectFeature, key: "feature-menu", loading: e16.waitingForContents, onCalciteFlowItemBack: (e17) => {
      e17.preventDefault(), this._handleFeatureMenuBack();
    } }, n18 > 0 ? n2("calcite-loader", { class: n15.loader, inline: true, key: "feature-menu-loader", label: o7.loading, slot: "header-actions-end" }) : null, n2("div", { class: n15.container }, this._renderFeatureMenu()), n2("div", { afterCreate: this._featureMenuIntersectionObserverCreated, bind: this, class: n15.featureMenuObserver }), n2("calcite-button", { appearance: "transparent", onclick: this._handleFeatureMenuBack, slot: "footer-actions", width: "full" }, o7.back)) : null;
  }
  _renderContentContainer() {
    const e16 = [this._renderContentFeature(), this._renderFeatureMenuContainer(), this._relatedRecordsWidget.render()];
    return this.visibleElements.flow ? n2("calcite-flow", { key: "content-container" }, e16) : e16;
  }
  _getFallbackIcon(e16) {
    const { className: t11, icon: i12 } = e16;
    if (i12) return null;
    const o7 = e6({ action: e16, feature: this.selectedFeature }), s17 = { [n15.icon]: !!t11, [n15.actionImage]: !!o7 };
    return t11 && (s17[t11] = true), o7 || t11 ? n2("span", { "aria-hidden": "true", class: this.classes(n15.icon, s17), key: "icon", styles: n7(o7) }) : null;
  }
  _renderActionBar() {
    var _a;
    return !this._isCollapsed && this.visibleElements.actionBar && ((_a = this.viewModel.allActions) == null ? void 0 : _a.length) ? n2("calcite-action-bar", { expandDisabled: true, expanded: !this._hideActionText, key: "header-action-bar", scale: "s", slot: "action-bar" }, n2("calcite-action-group", { afterCreate: (e16) => this._actionBarMenuNode = e16, overlayPositioning: "fixed", scale: "s" }, this._renderActions())) : null;
  }
  _renderActions() {
    return this.viewModel.allActions.toArray().map(this._renderAction);
  }
  _renderContent() {
    var _a;
    const e16 = (_a = this.viewModel) == null ? void 0 : _a.content;
    return e16 ? "string" == typeof e16 ? n2("div", { class: t6.contentNode, innerHTML: e16, key: e16 }) : this.renderNodeContent(e16) : null;
  }
  _setFocusOn() {
    this.renderNow(), requestAnimationFrame(() => {
      this._focusOn = this.featureMenuOpen ? "menu-flow-item" : "root-flow-item";
    });
  }
  _handleCollapseToggle() {
    this.collapsed = !this.collapsed;
  }
  async _openRelatedFeature(e16) {
    await e16.viewModel.updateGeometry();
    const t11 = e16.graphic, i12 = t11 == null ? void 0 : t11.geometry;
    if (null == i12 || null == t11) return;
    this._destroyRelatedRecordsFlowItemWidgets(), await this.viewModel.zoomTo({ target: i12 });
    const o7 = n6(i12);
    this.open({ features: [t11], location: null != o7 ? o7 : void 0 });
  }
  _focusRootFlowItemNode() {
    this._focusFlowItemNodeThrottled("root-flow-item");
  }
  _focusFeatureMenuFlowItemNode() {
    this._focusFlowItemNodeThrottled("menu-flow-item");
  }
  _storeRootFlowItemNode(e16) {
    this._rootFlowItemNode = e16, this._focusFlowItemNodeThrottled("root-flow-item");
  }
  _storeFeatureMenuFlowItemNode(e16) {
    this._featureMenuViewportNode = e16, this._focusFlowItemNodeThrottled("menu-flow-item");
  }
  _setActiveFeature(e16) {
    var _a;
    const { viewModel: t11 } = this, i12 = e16.currentTarget["data-feature-index"];
    t11.activeFeature = ((_a = t11.features) == null ? void 0 : _a[i12]) || null;
  }
  _removeActiveFeature() {
    this.viewModel.activeFeature = null;
  }
  _selectFeature(e16) {
    const t11 = e16.currentTarget["data-feature-index"];
    isNaN(t11) || (this.viewModel.selectedFeatureIndex = t11), this._handleFeatureMenuBack();
  }
  _unobserveFeatureMenuObserver() {
    this._featureMenuIntersectionObserverNode && this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode);
  }
  _featureMenuIntersectionObserverCreated(e16) {
    this._unobserveFeatureMenuObserver(), this._featureMenuIntersectionObserver.observe(e16), this._featureMenuIntersectionObserverNode = e16;
  }
  _getActionIcon(e16) {
    return e16.icon ? e16.icon : e16.image || e16.className ? void 0 : "question";
  }
  _getActionTitle(e16) {
    const { messages: t11, selectedFeature: i12, messagesCommon: o7 } = this, { id: s17 } = e16, r8 = i12 == null ? void 0 : i12.attributes, n18 = e16.title ?? "", a10 = "zoom-to-feature" === s17 ? s4(n18, { messages: t11 }) : "remove-selected-feature" === s17 ? s4(n18, { messages: o7 }) : "zoom-to-clustered-features" === s17 || "browse-clustered-features" === s17 ? s4(n18, { messages: t11 }) : e16.title;
    return a10 && r8 ? s4(a10, r8) : a10 ?? "";
  }
  _onMainKeydown(e16) {
    const { key: t11 } = e16;
    "ArrowLeft" === t11 && (e16.stopPropagation(), this._handleFeatureMenuBack(), this.previous()), "ArrowRight" === t11 && (e16.stopPropagation(), this._handleFeatureMenuBack(), this.next());
  }
  _featureMenuViewportScrollTop() {
    this._featureMenuViewportNode && this._featureMenuViewportNode.scrollContentTo({ top: 0 });
  }
  _setContentFromFeatureWidget() {
    const { selectedFeatureWidget: e16 } = this;
    e16 && (this.viewModel.content = e16);
  }
  _setTitleFromFeatureWidget() {
    const { selectedFeatureWidget: e16, messagesCommon: t11 } = this, i12 = e16 == null ? void 0 : e16.viewModel;
    e16 && (this.viewModel.title = "error" === (i12 == null ? void 0 : i12.state) ? t11 == null ? void 0 : t11.errorMessage : (i12 == null ? void 0 : i12.title) || "");
  }
  _addSelectedFeatureIndexHandle() {
    const e16 = d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.selectedFeatureIndex;
    }, (e17, t11) => this._selectedFeatureIndexUpdated(e17, t11));
    this.addHandles(e16, O5);
  }
  _selectedFeatureIndexUpdated(e16, t11) {
    const { featureCount: i12 } = this.viewModel;
    i12 && e16 !== t11 && -1 !== e16 && (this._destroyRelatedRecordsFlowItemWidgets(), this._rootFlowItemNode && this._rootFlowItemNode.scrollContentTo({ top: 0 }));
  }
  _triggerHeaderAction(e16) {
    const t11 = e16.currentTarget;
    if (t11.disabled) return;
    const i12 = t11.dataset.actionUid, o7 = this.headerActions.find(({ uid: e17 }) => e17 === i12);
    o7 && !o7.disabled && ("toggle" === (o7 == null ? void 0 : o7.type) && (o7.value = !o7.value), this.emit("trigger-header-action", { action: o7 }));
  }
  _triggerAction(e16) {
    const t11 = e16.currentTarget;
    if (t11.disabled) return;
    const i12 = t11.dataset.actionUid, { allActions: o7 } = this.viewModel, s17 = o7.findIndex((e17) => e17.uid === i12), r8 = o7.at(s17);
    r8 && "toggle" === r8.type && (r8.value = !r8.value), this.viewModel.triggerAction(s17);
  }
  _createSpinner(e16) {
    e16 && (this._spinner = new h11({ view: e16 }), e16.ui.add(this._spinner, { key: T10, position: "manual", internal: true }));
  }
  _wireUpView(e16) {
    var _a;
    this._destroySpinner(), e16 && ((_a = this.visibleElements) == null ? void 0 : _a.spinner) && this._createSpinner(e16);
  }
  _hideSpinner() {
    const { _spinner: e16 } = this;
    e16 && (e16.location = null, e16.hide());
  }
  _viewReadyChange(e16, t11) {
    var _a;
    e16 ? this._wireUpView((_a = this.viewModel) == null ? void 0 : _a.view) : t11 && this.viewModel.clear();
  }
  _viewChange(e16, t11) {
    e16 && t11 && this.viewModel.clear();
  }
  _destroySelectedFeatureWidget() {
    const { _feature: e16 } = this;
    e16 && (e16.viewModel = null, !e16.destroyed && e16.destroy()), this._feature = null;
  }
  _closeOpenActionMenu() {
    const { _actionBarMenuNode: e16 } = this;
    e16 && (e16.menuOpen = false);
  }
  _destroyRelatedRecordsFlowItemWidgets() {
    this._relatedRecordsFlowItems.drain((e16) => {
      "showAllEnabled" in e16.viewModel && (e16.viewModel.showAllEnabled = false), e16.viewModel = null, e16.destroy();
    });
  }
  _toggleScreenLocationEnabled() {
    const { viewModel: e16 } = this;
    e16 && (e16.screenLocationEnabled = e16.active);
  }
  _displaySpinner() {
    const { _spinner: e16 } = this;
    if (!e16) return;
    const { location: t11, waitingForResult: i12 } = this.viewModel;
    i12 && t11 ? e16.show({ location: t11 }) : e16.hide();
  }
  _destroySpinner() {
    var _a;
    const { _spinner: e16, view: t11 } = this;
    e16 && ((_a = t11 == null ? void 0 : t11.ui) == null ? void 0 : _a.remove(e16, T10), e16.destroy(), this._spinner = null);
  }
  _spinnerEnabledChange(e16) {
    var _a;
    this._destroySpinner(), e16 && this._createSpinner((_a = this.viewModel) == null ? void 0 : _a.view);
  }
};
e([y()], E6.prototype, "_focusOn", void 0), e([y()], E6.prototype, "_relatedRecordsFlowItems", void 0), e([y()], E6.prototype, "_hideActionText", null), e([y()], E6.prototype, "_featureNavigationVisible", null), e([y()], E6.prototype, "_isCollapsed", null), e([y()], E6.prototype, "_collapseEnabled", null), e([y({ readOnly: true })], E6.prototype, "active", null), e([y()], E6.prototype, "collapsed", void 0), e([y()], E6.prototype, "content", null), e([y()], E6.prototype, "icon", null), e([y()], E6.prototype, "featureMenuOpen", null), e([y()], E6.prototype, "featureNavigationTop", void 0), e([y()], E6.prototype, "features", null), e([y()], E6.prototype, "goToOverride", null), e([y({ type: i11 })], E6.prototype, "headerActions", void 0), e([y()], E6.prototype, "headingLevel", void 0), e([y()], E6.prototype, "location", null), e([y()], E6.prototype, "label", null), e([y()], E6.prototype, "map", null), e([y(), e2("esri/widgets/Features/t9n/Features")], E6.prototype, "messages", void 0), e([y(), e2("esri/t9n/common")], E6.prototype, "messagesCommon", void 0), e([y()], E6.prototype, "promises", null), e([y()], E6.prototype, "responsiveActionsEnabled", void 0), e([y({ readOnly: true })], E6.prototype, "selectedFeature", null), e([y()], E6.prototype, "selectedFeatureIndex", null), e([y({ readOnly: true })], E6.prototype, "selectedFeatureWidget", null), e([y()], E6.prototype, "spatialReference", null), e([y()], E6.prototype, "title", null), e([y()], E6.prototype, "timeZone", null), e([y()], E6.prototype, "updateLocationEnabled", null), e([y()], E6.prototype, "view", null), e([y({ type: W4 }), e9(["triggerAction", "trigger-action"])], E6.prototype, "viewModel", void 0), e([y({ type: l13, nonNullable: true })], E6.prototype, "visibleElements", void 0), e([y()], E6.prototype, "visible", null), E6 = e([a("esri.widgets.Features")], E6);
var L5 = E6;

// ../node_modules/@arcgis/core/widgets/Popup/css.js
var t9 = "esri-popup";
var o6 = `${t9}--is-docked`;
var e14 = { base: t9, baseHidden: `${t9}--hidden`, main: `${t9}__main-container`, shadow: `${t9}--shadow`, isDocked: o6, isDockedTopLeft: `${o6}-top-left`, isDockedTopCenter: `${o6}-top-center`, isDockedTopRight: `${o6}-top-right`, isDockedBottomLeft: `${o6}-bottom-left`, isDockedBottomCenter: `${o6}-bottom-center`, isDockedBottomRight: `${o6}-bottom-right`, alignTopCenter: `${t9}--aligned-top-center`, alignBottomCenter: `${t9}--aligned-bottom-center`, alignTopLeft: `${t9}--aligned-top-left`, alignBottomLeft: `${t9}--aligned-bottom-left`, alignTopRight: `${t9}--aligned-top-right`, alignBottomRight: `${t9}--aligned-bottom-right`, pointer: `${t9}__pointer`, pointerDirection: `${t9}__pointer-direction` };

// ../node_modules/@arcgis/core/widgets/Popup/PopupViewModel.js
var e15 = class extends W4 {
  constructor(o7) {
    super(o7);
  }
};
e15 = e([a("esri.widgets.Popup.PopupViewModel")], e15);
var t10 = e15;

// ../node_modules/@arcgis/core/widgets/Popup/PopupVisibleElements.js
var s16 = class extends S {
  constructor() {
    super(...arguments), this.actionBar = true, this.closeButton = true, this.collapseButton = true, this.featureNavigation = true, this.featureListLayerTitle = true, this.heading = true, this.spinner = true;
  }
};
e([y({ type: Boolean, nonNullable: true })], s16.prototype, "actionBar", void 0), e([y({ type: Boolean, nonNullable: true })], s16.prototype, "closeButton", void 0), e([y({ type: Boolean, nonNullable: true })], s16.prototype, "collapseButton", void 0), e([y({ type: Boolean, nonNullable: true })], s16.prototype, "featureNavigation", void 0), e([y({ type: Boolean, nonNullable: true })], s16.prototype, "featureListLayerTitle", void 0), e([y({ type: Boolean, nonNullable: true })], s16.prototype, "heading", void 0), e([y({ type: Boolean, nonNullable: true })], s16.prototype, "spinner", void 0), s16 = e([a("esri.widgets.Popup.PopupVisibleElements")], s16);
var p13 = s16;

// ../node_modules/@arcgis/core/widgets/Popup.js
var _4 = { buttonEnabled: true, position: "auto", breakpoint: { width: 544 } };
var E7 = class extends B {
  constructor(e16, t11) {
    super(e16, t11), this._dockAction = new c4({ id: "popup-dock-action" }), this._featuresWidget = new L5({ responsiveActionsEnabled: true }), this._containerNode = null, this._mainContainerNode = null, this._pointerOffsetInPx = 16, this.alignment = "auto", this.dockEnabled = false, this.headingLevel = 2, this.messages = null, this.viewModel = new t10(), this.visibleElements = new p13();
  }
  initialize() {
    this.addHandles([d2(() => {
      var _a, _b;
      return [(_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.widthBreakpoint, this.dockEnabled];
    }, () => this._handleDockIcon(), P), d2(() => {
      var _a, _b;
      return [this.dockEnabled, (_a = this.messages) == null ? void 0 : _a.undock, (_b = this.messages) == null ? void 0 : _b.dock];
    }, () => this._handleDockEnabled(), P), d2(() => this.dockOptions, (e16) => {
      const { _dockAction: t11 } = this, i12 = this._featuresWidget.headerActions;
      i12.remove(t11), e16.buttonEnabled && i12.add(t11);
    }, P), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.screenLocation;
    }, () => this._positionContainer()), d2(() => {
      var _a;
      return [(_a = this.viewModel) == null ? void 0 : _a.active, this.dockEnabled];
    }, () => this._toggleScreenLocationEnabled()), d2(() => {
      var _a, _b, _c, _d, _e, _f, _g;
      return [(_a = this.viewModel) == null ? void 0 : _a.screenLocation, (_c = (_b = this.viewModel) == null ? void 0 : _b.view) == null ? void 0 : _c.padding, (_e = (_d = this.viewModel) == null ? void 0 : _d.view) == null ? void 0 : _e.size, (_f = this.viewModel) == null ? void 0 : _f.active, (_g = this.viewModel) == null ? void 0 : _g.location, this.alignment];
    }, () => this.reposition()), d2(() => {
      var _a, _b;
      return (_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.size;
    }, (e16, t11) => this._updateDockEnabledForViewSize(e16, t11)), d2(() => {
      var _a;
      return (_a = this.viewModel) == null ? void 0 : _a.view;
    }, (e16, t11) => this._viewChange(e16, t11)), d2(() => {
      var _a, _b;
      return (_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.ready;
    }, (e16, t11) => this._viewReadyChange(e16 ?? false, t11 ?? false)), d2(() => this.viewModel, () => this._featuresWidget.viewModel = this.viewModel, P), d2(() => this._featureNavigationTop, (e16) => this._featuresWidget.featureNavigationTop = e16, P), d2(() => this.headingLevel, (e16) => this._featuresWidget.headingLevel = e16, P), d2(() => this.visibleElements.actionBar, (e16) => this._featuresWidget.visibleElements.actionBar = !!e16, P), d2(() => this.visibleElements.closeButton, (e16) => this._featuresWidget.visibleElements.closeButton = !!e16, P), d2(() => this.visibleElements.collapseButton, (e16) => this._featuresWidget.visibleElements.collapseButton = !!e16, P), d2(() => this.visibleElements.heading, (e16) => this._featuresWidget.visibleElements.heading = !!e16, P), d2(() => this.visibleElements.spinner, (e16) => this._featuresWidget.visibleElements.spinner = !!e16, P), d2(() => this.visibleElements.featureNavigation, (e16) => this._featuresWidget.visibleElements.featureNavigation = !!e16, P), d2(() => this.visibleElements.featureListLayerTitle, (e16) => this._featuresWidget.visibleElements.featureListLayerTitle = !!e16, P), v2(() => this._featuresWidget, "trigger-header-action", (e16) => {
      e16.action === this._dockAction && (this.dockEnabled = !this.dockEnabled);
    })]);
  }
  normalizeCtorArgs(e16) {
    const t11 = { ...e16 };
    return null != (e16 == null ? void 0 : e16.visibleElements) && (t11.visibleElements = new p13(e16.visibleElements), null != e16.collapseEnabled && (t11.visibleElements.collapseButton = e16.collapseEnabled), null != e16.spinnerEnabled && (t11.visibleElements.spinner = e16.spinnerEnabled)), t11;
  }
  destroy() {
    var _a;
    this._dockAction.destroy(), (_a = this._featuresWidget) == null ? void 0 : _a.destroy();
  }
  get _featureNavigationTop() {
    const { currentAlignment: e16, currentDockPosition: t11 } = this;
    return "bottom-left" === e16 || "bottom-center" === e16 || "bottom-right" === e16 || "top-left" === t11 || "top-center" === t11 || "top-right" === t11;
  }
  get actions() {
    return this.viewModel.actions;
  }
  set actions(e16) {
    this.viewModel.actions = e16;
  }
  get active() {
    return this.viewModel.active;
  }
  get autoCloseEnabled() {
    return this.viewModel.autoCloseEnabled;
  }
  set autoCloseEnabled(e16) {
    this.viewModel.autoCloseEnabled = e16;
  }
  get defaultPopupTemplateEnabled() {
    return this.viewModel.defaultPopupTemplateEnabled;
  }
  set defaultPopupTemplateEnabled(e16) {
    this.viewModel.defaultPopupTemplateEnabled = e16;
  }
  get content() {
    return this.viewModel.content;
  }
  set content(e16) {
    this.viewModel.content = e16;
  }
  get collapsed() {
    return this._featuresWidget.collapsed;
  }
  set collapsed(e16) {
    this._featuresWidget.collapsed = e16;
  }
  get collapseEnabled() {
    return i2(n.getLogger(this), "collapseEnabled", { replacement: "PopupVisibleElements.collapseButton", version: "4.29" }), this.visibleElements.collapseButton;
  }
  set collapseEnabled(e16) {
    i2(n.getLogger(this), "collapseEnabled", { replacement: "PopupVisibleElements.collapseButton", version: "4.29" }), this.visibleElements.collapseButton = e16;
  }
  get currentAlignment() {
    return this._getCurrentAlignment();
  }
  get currentDockPosition() {
    return this._getCurrentDockPosition();
  }
  get dockOptions() {
    return this._get("dockOptions") || _4;
  }
  set dockOptions(e16) {
    var _a, _b;
    const t11 = { ..._4 }, i12 = (_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.breakpoints, o7 = {};
    i12 && (o7.width = i12.xsmall, o7.height = i12.xsmall);
    const n18 = { ...t11, ...e16 }, s17 = { ...t11.breakpoint, ...o7 }, { breakpoint: r8 } = n18;
    "object" == typeof r8 ? n18.breakpoint = { ...s17, ...r8 } : r8 && (n18.breakpoint = s17), this._set("dockOptions", n18), this._setCurrentDockPosition(), this.reposition();
  }
  get featureCount() {
    return this.viewModel.featureCount;
  }
  get featureMenuOpen() {
    return this.viewModel.featureMenuOpen;
  }
  set featureMenuOpen(e16) {
    this.viewModel.featureMenuOpen = e16;
  }
  get features() {
    return this.viewModel.features;
  }
  set features(e16) {
    this.viewModel.features = e16;
  }
  get goToOverride() {
    return this.viewModel.goToOverride;
  }
  set goToOverride(e16) {
    this.viewModel.goToOverride = e16;
  }
  get highlightEnabled() {
    return this.viewModel.highlightEnabled;
  }
  set highlightEnabled(e16) {
    this.viewModel.highlightEnabled = e16;
  }
  get icon() {
    return "popup";
  }
  set icon(e16) {
    this._overrideIfSome("icon", e16);
  }
  get location() {
    return this.viewModel.location;
  }
  set location(e16) {
    this.viewModel.location = e16;
  }
  get label() {
    var _a;
    return ((_a = this.messages) == null ? void 0 : _a.widgetLabel) ?? "";
  }
  set label(e16) {
    this._overrideIfSome("label", e16);
  }
  get promises() {
    return this.viewModel.promises;
  }
  set promises(e16) {
    this.viewModel.promises = e16;
  }
  get selectedFeature() {
    return this.viewModel.selectedFeature;
  }
  get selectedFeatureIndex() {
    return this.viewModel.selectedFeatureIndex;
  }
  set selectedFeatureIndex(e16) {
    this.viewModel.selectedFeatureIndex = e16;
  }
  get selectedFeatureWidget() {
    return this._featuresWidget.selectedFeatureWidget;
  }
  get spinnerEnabled() {
    return i2(n.getLogger(this), "spinnerEnabled", { replacement: "PopupVisibleElements.spinner", version: "4.29" }), this.visibleElements.spinner;
  }
  set spinnerEnabled(e16) {
    i2(n.getLogger(this), "spinnerEnabled", { replacement: "PopupVisibleElements.spinner", version: "4.29" }), this.visibleElements.spinner = e16;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e16) {
    this.viewModel.title = e16;
  }
  get updateLocationEnabled() {
    return this.viewModel.updateLocationEnabled;
  }
  set updateLocationEnabled(e16) {
    this.viewModel.updateLocationEnabled = e16;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e16) {
    this.viewModel.view = e16;
  }
  get visible() {
    return this.viewModel.visible;
  }
  set visible(e16) {
    this.viewModel.visible = e16;
  }
  blur() {
    const { active: e16 } = this.viewModel;
    e16 || n.getLogger(this).warn("Popup can only be blurred when currently active."), this._featuresWidget.blur();
  }
  clear() {
    return this.viewModel.clear();
  }
  close() {
    this.visible = false;
  }
  fetchFeatures(e16, t11) {
    return this.viewModel.fetchFeatures(e16, t11);
  }
  focus() {
    const { active: e16 } = this.viewModel;
    e16 || n.getLogger(this).warn("Popup can only be focused when currently active."), this.reposition(), requestAnimationFrame(() => {
      this._featuresWidget.focus();
    });
  }
  next() {
    return this.viewModel.next();
  }
  open(e16) {
    const t11 = !!e16 && !!e16.featureMenuOpen, i12 = { collapsed: !!e16 && !!e16.collapsed, featureMenuOpen: t11 };
    this.set(i12), this.viewModel.open(e16), this._shouldFocus(e16);
  }
  previous() {
    return this.viewModel.previous();
  }
  reposition() {
    this.renderNow(), this._positionContainer(), this._setCurrentAlignment();
  }
  triggerAction(e16) {
    return this.viewModel.triggerAction(e16);
  }
  render() {
    var _a, _b, _c, _d;
    const { dockEnabled: e16, currentAlignment: t11, currentDockPosition: i12 } = this, { active: o7, screenLocation: n18 } = this.viewModel, s17 = o7 && e16, r8 = o7 && !e16, l14 = (_b = (_a = this.selectedFeature) == null ? void 0 : _a.layer) == null ? void 0 : _b.title, a10 = (_d = (_c = this.selectedFeature) == null ? void 0 : _c.layer) == null ? void 0 : _d.id, d12 = { [e14.alignTopCenter]: "top-center" === t11, [e14.alignBottomCenter]: "bottom-center" === t11, [e14.alignTopLeft]: "top-left" === t11, [e14.alignBottomLeft]: "bottom-left" === t11, [e14.alignTopRight]: "top-right" === t11, [e14.alignBottomRight]: "bottom-right" === t11, [e14.isDocked]: s17, [e14.shadow]: r8, [e14.isDockedTopLeft]: "top-left" === i12, [e14.isDockedTopCenter]: "top-center" === i12, [e14.isDockedTopRight]: "top-right" === i12, [e14.isDockedBottomLeft]: "bottom-left" === i12, [e14.isDockedBottomCenter]: "bottom-center" === i12, [e14.isDockedBottomRight]: "bottom-right" === i12 };
    return n2("div", { afterCreate: this._positionContainer, afterUpdate: this._positionContainer, bind: this, class: this.classes(e14.base, d12, { [e14.baseHidden]: !n18 && !e16 }), "data-layer-id": a10, "data-layer-title": l14, role: "presentation" }, o7 ? [this._renderMainContainer(), this._renderPointer()] : null);
  }
  _renderPointer() {
    return this.dockEnabled ? null : n2("div", { class: e14.pointer, key: "popup-pointer", role: "presentation" }, n2("div", { class: this.classes(e14.pointerDirection, e14.shadow) }));
  }
  _renderMainContainer() {
    const { dockEnabled: e16 } = this, t11 = { [e14.shadow]: e16 };
    return n2("div", { afterCreate: this._setMainContainerNode, afterUpdate: this._setMainContainerNode, bind: this, class: this.classes(e14.main, e4.widget, t11) }, this._featuresWidget.render());
  }
  async _shouldFocus(e16) {
    (e16 == null ? void 0 : e16.shouldFocus) && (await w(() => {
      var _a;
      return true === ((_a = this.viewModel) == null ? void 0 : _a.active);
    }), this.focus());
  }
  _isOutsideView(e16) {
    const { popupHeight: t11, popupWidth: i12, screenLocation: o7, side: n18, view: s17 } = e16;
    if (isNaN(i12) || isNaN(t11) || !s17 || !o7) return false;
    const r8 = s17.padding;
    return "right" === n18 && o7.x + i12 / 2 > s17.width - r8.right || ("left" === n18 && o7.x - i12 / 2 < r8.left || ("top" === n18 && o7.y - t11 < r8.top || "bottom" === n18 && o7.y + t11 > s17.height - r8.bottom));
  }
  _calculateAutoAlignment(e16) {
    if ("auto" !== e16) return e16;
    const { _pointerOffsetInPx: t11, _containerNode: i12, _mainContainerNode: o7, viewModel: n18 } = this, { screenLocation: s17, view: r8 } = n18;
    if (null == s17 || !r8 || !i12) return "top-center";
    function l14(e17) {
      return parseInt(e17.replaceAll(/[^-\d.]/g, ""), 10);
    }
    const a10 = o7 ? window.getComputedStyle(o7, null) : null, d12 = a10 ? l14(a10.getPropertyValue("max-height")) : 0, c18 = a10 ? l14(a10.getPropertyValue("height")) : 0, { height: p14, width: h14 } = i12.getBoundingClientRect(), u10 = h14 + t11, g11 = Math.max(p14, d12, c18) + t11, v12 = this._isOutsideView({ popupHeight: g11, popupWidth: u10, screenLocation: s17, side: "right", view: r8 }), m12 = this._isOutsideView({ popupHeight: g11, popupWidth: u10, screenLocation: s17, side: "left", view: r8 }), b10 = this._isOutsideView({ popupHeight: g11, popupWidth: u10, screenLocation: s17, side: "top", view: r8 }), f10 = this._isOutsideView({ popupHeight: g11, popupWidth: u10, screenLocation: s17, side: "bottom", view: r8 });
    return m12 ? b10 ? "bottom-right" : "top-right" : v12 ? b10 ? "bottom-left" : "top-left" : b10 ? f10 ? "top-center" : "bottom-center" : "top-center";
  }
  _callCurrentAlignment(e16) {
    return "function" == typeof e16 ? e16.call(this) : e16;
  }
  _getCurrentAlignment() {
    const { alignment: e16, dockEnabled: t11 } = this;
    return t11 || !this.viewModel.active ? null : this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e16)));
  }
  _setCurrentAlignment() {
    this._set("currentAlignment", this._getCurrentAlignment());
  }
  _setCurrentDockPosition() {
    this._set("currentDockPosition", this._getCurrentDockPosition());
  }
  _calculatePositionResult(e16) {
    const t11 = ["left", "right"];
    return g2(this.container) && t11.reverse(), e16 == null ? void 0 : e16.replace(/leading/gi, t11[0]).replaceAll(/trailing/gi, t11[1]);
  }
  _callDockPosition(e16) {
    return "function" == typeof e16 ? e16.call(this) : e16;
  }
  _getDockPosition() {
    var _a;
    return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((_a = this.dockOptions) == null ? void 0 : _a.position)));
  }
  _getCurrentDockPosition() {
    return this.dockEnabled && this.viewModel.active ? this._getDockPosition() : null;
  }
  _calculateAutoDockPosition(e16) {
    var _a;
    if ("auto" !== e16) return e16;
    const t11 = (_a = this.viewModel) == null ? void 0 : _a.view, i12 = g2(this.container) ? "top-left" : "top-right";
    if (!t11) return i12;
    const o7 = t11.padding || { left: 0, right: 0, top: 0, bottom: 0 }, n18 = t11.width - o7.left - o7.right, { breakpoints: s17 } = t11;
    return s17 && n18 <= s17.xsmall ? "bottom-center" : i12;
  }
  _getDockIcon() {
    const e16 = this._getDockPosition();
    if (this.dockEnabled) return "minimize";
    switch (e16) {
      case "top-left":
      case "bottom-left":
        return "dock-left";
      case "top-center":
        return "maximize";
      case "bottom-center":
        return "dock-bottom";
      default:
        return "dock-right";
    }
  }
  _handleDockIcon() {
    this._dockAction.icon = this._getDockIcon();
  }
  _handleDockEnabled() {
    var _a, _b;
    this._dockAction.title = this.dockEnabled ? (_a = this.messages) == null ? void 0 : _a.undock : (_b = this.messages) == null ? void 0 : _b.dock;
  }
  _setMainContainerNode(e16) {
    this._mainContainerNode = e16;
  }
  _positionContainer(e16 = this._containerNode) {
    if (e16 && (this._containerNode = e16), !this._containerNode) return;
    const { screenLocation: t11 } = this.viewModel, { width: i12 } = this._containerNode.getBoundingClientRect(), o7 = this._calculatePositionStyle(t11, i12);
    o7 && Object.assign(this._containerNode.style, o7);
  }
  _calculateFullWidth(e16) {
    const { currentAlignment: t11, _pointerOffsetInPx: i12 } = this;
    return "top-left" === t11 || "bottom-left" === t11 || "top-right" === t11 || "bottom-right" === t11 ? e16 + i12 : e16;
  }
  _calculateAlignmentPosition(e16, t11, i12, o7) {
    const { currentAlignment: n18, _pointerOffsetInPx: s17 } = this;
    if (!i12) return;
    const { padding: r8 } = i12, l14 = o7 / 2, a10 = i12.height - t11, d12 = i12.width - e16;
    return "bottom-center" === n18 ? { top: t11 + s17 - r8.top, left: e16 - l14 - r8.left } : "top-left" === n18 ? { bottom: a10 + s17 - r8.bottom, right: d12 + s17 - r8.right } : "bottom-left" === n18 ? { top: t11 + s17 - r8.top, right: d12 + s17 - r8.right } : "top-right" === n18 ? { bottom: a10 + s17 - r8.bottom, left: e16 + s17 - r8.left } : "bottom-right" === n18 ? { top: t11 + s17 - r8.top, left: e16 + s17 - r8.left } : "top-center" === n18 ? { bottom: a10 + s17 - r8.bottom, left: e16 - l14 - r8.left } : void 0;
  }
  _calculatePositionStyle(e16, t11) {
    const { dockEnabled: i12, view: o7 } = this;
    if (!o7) return;
    if (i12) return { left: "", top: "", right: "", bottom: "" };
    if (null == e16 || !t11) return;
    const n18 = this._calculateFullWidth(t11), s17 = this._calculateAlignmentPosition(e16.x, e16.y, o7, n18);
    return s17 ? { top: void 0 !== s17.top ? `${s17.top}px` : "auto", left: void 0 !== s17.left ? `${s17.left}px` : "auto", bottom: void 0 !== s17.bottom ? `${s17.bottom}px` : "auto", right: void 0 !== s17.right ? `${s17.right}px` : "auto" } : void 0;
  }
  _viewChange(e16, t11) {
    e16 && t11 && (this.close(), this.clear());
  }
  _viewReadyChange(e16, t11) {
    e16 ? this._wireUpView() : t11 && (this.close(), this.clear());
  }
  _wireUpView() {
    this._setDockEnabledForViewSize(this.dockOptions);
  }
  _dockingThresholdCrossed(e16, t11, i12) {
    const [o7, n18] = e16, [s17, r8] = t11, { width: l14 = 0, height: a10 = 0 } = i12 ?? {};
    return o7 <= l14 && s17 > l14 || o7 > l14 && s17 <= l14 || n18 <= a10 && r8 > a10 || n18 > a10 && r8 <= a10;
  }
  _updateDockEnabledForViewSize(e16, t11) {
    var _a, _b;
    if (!e16 || !t11) return;
    const i12 = ((_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.padding) || { left: 0, right: 0, top: 0, bottom: 0 }, o7 = i12.left + i12.right, n18 = i12.top + i12.bottom, s17 = [], r8 = [];
    s17[0] = e16[0] - o7, s17[1] = e16[1] - n18, r8[0] = t11[0] - o7, r8[1] = t11[1] - n18;
    const { dockOptions: l14 } = this, a10 = l14.breakpoint;
    this._dockingThresholdCrossed(s17, r8, a10) && this._setDockEnabledForViewSize(l14), this._setCurrentDockPosition();
  }
  _toggleScreenLocationEnabled() {
    const { dockEnabled: e16, viewModel: t11 } = this;
    if (!t11) return;
    const i12 = t11.active && !e16;
    t11.screenLocationEnabled = i12;
  }
  _shouldDockAtCurrentViewSize(e16) {
    var _a, _b;
    const t11 = e16.breakpoint, i12 = (_b = (_a = this.viewModel) == null ? void 0 : _a.view) == null ? void 0 : _b.ui;
    if (!i12) return false;
    const { width: o7, height: n18 } = i12;
    if (isNaN(o7) || isNaN(n18)) return false;
    if (!t11) return false;
    const s17 = t11.hasOwnProperty("width") && o7 <= (t11.width ?? 0), r8 = t11.hasOwnProperty("height") && n18 <= (t11.height ?? 0);
    return s17 || r8;
  }
  _setDockEnabledForViewSize(e16) {
    e16.breakpoint && (this.dockEnabled = this._shouldDockAtCurrentViewSize(e16));
  }
};
e([y({ readOnly: true })], E7.prototype, "_featureNavigationTop", null), e([y()], E7.prototype, "actions", null), e([y({ readOnly: true })], E7.prototype, "active", null), e([y()], E7.prototype, "alignment", void 0), e([y()], E7.prototype, "autoCloseEnabled", null), e([y()], E7.prototype, "defaultPopupTemplateEnabled", null), e([y()], E7.prototype, "content", null), e([y()], E7.prototype, "collapsed", null), e([y()], E7.prototype, "collapseEnabled", null), e([y({ readOnly: true })], E7.prototype, "currentAlignment", null), e([y({ readOnly: true })], E7.prototype, "currentDockPosition", null), e([y()], E7.prototype, "dockOptions", null), e([y()], E7.prototype, "dockEnabled", void 0), e([y({ readOnly: true })], E7.prototype, "featureCount", null), e([y()], E7.prototype, "featureMenuOpen", null), e([y()], E7.prototype, "features", null), e([y()], E7.prototype, "goToOverride", null), e([y()], E7.prototype, "headingLevel", void 0), e([y()], E7.prototype, "highlightEnabled", null), e([y()], E7.prototype, "icon", null), e([y()], E7.prototype, "location", null), e([y()], E7.prototype, "label", null), e([y(), e2("esri/widgets/Popup/t9n/Popup")], E7.prototype, "messages", void 0), e([y()], E7.prototype, "promises", null), e([y({ readOnly: true })], E7.prototype, "selectedFeature", null), e([y()], E7.prototype, "selectedFeatureIndex", null), e([y({ readOnly: true })], E7.prototype, "selectedFeatureWidget", null), e([y()], E7.prototype, "spinnerEnabled", null), e([y()], E7.prototype, "title", null), e([y()], E7.prototype, "updateLocationEnabled", null), e([y()], E7.prototype, "view", null), e([y({ type: t10 }), e9(["triggerAction", "trigger-action"])], E7.prototype, "viewModel", void 0), e([y()], E7.prototype, "visible", null), e([y({ type: p13, nonNullable: true })], E7.prototype, "visibleElements", void 0), E7 = e([a("esri.widgets.Popup")], E7);
var k7 = E7;
export {
  k7 as default
};
//# sourceMappingURL=Popup-CMP3KBPS.js.map
