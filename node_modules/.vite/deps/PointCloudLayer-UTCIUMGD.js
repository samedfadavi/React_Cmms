import {
  C,
  L
} from "./chunk-7VIMGDT3.js";
import {
  $,
  Z,
  w
} from "./chunk-2RXPQJAL.js";
import {
  a as a4,
  a2 as a5,
  a3 as a6,
  d as d2
} from "./chunk-GX7Z7IQT.js";
import "./chunk-OXBW45CN.js";
import "./chunk-UPDXKN2W.js";
import "./chunk-LAB5SETU.js";
import "./chunk-7W2VQZZM.js";
import "./chunk-XPEOBWSB.js";
import "./chunk-PYM2YVDF.js";
import "./chunk-JSJ34DFQ.js";
import {
  i
} from "./chunk-NGPLQQSE.js";
import {
  l
} from "./chunk-HN3UL7DT.js";
import {
  s as s3
} from "./chunk-AMKKU676.js";
import {
  p
} from "./chunk-FTURJXD3.js";
import {
  e as e3
} from "./chunk-TJWXOPWU.js";
import "./chunk-6QBE4YDH.js";
import "./chunk-LXDJBJSP.js";
import {
  j
} from "./chunk-5LNCGIUN.js";
import {
  t
} from "./chunk-HNXXFTFZ.js";
import {
  b
} from "./chunk-KVPS4KFB.js";
import {
  d,
  s as s2,
  y as y3
} from "./chunk-NSXZC33R.js";
import {
  S
} from "./chunk-E7HFITKU.js";
import "./chunk-ZFQCSBZ4.js";
import "./chunk-4PAHN45R.js";
import "./chunk-G5U2OA3R.js";
import "./chunk-7TO4QD67.js";
import "./chunk-DZNQTDMC.js";
import "./chunk-RM4VMFVT.js";
import {
  y as y2
} from "./chunk-TXIL3QUC.js";
import "./chunk-2ASAB4KA.js";
import {
  f as f2
} from "./chunk-EA74CF7B.js";
import "./chunk-IGNUVZ34.js";
import "./chunk-TQBRYTUC.js";
import "./chunk-OHUWK5XV.js";
import "./chunk-PHVKM5OH.js";
import "./chunk-KQ5GHUVQ.js";
import "./chunk-RTULPMO3.js";
import "./chunk-AJ6PR43V.js";
import "./chunk-6LV4OO46.js";
import "./chunk-ZK2DM5OJ.js";
import {
  i4 as i2,
  k
} from "./chunk-IJUFAIOF.js";
import "./chunk-MNMU4ARP.js";
import "./chunk-4AGGGL2W.js";
import "./chunk-FJPG3YI6.js";
import "./chunk-E5KBRIJQ.js";
import {
  o as o2
} from "./chunk-Z32PAECZ.js";
import "./chunk-CAC7FEOV.js";
import "./chunk-KK4UI5LV.js";
import "./chunk-Q4D7WYWB.js";
import "./chunk-NYWHVRZC.js";
import "./chunk-ZH4RVBER.js";
import "./chunk-UGXIDNPX.js";
import "./chunk-FADA7L64.js";
import "./chunk-YTTIKQNA.js";
import "./chunk-PNUUOKAJ.js";
import "./chunk-4K4GIBGP.js";
import "./chunk-WMMHQ2SA.js";
import "./chunk-AZ7WOCBW.js";
import "./chunk-3DBICPHD.js";
import "./chunk-7R5XEKR3.js";
import "./chunk-ZK4LSXOH.js";
import "./chunk-XFBTC3BA.js";
import "./chunk-XFU3BDEI.js";
import "./chunk-IZXTMJPP.js";
import "./chunk-5MMVRBZL.js";
import "./chunk-RS5OZZZ5.js";
import "./chunk-VRHSV3YE.js";
import "./chunk-OVORXUCO.js";
import "./chunk-WLUQPLAY.js";
import "./chunk-BTSZKQPH.js";
import "./chunk-AL3F322A.js";
import "./chunk-6N5YXCNN.js";
import "./chunk-MJ2NSPP7.js";
import "./chunk-6YSPJNLC.js";
import "./chunk-66KCMKB5.js";
import {
  o
} from "./chunk-ZART2Y5J.js";
import {
  r
} from "./chunk-F4OBDVPS.js";
import "./chunk-X3IFQMC4.js";
import "./chunk-4ZEH5SNV.js";
import "./chunk-Z6R2SP3D.js";
import "./chunk-K4UOG562.js";
import {
  U,
  V
} from "./chunk-WC4SPMPL.js";
import {
  f2 as f,
  y
} from "./chunk-TJUEGVVG.js";
import "./chunk-FXNOKZ3B.js";
import {
  N,
  a3 as a2
} from "./chunk-GEH2VXFC.js";
import {
  e
} from "./chunk-BJY5ADVY.js";
import {
  a as a3
} from "./chunk-VMWKLHJD.js";
import "./chunk-5AEITAWU.js";
import "./chunk-G36SOMYZ.js";
import {
  a,
  e as e2,
  n2 as n,
  s2 as s
} from "./chunk-YNL57W4I.js";
import "./chunk-2PA5UPTB.js";
import "./chunk-XZXEUADC.js";

// ../node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudFilter.js
var t2 = class extends f {
  constructor(o3) {
    super(o3), this.field = null, this.type = null;
  }
  clone() {
    return console.warn(".clone() is not implemented for " + this.declaredClass), null;
  }
};
e([y({ type: String, json: { write: { enabled: true, isRequired: true } } })], t2.prototype, "field", void 0), e([y({ readOnly: true, nonNullable: true, json: { read: false } })], t2.prototype, "type", void 0), t2 = e([a2("esri.layers.pointCloudFilters.PointCloudFilter")], t2);
var l2 = t2;

// ../node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudBitfieldFilter.js
var d3;
var p2 = d3 = class extends l2 {
  constructor(e5) {
    super(e5), this.requiredClearBits = null, this.requiredSetBits = null, this.type = "bitfield";
  }
  clone() {
    return new d3({ field: this.field, requiredClearBits: a(this.requiredClearBits), requiredSetBits: a(this.requiredSetBits) });
  }
};
e([y({ type: [N], json: { write: { enabled: true, overridePolicy() {
  return { enabled: true, isRequired: !this.requiredSetBits };
} } } })], p2.prototype, "requiredClearBits", void 0), e([y({ type: [N], json: { write: { enabled: true, overridePolicy() {
  return { enabled: true, isRequired: !this.requiredClearBits };
} } } })], p2.prototype, "requiredSetBits", void 0), e([o2({ pointCloudBitfieldFilter: "bitfield" })], p2.prototype, "type", void 0), p2 = d3 = e([a2("esri.layers.pointCloudFilters.PointCloudBitfieldFilter")], p2);
var u = p2;

// ../node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudReturnFilter.js
var n2;
var p3 = n2 = class extends l2 {
  constructor(r2) {
    super(r2), this.includedReturns = [], this.type = "return";
  }
  clone() {
    return new n2({ field: this.field, includedReturns: a(this.includedReturns) });
  }
};
e([y({ type: [["firstOfMany", "last", "lastOfMany", "single"]], json: { write: { enabled: true, isRequired: true } } })], p3.prototype, "includedReturns", void 0), e([o2({ pointCloudReturnFilter: "return" })], p3.prototype, "type", void 0), p3 = n2 = e([a2("esri.layers.pointCloudFilters.PointCloudReturnFilter")], p3);
var u2 = p3;

// ../node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudValueFilter.js
var l3;
var p4 = l3 = class extends l2 {
  constructor(e5) {
    super(e5), this.mode = "exclude", this.type = "value", this.values = [];
  }
  clone() {
    return new l3({ field: this.field, mode: this.mode, values: a(this.values) });
  }
};
e([y({ type: ["exclude", "include"], json: { write: { enabled: true, isRequired: true } } })], p4.prototype, "mode", void 0), e([o2({ pointCloudValueFilter: "value" })], p4.prototype, "type", void 0), e([y({ type: [Number], json: { write: { enabled: true, isRequired: true } } })], p4.prototype, "values", void 0), p4 = l3 = e([a2("esri.layers.pointCloudFilters.PointCloudValueFilter")], p4);
var u3 = p4;

// ../node_modules/@arcgis/core/layers/pointCloudFilters/typeUtils.js
var e4 = { key: "type", base: l2, typeMap: { value: u3, bitfield: u, return: u2 } };

// ../node_modules/@arcgis/core/renderers/PointCloudRGBRenderer.js
var p5;
var c = p5 = class extends a4 {
  constructor(r2) {
    super(r2), this.type = "point-cloud-rgb", this.field = null;
  }
  clone() {
    return new p5({ ...this.cloneProperties(), field: a(this.field) });
  }
};
e([o2({ pointCloudRGBRenderer: "point-cloud-rgb" })], c.prototype, "type", void 0), e([y({ type: String, json: { write: true } })], c.prototype, "field", void 0), c = p5 = e([a2("esri.renderers.PointCloudRGBRenderer")], c);
var n3 = c;

// ../node_modules/@arcgis/core/renderers/support/pointCloud/typeUtils.js
var i3 = { key: "type", base: a4, typeMap: { "point-cloud-class-breaks": d2, "point-cloud-rgb": n3, "point-cloud-stretch": a5, "point-cloud-unique-value": a6 }, errorContext: "renderer" };

// ../node_modules/@arcgis/core/layers/PointCloudLayer.js
var O = s3();
var V2 = class extends L(l(b(j(t(S(e3(i(f2)))))))) {
  constructor(...e5) {
    super(...e5), this.operationalLayerType = "PointCloudLayer", this.popupEnabled = true, this.popupTemplate = null, this.opacity = 1, this.filters = [], this.fields = null, this.fieldsIndex = null, this.outFields = null, this.path = null, this.legendEnabled = true, this.renderer = null, this.type = "point-cloud";
  }
  normalizeCtorArgs(e5, r2) {
    return "string" == typeof e5 ? { url: e5, ...r2 } : e5;
  }
  get defaultPopupTemplate() {
    return this.attributeStorageInfo ? this.createPopupTemplate() : null;
  }
  getFieldDomain(e5) {
    const r2 = this.fieldsIndex.get(e5);
    return (r2 == null ? void 0 : r2.domain) ? r2.domain : null;
  }
  readServiceFields(e5, r2, t3) {
    return Array.isArray(e5) ? e5.map((e6) => {
      const r3 = new y2();
      return "FieldTypeInteger" === e6.type && ((e6 = a(e6)).type = "esriFieldTypeInteger"), r3.read(e6, t3), r3;
    }) : Array.isArray(r2.attributeStorageInfo) ? r2.attributeStorageInfo.map((e6) => new y2({ name: e6.name, type: "ELEVATION" === e6.name ? "double" : "integer" })) : null;
  }
  set elevationInfo(e5) {
    this._set("elevationInfo", e5), this._validateElevationInfo();
  }
  writeRenderer(e5, r2, t3, o3) {
    e2("layerDefinition.drawingInfo.renderer", e5.write({}, o3), r2);
  }
  load(e5) {
    const r2 = null != e5 ? e5.signal : null, t3 = this.loadFromPortal({ supportedTypes: ["Scene Service"] }, e5).catch(a3).then(() => this._fetchService(r2));
    return this.addResolvingPromise(t3), Promise.resolve(this);
  }
  createPopupTemplate(e5) {
    const r2 = p(this, e5);
    return r2 && (this._formatPopupTemplateReturnsField(r2), this._formatPopupTemplateRGBField(r2)), r2;
  }
  _formatPopupTemplateReturnsField(e5) {
    var _a;
    const r2 = this.fieldsIndex.get("RETURNS");
    if (!r2) return;
    const t3 = (_a = e5.fieldInfos) == null ? void 0 : _a.find((e6) => e6.fieldName === r2.name);
    if (!t3) return;
    const o3 = new i2({ name: "pcl-returns-decoded", title: r2.alias || r2.name, expression: `
        var returnValue = $feature.${r2.name};
        return (returnValue % 16) + " / " + Floor(returnValue / 16);
      ` });
    e5.expressionInfos = [...e5.expressionInfos || [], o3], t3.fieldName = "expression/pcl-returns-decoded";
  }
  _formatPopupTemplateRGBField(e5) {
    var _a;
    const r2 = this.fieldsIndex.get("RGB");
    if (!r2) return;
    const t3 = (_a = e5.fieldInfos) == null ? void 0 : _a.find((e6) => e6.fieldName === r2.name);
    if (!t3) return;
    const o3 = new i2({ name: "pcl-rgb-decoded", title: r2.alias || r2.name, expression: `
        var rgb = $feature.${r2.name};
        var red = Floor(rgb / 65536, 0);
        var green = Floor((rgb - (red * 65536)) / 256,0);
        var blue = rgb - (red * 65536) - (green * 256);

        return "rgb(" + red + "," + green + "," + blue + ")";
      ` });
    e5.expressionInfos = [...e5.expressionInfos || [], o3], t3.fieldName = "expression/pcl-rgb-decoded";
  }
  async queryCachedStatistics(e5, r2) {
    var _a;
    if (await this.load(r2), !this.attributeStorageInfo) throw new s("scenelayer:no-cached-statistics", "Cached statistics are not available for this layer");
    const i4 = this.fieldsIndex.get(e5);
    if (!i4) throw new s("pointcloudlayer:field-unexisting", `Field '${e5}' does not exist on the layer`);
    for (const o3 of this.attributeStorageInfo) if (o3.name === i4.name) {
      const e6 = V(((_a = this.parsedUrl) == null ? void 0 : _a.path) ?? "", `./statistics/${o3.key}`);
      return U(e6, { query: { f: "json", ...this.customParameters, token: this.apiKey }, responseType: "json", signal: r2 ? r2.signal : null }).then((e7) => e7.data);
    }
    throw new s("pointcloudlayer:no-cached-statistics", "Cached statistics for this attribute are not available");
  }
  async saveAs(e5, r2) {
    return this._debouncedSaveOperations(C.SAVE_AS, { ...r2, getTypeKeywords: () => this._getTypeKeywords(), portalItemLayerType: "point-cloud" }, e5);
  }
  async save() {
    const e5 = { getTypeKeywords: () => this._getTypeKeywords(), portalItemLayerType: "point-cloud" };
    return this._debouncedSaveOperations(C.SAVE, e5);
  }
  validateLayer(e5) {
    if (e5.layerType && "PointCloud" !== e5.layerType) throw new s("pointcloudlayer:layer-type-not-supported", "PointCloudLayer does not support this layer type", { layerType: e5.layerType });
    if (isNaN(this.version.major) || isNaN(this.version.minor)) throw new s("layer:service-version-not-supported", "Service version is not supported.", { serviceVersion: this.version.versionString, supportedVersions: "1.x-2.x" });
    if (this.version.major > 2) throw new s("layer:service-version-too-new", "Service version is too new.", { serviceVersion: this.version.versionString, supportedVersions: "1.x-2.x" });
  }
  hasCachedStatistics(e5) {
    return null != this.attributeStorageInfo && this.attributeStorageInfo.some((r2) => r2.name === e5);
  }
  _getTypeKeywords() {
    return ["PointCloud"];
  }
  _validateElevationInfo() {
    const e5 = this.elevationInfo;
    $(n.getLogger(this), Z("Point cloud layers", "absolute-height", e5)), $(n.getLogger(this), w("Point cloud layers", e5));
  }
};
e([y({ type: ["PointCloudLayer"] })], V2.prototype, "operationalLayerType", void 0), e([y(s2)], V2.prototype, "popupEnabled", void 0), e([y({ type: k, json: { name: "popupInfo", write: true } })], V2.prototype, "popupTemplate", void 0), e([y({ readOnly: true, json: { read: false } })], V2.prototype, "defaultPopupTemplate", null), e([y({ readOnly: true, json: { write: false, read: false, origins: { "web-document": { write: false, read: false } } } })], V2.prototype, "opacity", void 0), e([y({ type: ["show", "hide"] })], V2.prototype, "listMode", void 0), e([y({ types: [e4], json: { origins: { service: { read: { source: "filters" } } }, name: "layerDefinition.filters", write: true } })], V2.prototype, "filters", void 0), e([y({ type: [y2] })], V2.prototype, "fields", void 0), e([y(O.fieldsIndex)], V2.prototype, "fieldsIndex", void 0), e([o("service", "fields", ["fields", "attributeStorageInfo"])], V2.prototype, "readServiceFields", null), e([y(O.outFields)], V2.prototype, "outFields", void 0), e([y({ readOnly: true })], V2.prototype, "attributeStorageInfo", void 0), e([y(d)], V2.prototype, "elevationInfo", null), e([y({ type: String, json: { origins: { "web-scene": { read: true, write: true }, "portal-item": { read: true, write: true } }, read: false } })], V2.prototype, "path", void 0), e([y(y3)], V2.prototype, "legendEnabled", void 0), e([y({ types: i3, json: { origins: { service: { read: { source: "drawingInfo.renderer" } } }, name: "layerDefinition.drawingInfo.renderer", write: { target: { "layerDefinition.drawingInfo.renderer": { types: i3 }, "layerDefinition.drawingInfo.transparency": { type: Number } } } } })], V2.prototype, "renderer", void 0), e([r("renderer")], V2.prototype, "writeRenderer", null), e([y({ json: { read: false }, readOnly: true })], V2.prototype, "type", void 0), V2 = e([a2("esri.layers.PointCloudLayer")], V2);
var U2 = V2;
export {
  U2 as default
};
//# sourceMappingURL=PointCloudLayer-UTCIUMGD.js.map
