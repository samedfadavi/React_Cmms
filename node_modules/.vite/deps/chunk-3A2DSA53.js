import {
  H
} from "./chunk-U23SDH2H.js";
import {
  e as e4
} from "./chunk-NSJBY6SI.js";
import {
  t as t2
} from "./chunk-LXZ5X57H.js";
import {
  C
} from "./chunk-POOHJZAR.js";
import {
  e as e3
} from "./chunk-RRSX64BO.js";
import {
  e as e2,
  h,
  m
} from "./chunk-6N5YXCNN.js";
import {
  J,
  P,
  _2 as _,
  e2 as e,
  n,
  o,
  r2 as r,
  u,
  x,
  z
} from "./chunk-MJ2NSPP7.js";
import {
  l
} from "./chunk-G36SOMYZ.js";
import {
  t
} from "./chunk-2PA5UPTB.js";

// ../node_modules/@arcgis/core/views/3d/support/buffer/glUtil.js
function t3(e5, t6 = 0) {
  const n3 = e5.stride;
  return Array.from(e5.fields.keys()).map((s3) => {
    var _a;
    const i2 = e5.fields.get(s3), u4 = i2.constructor.ElementCount, f4 = o2(i2.constructor.ElementType), c2 = i2.offset, m5 = ((_a = i2.optional) == null ? void 0 : _a.glNormalized) ?? false;
    return new t2(s3, u4, f4, c2, n3, m5, t6);
  });
}
function o2(e5) {
  const r3 = n2[e5];
  if (r3) return r3;
  throw new Error("BufferType not supported in WebGL");
}
var n2 = { u8: C.UNSIGNED_BYTE, u16: C.UNSIGNED_SHORT, u32: C.UNSIGNED_INT, i8: C.BYTE, i16: C.SHORT, i32: C.INT, f32: C.FLOAT };

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts.js
var E = H().vec3f(e3.POSITION).u16(e3.COMPONENTINDEX).freeze();
var I = H().vec2u8(e3.SIDENESS).freeze();
var S = t3(I);
var T = H().vec3f(e3.POSITION0).vec3f(e3.POSITION1).vec2i16(e3.NORMALCOMPRESSED).u16(e3.COMPONENTINDEX).u8(e3.VARIANTOFFSET, { glNormalized: true }).u8(e3.VARIANTSTROKE).u8(e3.VARIANTEXTENSION, { glNormalized: true }).freeze();
var A = H().vec3f(e3.POSITION0).vec3f(e3.POSITION1).vec2i16(e3.NORMALCOMPRESSED).vec2i16(e3.NORMAL2COMPRESSED).u16(e3.COMPONENTINDEX).u8(e3.VARIANTOFFSET, { glNormalized: true }).u8(e3.VARIANTSTROKE).u8(e3.VARIANTEXTENSION, { glNormalized: true }).freeze();
var r2 = /* @__PURE__ */ new Map([[e3.POSITION0, 0], [e3.POSITION1, 1], [e3.COMPONENTINDEX, 2], [e3.VARIANTOFFSET, 3], [e3.VARIANTSTROKE, 4], [e3.VARIANTEXTENSION, 5], [e3.NORMALCOMPRESSED, 6], [e3.NORMAL2COMPRESSED, 7], [e3.SIDENESS, 8]]);

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/Edge.js
var s = class {
  constructor() {
    this.position0 = n(), this.position1 = n(), this.faceNormal0 = n(), this.faceNormal1 = n(), this.componentIndex = 0, this.cosAngle = 0;
  }
};

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing.js
var d = -1;
function p(e5, t6, o3) {
  const c2 = e5.vertices.position, l3 = e5.vertices.componentIndex, i2 = j.position0, h3 = j.position1, g3 = j.faceNormal0, u4 = j.faceNormal1, { edges: p4, normals: v2 } = w(e5), V2 = p4.length / 4, y3 = t6.allocate(V2);
  let I3 = 0;
  const N3 = V2, b2 = o3 == null ? void 0 : o3.allocate(N3);
  let E3 = 0, D2 = 0, k2 = 0;
  x2.length = 0;
  for (let s3 = 0; s3 < V2; ++s3) {
    const e6 = 4 * s3;
    c2.getVec(p4.data[e6], i2), c2.getVec(p4.data[e6 + 1], h3);
    const t7 = x2.pushNew();
    t7.index = 4 * s3, t7.length = x(i2, h3);
  }
  x2.sort((e6, t7) => t7.length - e6.length);
  const P2 = new Array(), U = new Array();
  x2.forAll(({ length: e6, index: n3 }) => {
    const w3 = p4.data[n3], x3 = p4.data[n3 + 1], V3 = p4.data[n3 + 2], N4 = p4.data[n3 + 3], q2 = N4 === d;
    if (c2.getVec(w3, i2), c2.getVec(x3, h3), q2) {
      const e7 = 3 * V3;
      o(g3, v2.data[e7], v2.data[e7 + 1], v2.data[e7 + 2]), r(u4, g3), j.componentIndex = l3.get(w3), j.cosAngle = P(g3, u4);
    } else {
      let e7 = 3 * V3;
      if (o(g3, v2.data[e7], v2.data[e7 + 1], v2.data[e7 + 2]), e7 = 3 * N4, o(u4, v2.data[e7], v2.data[e7 + 1], v2.data[e7 + 2]), j.componentIndex = l3.get(w3), j.cosAngle = P(g3, u4), m2(j, M)) return;
      j.cosAngle < -0.9999 && r(u4, g3);
    }
    D2 += e6, k2++, q2 || f(j, L) ? (t6.write(y3, I3++, j), P2.push(e6)) : A2(j, F) && (b2 && o3 && o3.write(b2, E3++, j), U.push(e6));
  });
  const q = new Float32Array(P2.reverse()), z2 = new Float32Array(U.reverse()), B2 = b2 && o3 ? { instancesData: b2.slice(0, E3), lodInfo: { lengths: z2 } } : void 0;
  return { regular: { instancesData: y3.slice(0, I3), lodInfo: { lengths: q } }, silhouette: B2, averageEdgeLength: D2 / k2 };
}
function f(e5, t6) {
  return e5.cosAngle < t6;
}
function m2(e5, t6) {
  return e5.cosAngle > t6;
}
function A2(t6, o3) {
  const n3 = m(t6.cosAngle);
  J(N, t6.position1, t6.position0);
  return n3 * (P(_(I2, t6.faceNormal0, t6.faceNormal1), N) > 0 ? -1 : 1) > o3;
}
function w(e5) {
  const t6 = e5.faces.length / 3, o3 = e5.faces, n3 = e5.neighbors, s3 = e5.vertices.position;
  V.length = y.length = 0;
  for (let a2 = 0; a2 < t6; a2++) {
    const e6 = 3 * a2, t7 = n3[e6], r3 = n3[e6 + 1], c2 = n3[e6 + 2], g3 = o3[e6], u4 = o3[e6 + 1], p4 = o3[e6 + 2];
    s3.getVec(g3, b), s3.getVec(u4, E2), s3.getVec(p4, D), e(E2, E2, b), e(D, D, b), _(b, E2, D), z(b, b), y.pushArray(b), (t7 === d || g3 < u4) && (V.push(g3), V.push(u4), V.push(a2), V.push(t7)), (r3 === d || u4 < p4) && (V.push(u4), V.push(p4), V.push(a2), V.push(r3)), (c2 === d || p4 < g3) && (V.push(p4), V.push(g3), V.push(a2), V.push(c2));
  }
  return { edges: V, normals: y };
}
var v = class {
  constructor() {
    this.index = 0, this.length = 0;
  }
};
var x2 = new l({ allocator: (e5) => e5 || new v(), deallocator: null });
var V = new l({ deallocator: null });
var y = new l({ deallocator: null });
var j = new s();
var I2 = n();
var N = n();
var b = n();
var E2 = n();
var D = n();
var F = h(4);
var M = Math.cos(F);
var k = h(35);
var L = Math.cos(k);

// ../node_modules/@arcgis/core/views/3d/support/meshProcessing.js
function t4(t6, o3, n3) {
  const r3 = o3 / 3, c2 = new Uint32Array(n3 + 1), e5 = new Uint32Array(n3 + 1), s3 = (t7, o4) => {
    t7 < o4 ? c2[t7 + 1]++ : e5[o4 + 1]++;
  };
  for (let x3 = 0; x3 < r3; x3++) {
    const o4 = t6[3 * x3], n4 = t6[3 * x3 + 1], r4 = t6[3 * x3 + 2];
    s3(o4, n4), s3(n4, r4), s3(r4, o4);
  }
  let f4 = 0, l3 = 0;
  for (let x3 = 0; x3 < n3; x3++) {
    const t7 = c2[x3 + 1], o4 = e5[x3 + 1];
    c2[x3 + 1] = f4, e5[x3 + 1] = l3, f4 += t7, l3 += o4;
  }
  const i2 = new Uint32Array(6 * r3), a2 = c2[n3], w3 = (t7, o4, n4) => {
    if (t7 < o4) {
      const r4 = c2[t7 + 1]++;
      i2[2 * r4] = o4, i2[2 * r4 + 1] = n4;
    } else {
      const r4 = e5[o4 + 1]++;
      i2[2 * a2 + 2 * r4] = t7, i2[2 * a2 + 2 * r4 + 1] = n4;
    }
  };
  for (let x3 = 0; x3 < r3; x3++) {
    const o4 = t6[3 * x3], n4 = t6[3 * x3 + 1], r4 = t6[3 * x3 + 2];
    w3(o4, n4, x3), w3(n4, r4, x3), w3(r4, o4, x3);
  }
  const y3 = (t7, o4) => {
    const n4 = 2 * t7, r4 = o4 - t7;
    for (let c3 = 1; c3 < r4; c3++) {
      const t8 = i2[n4 + 2 * c3], o5 = i2[n4 + 2 * c3 + 1];
      let r5 = c3 - 1;
      for (; r5 >= 0 && i2[n4 + 2 * r5] > t8; r5--) i2[n4 + 2 * r5 + 2] = i2[n4 + 2 * r5], i2[n4 + 2 * r5 + 3] = i2[n4 + 2 * r5 + 1];
      i2[n4 + 2 * r5 + 2] = t8, i2[n4 + 2 * r5 + 3] = o5;
    }
  };
  for (let x3 = 0; x3 < n3; x3++) y3(c2[x3], c2[x3 + 1]), y3(a2 + e5[x3], a2 + e5[x3 + 1]);
  const A3 = new Int32Array(3 * r3), U = (o4, n4) => o4 === t6[3 * n4] ? 0 : o4 === t6[3 * n4 + 1] ? 1 : o4 === t6[3 * n4 + 2] ? 2 : -1, u4 = (t7, o4) => {
    const n4 = U(t7, o4);
    A3[3 * o4 + n4] = -1;
  }, p4 = (t7, o4, n4, r4) => {
    const c3 = U(t7, o4);
    A3[3 * o4 + c3] = r4;
    const e6 = U(n4, r4);
    A3[3 * r4 + e6] = o4;
  };
  for (let x3 = 0; x3 < n3; x3++) {
    let t7 = c2[x3];
    const o4 = c2[x3 + 1];
    let n4 = e5[x3];
    const r4 = e5[x3 + 1];
    for (; t7 < o4 && n4 < r4; ) {
      const o5 = i2[2 * t7], r5 = i2[2 * a2 + 2 * n4];
      o5 === r5 ? (p4(x3, i2[2 * t7 + 1], r5, i2[2 * a2 + 2 * n4 + 1]), t7++, n4++) : o5 < r5 ? (u4(x3, i2[2 * t7 + 1]), t7++) : (u4(r5, i2[2 * a2 + 2 * n4 + 1]), n4++);
    }
    for (; t7 < o4; ) u4(x3, i2[2 * t7 + 1]), t7++;
    for (; n4 < r4; ) {
      u4(i2[2 * a2 + 2 * n4], i2[2 * a2 + 2 * n4 + 1]), n4++;
    }
  }
  return A3;
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Normals.js
function s2(t6, n3, r3, o3, a2, s3 = 2) {
  const e5 = 1 / (Math.abs(r3) + Math.abs(o3) + Math.abs(a2)), c2 = r3 * e5, f4 = o3 * e5, h3 = a2 <= 0 ? (c2 >= 0 ? 1 : -1) * (1 - Math.abs(f4)) : c2, u4 = a2 <= 0 ? (f4 >= 0 ? 1 : -1) * (1 - Math.abs(c2)) : f4, l3 = n3 * s3;
  t6[l3] = i(h3), t6[l3 + 1] = i(u4);
}
function i(n3) {
  return e2(Math.round(32767 * n3), -32767, 32767);
}

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters.js
var c = 0.7;
var f2 = class {
  updateSettings(t6) {
    this.settings = t6, this._edgeHashFunction = t6.reducedPrecision ? d2 : l2;
  }
  write(t6, o3, e5) {
    B.seed = this._edgeHashFunction(e5);
    const r3 = B.getIntRange(0, 255), n3 = B.getIntRange(0, this.settings.variants - 1), i2 = B.getFloat(), s3 = 255 * (0.5 * y2(-(1 - Math.min(i2 / c, 1)) + Math.max(0, i2 - c) / (1 - c), 1.2) + 0.5);
    t6.position0.setVec(o3, e5.position0), t6.position1.setVec(o3, e5.position1), t6.componentIndex.set(o3, e5.componentIndex), t6.variantOffset.set(o3, r3), t6.variantStroke.set(o3, n3), t6.variantExtension.set(o3, s3);
  }
};
var m3 = new Float32Array(6);
var p2 = new Uint32Array(m3.buffer);
var u2 = new Uint32Array(1);
function l2(t6) {
  return m3[0] = t6.position0[0], m3[1] = t6.position0[1], m3[2] = t6.position0[2], m3[3] = t6.position1[0], m3[4] = t6.position1[1], m3[5] = t6.position1[2], u2[0] = 31 * (31 * (31 * (31 * (31 * (166811 + p2[0]) + p2[1]) + p2[2]) + p2[3]) + p2[4]) + p2[5], u2[0];
}
function d2(t6) {
  const o3 = m3;
  o3[0] = h2(t6.position0[0]), o3[1] = h2(t6.position0[1]), o3[2] = h2(t6.position0[2]), o3[3] = h2(t6.position1[0]), o3[4] = h2(t6.position1[1]), o3[5] = h2(t6.position1[2]), u2[0] = 5381;
  for (let e5 = 0; e5 < p2.length; e5++) u2[0] = 31 * u2[0] + p2[e5];
  return u2[0];
}
var g = 1e4;
function h2(t6) {
  return Math.round(t6 * g) / g;
}
function y2(t6, o3) {
  return Math.abs(t6) ** o3 * Math.sign(t6);
}
var w2 = class {
  constructor() {
    this._commonWriter = new f2();
  }
  updateSettings(t6) {
    this._commonWriter.updateSettings(t6);
  }
  allocate(t6) {
    return T.createBuffer(t6);
  }
  write(t6, r3, n3) {
    this._commonWriter.write(t6, r3, n3), u(S3, n3.faceNormal0, n3.faceNormal1), z(S3, S3);
    const { typedBuffer: s3, typedBufferStride: a2 } = t6.normalCompressed;
    s2(s3, r3, S3[0], S3[1], S3[2], a2);
  }
};
w2.Layout = T, w2.glLayout = t3(T, 1);
var N2 = class {
  constructor() {
    this._commonWriter = new f2();
  }
  updateSettings(t6) {
    this._commonWriter.updateSettings(t6);
  }
  allocate(t6) {
    return A.createBuffer(t6);
  }
  write(t6, o3, e5) {
    this._commonWriter.write(t6, o3, e5);
    {
      const { typedBuffer: r3, typedBufferStride: n3 } = t6.normalCompressed;
      s2(r3, o3, e5.faceNormal0[0], e5.faceNormal0[1], e5.faceNormal0[2], n3);
    }
    {
      const { typedBuffer: r3, typedBufferStride: n3 } = t6.normal2Compressed;
      s2(r3, o3, e5.faceNormal1[0], e5.faceNormal1[1], e5.faceNormal1[2], n3);
    }
  }
};
N2.Layout = A, N2.glLayout = t3(A, 1);
var S3 = n();
var B = new t();

// ../node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing.js
function f3(e5) {
  const t6 = u3(e5.data, e5.skipDeduplicate, e5.indices, e5.indicesLength);
  return g2.updateSettings(e5.writerSettings), a.updateSettings(e5.writerSettings), p(t6, g2, a);
}
function u3(r3, i2, n3, o3) {
  if (i2) {
    const e5 = t4(n3, o3, r3.count);
    return new p3(n3, o3, e5, r3);
  }
  const c2 = e4(r3.buffer, r3.stride / 4, { originalIndices: n3, originalIndicesLength: o3 }), f4 = t4(c2.indices, o3, c2.uniqueCount);
  return { faces: c2.indices, facesLength: c2.indices.length, neighbors: f4, vertices: E.createView(c2.buffer) };
}
var p3 = class {
  constructor(e5, t6, r3, i2) {
    this.faces = e5, this.facesLength = t6, this.neighbors = r3, this.vertices = i2;
  }
};
var g2 = new w2();
var a = new N2();
var d3 = H().vec3f(e3.POSITION0).vec3f(e3.POSITION1);
var m4 = H().vec3f(e3.POSITION0).vec3f(e3.POSITION1).u16(e3.COMPONENTINDEX);

export {
  E,
  p,
  f3 as f,
  u3 as u,
  d3 as d,
  m4 as m
};
//# sourceMappingURL=chunk-3A2DSA53.js.map
