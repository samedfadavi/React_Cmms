{"version":3,"file":"index.js","sources":["../src/ElementTemplateChooser.js","../src/ElementTemplateChooserEntryProvider.js","../src/index.js"],"sourcesContent":["import './ElementTemplateChooser.css';\n\n\n/**\n * An element template chooser that hooks into\n * properties panel fired \"choose template\" events.\n *\n * @param {Object} config\n * @param {EventBus} eventBus\n * @param {ElementTemplates} elementTemplates\n * @param {Translate} translate\n * @param {PopupMenu} popupMenu\n */\nexport default function ElementTemplateChooser(\n    config,\n    eventBus,\n    elementTemplates,\n    translate,\n    popupMenu) {\n\n  this._eventBus = eventBus;\n  this._elementTemplates = elementTemplates;\n  this._translate = translate;\n  this._popupMenu = popupMenu;\n\n  const enableChooser = !config || config.elementTemplateChooser !== false;\n\n  enableChooser && eventBus.on('elementTemplates.select', (event) => {\n\n    const { element } = event;\n\n    this.open(element).then(template => {\n      elementTemplates.applyTemplate(element, template);\n    }).catch(err => {\n      if (err !== 'user-canceled') {\n        console.error('elementTemplate.select :: error', err);\n      }\n    });\n  });\n}\n\nElementTemplateChooser.$inject = [\n  'config.connectorsExtension',\n  'eventBus',\n  'elementTemplates',\n  'translate',\n  'popupMenu'\n];\n\nElementTemplateChooser.prototype.open = function(element) {\n\n  const popupMenu = this._popupMenu;\n  const translate = this._translate;\n  const eventBus = this._eventBus;\n\n  return new Promise((resolve, reject) => {\n\n    const handleClosed = () => reject('user-canceled');\n\n    eventBus.once('popupMenu.close', handleClosed);\n\n    eventBus.once('elementTemplateChooser.chosen', event => {\n\n      const { template } = event;\n\n      eventBus.off('popupMenu.close', handleClosed);\n\n      resolve(template);\n    });\n\n    popupMenu.open(element, 'element-template-chooser', { x: 0, y: 0 }, {\n      title: translate('Choose element template'),\n      search: true,\n      width: 350\n    });\n  });\n\n};","import {\n  getBusinessObject,\n  isAny\n} from 'bpmn-js/lib/util/ModelUtil';\n\n/**\n * A entry provider for the <element-template-chooser> popup menu.\n */\nexport default function ElementTemplateChooserEntryProvider(popupMenu, eventBus, translate, elementTemplates) {\n\n  this._popupMenu = popupMenu;\n  this._eventBus = eventBus;\n  this._translate = translate;\n  this._elementTemplates = elementTemplates;\n\n  this.register();\n}\n\nElementTemplateChooserEntryProvider.$inject = [\n  'popupMenu',\n  'eventBus',\n  'translate',\n  'elementTemplates'\n];\n\n/**\n * Register replace menu provider in the popup menu\n */\nElementTemplateChooserEntryProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('element-template-chooser', this);\n};\n\n/**\n * Adds the element templates to the replace menu.\n * @param {djs.model.Base} element\n *\n * @returns {Object}\n */\nElementTemplateChooserEntryProvider.prototype.getPopupMenuEntries = function(element) {\n\n  // convert to object\n  return this.getTemplateEntries(element).reduce((entries, [ key, value ]) => {\n    entries[key] = value;\n\n    return entries;\n  }, {});\n\n};\n\n/**\n * Get all element templates that can be used to replace the given element.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of element templates as menu entries\n */\nElementTemplateChooserEntryProvider.prototype.getTemplateEntries = function(element) {\n\n  const eventBus = this._eventBus;\n  const translate = this._translate;\n\n  return this._getMatchingTemplates(element).map(template => {\n\n    const {\n      icon = {},\n      category\n    } = template;\n\n    const entryId = `apply-template-${ template.id }`;\n\n    return [ entryId, {\n      label: template.name && translate(template.name),\n      description: template.description && translate(template.description),\n      documentationRef: template.documentationRef,\n      imageUrl: icon.contents,\n      group: category && { ...category, name: translate(category.name) },\n      action: () => {\n        eventBus.fire('elementTemplateChooser.chosen', { element, template });\n      }\n    } ];\n  });\n};\n\n/**\n * Returns the templates that can the element can be replaced with.\n *\n * @param  {djs.model.Base} element\n *\n * @return {Array<ElementTemplate>}\n */\nElementTemplateChooserEntryProvider.prototype._getMatchingTemplates = function(element) {\n  return this._elementTemplates.getLatest().filter(template => {\n    return isAny(element, template.appliesTo) && !isTemplateApplied(element, template);\n  });\n};\n\n\n// helpers ////////////\n\nexport function isTemplateApplied(element, template) {\n  const businessObject = getBusinessObject(element);\n\n  if (businessObject) {\n    return businessObject.get('modelerTemplate') === template.id;\n  }\n\n  return false;\n}","import ElementTemplateChooser from './ElementTemplateChooser';\nimport ElementTemplateChooserEntryProvider from './ElementTemplateChooserEntryProvider';\n\nexport default {\n  __init__: [\n    'elementTemplateChooser',\n    'elementTemplateChooserEntryProvider'\n  ],\n  elementTemplateChooser: [ 'type', ElementTemplateChooser ],\n  elementTemplateChooserEntryProvider: [ 'type', ElementTemplateChooserEntryProvider ]\n};\n"],"names":["isAny","getBusinessObject"],"mappings":"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"}